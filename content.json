{"meta":{"title":"ç»‡ç§‹ä¸ªäººåšå®¢","subtitle":"å‰¯æ ‡é¢˜","description":"åº§å³é“­","author":"solitaire-12","url":"https://solitaire-12.github.io","root":"/"},"pages":[{"title":"","date":"2024-03-14T09:19:27.963Z","updated":"2024-03-14T09:19:27.963Z","comments":true,"path":"404.html","permalink":"https://solitaire-12.github.io/404.html","excerpt":"","text":""},{"title":"åˆ†ç±»","date":"2024-03-14T07:40:18.000Z","updated":"2024-03-14T08:58:24.939Z","comments":true,"path":"categories/index.html","permalink":"https://solitaire-12.github.io/categories/index.html","excerpt":"","text":""},{"title":"about","date":"2024-03-19T04:54:36.000Z","updated":"2024-03-25T04:03:09.016Z","comments":true,"path":"about/index.html","permalink":"https://solitaire-12.github.io/about/index.html","excerpt":"","text":"2024-03-25 ä¸Šä¼ ç¬”è®° Redisè§£å†³æ•°å­¦å…¬å¼é‡å¤æ˜¾ç¤ºé—®é¢˜ 2024-03-19 åˆ‡æ¢ä¸»é¢˜ Volantis 2024-03-18 åŒæ­¥ç¬”è®° æœåŠ¡å™¨ç¯å¢ƒé…ç½®ç¬”è®°JVMJava8 2024-03-15 åˆ‡æ¢ä¸»é¢˜ Async 2024-03-14 åšå®¢å»ºç«‹ ç®€å•è¯´ä¸€ä¸‹ä¸ºå•¥å»ºç«‹è¿™ä¸ªåšå®¢å§ã€‚åŸå…ˆç”¨giteeå­˜æ”¾è‡ªå·±çš„ç¬”è®°ï¼Œæ¯æ¬¡å†™å®Œä¹‹åpushä¸€ä¸‹å°±å¥½äº†ï¼Œä¹Ÿç®—æ–¹ä¾¿ã€‚éšç€ç¬”è®°è¶Šæ¥è¶Šå¤šï¼Œæƒ³è¦åœ¨è¿™ç§æ–¹å¼ä¸‹æ‰¾åˆ°è‡ªå·±æƒ³è¦çš„å†…å®¹ï¼Œç®€ç›´å™©æ¢¦ã€‚ä¹Ÿå°è¯•è¿‡Notionï¼Œä¸è¿‡Notionä¼šæŠŠé¸¡è›‹æ”¾ä¸€ä¸ªç¯®å­é‡Œã€‚æ€æ¥æƒ³å»ï¼Œæäº†è¿™ä¸ªåšå®¢ã€‚","author":"ç»‡ç§‹"},{"title":"å‹æƒ…é“¾æ¥","date":"2024-03-14T08:59:43.000Z","updated":"2024-03-14T09:00:13.560Z","comments":true,"path":"links/index.html","permalink":"https://solitaire-12.github.io/links/index.html","excerpt":"","text":""},{"title":"tags","date":"2024-03-14T08:59:06.000Z","updated":"2024-03-14T08:59:23.315Z","comments":true,"path":"tags/index.html","permalink":"https://solitaire-12.github.io/tags/index.html","excerpt":"","text":""},{"title":"frineds","date":"2024-03-19T04:55:03.000Z","updated":"2024-03-19T04:55:03.563Z","comments":true,"path":"frineds/index.html","permalink":"https://solitaire-12.github.io/frineds/index.html","excerpt":"","text":""}],"posts":[{"title":"MySQL|åŸºç¡€","slug":"data/mysql","date":"2024-03-25T08:20:00.000Z","updated":"2024-03-27T02:24:18.861Z","comments":true,"path":"2024/03/25/data/mysql/","permalink":"https://solitaire-12.github.io/2024/03/25/data/mysql/","excerpt":"","text":"å®‰è£… Linuxç¯å¢ƒè¯·ç‚¹åšå®¢è·³è½¬ Windowså®‰è£…mysqlè¯¦ç»†æ­¥éª¤ï¼ˆé€šä¿—æ˜“æ‡‚ï¼Œç®€å•ä¸Šæ‰‹ï¼‰-CSDNåšå®¢ç”¨ä¸‹åˆ«äººçš„è½®å­ æ•°æ®åº“çš„åŸºç¡€æ“ä½œ 123456# æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“show databases;# åˆ›å»ºæ•°æ®åº“create database database_name;# åˆ é™¤æ•°æ®åº“drop database database_name; âš ï¸ä½¿ç”¨drop databaseå‘½ä»¤æ—¶ï¼ŒMySQLå¹¶ä¸ä¼šç»™å‡ºä»»ä½•æé†’ã€ç¡®è®¤ä¿¡æ¯ã€‚è¯¥å‘½ä»¤æ‰§è¡Œåï¼Œæ‰€æœ‰æ•°æ®è¡¨å’Œæ•°æ®ä¹Ÿå°†åˆ é™¤ï¼Œä¸”æ“ä½œä¸å¯é€†ã€‚è¯·æ…é‡ä½¿ç”¨ã€‚ æ•°æ®è¡¨çš„åŸºæœ¬æ“ä½œ ğŸŒŸæƒ³è¦æ“ä½œæ•°æ®è¡¨ï¼Œéœ€è¦ä½¿ç”¨use database_nameæŒ‡å®šæ“ä½œåœ¨å“ªä¸ªæ•°æ®åº“ä¸­æ‰§è¡Œã€‚å¦‚æœæ²¡æœ‰é€‰æ‹©æ•°æ®åº“ï¼Œå°±ä¼šæŠ›å‡ºNo database selectedçš„é”™è¯¯ã€‚ åˆ›å»ºè¡¨ 1234567# åˆ›å»ºæ•°æ®è¡¨create table &lt;table_name&gt;( column_1 data_type, ...);# æŸ¥çœ‹æ•°æ®è¡¨show tables; çº¦æŸ ä¸»é”®çº¦æŸ ä¸»é”®ï¼Œåˆç§°ä¸»ç ï¼Œæ˜¯è¡¨ä¸­ä¸€åˆ—æˆ–å¤šåˆ—çš„ç»„åˆã€‚ä¸»é”®çº¦æŸï¼ˆPrimary Key Constraintï¼‰è¦æ±‚ä¸»é”®åˆ—çš„æ•°æ®å”¯ä¸€ï¼Œå¹¶ä¸”ä¸å…è®¸ä¸ºç©ºã€‚ 12345# å•å­—æ®µä¸»é”®å­—æ®µå æ•°æ®ç±» primary key [é»˜è®¤å€¼]# å¤šå­—æ®µä¸»é”®[constraint &lt;&gt;]","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://solitaire-12.github.io/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"https://solitaire-12.github.io/tags/MySQL/"}]},{"title":"Spring|åŸºç¡€|AOP","slug":"spring/åŸºç¡€AOP","date":"2024-03-25T08:20:00.000Z","updated":"2024-03-25T08:48:41.136Z","comments":true,"path":"2024/03/25/spring/åŸºç¡€AOP/","permalink":"https://solitaire-12.github.io/2024/03/25/spring/%E5%9F%BA%E7%A1%80AOP/","excerpt":"","text":"é¢å‘åˆ‡é¢(AOP) AOPçš„æœ¬è´¨ä¹Ÿæ˜¯ä¸ºäº†è§£è€¦ï¼Œå®ƒæ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ AOP(Aspect Oriented Programming)ï¼Œæ„ä¸ºé¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚æœ€æ—©ç”±AOPè”ç›Ÿç»„ç»‡æå‡ºçš„ï¼ŒæŒ‡å®šçš„ä¸€å¥—è§„èŒƒï¼ŒSpringå°†AOPçš„æ€æƒ³å¼•å…¥åˆ°é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸé—´ä¸œå²±ä»£ç†å®ç°ç¨‹åºçš„ç»Ÿä¸€ç»´æŠ¤çš„ä¸€ç§æŠ€æœ¯ã€‚ ä»è¦ç‚¹å®ä¾‹åˆ†æï¼Œç±»ä¼¼äºæ·»åŠ æ—¥å¿—è¿™ç§è§£è€¦ç±»çš„é—®é¢˜ï¼Œå¦‚æœæ²¡æœ‰Springæ¡†æ¶ï¼Œ æˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸ªserviceçš„æ–¹æ³•ä¸­æ·»åŠ è®°å½•æ—¥å¿—çš„æ–¹æ³•ï¼›ç”±Springä¹‹åï¼Œé€šè¿‡@Aspectæ³¨è§£å®šä¹‰åˆ‡é¢ï¼Œè¿™ä¸ªåˆ‡é¢ä¸­å®šä¹‰äº†æ‹¦æˆªæ‰€æœ‰serviceä¸­çš„æ–¹æ³•ï¼Œå¹¶è®°å½•æ—¥å¿—ï¼Œä»ä»£ç è§’åº¦è€Œè¨€ï¼Œè®°å½•æ—¥å¿—ä¸ä¸šåŠ¡ä»£ç ä¹‹é—´å·²ç»è§£è€¦ã€‚ 123456789101112@Aspectpublic class LogAspect &#123; /** * set aspect to get the name of the service method being done */ @Around(&quot;execution(* x.service.*.*(..))&quot;) public Object businessService(ProceedingJoinPoint pjp) throws Throwable&#123; Method method = ((MethodSignature) pjp.getSignature()).getMethod(); System.out.println(&quot;execute method:&quot;+method.getName()); return pjp.proceed(); &#125;&#125; å°†è®°å½•æ—¥å¿—åŠŸèƒ½è§£è€¦ä¸ºæ—¥å¿—åˆ‡é¢ï¼Œå®ƒçš„ç›®æ ‡æ˜¯è§£è€¦ã€‚è¿›è€Œå¼•å‡ºAOPçš„ç†å¿µï¼šå°†åˆ†æ•£åœ¨ä¸šåŠ¡é€»è¾‘ä»£ç ä¸­ç›¸åŒçš„ä»£ç é€šè¿‡æ¨ªå‘åˆ‡å‰²çš„æ–¹å¼æŠ½å–åˆ°ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ä¸­ã€‚ OOPé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œé’ˆå¯¹ä¸šåŠ¡å¤„ç†è¿‡ç¨‹çš„å®ä½“åŠå…¶å±æ€§å’Œè¡Œä¸ºè¿›è¡ŒæŠ½è±¡å°è£…ï¼Œä»¥è·å¾—æ›´åŠ æ¸…æ™°é«˜æ•ˆçš„é€»è¾‘å•å…ƒåˆ’åˆ†ã€‚è€ŒAOPåˆ™æ˜¯é’ˆå¯¹ä¸šåŠ¡å¤„ç†è¿‡ç¨‹ä¸­çš„åˆ‡é¢è¿›è¡Œæå–ï¼Œå®ƒæ‰€é¢å¯¹çš„æ˜¯å¤„ç†è¿‡ç¨‹çš„æŸä¸ªæ­¥éª¤æˆ–é˜¶æ®µï¼Œä»¥è·å¾—é€»è¾‘è¿‡ç¨‹ä¸­çš„å„ç§éƒ¨åˆ†ä¹‹é—´ä½è€¦åˆçš„éš”ç¦»æ•ˆæœã€‚ä¸¤ç§è®¾è®¡æ€æƒ³åœ¨ç›®æ ‡ä¸Šæœ‰æœ¬è´¨çš„åŒºåˆ«ã€‚ æœ¯è¯­ é¦–å…ˆæ˜ç¡®ï¼ŒAOPçš„æ¦‚å¿µå’Œæœ¯è¯­å¹¶éSpringç‰¹æœ‰çš„ã€‚ è¿æ¥ç‚¹(Jointpoint)ï¼šè¡¨ç¤ºéœ€è¦åœ¨ç¨‹åºä¸­æ’å…¥æ¨ªåˆ‡å…³æ³¨ç‚¹çš„æ‹“å±•ç‚¹ï¼Œè¿æ¥ç‚¹å¯èƒ½æ˜¯ç±»åˆå§‹åŒ–ã€æ–¹æ³•æ‰§è¡Œã€æ–¹æ³•è°ƒç”¨ã€å­—æ®µè°ƒç”¨å’Œå¤„ç†å¼‚å¸¸ç­‰ç­‰ï¼ŒSpringåªæ”¯æŒæ–¹æ³•æ‰§è¡Œè¿æ¥ç‚¹ï¼Œåœ¨AOPä¸­è¡¨ç¤ºåœ¨å“ªé‡Œå¹²ã€‚ åˆ‡å…¥ç‚¹(Pointcut)ï¼šé€‰æ‹©ä¸€ç»„ç›¸å…³è¿æ¥ç‚¹çš„æ¨¡å¼ï¼Œå³å¯ä»¥ä»»åŠ¡è¿æ¥ç‚¹çš„é›†åˆï¼ŒSpringæ”¯æŒperl5æ­£åˆ™è¡¨è¾¾å¼å’ŒAspectJåˆ‡å…¥ç‚¹æ¨¡å¼ï¼ŒSpringé»˜è®¤ä½¿ç”¨AspectJè¯­æ³•ï¼Œåœ¨AOPä¸­è¡¨ç¤ºåœ¨å“ªé‡Œå¹²çš„é›†åˆ é€šçŸ¥(Advice)ï¼šåœ¨è¿æ¥ç‚¹ä¸Šæ‰§è¡Œçš„ä»£ç ï¼Œé€šçŸ¥æä¾›äº†åœ¨AOPä¸­éœ€è¦åœ¨åˆ‡å…¥ç‚¹æ‰€é€‰æ‹©çš„è¿æ¥ç‚¹å‡ºè¿›è¡Œæ‹“å±•ç°æœ‰è¡Œä¸ºçš„æ‰‹æ®µï¼›åŒ…æ‹¬å‰ç½®é€šçŸ¥ã€åç½®é€šçŸ¥ã€ç¯ç»•é€šçŸ¥ï¼Œåœ¨Springä¸­é€šè¿‡ä»£ç†æ¨¡å¼å®ç°AOPï¼Œå¹¶é€šè¿‡è¿æ¥å™¨æ¨¡å¼ä»¥ç¯ç»•è¿æ¥ç‚¹çš„æ‹¦æˆªå™¨é“¾ç»‡å…¥é€šçŸ¥ï¼›åœ¨AOPä¸­è¡¨ç¤ºå¹²ä»€ä¹ˆã€‚ ğŸ’¡ é€šçŸ¥çš„ç±»å‹ï¼š å‰ç½®é€šçŸ¥(before advice)ï¼šåœ¨æŸä¸ªè¿æ¥ç‚¹ä¹‹å‰æ‰§è¡Œçš„é€šçŸ¥ï¼Œä½†è¿™ä¸ªé€šçŸ¥ä¸èƒ½é˜»æ­¢è¿æ¥ç‚¹ä¹‹å‰æ‰§è¡Œæµç¨‹(é™¤éå®ƒæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸)ã€‚ åç½®é€šçŸ¥(after returning advice)ï¼šåœ¨æŸè¿æ¥ç‚¹æ­£å¸¸æ‰§è¡Œå®Œæˆåæ‰§è¡Œçš„é€šçŸ¥ã€‚ å¼‚å¸¸é€šçŸ¥(after throwing advice)ï¼š åœ¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸é€€å‡ºæ—¶æ‰§è¡Œçš„é€šçŸ¥ã€‚ æœ€ç»ˆé€šçŸ¥(after [finally] advice)ï¼š å½“æŸè¿æ¥ç‚¹é€€å‡ºçš„æ—¶å€™æ‰§è¡Œçš„é€šçŸ¥ï¼ˆä¸è®ºæ˜¯æ­£å¸¸è¿”å›è¿˜æ˜¯å¼‚å¸¸é€€å‡ºï¼‰ã€‚ ç¯ç»•é€šçŸ¥(around advice)ï¼š åŒ…å›´ä¸€ä¸ªè¿æ¥ç‚¹çš„é€šçŸ¥ï¼Œå¦‚æ–¹æ³•è°ƒç”¨ã€‚è¿™æ˜¯æœ€å¼ºå¤§çš„ä¸€ç§é€šçŸ¥ç±»å‹ã€‚ç¯ç»•é€šçŸ¥å¯ä»¥åœ¨æ–¹æ³•è°ƒç”¨å‰åå®Œæˆè‡ªå®šä¹‰çš„è¡Œä¸ºã€‚å®ƒä¹Ÿä¼šé€‰æ‹©æ˜¯å¦ç»§ç»­æ‰§è¡Œè¿æ¥ç‚¹æˆ–ç›´æ¥è¿”å›å®ƒè‡ªå·±çš„è¿”å›å€¼æˆ–æŠ›å‡ºå¼‚å¸¸æ¥ç»“æŸæ‰§è¡Œã€‚ ç¯ç»•é€šçŸ¥æ˜¯æœ€å¸¸ç”¨çš„é€šçŸ¥ç±»å‹ã€‚å’ŒAspectJä¸€æ ·ï¼ŒSpringæä¾›æ‰€æœ‰ç±»å‹çš„é€šçŸ¥ï¼Œæˆ‘ä»¬æ¨èä½ ä½¿ç”¨å°½å¯èƒ½ç®€å•çš„é€šçŸ¥ç±»å‹æ¥å®ç°éœ€è¦çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åªæ˜¯éœ€è¦ä¸€ä¸ªæ–¹æ³•çš„è¿”å›å€¼æ¥æ›´æ–°ç¼“å­˜ï¼Œæœ€å¥½ä½¿ç”¨åç½®é€šçŸ¥è€Œä¸æ˜¯ç¯ç»•é€šçŸ¥ï¼Œå°½ç®¡ç¯ç»•é€šçŸ¥ä¹Ÿèƒ½å®ŒæˆåŒæ ·çš„äº‹æƒ…ã€‚ç”¨æœ€åˆé€‚çš„é€šçŸ¥ç±»å‹å¯ä»¥ä½¿å¾—ç¼–ç¨‹æ¨¡å‹å˜å¾—ç®€å•ï¼Œå¹¶ä¸”èƒ½å¤Ÿé¿å…å¾ˆå¤šæ½œåœ¨çš„é”™è¯¯ã€‚æ¯”å¦‚ï¼Œä½ ä¸éœ€è¦åœ¨JoinPointä¸Šè°ƒç”¨ç”¨äºç¯ç»•é€šçŸ¥çš„proceed()æ–¹æ³•ï¼Œå°±ä¸ä¼šæœ‰è°ƒç”¨çš„é—®é¢˜ã€‚ åˆ‡é¢(Aspect)ï¼šæ¨ªåˆ‡å…³æ³¨ç‚¹çš„æ¨¡å—åŒ–ï¼Œæ¯”å¦‚ä¸Šè¿°ä»£ç ä¸­çš„æ—¥å¿—ç»„ä»¶ã€‚å¯ä»¥è®¤ä¸ºiæ˜¯é€šçŸ¥ã€å¼•å…¥å’Œåˆ‡å…¥ç‚¹çš„ç»„åˆï¼›åœ¨Springä¸­å¯ä»¥ä½¿ç”¨Schemaå’Œ@AspectJæ–¹å¼è¿›è¡Œç»„ç»‡å®ç°ï¼›åœ¨AOPä¸­è¡¨ç¤ºåœ¨å“ªå¹²äº†ä»€ä¹ˆï¼› å¼•å…¥(inter-type declaration)ï¼šä¹Ÿæˆä¸ºå†…éƒ¨ç±»å£°æ˜ï¼Œä¸ºå·²æœ‰çš„ç±»æ·»åŠ é¢å¤–æ–°çš„å­—æ®µæˆ–è€…æ–¹æ³•ï¼ŒSpringå…è®¸å¼•å…¥æ–°çš„æ¥å£(å¿…é¡»å¯¹åº”ä¸€ä¸ªå®ç°)åˆ°æ‰€æœ‰è¢«ä»£ç†å¯¹è±¡(ç›®æ ‡å¯¹è±¡)ï¼Œåœ¨AOPä¸­è¡¨ç¤ºä¸ºå¼•å…¥ä»€ä¹ˆã€‚ ç›®æ ‡å¯¹è±¡(Target Object)ï¼šéœ€è¦è¢«ç»‡å…¥æ¨ªåˆ‡å…³æ³¨ç‚¹çš„å¯¹è±¡ï¼Œå³è¯¥å¯¹è±¡æ˜¯åˆ‡å…¥ç‚¹é€‰æ‹©çš„å¯¹è±¡ï¼Œéœ€è¦è¢«é€šçŸ¥çš„å¯¹è±¡ï¼Œä»è€Œä¹Ÿå¯ä»¥ç§°ä¸ºè¢«é€šçŸ¥å¯¹è±¡ã€‚ç”±äºSpring AOPé€šè¿‡ä»£ç†å®ç°ï¼Œä»è€Œè¿™ä¸ªå¯¹è±¡æ°¸è¿œæ˜¯è¢«ä»£ç†å¯¹è±¡ï¼Œåœ¨AOPä¸­è¡¨ç¤ºå¯¹è°å¹²ã€‚ ç»‡å…¥(Weaving)ï¼šæŠŠåˆ‡é¢è¿æ¥åˆ°å…¶ä»–çš„åº”ç”¨ç¨‹åºç±»å‹æˆ–è€…å¯¹è±¡ä¸Šï¼Œå¹¶åˆ›å»ºä¸€ä¸ªè¢«é€šçŸ¥çš„å¯¹è±¡ã€‚è¿™äº›å¯ä»¥åœ¨ç¼–è¯‘æ—¶ï¼ˆä¾‹å¦‚ä½¿ç”¨AspectJç¼–è¯‘å™¨ï¼‰ï¼Œç±»åŠ è½½æ—¶å’Œè¿è¡Œæ—¶å®Œæˆã€‚Springå’Œå…¶ä»–çº¯Java AOPæ¡†æ¶ä¸€æ ·ï¼Œåœ¨è¿è¡Œæ—¶å®Œæˆç»‡å…¥ã€‚åœ¨AOPä¸­è¡¨ç¤ºå¦‚ä½•å®ç°ã€‚ AOPä»£ç†(AOP Proxy)ï¼šAOPæ¡†æ¶ä½¿ç”¨ä»£ç†æ¨¡å¼åˆ›å»ºçš„å…‘ç°ç»™ï¼Œä»è€Œå®ç°åœ¨è¿æ¥å¸¦ä½ å¤„æ’å…¥é€šçŸ¥ï¼ˆå³åº”ç”¨åˆ‡é¢ï¼‰ï¼Œå°±æ˜¯é€šè¿‡ä»£ç†æ¥å¯¹ç›®æ ‡å¯¹è±¡åº”ç”¨åˆ‡é¢ã€‚åœ¨Springä¸­ï¼ŒAOPä»£ç†å¯ä»¥ç”¨JDKåŠ¨æ€ä»£ç†æˆ–è€…CGLIBä»£ç†å®ç°ï¼Œè€Œé€šè¿‡è¿æ¥å™¨æ¨¡å‹åº”ç”¨åˆ‡é¢ã€‚åœ¨AOPä¸­è¡¨ç¤ºä¸ºæ€ä¹ˆå®ç°çš„ä¸€ç§å…¸å‹æ–¹å¼ã€‚ Spring AOPå’ŒAspectJæ˜¯ä»€ä¹ˆå…³ç³» é¦–å…ˆAspectJæ˜¯ä»€ä¹ˆï¼Ÿ AspectJæ˜¯ä¸€ä¸ªjavaå®ç°çš„AOPæ¡†æ¶ï¼Œå®ƒèƒ½å¤Ÿå¯¹javaä»£ç è¿›è¡ŒAOPç¼–è¯‘ï¼ˆä¸€èˆ¬åœ¨ç¼–è¯‘æœŸè¿›è¡Œï¼‰ï¼Œè®©javaä»£ç å…·æœ‰AspectJçš„AOPåŠŸèƒ½ï¼ˆå½“ç„¶éœ€è¦ç‰¹æ®Šçš„ç¼–è¯‘å™¨ï¼‰ã€‚å¯ä»¥è¿™æ ·è¯´AspectJæ˜¯ç›®å‰å®ç°AOPæ¡†æ¶ä¸­æœ€æˆç†Ÿï¼ŒåŠŸèƒ½æœ€ä¸°å¯Œçš„è¯­è¨€ï¼Œè€Œä¸”AspectJä¸javaç¨‹åºå®Œå…¨å…¼å®¹ï¼Œå‡ ä¹æ˜¯æ— ç¼å…³è”ã€‚ å…¶æ¬¡ï¼Œä¸ºä»€ä¹ˆéœ€è¦ç†æ¸…æ¥šSpring AOPå’ŒAspectJçš„å…³ç³»ï¼Ÿ Spring AOPå’ŒAspectJæ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ AspectJæ˜¯æ›´å¼ºçš„AOPæ¡†æ¶ï¼Œæ˜¯å®é™…æ„ä¹‰çš„AOPæ ‡å‡†ï¼› Springä¸ºä½•ä¸å†™ç±»ä¼¼AspectJçš„æ¡†æ¶ï¼Ÿ Spring AOPä½¿ç”¨çº¯Javaå®ç°, å®ƒä¸éœ€è¦ä¸“é—¨çš„ç¼–è¯‘è¿‡ç¨‹, å®ƒä¸€ä¸ªé‡è¦çš„åŸåˆ™å°±æ˜¯æ— ä¾µå…¥æ€§ï¼ˆnon-invasivenessï¼‰; Spring å°ç»„å®Œå…¨æœ‰èƒ½åŠ›å†™ç±»ä¼¼çš„æ¡†æ¶ï¼Œåªæ˜¯Spring AOPä»æ¥æ²¡æœ‰æ‰“ç®—é€šè¿‡æä¾›ä¸€ç§å…¨é¢çš„AOPè§£å†³æ–¹æ¡ˆæ¥ä¸AspectJç«äº‰ã€‚Springçš„å¼€å‘å°ç»„ç›¸ä¿¡æ— è®ºæ˜¯åŸºäºä»£ç†ï¼ˆproxy-basedï¼‰çš„æ¡†æ¶å¦‚Spring AOPæˆ–è€…æ˜¯æˆç†Ÿçš„æ¡†æ¶å¦‚AspectJéƒ½æ˜¯å¾ˆæœ‰ä»·å€¼çš„ï¼Œä»–ä»¬ä¹‹é—´åº”è¯¥æ˜¯äº’è¡¥è€Œä¸æ˜¯ç«äº‰çš„å…³ç³»ã€‚ Springå°ç»„å–œæ¬¢@AspectJæ³¨è§£é£æ ¼æ›´èƒœäºSpring XMLé…ç½®ï¼› æ‰€ä»¥åœ¨Spring 2.0ä½¿ç”¨äº†å’ŒAspectJ 5ä¸€æ ·çš„æ³¨è§£ï¼Œå¹¶ä½¿ç”¨AspectJæ¥åšåˆ‡å…¥ç‚¹è§£æå’ŒåŒ¹é…ã€‚ä½†æ˜¯ï¼ŒAOPåœ¨è¿è¡Œæ—¶ä»æ—§æ˜¯çº¯çš„Spring AOPï¼Œå¹¶ä¸ä¾èµ–äºAspectJçš„ç¼–è¯‘å™¨æˆ–è€…ç»‡å…¥å™¨ï¼ˆweaverï¼‰ã€‚ Spring 2.5å¯¹AspectJçš„æ”¯æŒï¼šåœ¨ä¸€äº›ç¯å¢ƒä¸‹ï¼Œå¢åŠ äº†å¯¹AspectJçš„è£…è½½æ—¶ç¼–ç»‡æ”¯æŒï¼ŒåŒæ—¶æä¾›äº†ä¸€ä¸ªæ–°çš„beanåˆ‡å…¥ç‚¹ã€‚ æ›´å¤šå…³äºAspectJï¼Ÿ äº†è§£AspectJåº”ç”¨åˆ°javaä»£ç çš„è¿‡ç¨‹ï¼ˆè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºç»‡å…¥ï¼‰ï¼Œå¯¹äºç»‡å…¥è¿™ä¸ªæ¦‚å¿µï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºaspect(åˆ‡é¢)åº”ç”¨åˆ°ç›®æ ‡å‡½æ•°(ç±»)çš„è¿‡ç¨‹ã€‚ å¯¹äºè¿™ä¸ªè¿‡ç¨‹ï¼Œä¸€èˆ¬åˆ†ä¸ºåŠ¨æ€ç»‡å…¥å’Œé™æ€ç»‡å…¥ï¼š åŠ¨æ€ç»‡å…¥çš„æ–¹å¼æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€å°†è¦å¢å¼ºçš„ä»£ç ç»‡å…¥åˆ°ç›®æ ‡ç±»ä¸­ï¼Œè¿™æ ·å¾€å¾€æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†æŠ€æœ¯å®Œæˆçš„ï¼Œå¦‚Java JDKçš„åŠ¨æ€ä»£ç†(Proxyï¼Œåº•å±‚é€šè¿‡åå°„å®ç°)æˆ–è€…CGLIBçš„åŠ¨æ€ä»£ç†(åº•å±‚é€šè¿‡ç»§æ‰¿å®ç°)ï¼ŒSpring AOPé‡‡ç”¨çš„å°±æ˜¯åŸºäºè¿è¡Œæ—¶å¢å¼ºçš„ä»£ç†æŠ€æœ¯ ApectJé‡‡ç”¨çš„å°±æ˜¯é™æ€ç»‡å…¥çš„æ–¹å¼ã€‚ApectJä¸»è¦é‡‡ç”¨çš„æ˜¯ç¼–è¯‘æœŸç»‡å…¥ï¼Œåœ¨è¿™ä¸ªæœŸé—´ä½¿ç”¨AspectJçš„acjç¼–è¯‘å™¨(ç±»ä¼¼javac)æŠŠaspectç±»ç¼–è¯‘æˆclasså­—èŠ‚ç åï¼Œåœ¨javaç›®æ ‡ç±»ç¼–è¯‘æ—¶ç»‡å…¥ï¼Œå³å…ˆç¼–è¯‘aspectç±»å†ç¼–è¯‘ç›®æ ‡ç±»ã€‚ AOPçš„é…ç½®æ–¹å¼ Spring AOPæ”¯æŒå¯¹XMLæ¨¡å¼å’ŒåŸºäº@AspectJæ³¨è§£çš„ä¸¤ç§é…ç½®æ–¹å¼ã€‚ XML Schemaé…ç½®æ–¹å¼ ç›®æ ‡ç±» 12345678910111213141516public class AopDemoServiceImpl &#123; public void doMethod1() &#123; System.out.println(&quot;AopDemoServiceImpl.doMethod1()&quot;); &#125; public String doMethod2() &#123; System.out.println(&quot;AopDemoServiceImpl.doMethod2()&quot;); return &quot;hello world&quot;; &#125; public String doMethod3() throws Exception &#123; System.out.println(&quot;AopDemoServiceImpl.doMethod3()&quot;); throw new Exception(&quot;some exception&quot;); &#125;&#125; åˆ‡é¢ç±» 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public class LogAspect &#123; /** * ç¯ç»•é€šçŸ¥. * * @param pjp pjp * @return obj * @throws Throwable exception */ public Object doAround(ProceedingJoinPoint pjp) throws Throwable &#123; System.out.println(&quot;-----------------------&quot;); System.out.println(&quot;ç¯ç»•é€šçŸ¥: è¿›å…¥æ–¹æ³•&quot;); Object o = pjp.proceed(); System.out.println(&quot;ç¯ç»•é€šçŸ¥: é€€å‡ºæ–¹æ³•&quot;); return o; &#125; /** * å‰ç½®é€šçŸ¥. */ public void doBefore() &#123; System.out.println(&quot;å‰ç½®é€šçŸ¥&quot;); &#125; /** * åç½®é€šçŸ¥. * * @param result return val */ public void doAfterReturning(String result) &#123; System.out.println(&quot;åç½®é€šçŸ¥, è¿”å›å€¼: &quot; + result); &#125; /** * å¼‚å¸¸é€šçŸ¥. * * @param e exception */ public void doAfterThrowing(Exception e) &#123; System.out.println(&quot;å¼‚å¸¸é€šçŸ¥, å¼‚å¸¸: &quot; + e.getMessage()); &#125; /** * æœ€ç»ˆé€šçŸ¥. */ public void doAfter() &#123; System.out.println(&quot;æœ€ç»ˆé€šçŸ¥&quot;); &#125;&#125; XMLé…ç½®AOP 123456789101112131415161718192021222324252627282930313233343536373839&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt; &lt;context:component-scan base-package=&quot;x&quot; /&gt; &lt;aop:aspectj-autoproxy/&gt; &lt;!-- ç›®æ ‡ç±» --&gt; &lt;bean id=&quot;demoService&quot; class=&quot;x.service.AopDemoServiceImpl&quot;&gt; &lt;!-- configure prop&lt;/bean&gt; &lt;!-- åˆ‡é¢ --&gt; &lt;bean id=&quot;logAspect&quot; class=&quot;x.aspect.LogAspect&quot;&gt; xfig&gt; &lt;!-- é…ç½®åˆ‡é¢ --&gt; &lt;aop:aspect ref=&quot;logAspect&quot;&gt; &lt;!-- é…ç½®åˆ‡å…¥ç‚¹ --&gt; &lt;aop:pointcut id=&quot;pointCutMethod&quot; expression=&quot;execution(* x.service.*.*(..))&quot;/&gt; &lt;!-- ç¯ç»•é€šçŸ¥ --&gt;x method=&quot;doAround&quot; pointcut-ref=&quot;pointCutMethod&quot;/&gt; &lt;!-- å‰ç½®é€šçŸ¥ --&gt; &lt;aop:before method=&quot;doBefore&quot; pointcut-ref=&quot;pointCutMethod&quot;/&gt; &lt;!-- åç½®é€šçŸ¥ï¼›returningå±æ€§ï¼šç”¨äºè®¾ç½®åç½®é€šçŸ¥çš„ç¬¬äºŒä¸ªå‚æ•°çš„åç§°ï¼Œç±»å‹æ˜¯Object --&gt; &lt;aop:after-returning method=&quot;doAfterReturning&quot; pointcut-ref=&quot;pointCutMethod&quot; returning=&quot;result&quot;/&gt; &lt;!-- å¼‚å¸¸é€šçŸ¥ï¼šå¦‚æœæ²¡æœ‰å¼‚å¸¸ï¼Œå°†ä¸ä¼šæ‰§è¡Œå¢å¼ºï¼›throwingå±æ€§ï¼šç”¨äºè®¾ç½®é€šçŸ¥ç¬¬äºŒä¸ªå‚æ•°çš„çš„åç§°ã€ç±»å‹--&gt; &lt;aop:after-throwing method=&quot;doAfterThrowing&quot; pointcut-ref=&quot;pointCutMethod&quot; throwing=&quot;e&quot;/&gt; &lt;aop:after method=&quot;doAfter&quot; pointcut-ref=&quot;pointCutMethod&quot;/&gt; &lt;/aop:aspect&gt; &lt;/aop:config&gt;&lt;/beans&gt; æµ‹è¯• 1234567891011public static void main(String[] args) &#123; ApplicationContext context = new ClassPathXmlApplicationContext(&quot;aspects.xml&quot;); AopDemoServiceImpl service = context.getBean(&quot;demoService&quot;, AopDemoServiceImpl.class); service.doMethod1(); service.doMethod2(); try &#123; service.doMethod3(); &#125; catch (Exception e) &#123; // e.printStackTrace(); &#125;&#125; AspectJæ³¨è§£æ–¹å¼ æ³¨è§£æ–¹å¼é…ç½®aop åˆ‡é¢ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748@Aspect@Componentpublic class LogAspect &#123; /** * ç¯ç»•é€šçŸ¥. */ @Around(&quot;execution(* x.service.*.*(..))&quot;) public Object doAround(ProceedingJoinPoint pjp) throws Throwable &#123; System.out.println(&quot;-----------------------&quot;); System.out.println(&quot;ç¯ç»•é€šçŸ¥: è¿›å…¥æ–¹æ³•&quot;); Object o = pjp.proceed(); System.out.println(&quot;ç¯ç»•é€šçŸ¥: é€€å‡ºæ–¹æ³•&quot;); return o; &#125; /** * å‰ç½®é€šçŸ¥. */ @Before(&quot;execution(* x.service.*.*(..))&quot;) public void doBefore() &#123; System.out.println(&quot;å‰ç½®é€šçŸ¥&quot;); &#125; /** * åç½®é€šçŸ¥. */ @AfterReturning(value = &quot;execution(* x.service.*.*(..))&quot;,returning = &quot;result&quot;) public void doAfterReturning(String result) &#123; System.out.println(&quot;åç½®é€šçŸ¥, è¿”å›å€¼: &quot; + result); &#125; /** * å¼‚å¸¸é€šçŸ¥. */ @AfterThrowing(value = &quot;execution(* x.service.*.*(..))&quot;,throwing = &quot;e&quot;) public void doAfterThrowing(Exception e) &#123; System.out.println(&quot;å¼‚å¸¸é€šçŸ¥, å¼‚å¸¸: &quot; + e.getMessage()); &#125; /** * æœ€ç»ˆé€šçŸ¥. */ @After(&quot;execution(* x.service.*.*(..))&quot;) public void doAfter() &#123; System.out.println(&quot;æœ€ç»ˆé€šçŸ¥&quot;); &#125;&#125; 12345678910111213141516@EnableAspectJAutoProxy@Configurationpublic class App &#123; public static void main(String[] args) &#123; AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(&quot;x&quot;); AopServiceImpl service = context.getBean(AopServiceImpl.class); service.doMethod1(); service.doMethod2(); try &#123; service.doMethod3(); &#125; catch (Exception e) &#123; // e.printStackTrace(); &#125; &#125;&#125; ğŸŒŸexecutionè¯­æ³•ï¼š å…³äº @After(&quot;execution()&quot;)ä¸­execution()çš„ä½œç”¨æ˜¯å»æ‰¾åˆ°ä¸ä¹‹åŒ¹é…çš„åˆ‡ç‚¹ã€‚ è¯­æ³•ï¼š execution(&lt;ä¿®é¥°ç¬¦æ¨¡å¼&gt;?&lt;è¿”å›ç±»å‹æ¨¡å¼&gt;&lt;æ–¹æ³•åæ¨¡å¼&gt;(&lt;å‚æ•°æ¨¡å¼&gt;)&lt;å¼‚å¸¸æ¨¡å¼&gt;?) ,ä¾‹å¦‚ä¸‹â†“ï¼š 1// execution(* com.service.impl..*.*(..)) å«ä¹‰ï¼š *,ä»£è¡¨ä»»æ„ com.service.implï¼Œä»£è¡¨AOPçš„åˆ‡å…¥ç‚¹åŒ…ä½ç½® com.service.impl..ï¼Œè¡¨ç¤ºå½“å‰åŒ…ä»¥åŠå­åŒ… com.service.impl..*ï¼Œè¡¨ç¤ºå½“å‰åŒ…ä»¥åŠå­åŒ…ä¸‹çš„æ‰€æœ‰çš„ç±» com.service.impl..*(..)ï¼Œè¡¨ç¤ºè¡¨ç¤ºå½“å‰åŒ…ä»¥åŠå­åŒ…ä¸‹çš„æ‰€æœ‰çš„ç±»çš„ä»»ä½•æ–¹æ³•ï¼Œ(..)ä¸­çš„ç‚¹ç‚¹è¡¨ç¤ºä»»æ„å‚æ•°ç±»å‹ â—AOPåˆ‡ä¸åˆ°staticæ–¹æ³• ğŸ”—ï¼šè·å–åˆ°æ–¹æ³•çš„å‚æ•°ï¼Œè¿”å›å€¼","categories":[{"name":"Spring","slug":"Spring","permalink":"https://solitaire-12.github.io/categories/Spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://solitaire-12.github.io/tags/spring/"},{"name":"AOP","slug":"AOP","permalink":"https://solitaire-12.github.io/tags/AOP/"}]},{"title":"Spring|åŸºç¡€|IOC/DI","slug":"spring/åŸºç¡€IOC","date":"2024-03-25T08:15:00.000Z","updated":"2024-03-25T08:45:44.941Z","comments":true,"path":"2024/03/25/spring/åŸºç¡€IOC/","permalink":"https://solitaire-12.github.io/2024/03/25/spring/%E5%9F%BA%E7%A1%80IOC/","excerpt":"","text":"æ§åˆ¶åè½¬(IOC) ä»ã€åŸºç¡€|ç¬¬ä¸€ä¸ªspringé¡¹ç›®ã€‘ä¸­çš„å®ä¾‹åˆ†æï¼Œå¦‚æœæ²¡æœ‰Springæ¡†æ¶ï¼Œå°±éœ€è¦æ‰‹åŠ¨å»åˆ›å»ºUser/Dao/Serviceç­‰ï¼›æœ‰äº†Springæ¡†æ¶åï¼Œå¯ä»¥å°†åŸæœ‰çš„Beançš„åˆ›å»ºå·¥ä½œè½¬ç»™æ¡†æ¶ï¼Œéœ€è¦ç”¨çš„æ—¶å€™ä»Beançš„å®¹å™¨ä¸­è·å–å³å¯ã€‚ 1234567// create and configure beansApplicationContext context = new ClassPathXmlApplicationContext(&quot;aspects.xml&quot;, &quot;daos.xml&quot;, &quot;services.xml&quot;);// retrieve configured instanceUserServiceImpl service = context.getBean(&quot;userService&quot;, UserServiceImpl.class);// use configured instanceList&lt;User&gt; userList = service.findUserList(); Spring Bean Springé‡Œè¾¹çš„beanå°±ç±»ä¼¼æ˜¯å®šä¹‰çš„ä¸€ä¸ªç»„ä»¶ï¼Œè€Œè¿™ä¸ªç»„ä»¶çš„ä½œç”¨å°±æ˜¯æ˜¯å¿ƒå•ŠæŸä¸ªåŠŸèƒ½ã€‚è¿™é‡Œæ‰€å®šä¹‰çš„beanå°±ç›¸å½“äºç»™äº†ä½ ä¸€ä¸ªæ›´ä¸ºç®€ä¾¿çš„æ–¹æ³•å»è°ƒç”¨ç»„ä»¶æ¥å®ç°ä½ çš„ä¸šåŠ¡ã€‚ IOC Inversion of Controlï¼Œå³æ§åˆ¶åè½¬ï¼Œæ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ã€‚ è°æ§åˆ¶è°ï¼Œæ§åˆ¶ä»€ä¹ˆï¼Ÿ ä¼ ç»Ÿçš„Java SEç¨‹åºè®¾è®¡ï¼Œç›´æ¥åœ¨å¯¹è±¡å†…éƒ¨é€šè¿‡newè¿›è¡Œåˆ›å»ºå¯¹è±¡ï¼Œæ˜¯ç¨‹åºä¸»åŠ¨å»åˆ›å»ºä¾èµ–å¯¹è±¡ï¼›è€ŒIOCæ˜¯ç”±ä¸“é—¨çš„ä¸€ä¸ªå®¹å™¨æ¥åˆ›å»ºè¿™äº›å¯¹è±¡ï¼Œå³ç”±IOCå®¹å™¨æ¥æ§åˆ¶å¯¹è±¡çš„åˆ›å»ºï¼› æ‰€ä»¥ï¼ŒIOCå®¹å™¨æ§åˆ¶äº†å¯¹è±¡ã€‚ä¸»è¦æ§åˆ¶äº†å¤–éƒ¨èµ„æºè·å–ã€‚ ä¸ºä»€ä¹ˆæ˜¯åè½¬ï¼Ÿ ä¼ ç»Ÿçš„ç”±è‡ªå·±åœ¨å¯¹è±¡ä¸­ä¸»åŠ¨æ§åˆ¶å»è·å–ä¾èµ–å¯¹è±¡çš„å°±æ˜¯æ­£è½¬ï¼›é€šè¿‡å®¹å™¨æ¥å¸®å¿™åˆ›å»ºä»¥åŠæ³¨å…¥ä¾èµ–å¯¹è±¡çš„ï¼Œå«åè½¬ã€‚å› ä¸ºç”±å®¹å™¨å°†ä¾èµ–å¯¹è±¡æ³¨å…¥ï¼Œå¯¹è±¡æ˜¯è¢«åŠ¨çš„æ¥æ”¶ä¾èµ–å¯¹è±¡çš„ï¼Œæ‰€ä»¥ç§°ä¸ºåè½¬ã€‚ ä¼ ç»Ÿæ–¹å¼ï¼š IOCï¼š IOCå’ŒDI æ§åˆ¶åè½¬æ˜¯é€šè¿‡ä¾èµ–æ³¨å…¥å®ç°çš„ï¼Œå…¶å®å®ƒä»¬æ˜¯åŒä¸€ä¸ªæ¦‚å¿µçš„ä¸åŒè§’åº¦çš„æè¿°ã€‚ç®€å•æ¥è¯´IOCæ˜¯è®¾è®¡æ€æƒ³ï¼ŒDIæ˜¯å®ç°æ–¹å¼ã€‚ DI(Dependency Injection)ï¼Œä¾èµ–æ³¨å…¥ã€‚ç»„ä»¶ä¹‹é—´ä¾èµ–å…³ç³»ç”±å®¹å™¨åœ¨è¿è¡ŒæœŸé—´å†³å®šã€‚ä¾èµ–æ³¨å…¥çš„ç›®çš„å¹¶éä¸ºè½¯ä»¶ç³»ç»Ÿå¸¦æ¥æ›´å¤šåŠŸèƒ½ï¼Œè€Œæ˜¯ä¸ºäº†æå‡ç»„ä»¶é‡ç”¨çš„é¢‘ç‡ï¼Œå¹¶ä¸ºç³»ç»Ÿæ­å»ºä¸€ä¸ªçµæ´»ã€å¯æ‰©å±•çš„å¹³å°ã€‚é€šè¿‡ä¾èµ–æ³¨å…¥æœºåˆ¶ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡ç®€å•çš„é…ç½®ï¼Œè€Œæ— éœ€ä»»ä½•ä»£ç å°±å¯æŒ‡å®šç›®æ ‡éœ€è¦çš„èµ„æºï¼Œå®Œæˆè‡ªèº«çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸éœ€è¦å…³å¿ƒå…·ä½“çš„èµ„æºæ¥è‡ªä½•å¤„ï¼Œç”±è°å®ç°ã€‚ æˆ‘ä»¬æ¥æ·±å…¥åˆ†æä¸€ä¸‹ï¼š è°ä¾èµ–äºè°ï¼Ÿ å½“ç„¶æ˜¯åº”ç”¨ç¨‹åºä¾èµ–äºIoCå®¹å™¨ï¼› ä¸ºä»€ä¹ˆéœ€è¦ä¾èµ–ï¼Ÿ åº”ç”¨ç¨‹åºéœ€è¦IoCå®¹å™¨æ¥æä¾›å¯¹è±¡éœ€è¦çš„å¤–éƒ¨èµ„æºï¼› è°æ³¨å…¥è°ï¼Ÿ å¾ˆæ˜æ˜¾æ˜¯IoCå®¹å™¨æ³¨å…¥åº”ç”¨ç¨‹åºæŸä¸ªå¯¹è±¡ï¼Œåº”ç”¨ç¨‹åºä¾èµ–çš„å¯¹è±¡ï¼› æ³¨å…¥äº†ä»€ä¹ˆï¼Ÿ å°±æ˜¯æ³¨å…¥æŸä¸ªå¯¹è±¡æ‰€éœ€è¦çš„å¤–éƒ¨èµ„æºï¼ˆåŒ…æ‹¬å¯¹è±¡ã€èµ„æºã€å¸¸é‡æ•°æ®ï¼‰ã€‚ IoCå’ŒDIæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ å…¶å®å®ƒä»¬æ˜¯åŒä¸€ä¸ªæ¦‚å¿µçš„ä¸åŒè§’åº¦æè¿°ï¼Œç”±äºæ§åˆ¶åè½¬æ¦‚å¿µæ¯”è¾ƒå«ç³Šï¼ˆå¯èƒ½åªæ˜¯ç†è§£ä¸ºå®¹å™¨æ§åˆ¶å¯¹è±¡è¿™ä¸€ä¸ªå±‚é¢ï¼Œå¾ˆéš¾è®©äººæƒ³åˆ°è°æ¥ç»´æŠ¤å¯¹è±¡å…³ç³»ï¼‰ï¼Œæ‰€ä»¥2004å¹´å¤§å¸ˆçº§äººç‰©Martin Fowleråˆç»™å‡ºäº†ä¸€ä¸ªæ–°çš„åå­—ï¼šâ€œä¾èµ–æ³¨å…¥â€ï¼Œç›¸å¯¹IoC è€Œè¨€ï¼Œâ€œä¾èµ–æ³¨å…¥â€æ˜ç¡®æè¿°äº†â€œè¢«æ³¨å…¥å¯¹è±¡ä¾èµ–IoCå®¹å™¨é…ç½®ä¾èµ–å¯¹è±¡â€ã€‚é€šä¿—æ¥è¯´å°±æ˜¯IoCæ˜¯è®¾è®¡æ€æƒ³ï¼ŒDIæ˜¯å®ç°æ–¹å¼ã€‚ IOCä¸‰ç§é…ç½®æ–¹å¼ xmlé…ç½® é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†beançš„ä¿¡æ¯é…ç½®.xmlæ–‡ä»¶é‡Œï¼Œé€šè¿‡SpringåŠ è½½æ–‡ä»¶ä¸ºæˆ‘ä»¬åˆ›å»ºbeanã€‚è¿™ç§æ–¹å¼å‡ºç°å¾ˆå¤šæ—©å‰çš„SSMé¡¹ç›®ä¸­ï¼Œå°†ç¬¬ä¸‰æ–¹ç±»åº“æˆ–è€…ä¸€äº›é…ç½®å·¥å…·ç±»éƒ½ä»¥è¿™ç§æ–¹å¼è¿›è¡Œé…ç½®ï¼Œä¸»è¦åŸå› æ˜¯ç”±äºç¬¬ä¸‰æ–¹ç±»ä¸æ”¯æŒSpringæ³¨è§£ã€‚ ä¼˜ç‚¹ï¼š å¯ä»¥ä½¿ç”¨äºä»»ä½•åœºæ™¯ï¼Œç»“æ„æ¸…æ™°ï¼Œé€šä¿—æ˜“æ‡‚ ç¼ºç‚¹ï¼š é…ç½®ç¹çï¼Œä¸æ˜“ç»´æŠ¤ï¼Œæ¯ç‡¥æ— å‘³ï¼Œæ‰©å±•æ€§å·® ä¸¾ä¾‹ï¼š é…ç½®xx.xmlæ–‡ä»¶ å£°æ˜å‘½åç©ºé—´å’Œé…ç½®bean 12345678910&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt; &lt;!-- services --&gt; &lt;bean id=&quot;userService&quot; class=&quot;x.service.UserServiceImpl&quot;&gt; &lt;property name=&quot;userDao&quot; ref=&quot;userDao&quot;/&gt; &lt;/bean&gt;&lt;/beans&gt; Javaé…ç½® å°†ç±»çš„åˆ›å»ºäº¤ç»™æˆ‘ä»¬é…ç½®çš„JavcConfigç±»æ¥å®Œæˆï¼ŒSpringåªè´Ÿè´£ç»´æŠ¤å’Œç®¡ç†ï¼Œé‡‡ç”¨çº¯Javaåˆ›å»ºæ–¹å¼ã€‚å…¶æœ¬è´¨ä¸Šå°±æ˜¯æŠŠåœ¨XMLä¸Šçš„é…ç½®å£°æ˜è½¬ç§»åˆ°Javaé…ç½®ç±»ä¸­ ä¼˜ç‚¹ï¼šé€‚ç”¨äºä»»ä½•åœºæ™¯ï¼Œé…ç½®æ–¹ä¾¿ï¼Œå› ä¸ºæ˜¯çº¯Javaä»£ç ï¼Œæ‰©å±•æ€§é«˜ï¼Œååˆ†çµæ´» ç¼ºç‚¹ï¼šç”±äºæ˜¯é‡‡ç”¨Javaç±»çš„æ–¹å¼ï¼Œå£°æ˜ä¸æ˜æ˜¾ï¼Œå¦‚æœå¤§é‡é…ç½®ï¼Œå¯è¯»æ€§æ¯”è¾ƒå·® ä¸¾ä¾‹ï¼š åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œ æ·»åŠ @Configurationæ³¨è§£å£°æ˜ä¸ºé…ç½®ç±» åˆ›å»ºæ–¹æ³•ï¼Œæ–¹æ³•ä¸ŠåŠ ä¸Š@beanï¼Œè¯¥æ–¹æ³•ç”¨äºåˆ›å»ºå®ä¾‹å¹¶è¿”å›ï¼Œè¯¥å®ä¾‹åˆ›å»ºåä¼šäº¤ç»™springç®¡ç†ï¼Œæ–¹æ³•åå»ºè®®ä¸å®ä¾‹åç›¸åŒï¼ˆé¦–å­—æ¯å°å†™ï¼‰ã€‚æ³¨ï¼šå®ä¾‹ç±»ä¸éœ€è¦åŠ ä»»ä½•æ³¨è§£ 123456789@EnableAspectJAutoProxy@Configurationpublic class BeanConfig &#123; @Bean(&quot;userDao&quot;) public UserDaoImpl userDao()&#123; return new UserDaoImpl(); &#125; //...&#125; æ³¨è§£é…ç½® é€šè¿‡åœ¨ç±»ä¸ŠåŠ æ³¨è§£çš„æ–¹å¼ï¼Œæ¥å£°æ˜ä¸€ä¸ªç±»äº¤ç»™Springç®¡ç†ï¼ŒSpringä¼šè‡ªåŠ¨æ‰«æå¸¦æœ‰@Componentï¼Œ@Controllerï¼Œ@Serviceï¼Œ@Repositoryè¿™å››ä¸ªæ³¨è§£çš„ç±»ï¼Œç„¶åå¸®æˆ‘ä»¬åˆ›å»ºå¹¶ç®¡ç†ï¼Œå‰ææ˜¯éœ€è¦å…ˆé…ç½®Springçš„æ³¨è§£æ‰«æå™¨ã€‚ ä¼˜ç‚¹ï¼šå¼€å‘ä¾¿æ·ï¼Œé€šä¿—æ˜“æ‡‚ï¼Œæ–¹ä¾¿ç»´æŠ¤ã€‚ ç¼ºç‚¹ï¼šå…·æœ‰å±€é™æ€§ï¼Œå¯¹äºä¸€äº›ç¬¬ä¸‰æ–¹èµ„æºï¼Œæ— æ³•æ·»åŠ æ³¨è§£ã€‚åªèƒ½é‡‡ç”¨XMLæˆ–JavaConfigçš„æ–¹å¼é…ç½® ä¸¾ä¾‹ï¼š å¯¹ç±»æ·»åŠ @Componentç›¸å…³çš„æ³¨è§£ï¼Œæ¯”å¦‚@Controllerï¼Œ@Serviceï¼Œ@Repository è®¾ç½®ComponentScançš„basePackageï¼Œä¾‹å¦‚&lt;context:component-scan base-package='x'&gt;,æˆ–è€…@ComponentScan(&quot;x&quot;)æ³¨è§£ï¼Œæˆ–è€…new AnnotationConfigApplicationContext(&quot;x&quot;);éƒ½æ˜¯åœ¨æŒ‡å®šæ‰«æçš„basePackageã€‚ DIçš„ä¸‰ç§æ–¹å¼ setter 12345678910&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt; &lt;!-- services --&gt; &lt;bean id=&quot;userService&quot; class=&quot;x.service.UserServiceImpl&quot;&gt; &lt;property name=&quot;userDao&quot; ref=&quot;userDao&quot;/&gt; &lt;/bean&gt;&lt;/beans&gt; æœ¬è´¨ä¸ŠåŒ…å«ä¸¤æ­¥ï¼š éœ€è¦new UserServiceImpl()åˆ›å»ºå¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦é»˜è®¤æ„é€ å‡½æ•° è°ƒç”¨setUserDao()å‡½æ•°æ³¨å…¥userDaoçš„å€¼ï¼Œæ‰€ä»¥éœ€è¦setUserDao()å‡½æ•° å¯¹åº”çš„serviceç±»ï¼š 1234567891011public class UserServiceImpl &#123; private UserDaoImpl userDao; public UserServiceImpl() &#123; &#125; public List&lt;User&gt; findUserList()&#123; return this.userDao.findUserList(); &#125; public void setUserDao(UserDaoImpl userDao)&#123; this.userDao = userDao; &#125;&#125; æ³¨è§£Javaé…ç½®ï¼š 12345678910public class UserServiceImpl &#123; private UserDaoImpl userDao; public List&lt;User&gt; findUserList() &#123; return this.userDao.findUserList(); &#125; @Autowired public void setUserDao(UserDaoImpl userDao) &#123; this.userDao = userDao; &#125;&#125; æ„é€ å‡½æ•° 123456789101112&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt; &lt;!-- services --&gt; &lt;bean id=&quot;userService&quot; class=&quot;x.service.UserServiceImpl&quot;&gt; &lt;constructor-arg name=&quot;userDao&quot; ref=&quot;userDao&quot;/&gt; &lt;!-- additional collaborators and configuration for this bean go here --&gt; &lt;/bean&gt; &lt;!-- more bean definitions for services go here --&gt;&lt;/beans&gt; æ³¨è§£è¾“å…¥ ä»¥@Autowiredï¼ˆè‡ªåŠ¨æ³¨å…¥ï¼‰æ³¨è§£æ³¨å…¥ä¸ºä¾‹ï¼Œä¿®é¥°ç¬¦æœ‰ä¸‰ä¸ªå±æ€§ï¼šConstructorï¼ŒbyTypeï¼ŒbyNameã€‚é»˜è®¤æŒ‰ç…§byTypeæ³¨å…¥ã€‚ constructorï¼šé€šè¿‡æ„é€ æ–¹æ³•è¿›è¡Œè‡ªåŠ¨æ³¨å…¥ï¼Œspringä¼šåŒ¹é…ä¸æ„é€ æ–¹æ³•å‚æ•°ç±»å‹ä¸€è‡´çš„beanè¿›è¡Œæ³¨å…¥ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå¤šå‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œä¸€ä¸ªåªæœ‰ä¸€ä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œåœ¨å®¹å™¨ä¸­æŸ¥æ‰¾åˆ°å¤šä¸ªåŒ¹é…å¤šå‚æ•°æ„é€ æ–¹æ³•çš„beanï¼Œé‚£ä¹ˆspringä¼šä¼˜å…ˆå°†beanæ³¨å…¥åˆ°å¤šå‚æ•°çš„æ„é€ æ–¹æ³•ä¸­ã€‚ byNameï¼šè¢«æ³¨å…¥beançš„idåå¿…é¡»ä¸setæ–¹æ³•ååŠæˆªåŒ¹é…ï¼Œå¹¶ä¸”idåç§°çš„ç¬¬ä¸€ä¸ªå•è¯é¦–å­—æ¯å¿…é¡»å°å†™ï¼Œè¿™ä¸€ç‚¹ä¸æ‰‹åŠ¨setæ³¨å…¥æœ‰ç‚¹ä¸åŒã€‚ byTypeï¼šæŸ¥æ‰¾æ‰€æœ‰çš„setæ–¹æ³•ï¼Œå°†ç¬¦åˆç¬¦åˆå‚æ•°ç±»å‹çš„beanæ³¨å…¥ã€‚ 12345678@Servicepublic class UserServiceImpl &#123; @Autowired private UserDaoImpl userDao; public List&lt;User&gt; findUserList() &#123; return userDao.findUserList(); &#125;&#125; IOCå’ŒDIä½¿ç”¨é—®é¢˜å°ç»“ ä¸ºä»€ä¹ˆæ¨èæ„é€ å™¨æ³¨å…¥æ–¹å¼ï¼Ÿ Springæ–‡æ¡£ä¸­ï¼Œæœ‰è¿™ä¹ˆä¸€æ®µæè¿°ï¼š The Spring team generally advocates constructor injection as it enables one to implement application components as immutable objects and to ensure that required dependencies are not null. Furthermore constructor-injected components are always returned to client (calling) code in a fully initialized state. Springå›¢é˜Ÿé€šå¸¸æå€¡æ„é€ å‡½æ•°æ³¨å…¥ï¼Œå› ä¸ºå®ƒå…è®¸å°†åº”ç”¨ç¨‹åºç»„ä»¶å®ç°ä¸ºä¸å¯å˜å¯¹è±¡ï¼Œå¹¶ç¡®ä¿æ‰€éœ€çš„ä¾èµ–é¡¹ä¸ä¸ºç©ºã€‚æ­¤å¤–ï¼Œæ„é€ å‡½æ•°æ³¨å…¥çš„ç»„ä»¶æ€»æ˜¯ä»¥å®Œå…¨åˆå§‹åŒ–çš„çŠ¶æ€è¿”å›ç»™å®¢æˆ·ç«¯(è°ƒç”¨)ä»£ç ã€‚ ä¸å¯å˜å¯¹è±¡ï¼šå…¶å®è¯´çš„å°±æ˜¯finalå…³é”®å­— ä¾èµ–é¡¹ä¸ä¸ºç©ºï¼šå½“å®ä¾‹åŒ–UserServiceImplçš„æ—¶å€™ï¼Œç”±äºè‡ªå·±å®ç°äº†æœ‰å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥ä¸ä¼šè°ƒç”¨é»˜è®¤æ„é€ å‚æ•°ï¼Œé‚£ä¹ˆå°±éœ€è¦Springå®¹å™¨ä¼ å…¥æ‰€éœ€è¦çš„æ­¤å‚æ•°ï¼Œè¿™æ—¶å°±ä¼šå‡ºç°ä¸¤ç§æƒ…å†µï¼šæœ‰è¯¥ç±»å‹çš„å‚æ•°ï¼Œä¼ å…¥ï¼›æ²¡æœ‰ï¼ŒæŠ¥é”™ã€‚ å®Œå…¨åˆå§‹åŒ–çš„çŠ¶æ€ï¼šè¿™ä¸ªå¯ä»¥è·Ÿä¸Šé¢çš„ä¾èµ–é¡¹ä¸ä¸ºç©ºç»„åˆèµ·æ¥çœ‹ï¼Œå‘æ„é€ å™¨ä¼ å‚ä¹‹å‰ï¼Œè¦ç¡®ä¿æ³¨å…¥çš„å†…å®¹ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆè‚¯å®šè¦è°ƒç”¨ä¾èµ–ç»„ä»¶çš„æ„é€ æ–¹æ³•å®Œæˆå®ä¾‹åŒ–ã€‚è€Œåœ¨Javaç±»åŠ è½½å®ä¾‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæ„é€ æ–¹æ³•æ˜¯æœ€åä¸€æ­¥ï¼ˆä¹‹å‰é‚£å¦‚æœæœ‰çˆ¶ç±»å…ˆåˆå§‹åŒ–çˆ¶ç±»ï¼Œç„¶åè‡ªå·±çš„æˆå‘˜å˜é‡ï¼Œæœ€åæ‰æ˜¯æ„é€ æ–¹æ³•ï¼‰ï¼Œæ‰€ä»¥è¿”å›æ¥çš„éƒ½æ˜¯åˆå§‹åŒ–ä¹‹åçš„çŠ¶æ€ã€‚ 1234567@Servicepublic class UserServiceImpl&#123; private final UserDaoImpl userDao; public UserServiceImpl(final UserDaoImpl userDaoImpl)&#123; this.userDao = userDaoImpl; &#125;&#125; å¦‚æœä½¿ç”¨setteræ³¨å…¥ï¼Œç¼ºç‚¹æ˜¾è€Œæ˜“è§ï¼Œå¯¹äºIOCå®¹å™¨ä»¥å¤–çš„ç¯å¢ƒï¼Œé™¤äº†ä½¿ç”¨åå°„æ¥æä¾›å®ƒéœ€è¦çš„ä»¥æ¥ä¹‹å¤–ï¼Œæ— æ³•æ— ç”¨è¯¥ç±»çš„å®ç°ç±»ã€‚è€Œä¸”å°†ä¸€ç›´æ˜¯ä¸ªæ½œåœ¨éšæ‚£ï¼Œå› ä¸ºä½ ä¸è°ƒç”¨å°†ä¸€ç›´æ— æ³•ç¡®å®šNullPointerExceptionå¼‚å¸¸æ˜¯å¦å­˜åœ¨ã€‚ å¾ªç¯ä¾èµ–é—®é¢˜ ä½¿ç”¨fieldæ¤å…¥å¯èƒ½å¯¼è‡´å¾ªç¯ä¾èµ–ï¼Œå³Aé‡Œé¢æ³¨å…¥Bï¼ŒBé‡Œé¢æ³¨å…¥Aï¼š 12345678public class A&#123; @Autowired private B b;&#125;public class B&#123; @Autowired private A a;&#125; å¦‚æœä½¿ç”¨æ„é€ å™¨æ³¨å…¥ï¼Œåœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™ï¼Œå°±ä¼šæŠ›å‡ºBeanCurrentlyCreationException:Requested bean is currently in creation:Is there an unresolvable circular reference?ä»è€Œåœ¨é¡¹ç›®å¯åŠ¨ä¹‹å‰å¤„ç†æ‰å¾ªç¯ä¾èµ–çš„é—®é¢˜ã€‚ DIçš„ä¸‰ç§æ³¨è§£ @Autowired Spring2.5å¼•å…¥äº†@Autowiredæ³¨è§£ï¼š 123456@Target(&#123;ElementType.CONSTRUCTOR, ElementType.METHOD, ElementType.PARAMETER, ElementType.FIELD, ElementType.ANNOTATION_TYPE&#125;)@Retention(RetentionPolicy.RUNTIME)@Documentedpublic @interface Autowired &#123; boolean required() default true;&#125; ä»å…ƒæ³¨è§£@Targetæ³¨è§£ä¸Šçœ‹ï¼Œå¯ä»¥ä½¿ç”¨åœ¨ï¼š ElementType.CONSTRUCTOR æ„é€ å‡½æ•° ElementType.METHOD æ–¹æ³• ElementType.PARAMETER æ–¹æ³•å‚æ•° ElementType.FIELD å­—æ®µã€æšä¸¾çš„å¸¸é‡ ElementType.ANNOTATION_TYPE æ³¨è§£ è¿˜æœ‰ä¸€ä¸ªrequiredï¼Œé»˜è®¤æ˜¯trueï¼Œä»£è¡¨æ³¨å…¥beançš„æ—¶å€™è¯¥beanå¿…é¡»å­˜åœ¨ï¼Œä¸ç„¶å°±ä¼šæ³¨å…¥å¤±è´¥ï¼›è®¾ç½®æˆfalseï¼Œä»£è¡¨æ³¨å…¥beanæ—¶ï¼Œbeanå­˜åœ¨ï¼Œåˆ™æ³¨å…¥æˆåŠŸï¼›ä¸å­˜åœ¨å°±å¿½ç•¥è·³è¿‡ï¼Œå¯åŠ¨æ—¶ä¸æŠ¥é”™ï¼Œä¼šå°†NullPointerExceptionéšè—ã€‚ @Autowiredæ€»ç»“ï¼š æ˜¯Springè‡ªå¸¦çš„æ³¨è§£ï¼Œé€šè¿‡AutowiredAnnotationBeanPostProcessorç±»å®ç°çš„ä¾èµ–æ³¨å…¥ã€‚ å¯ä»¥ä½œç”¨åœ¨æ„é€ å‡½æ•°ï¼Œæ–¹æ³•ï¼Œæ–¹æ³•å‚æ•°ï¼Œå­—æ®µã€æšä¸¾çš„å¸¸é‡ï¼Œæ³¨è§£ é»˜è®¤æ ¹æ®ç±»å‹(byType)è¿›è¡Œè‡ªåŠ¨è£…é… ğŸ”¶ â€‹å¦‚æœæœ‰å¤šä¸ªç±»å‹ä¸€æ ·çš„Beanå€™é€‰è€…ï¼Œéœ€è¦æŒ‡å®šæŒ‰ç…§åç§°(byName)è¿›è¡Œè£…é…ï¼Œåˆ™éœ€è¦é…åˆ@Qualifier 123@Qualifier(&quot;xxxxyyyy&quot;)@Autowired(required = false)private HelloDao helloDao; @Resoure 123456@Target(&#123;TYPE, FIELD, METHOD&#125;)@Retention(RUNTIME)public @interface Resource &#123; String name() default &quot;&quot;; // ...&#125; ä»å…ƒæ³¨è§£@Targetæ³¨è§£ä¸Šçœ‹ï¼Œå¯ä»¥ä½¿ç”¨åœ¨ï¼š TYPE æ¥å£ã€ç±»ã€æšä¸¾ã€æ³¨è§£ FIELD å­—æ®µã€æšä¸¾çš„å¸¸é‡ METHOD æ–¹æ³• nameæŒ‡å®šæ³¨å…¥æŒ‡å®šåç§°çš„ç»„ä»¶ã€‚ @Resoureæ€»ç»“ï¼š æ˜¯JSR250è§„èŒƒçš„æ˜¯å®ç°ï¼Œåœ¨javax.annotationåŒ…ä¸‹ å¯ä»¥ä½œç”¨åœ¨TYPE, FIELD, METHOD é»˜è®¤æ ¹æ®å±æ€§åç§°è¿›è¡Œè‡ªåŠ¨è£…é…çš„ï¼Œå¦‚æœæœ‰å¤šä¸ªç±»å‹ä¸€æ ·çš„Beanå€™é€‰è€…ï¼Œåˆ™å¯ä»¥é€šè¿‡nameè¿›è¡ŒæŒ‡å®šè¿›è¡Œæ³¨å…¥ 123456@Componentpublic class SuperMan &#123; @Resource(name = &quot;BMW&quot;) private Car car;&#125;// nameçš„ä½œç”¨ç±»ä¼¼äº@Qualifier @Inject 1234@Target(&#123; METHOD, CONSTRUCTOR, FIELD &#125;)@Retention(RUNTIME)@Documentedpublic @interface Inject &#123;&#125; ä»å…ƒæ³¨è§£@Targetæ³¨è§£ä¸Šçœ‹ï¼Œå¯ä»¥ä½¿ç”¨åœ¨ï¼š CONSTRUCTOR æ„é€ å‡½æ•° FIELD å­—æ®µã€æšä¸¾çš„å¸¸é‡ METHOD æ–¹æ³• @Injectæ€»ç»“ï¼š æ˜¯JSR330 (Dependency Injection for Java)ä¸­çš„è§„èŒƒï¼Œéœ€è¦å¯¼å…¥javax.inject.Inject jaråŒ… ï¼Œæ‰èƒ½å®ç°æ³¨å…¥ å¯ä»¥ä½œç”¨CONSTRUCTORã€METHODã€FIELDä¸Š æ ¹æ®ç±»å‹è¿›è¡Œè‡ªåŠ¨è£…é…çš„ï¼Œå¦‚æœéœ€è¦æŒ‰åç§°è¿›è¡Œè£…é…ï¼Œåˆ™éœ€è¦é…åˆ@Namedï¼› 123@Inject@Named(&quot;BMW&quot;) // ä½œç”¨ç±»ä¼¼äº@Qualifierprivate Car car; æ€»ç»“ @Autowiredæ˜¯Springè‡ªå¸¦çš„ï¼Œ@Resourceæ˜¯JSR250è§„èŒƒå®ç°çš„ï¼Œ@Injectæ˜¯JSR330è§„èŒƒå®ç°çš„ @Autowiredã€@Injectç”¨æ³•åŸºæœ¬ä¸€æ ·ï¼Œä¸åŒçš„æ˜¯@Injectæ²¡æœ‰requiredå±æ€§ @Autowiredã€@Injectæ˜¯é»˜è®¤æŒ‰ç…§ç±»å‹åŒ¹é…çš„ï¼Œ@Resourceæ˜¯æŒ‰ç…§åç§°åŒ¹é…çš„ @Autowiredå¦‚æœéœ€è¦æŒ‰ç…§åç§°åŒ¹é…éœ€è¦å’Œ@Qualifierä¸€èµ·ä½¿ç”¨ï¼Œ@Injectå’Œ@Namedä¸€èµ·ä½¿ç”¨ï¼Œ@Resourceåˆ™é€šè¿‡nameè¿›è¡ŒæŒ‡å®š ğŸ”— Springæºç åˆ†æ@Autowiredã€@Resourceæ³¨è§£çš„åŒºåˆ«","categories":[{"name":"Spring","slug":"Spring","permalink":"https://solitaire-12.github.io/categories/Spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://solitaire-12.github.io/tags/spring/"},{"name":"IOC","slug":"IOC","permalink":"https://solitaire-12.github.io/tags/IOC/"}]},{"title":"Spring|åŸºç¡€|ç¬¬ä¸€ä¸ªspringé¡¹ç›®","slug":"spring/springé¡¹ç›®","date":"2024-03-25T08:05:00.000Z","updated":"2024-03-25T08:44:59.827Z","comments":true,"path":"2024/03/25/spring/springé¡¹ç›®/","permalink":"https://solitaire-12.github.io/2024/03/25/spring/spring%E9%A1%B9%E7%9B%AE/","excerpt":"","text":"hello Spring ç»“åˆä¸Šé¢çš„ä½¿ç”¨åœºæ™¯ï¼Œè®¾è®¡ä¸€ä¸ªæŸ¥è¯¢ç”¨æˆ·çš„æ¡ˆä¾‹çš„ä¸¤ä¸ªéœ€æ±‚ï¼Œæ¥çœ‹Springæ¡†æ¶å¸®æˆ‘ä»¬ç®€åŒ–äº†ä»€ä¹ˆå¼€å‘å·¥ä½œ: æŸ¥è¯¢ç”¨æˆ·æ•°æ® - æ¥çœ‹DAO+POJO-&gt; Service çš„åˆå§‹åŒ–å’Œè£…è½½ã€‚ ç»™æ‰€æœ‰Serviceçš„æŸ¥è¯¢æ–¹æ³•è®°å½•æ—¥å¿— åˆ›å»ºmavené¡¹ç›® æ·»åŠ pomä¾èµ– 1234567891011121314151617181920212223242526272829&lt;properties&gt; &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt; &lt;spring.version&gt;5.3.9&lt;/spring.version&gt; &lt;aspectjweaver.version&gt;1.9.6&lt;/aspectjweaver.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-context&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-core&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-beans&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.aspectj&lt;/groupId&gt; &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt; &lt;version&gt;$&#123;aspectjweaver.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; åˆ›å»ºç”¨æˆ·å®ä¾‹ - User 12345678910111213141516171819202122232425262728public class User &#123; private String userName; private Integer age; public User() &#123; &#125; public User(String userName, Integer age) &#123; this.userName = userName; this.age = age; &#125; public String getUserName() &#123; return userName; &#125; public void setUserName(String userName) &#123; this.userName = userName; &#125; public Integer getAge() &#123; return age; &#125; public void setAge(Integer age) &#123; this.age = age; &#125;&#125; é…ç½®daoå±‚ 1234567891011public class UserDaoImpl &#123; public UserDaoImpl() &#123; &#125; /** * forged a query instance of the findUserList method */ public List&lt;User&gt; findUserList()&#123; return Collections.singletonList(new User(&quot;wey&quot;,18)); &#125;&#125; é…ç½®daos.xml 12345678910&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt; &lt;bean id=&quot;userDao&quot; class=&quot;x.dao.UserDaoImpl&quot;&gt; &lt;!-- additional collaborators and configuration for this bean go here --&gt; &lt;/bean&gt; &lt;!-- more bean definitions for data access objects go here --&gt;&lt;/beans&gt; é…ç½®æœåŠ¡å±‚ 123456789101112131415public class UserServiceImpl &#123; private UserDaoImpl userDao; public UserServiceImpl() &#123; &#125; // get the result of the forged a query instance of the findUserList method public List&lt;User&gt; findUserList()&#123; return this.userDao.findUserList(); &#125; public void setUserDao(UserDaoImpl userDao)&#123; this.userDao = userDao; &#125;&#125; é…ç½®services.xml 1234567891011121314151617&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt; &lt;!-- services --&gt; &lt;bean id=&quot;userService&quot; class=&quot;x.service.UserServiceImpl&quot;&gt; &lt;!-- ps:The ref attribute of the property may be marked red in IDEA, but this does not affect the execution result --&gt; &lt;property name=&quot;userDao&quot; ref=&quot;userDao&quot;/&gt; &lt;!-- additional collaborators and configuration for this bean go here --&gt; &lt;/bean&gt;&lt;!-- ps:If you don&#x27;t want to see this red mark, add the following line of code --&gt;&lt;!-- &lt;bean id=&quot;userDao&quot; class=&quot;x.dao.UserDaoImpl&quot;/&gt;--&gt; &lt;!-- more bean definitions for services go here --&gt;&lt;/beans&gt; é…ç½®aspect 123456789101112131415@Aspectpublic class LogAspect &#123; /** * set aspect to get the name of the service method being done * @param pjp * @return * @throws Throwable */ @Around(&quot;execution(* x.service.*.*(..))&quot;) public Object businessService(ProceedingJoinPoint pjp) throws Throwable&#123; Method method = ((MethodSignature) pjp.getSignature()).getMethod(); System.out.println(&quot;execute method:&quot;+method.getName()); return pjp.proceed(); &#125;&#125; é…ç½®axpects.xml 12345678910111213141516171819202122&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt; &lt;context:component-scan base-package=&quot;x&quot; /&gt; &lt;aop:aspectj-autoproxy/&gt; &lt;bean id=&quot;logAspect&quot; class=&quot;x.aspect.LogAspect&quot;&gt; &lt;!-- configure properties of x.aspect here as normal --&gt; &lt;/bean&gt; &lt;!-- more bean definitions for data access objects go here --&gt;&lt;/beans&gt; å®ç°App 12345678910111213141516public class App &#123; public static void main(String[] args) &#123; // create and configure beans ApplicationContext context = new ClassPathXmlApplicationContext(&quot;aspects.xml&quot;, &quot;daos.xml&quot;, &quot;services.xml&quot;); // retrieve configured instance UserServiceImpl service = context.getBean(&quot;userService&quot;, UserServiceImpl.class); // use configured instance List&lt;User&gt; userList = service.findUserList(); // print info from beans userList.forEach(a -&gt; System.out.println(a.getUserName() + &quot;,&quot; + a.getAge())); &#125;&#125; é¡¹ç›®ç»“æ„ ç®€åŒ–ä¸Šè¿°é¡¹ç›®çš„é…ç½® é€šè¿‡configç®€åŒ–é…ç½® 12345678910111213141516171819202122232425262728293031323334353637383940414243444546@EnableAspectJAutoProxy@Configurationpublic class BeanConfig &#123; /** * @return userDao */ @Bean(&quot;userDao&quot;) public UserDaoImpl userDao()&#123; return new UserDaoImpl(); &#125; /** * @return user service */ @Bean(&quot;userService&quot;) public UserServiceImpl userService() &#123; UserServiceImpl userService = new UserServiceImpl(); userService.setUserDao(userDao()); return userService; &#125; /** * @return log aspect */ @Bean(&quot;logAspect&quot;) public LogAspect logAspect() &#123; return new LogAspect(); &#125;&#125;public class App &#123; public static void main(String[] args) &#123; // create and configure beans AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(BeanConfig.class); // retrieve configured instance UserServiceImpl service = context.getBean(&quot;userService&quot;, UserServiceImpl.class); // use configured instance List&lt;User&gt; userList = service.findUserList(); // print info from beans userList.forEach(a -&gt; System.out.println(a.getUserName() + &quot;,&quot; + a.getAge())); &#125;&#125; è¿™ç§ç®€åŒ–æ–¹å¼ï¼Œæ²¡åˆ›å»ºä¸€ä¸ªBeanéƒ½éœ€è¦åœ¨configæ–‡ä»¶ä¸­å»æ·»åŠ ç›¸åº”çš„æ˜ å°„ã€‚ â­æ³¨è§£ç®€åŒ–é…ç½® 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354@Configuration@EnableAspectJAutoProxypublic class BeanConfig &#123;&#125;// UserDaoImpl æ·»åŠ @Repositoryæ³¨è§£@Repositorypublic class UserDaoImpl &#123; /** * forged a query instance of the findUserList method */ public List&lt;User&gt; findUserList()&#123; return Collections.singletonList(new User(&quot;wey&quot;,18)); &#125;&#125;// UserServiceImplæ·»åŠ äº†@Serviceæ³¨è§£ï¼Œå¹¶é€šè¿‡@Autowiredæ³¨è§£æ³¨å…¥userDao@Servicepublic class UserServiceImpl &#123; /** * user dao impl. */ @Autowired private UserDaoImpl userDao; /** * find user list. * @return user list */ public List&lt;User&gt; findUserList() &#123; return userDao.findUserList(); &#125;&#125;// apppublic class App &#123; public static void main(String[] args) &#123; // create and configure beans AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext( &quot;x&quot;); // retrieve configured instance UserServiceImpl service = context.getBean(UserServiceImpl.class); // use configured instance List&lt;User&gt; userList = service.findUserList(); // print info from beans userList.forEach(a -&gt; System.out.println(a.getUserName() + &quot;,&quot; + a.getAge())); &#125;&#125; ğŸŒŸSpringBootæ‰˜ç®¡ SpringBootå®é™…ä¸Šé€šè¿‡çº¦å®šå¤§äºé…ç½®çš„æ–¹å¼ï¼Œä½¿ç”¨xx-starterç»Ÿä¸€çš„å¯¹Beanè¿›è¡Œé»˜è®¤åˆå§‹åŒ–ï¼Œç”¨æˆ·åªéœ€è¦å¾ˆå°‘çš„é…ç½®å°±å¯ä»¥è¿›è¡Œå¼€å‘äº†ã€‚","categories":[{"name":"Spring","slug":"Spring","permalink":"https://solitaire-12.github.io/categories/Spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://solitaire-12.github.io/tags/spring/"}]},{"title":"Spring|åŸºç¡€|æ¡†æ¶çš„ç»„æˆ","slug":"spring/springæ¡†æ¶è§£æ","date":"2024-03-25T07:31:00.000Z","updated":"2024-03-25T08:35:08.642Z","comments":true,"path":"2024/03/25/spring/springæ¡†æ¶è§£æ/","permalink":"https://solitaire-12.github.io/2024/03/25/spring/spring%E6%A1%86%E6%9E%B6%E8%A7%A3%E6%9E%90/","excerpt":"","text":"Springæ¡†æ¶çš„ç‰¹æ€§ä¸ä¼˜åŠ¿ ç‰¹æ€§ éä¾µå…¥å¼ï¼šåŸºäºSpringå¼€å‘çš„åº”ç”¨ä¸­çš„å¯¹è±¡å¯ä»¥ä¸ä¾èµ–äºSpringçš„API æ§åˆ¶åè½¬ï¼šIOCï¼ˆInversion of controlï¼‰ï¼ŒæŒ‡çš„æ˜¯å°†å¯¹è±¡çš„åˆ›å»ºæƒäº¤ç»™Springå»åˆ›å»ºã€‚ä½¿ç”¨Springä¹‹å‰ï¼Œå¯¹è±¡çš„åˆ›å»ºéƒ½æ˜¯ç”±æˆ‘ä»¬åœ¨ä»£ç newå‡ºæ¥çš„ï¼Œä½¿ç”¨Springä¹‹åï¼Œå¯¹è±¡çš„åˆ›å»ºå°±å¯ä»¥äº¤ç»™Springæ¡†æ¶ã€‚ ä¾èµ–æ³¨å…¥ï¼šDIï¼ˆDependency Injectionï¼‰ï¼Œæ˜¯æŒ‡ä¾èµ–çš„å¯¹è±¡ä¸éœ€è¦æ‰‹åŠ¨çš„è°ƒç”¨setæ–¹æ³•å»è®¾ç½®ï¼Œè€Œæ˜¯é€šè¿‡é…ç½®èµ‹å€¼ã€‚ é¢å‘åˆ‡é¢ï¼šAOPï¼ˆAspect Oriented Programmingï¼‰ å®¹å™¨ï¼šSpringæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œä»¥ä¸ºå®ƒåŒ…å«å¹¶ä¸”ç®¡ç†å¼•ç”¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ ç»„ä»¶åŒ–ï¼šSpringå®ç°äº†ä½¿ç”¨ç®€å•çš„ç»„ä»¶é…ç½®ç»„åˆæˆä¸€ä¸ªå¤æ‚çš„åº”ç”¨ã€‚åœ¨Springä¸­å¯ä»¥ä½¿ç”¨XMLå’ŒJavaæ³¨è§£ç»„åˆè¿™äº›å¯¹è±¡ã€‚ ä¸€ç«™å¼ï¼š åœ¨ IOC å’Œ AOP çš„åŸºç¡€ä¸Šå¯ä»¥æ•´åˆå„ç§ä¼ä¸šåº”ç”¨çš„å¼€æºæ¡†æ¶å’Œä¼˜ç§€çš„ç¬¬ä¸‰æ–¹ç±»åº“ï¼ˆå®é™…ä¸Š Spring è‡ªèº«ä¹Ÿæä¾›äº†è¡¨ç°å±‚çš„ Spring MVC å’ŒæŒä¹…å±‚çš„ Spring JDBCï¼‰ å¥½å¤„ Spring å¯ä»¥ä½¿å¼€å‘äººå‘˜ä½¿ç”¨ POJOs å¼€å‘ä¼ä¸šçº§çš„åº”ç”¨ç¨‹åºã€‚åªä½¿ç”¨ POJOs çš„å¥½å¤„æ˜¯ä½ ä¸éœ€è¦ä¸€ä¸ª EJB å®¹å™¨äº§å“ï¼Œæ¯”å¦‚ä¸€ä¸ªåº”ç”¨ç¨‹åºæœåŠ¡å™¨ï¼Œä½†æ˜¯ä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨ä¸€ä¸ªå¥å£®çš„ servlet å®¹å™¨ï¼Œæ¯”å¦‚ Tomcat æˆ–è€…ä¸€äº›å•†ä¸šäº§å“ã€‚ Spring åœ¨ä¸€ä¸ªå•å…ƒæ¨¡å¼ä¸­æ˜¯æœ‰ç»„ç»‡çš„ã€‚å³ä½¿åŒ…å’Œç±»çš„æ•°é‡éå¸¸å¤§ï¼Œä½ åªè¦æ‹…å¿ƒä½ éœ€è¦çš„ï¼Œè€Œå…¶å®ƒçš„å°±å¯ä»¥å¿½ç•¥äº†ã€‚ Spring ä¸ä¼šè®©ä½ ç™½è´¹åŠ›æ°”åšé‡å¤å·¥ä½œï¼Œå®ƒçœŸæ­£çš„åˆ©ç”¨äº†ä¸€äº›ç°æœ‰çš„æŠ€æœ¯ï¼Œåƒ ORM æ¡†æ¶ã€æ—¥å¿—æ¡†æ¶ã€JEEã€Quartz å’Œ JDK è®¡æ—¶å™¨ï¼Œå…¶ä»–è§†å›¾æŠ€æœ¯ã€‚ æµ‹è¯•ä¸€ä¸ªç”¨ Spring ç¼–å†™çš„åº”ç”¨ç¨‹åºå¾ˆå®¹æ˜“ï¼Œå› ä¸ºç¯å¢ƒç›¸å…³çš„ä»£ç è¢«ç§»åŠ¨åˆ°è¿™ä¸ªæ¡†æ¶ä¸­ã€‚æ­¤å¤–ï¼Œé€šè¿‡ä½¿ç”¨ JavaBean-style POJOsï¼Œå®ƒåœ¨ä½¿ç”¨ä¾èµ–æ³¨å…¥æ³¨å…¥æµ‹è¯•æ•°æ®æ—¶å˜å¾—æ›´å®¹æ˜“ã€‚ Spring çš„ web æ¡†æ¶æ˜¯ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„ web MVC æ¡†æ¶ï¼Œå®ƒä¸ºæ¯”å¦‚ Structs æˆ–è€…å…¶ä»–å·¥ç¨‹ä¸Šçš„æˆ–è€…ä¸æ€ä¹ˆå—æ¬¢è¿çš„ web æ¡†æ¶æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„ä¾›æ›¿ä»£çš„é€‰æ‹©ã€‚MVC æ¨¡å¼å¯¼è‡´åº”ç”¨ç¨‹åºçš„ä¸åŒæ–¹é¢(è¾“å…¥é€»è¾‘ï¼Œä¸šåŠ¡é€»è¾‘å’ŒUIé€»è¾‘)åˆ†ç¦»ï¼ŒåŒæ—¶æä¾›è¿™äº›å…ƒç´ ä¹‹é—´çš„æ¾æ•£è€¦åˆã€‚æ¨¡å‹(Model)å°è£…äº†åº”ç”¨ç¨‹åºæ•°æ®ï¼Œé€šå¸¸å®ƒä»¬å°†ç”± POJO ç±»ç»„æˆã€‚è§†å›¾(View)è´Ÿè´£æ¸²æŸ“æ¨¡å‹æ•°æ®ï¼Œä¸€èˆ¬æ¥è¯´å®ƒç”Ÿæˆå®¢æˆ·ç«¯æµè§ˆå™¨å¯ä»¥è§£é‡Š HTML è¾“å‡ºã€‚æ§åˆ¶å™¨(Controller)è´Ÿè´£å¤„ç†ç”¨æˆ·è¯·æ±‚å¹¶æ„å»ºé€‚å½“çš„æ¨¡å‹ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™è§†å›¾è¿›è¡Œæ¸²æŸ“ã€‚ Spring å¯¹ JavaEE å¼€å‘ä¸­éå¸¸éš¾ç”¨çš„ä¸€äº› APIï¼ˆJDBCã€JavaMailã€è¿œç¨‹è°ƒç”¨ç­‰ï¼‰ï¼Œéƒ½æä¾›äº†å°è£…ï¼Œä½¿è¿™äº›APIåº”ç”¨éš¾åº¦å¤§å¤§é™ä½ã€‚ è½»é‡çº§çš„ IOC å®¹å™¨å¾€å¾€æ˜¯è½»é‡çº§çš„ï¼Œä¾‹å¦‚ï¼Œç‰¹åˆ«æ˜¯å½“ä¸ EJB å®¹å™¨ç›¸æ¯”çš„æ—¶å€™ã€‚è¿™æœ‰åˆ©äºåœ¨å†…å­˜å’Œ CPU èµ„æºæœ‰é™çš„è®¡ç®—æœºä¸Šå¼€å‘å’Œéƒ¨ç½²åº”ç”¨ç¨‹åºã€‚ Spring æä¾›äº†ä¸€è‡´çš„äº‹åŠ¡ç®¡ç†æ¥å£ï¼Œå¯å‘ä¸‹æ‰©å±•åˆ°ï¼ˆä½¿ç”¨ä¸€ä¸ªå•ä¸€çš„æ•°æ®åº“ï¼Œä¾‹å¦‚ï¼‰æœ¬åœ°äº‹åŠ¡å¹¶æ‰©å±•åˆ°å…¨å±€äº‹åŠ¡ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ JTAï¼‰ ç»„ä»¶ 1ï¸âƒ£Core Container(Springæ ¸å¿ƒå®¹å™¨) Beansæ¨¡å—ï¼šæä¾›äº†æ¡†æ¶çš„åŸºç¡€éƒ¨åˆ†ï¼ŒåŒ…æ‹¬æ§åˆ¶åè½¬å’Œä¾èµ–æ³¨å…¥ã€‚ Coreæ¨¡å—ï¼šå°è£…äº†Springæ¡†æ¶çš„åº•å±‚éƒ¨åˆ†ï¼ŒåŒ…æ‹¬èµ„æºè®¿é—®ã€ç±»å‹è½¬æ¢ä»¥åŠä¸€äº›å¸¸ç”¨çš„å·¥å…·ç±»ã€‚ Contextä¸Šä¸‹æ–‡æ¨¡å—ï¼šå»ºç«‹åœ¨Coreå’ŒBeansä¸¤ä¸ªæ¨¡å—çš„åŸºç¡€ä¹‹ä¸Šï¼Œé›†æˆBeansæ¨¡å—çš„åŠŸèƒ½å¹¶æ·»åŠ äº†èµ„æºç»‘å®šã€æ•°æ®éªŒè¯ã€å›½é™…åŒ–ã€Java EEæ”¯æŒã€å®¹å™¨ç”Ÿå‘½å‘¨æœŸã€äº‹ä»¶ä¼ æ’­ç­‰ã€‚ApplicationContextæ¥å£æ˜¯ä¸Šä¸‹æ–‡æ¨¡å—çš„ç„¦ç‚¹ã€‚ SpElï¼šæä¾›äº†å¼ºå¤§çš„è¡¨è¾¾å¼è¯­è¨€æ”¯æŒï¼Œæ”¯æŒè®¿é—®å’Œä¿®æ”¹å±æ€§å€¼ï¼Œæ–¹æ³•è°ƒç”¨ï¼Œæ”¯æŒè®¿é—®åŠä¿®æ”¹æ•°ç»„ã€å®¹å™¨å’Œç´¢å¼•å™¨ï¼Œå‘½åå˜é‡ï¼Œæ”¯æŒç®—æ•°å’Œé€»è¾‘è¿ç®—ï¼Œæ”¯æŒä»Springå®¹å™¨è·å–Beanï¼Œä¹Ÿæ”¯æŒåˆ—è¡¨æŠ•å½±ã€æ‚¬ç€å’Œä¸€èˆ¬çš„åˆ—è¡¨èšåˆã€‚ 2ï¸âƒ£Data Access/Integrationï¼ˆæ•°æ®è®¿é—®/é›†æˆï¼‰ JDBCæ¨¡å—ï¼šæä¾›äº†ä¸€ä¸ªJBDCçš„æ ·ä¾‹æ¨¡å—ï¼Œä½¿ç”¨è¿™äº›æ¨¡å—èƒ½æ¶ˆé™¤ä¼ ç»Ÿå†—é•¿çš„JDBCç¼–ç è¿˜æœ‰å¿…é¡»çš„äº‹åŠ¡æ§åˆ¶ï¼Œè€Œä¸”èƒ½äº«å—åˆ°Springç®¡ç†äº‹åŠ¡çš„å¥½å¤„ã€‚ ORMæ¨¡å—ï¼šæä¾›ä¸æµè¡Œçš„&quot;å¯¹è±¡-å…³ç³»&quot;æ˜ å°„æ¡†æ¶æ— ç¼é›†æˆçš„APIï¼ŒåŒ…æ‹¬JPAã€JDOã€Hibernateå’ŒMybatisç­‰ã€‚è€Œä¸”è¿˜å¯ä»¥ä½¿ç”¨Springäº‹åŠ¡ç®¡ç†ã€‚ OXMæ¨¡å—ï¼šæä¾›äº†ä¸€ä¸ªæ”¯æŒObject/XMLæ˜ å°„çš„æŠ½è±¡å±‚å®ç°ã€‚å¦‚JAXBã€Castorã€XMLBeansã€JiBXå’ŒXStreamã€‚å°†Javaå¯¹è±¡æ˜ å°„æˆXMLæ•°æ®ï¼Œæˆ–è€…å°†XMLæ•°æ®æ˜ å°„æˆJavaå¯¹è±¡ã€‚ JMSæ¨¡å—ï¼šæŒ‡Javaæ¶ˆæ¯æœåŠ¡ï¼Œæä¾›ä¸€å¥—&quot;æ¶ˆæ¯ç”Ÿäº§è€…/æ¶ˆè´¹è€…&quot;æ¨¡å—ç”¨äºæ›´ç®€å•çš„ä½¿ç”¨JMSï¼ŒJMSç”¨äºä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´ï¼Œæˆ–åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‘é€æ¶ˆæ¯ï¼Œè¿›è¡Œå¼‚æ­¥é€šä¿¡ã€‚ Transactionäº‹åŠ¡æ¨¡å—ï¼šæ”¯æŒç¼–ç¨‹å’Œå£°æ˜å¼äº‹åŠ¡ç®¡ç†ã€‚ 3ï¸âƒ£Webæ¨¡å— Webæ¨¡å—ï¼šæä¾›äº†åŸºæœ¬çš„Webå¼€å‘é›†æˆç‰¹æ€§ï¼Œä¾‹å¦‚å¤šæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œä½¿ç”¨çš„Servletç›‘å¬å™¨å’ŒIOCå®¹å™¨åˆå§‹åŒ–ä»¥åŠWebåº”ç”¨ä¸Šä¸‹æ–‡ã€‚ Servletæ¨¡å—ï¼šæä¾›äº†ä¸€ä¸ªSpring MVC Webæ¡†æ¶çš„æ˜¯å¿ƒå•Šã€‚Spring MVCæ¡†æ¶æä¾›äº†åŸºäºæ³¨è§£çš„è¯·æ±‚èµ„æºæ³¨å…¥ï¼Œæ›´ç®€å•çš„æ•°æ®ç»‘å®šã€æ•°æ®éªŒè¯ç­‰åŠä¸€å¥—éå¸¸æ˜“ç”¨çš„JSPæ ‡ç­¾ï¼Œå®Œå…¨æ— ç¼ä¸Springå…¶ä»–æŠ€æœ¯åä½œã€‚ Web Socketæ¨¡å—ï¼šæä¾›äº†ç®€å•çš„æ¥å£ï¼Œç”¨æˆ·åªè¦å®ç°å“åº”çš„æ¥å£å°±å¯ä»¥å¿«é€Ÿæ­å»ºWeb Socket Serverï¼Œä»è€Œå®ç°åŒå‘é€šè®¯ã€‚ Webfulxæ¨¡å—ï¼šSpring WebFluxæ˜¯Spring Framework5.xä¸­å¼•å…¥çš„æ–°çš„å“åº”å¼webæ¡†æ¶ã€‚å’ŒSpring MVCä¸åŒï¼Œå®ƒä¸éœ€è¦Servlet APIï¼Œæ˜¯å®Œå…¨å¼‚æ­¥éé˜»å¡çš„ï¼Œå¹¶ä¸”é€šè¿‡Reactorå®ç°äº†Reactive Streamsè§„èŒƒã€‚Spring WebFluxç”¨äºåˆ›å»ºåŸºäºäº‹ä»¶å¾ªç¯æ‰§è¡Œæ¨¡å‹çš„å®Œå…¨å¼‚æ­¥ä¸”éé˜»å¡çš„åº”ç”¨ç¨‹åºã€‚ Portletæ¨¡å—ï¼šæä¾›äº†åœ¨Portletç¯å¢ƒä¸­ä½¿ç”¨MVCå®ç°ï¼Œç±»ä¼¼Web-Servletæ¨¡å—çš„åŠŸèƒ½ã€‚ ï¼ˆæ­¤å¤–Spring4.xä¸­è¿˜æœ‰Portlet æ¨¡å—ï¼Œåœ¨Spring 5.xä¸­å·²ç»ç§»é™¤ ã€‚ï¼‰ 4ï¸âƒ£AOPã€Aspectã€Instrumentationå’ŒMessaging AOPæ¨¡å—ï¼šæä¾›äº†é¢å‘åˆ‡é¢ç¼–ç¨‹å®ç°ï¼Œæä¾›æ¯”å¦‚æ—¥å¿—è®°å½•ã€æƒé™æ§åˆ¶ã€çº¿ç¨‹ç»Ÿè®¡ç­‰é€šç”¨åŠŸèƒ½å’Œä¸šåŠ¡é€»è¾‘åˆ†ç¦»çš„æŠ€æœ¯ï¼Œå¹¶ä¸”èƒ½åŠ¨æ€çš„æŠŠè¿™äº›åŠŸèƒ½æ·»åŠ åˆ°éœ€è¦çš„ä»£ç ä¸­ï¼Œè¿™æ ·å„å¸å…¶èŒï¼Œé™ä½ä¸šåŠ¡é€»è¾‘å’Œé€šç”¨åŠŸèƒ½çš„è§£è€¦ã€‚ Aspectsæ¨¡å—ï¼šæä¾›ä¸AspectJçš„é›†æˆï¼Œæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”æˆç†Ÿçš„é¢å‘åˆ‡é¢ç¼–ç¨‹çš„ï¼ˆAOPï¼‰æ¡†æ¶ã€‚ Instrumentationæ¨¡å—ï¼šæä¾›äº†ç±»å·¥å…·çš„æ”¯æŒå’Œç±»åŠ è½½å™¨çš„å®ç°ï¼Œå¯ä»¥åœ¨ç‰¹å®šçš„åº”ç”¨æœåŠ¡å™¨ä¸­ä½¿ç”¨ã€‚ messagingæ¨¡å—ï¼šSpring 4.0ä»¥åæ–°å¢äº†é›„å®‰é”¡ï¼ˆSpring-messagingï¼‰æ¨¡å—ï¼Œè¯¥æ¨¡å—æä¾›äº†å¯¹æ¶ˆæ¯ä¼ é€’ä½“ç³»ç»“æ„çš„åè®®çš„æ”¯æŒã€‚ jclæ¨¡å—ï¼šSpring 5.xä¸­æ–°å¢äº†æ—¥å¿—æ¡†æ¶é›†æˆçš„æ¨¡å—ã€‚ 5ï¸âƒ£Testæ¨¡å— Test æ¨¡å—ï¼šSpring æ”¯æŒ Junit å’Œ TestNG æµ‹è¯•æ¡†æ¶ï¼Œè€Œä¸”è¿˜é¢å¤–æä¾›äº†ä¸€äº›åŸºäº Spring çš„æµ‹è¯•åŠŸèƒ½ï¼Œæ¯”å¦‚åœ¨æµ‹è¯• Web æ¡†æ¶æ—¶ï¼Œæ¨¡æ‹Ÿ Http è¯·æ±‚çš„åŠŸèƒ½ã€‚ åŒ…å«Mock Objects, TestContext Framework, Spring MVC Test, WebTestClientã€‚","categories":[{"name":"Spring","slug":"Spring","permalink":"https://solitaire-12.github.io/categories/Spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://solitaire-12.github.io/tags/spring/"}]},{"title":"Spring|æ±‡æ€»","slug":"spring/spring","date":"2024-03-25T07:30:00.000Z","updated":"2024-03-25T08:52:02.660Z","comments":true,"path":"2024/03/25/spring/spring/","permalink":"https://solitaire-12.github.io/2024/03/25/spring/spring/","excerpt":"","text":"springæ¡†æ¶è§£æ springé¡¹ç›® åŸºç¡€IOC åŸºç¡€AOP åŸºç¡€ - MVCè¯·æ±‚æµç¨‹ // todo è¿›é˜¶ - IOCå®ç°åŸç† ä½“ç³»æ¶æ„ æ•´ä½“åŠŸèƒ½ ç»“æ„è®¾è®¡ BeanFactoryå’ŒBeanRegistry IOCå®¹å™¨åŠŸèƒ½è§„èŒƒå’ŒBeançš„æ³¨å†Œ Spring Beançš„åˆ›å»ºæ—¶å…¸å‹çš„å·¥å‚æ¨¡å¼ï¼Œè¿™ä¸€ç³»åˆ—çš„Beanå·¥å‚ï¼Œä¹Ÿå°±æ˜¯IOCå®¹å™¨ã€‚ä¸ºå¯¹è±¡é—´çš„ä¾èµ–å…³ç³»æä¾›äº†å¾ˆå¤šä¾¿åˆ©å’ŒåŸºç¡€æœåŠ¡ï¼Œåœ¨Springä¸­æœ‰è®¸å¤šçš„IOCå®¹å™¨çš„å®ç°æä¾›ç”¨æˆ·é€‰æ‹©å’Œä½¿ç”¨ï¼Œè¿™æ˜¯IOCå®¹å™¨çš„åŸºç¡€ï¼›åœ¨é¡¶å±‚çš„ç»“æ„è®¾è®¡ä¸»è¦å›´ç»•ç€BeanFactoryå’ŒxxRegistryè¿›è¡Œï¼š BeanFactoryï¼šå·¥å‚æ¨¡å¼å®šä¹‰äº†IOCå®¹å™¨çš„åŸºæœ¬åŠŸèƒ½è§„èŒƒã€‚ BeanRegistoryï¼šå‘IOCå®¹å™¨æ‰‹å·¥æ³¨å†ŒBeanDefinitionå¯¹è±¡çš„æ–¹æ³•ã€‚ BeanFactoryä½œä¸ºæœ€é¡¶å±‚çš„ä¸€ä¸ªæ¥å£ç±»ï¼Œå®ƒå®šä¹‰äº†IOCå®¹å™¨çš„åŸºæœ¬åŠŸèƒ½è§„èŒƒï¼ŒBeanFactory æœ‰ä¸‰ä¸ªå­ç±»ï¼šListableBeanFactoryã€HierarchicalBeanFactory å’ŒAutowireCapableBeanFactoryã€‚æˆ‘ä»¬çœ‹ä¸‹BeanFactoryæ¥å£ï¼š 1234567891011121314151617181920212223242526272829303132333435public interface BeanFactory &#123; //ç”¨äºå–æ¶ˆå¼•ç”¨å®ä¾‹å¹¶å°†å…¶ä¸FactoryBeanåˆ›å»ºçš„beanåŒºåˆ†å¼€æ¥ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå‘½åçš„beanæ˜¯FactoryBeanï¼Œåˆ™è·å–å°†è¿”å›Factoryï¼Œè€Œä¸æ˜¯Factoryè¿”å›çš„å®ä¾‹ã€‚ String FACTORY_BEAN_PREFIX = &quot;&amp;&quot;; //æ ¹æ®beançš„åå­—å’ŒClassç±»å‹ç­‰æ¥å¾—åˆ°beanå®ä¾‹ Object getBean(String name) throws BeansException; Object getBean(String name, Class requiredType) throws BeansException; Object getBean(String name, Object... args) throws BeansException; &lt;T&gt; T getBean(Class&lt;T&gt; requiredType) throws BeansException; &lt;T&gt; T getBean(Class&lt;T&gt; requiredType, Object... args) throws BeansException; //è¿”å›æŒ‡å®šbeançš„Provider &lt;T&gt; ObjectProvider&lt;T&gt; getBeanProvider(Class&lt;T&gt; requiredType); &lt;T&gt; ObjectProvider&lt;T&gt; getBeanProvider(ResolvableType requiredType); //æ£€æŸ¥å·¥å‚ä¸­æ˜¯å¦åŒ…å«ç»™å®šnameçš„beanï¼Œæˆ–è€…å¤–éƒ¨æ³¨å†Œçš„bean boolean containsBean(String name); //æ£€æŸ¥æ‰€ç»™å®šnameçš„beanæ˜¯å¦ä¸ºå•ä¾‹/åŸå‹ boolean isSingleton(String name) throws NoSuchBeanDefinitionException; boolean isPrototype(String name) throws NoSuchBeanDefinitionException; //åˆ¤æ–­æ‰€ç»™nameçš„ç±»å‹ä¸typeæ˜¯å¦åŒ¹é… boolean isTypeMatch(String name, ResolvableType typeToMatch) throws NoSuchBeanDefinitionException; boolean isTypeMatch(String name, Class&lt;?&gt; typeToMatch) throws NoSuchBeanDefinitionException; //è·å–ç»™å®šnameçš„beançš„ç±»å‹ @Nullable Class&lt;?&gt; getType(String name) throws NoSuchBeanDefinitionException; //è¿”å›ç»™å®šnameçš„beançš„åˆ«å String[] getAliases(String name); &#125; â“BeanFactoryä¸ºä½•è¦å®šä¹‰è¿™ä¹ˆå¤šå±‚æ¬¡çš„æ¥å£ï¼Ÿå®šä¹‰äº†å“ªäº›æ¥å£ï¼Ÿ ä¸»è¦æ˜¯ä¸ºäº†åŒºåˆ†åœ¨ Spring å†…éƒ¨åœ¨æ“ä½œè¿‡ç¨‹ä¸­å¯¹è±¡çš„ä¼ é€’å’Œè½¬åŒ–è¿‡ç¨‹ä¸­ï¼Œå¯¹å¯¹è±¡çš„æ•°æ®è®¿é—®æ‰€åšçš„é™åˆ¶ã€‚ ListableBeanFactoryï¼šè¯¥æ¥å£å®šä¹‰äº†è®¿é—®å®¹å™¨ä¸­ Bean åŸºæœ¬ä¿¡æ¯çš„è‹¥å¹²æ–¹æ³•ï¼Œå¦‚æŸ¥çœ‹Bean çš„ä¸ªæ•°ã€è·å–æŸä¸€ç±»å‹ Bean çš„é…ç½®åã€æŸ¥çœ‹å®¹å™¨ä¸­æ˜¯å¦åŒ…æ‹¬æŸä¸€ Bean ç­‰æ–¹æ³•ï¼› HierarchicalBeanFactoryï¼šçˆ¶å­çº§è” IoC å®¹å™¨çš„æ¥å£ï¼Œå­å®¹å™¨å¯ä»¥é€šè¿‡æ¥å£æ–¹æ³•è®¿é—®çˆ¶å®¹å™¨ï¼› é€šè¿‡ HierarchicalBeanFactory æ¥å£ï¼Œ Spring çš„ IoC å®¹å™¨å¯ä»¥å»ºç«‹çˆ¶å­å±‚çº§å…³è”çš„å®¹å™¨ä½“ç³»ï¼Œå­å®¹å™¨å¯ä»¥è®¿é—®çˆ¶å®¹å™¨ä¸­çš„ Beanï¼Œä½†çˆ¶å®¹å™¨ä¸èƒ½è®¿é—®å­å®¹å™¨çš„ Beanã€‚Spring ä½¿ç”¨çˆ¶å­å®¹å™¨å®ç°äº†å¾ˆå¤šåŠŸèƒ½ï¼Œæ¯”å¦‚åœ¨ Spring MVC ä¸­ï¼Œå±•ç°å±‚ Bean ä½äºä¸€ä¸ªå­å®¹å™¨ä¸­ï¼Œè€Œä¸šåŠ¡å±‚å’ŒæŒä¹…å±‚çš„ Bean ä½äºçˆ¶å®¹å™¨ä¸­ã€‚è¿™æ ·ï¼Œå±•ç°å±‚ Bean å°±å¯ä»¥å¼•ç”¨ä¸šåŠ¡å±‚å’ŒæŒä¹…å±‚çš„ Beanï¼Œè€Œä¸šåŠ¡å±‚å’ŒæŒä¹…å±‚çš„ Bean åˆ™çœ‹ä¸åˆ°å±•ç°å±‚çš„ Beanã€‚ ConfigurableBeanFactoryï¼šæ˜¯ä¸€ä¸ªé‡è¦çš„æ¥å£ï¼Œå¢å¼ºäº† IoC å®¹å™¨çš„å¯å®šåˆ¶æ€§ï¼Œå®ƒå®šä¹‰äº†è®¾ç½®ç±»è£…è½½å™¨ã€å±æ€§ç¼–è¾‘å™¨ã€å®¹å™¨åˆå§‹åŒ–åç½®å¤„ç†å™¨ç­‰æ–¹æ³•ï¼› ConfigurableListableBeanFactory: ListableBeanFactory å’Œ ConfigurableBeanFactoryçš„èåˆï¼› AutowireCapableBeanFactoryï¼šå®šä¹‰äº†å°†å®¹å™¨ä¸­çš„ Bean æŒ‰æŸç§è§„åˆ™ï¼ˆå¦‚æŒ‰åå­—åŒ¹é…ã€æŒ‰ç±»å‹åŒ¹é…ç­‰ï¼‰è¿›è¡Œè‡ªåŠ¨è£…é…çš„æ–¹æ³•ï¼› â“å¦‚ä½•å°†Beanæ³¨å†Œåˆ°BeanFactoryä¸­ï¼Ÿ Spring é…ç½®æ–‡ä»¶ä¸­æ¯ä¸€ä¸ª&lt;bean&gt;èŠ‚ç‚¹å…ƒç´ åœ¨ Spring å®¹å™¨é‡Œéƒ½é€šè¿‡ä¸€ä¸ª BeanDefinition å¯¹è±¡è¡¨ç¤ºï¼Œå®ƒæè¿°äº† Bean çš„é…ç½®ä¿¡æ¯ã€‚è€Œ BeanDefinitionRegistry æ¥å£æä¾›äº†å‘å®¹å™¨æ‰‹å·¥æ³¨å†Œ BeanDefinition å¯¹è±¡çš„æ–¹æ³•ã€‚ BeanDefinniton å„ç§Beanå¯¹è±¡åŠå…¶ç›¸äº’çš„å…³ç³» Beanå¯¹è±¡å­˜åœ¨ä¾èµ–åµŒå¥—ç­‰å…³ç³»ï¼Œæ‰€ä»¥è®¾è®¡è€…è®¾è®¡äº†BeanDefinitionï¼Œå®ƒç”¨æ¥å¯¹Beanå¯¹è±¡åŠå…³ç³»å®šä¹‰ï¼›æˆ‘ä»¬åœ¨ç†è§£æ—¶åªéœ€è¦æŠ“ä½å¦‚ä¸‹ä¸‰ä¸ªè¦ç‚¹ï¼š BeanDefinition å®šä¹‰äº†å„ç§Beanå¯¹è±¡åŠå…¶ç›¸äº’çš„å…³ç³» BeanDefinitionReader è¿™æ˜¯BeanDefinitionçš„è§£æå™¨ BeanDefinitionHolder è¿™æ˜¯BeanDefinationçš„åŒ…è£…ç±»ï¼Œç”¨æ¥å­˜å‚¨BeanDefinitionï¼Œnameä»¥åŠaliasesç­‰ã€‚ BeanDefinition SpringIOCå®¹å™¨ç®¡ç†äº†æˆ‘ä»¬å®šä¹‰çš„å„ç§Beanå¯¹è±¡åŠå…¶ç›¸äº’çš„å…³ç³»ï¼ŒBeanå¯¹è±¡åœ¨Springå®ç°ä¸­æ˜¯ä»¥BeanDefinitionæ¥æè¿°çš„ï¼Œå…¶ç»§æ‰¿ä½“ç³»å¦‚ä¸‹ ï¼š BeanDefinitionReader Bean çš„è§£æè¿‡ç¨‹éå¸¸å¤æ‚ï¼ŒåŠŸèƒ½è¢«åˆ†çš„å¾ˆç»†ï¼Œå› ä¸ºè¿™é‡Œéœ€è¦è¢«æ‰©å±•çš„åœ°æ–¹å¾ˆå¤šï¼Œå¿…é¡»ä¿è¯æœ‰è¶³å¤Ÿçš„çµæ´»æ€§ï¼Œä»¥åº”å¯¹å¯èƒ½çš„å˜åŒ–ã€‚Bean çš„è§£æä¸»è¦å°±æ˜¯å¯¹ Spring é…ç½®æ–‡ä»¶çš„è§£æã€‚è¿™ä¸ªè§£æè¿‡ç¨‹ä¸»è¦é€šè¿‡ä¸‹å›¾ä¸­çš„ç±»å®Œæˆï¼š BeanDefinitionHolder BeanDefinitionHolder è¿™æ˜¯BeanDefinationçš„åŒ…è£…ç±»ï¼Œç”¨æ¥å­˜å‚¨BeanDefinitionï¼Œnameä»¥åŠaliasesç­‰ã€‚ ApplicationContext IOCæ¥å£è®¾è®¡å’Œå®ç° IoCå®¹å™¨çš„æ¥å£ç±»æ˜¯ApplicationContextï¼Œå¾ˆæ˜¾ç„¶å®ƒå¿…ç„¶ç»§æ‰¿BeanFactoryå¯¹Beanè§„èŒƒï¼ˆæœ€åŸºæœ¬çš„iocå®¹å™¨çš„å®ç°ï¼‰è¿›è¡Œå®šä¹‰ã€‚è€ŒApplicationContextè¡¨ç¤ºçš„æ˜¯åº”ç”¨çš„ä¸Šä¸‹æ–‡ï¼Œé™¤äº†å¯¹Beançš„ç®¡ç†å¤–ï¼Œè¿˜è‡³å°‘åº”è¯¥åŒ…å«äº† è®¿é—®èµ„æºï¼š å¯¹ä¸åŒæ–¹å¼çš„Beané…ç½®ï¼ˆå³èµ„æºï¼‰è¿›è¡ŒåŠ è½½ã€‚(å®ç°ResourcePatternResolveræ¥å£) å›½é™…åŒ–: æ”¯æŒä¿¡æ¯æºï¼Œå¯ä»¥å®ç°å›½é™…åŒ–ã€‚ï¼ˆå®ç°MessageSourceæ¥å£ï¼‰ åº”ç”¨äº‹ä»¶: æ”¯æŒåº”ç”¨äº‹ä»¶ã€‚(å®ç°ApplicationEventPublisheræ¥å£ æ¥å£è®¾è®¡ï¼š HierarchicalBeanFactory å’Œ ListableBeanFactoryï¼š ApplicationContext ç»§æ‰¿äº† HierarchicalBeanFactory å’Œ ListableBeanFactory æ¥å£ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œè¿˜é€šè¿‡å¤šä¸ªå…¶ä»–çš„æ¥å£æ‰©å±•äº† BeanFactory çš„åŠŸèƒ½ï¼š ApplicationEventPublisherï¼šè®©å®¹å™¨æ‹¥æœ‰å‘å¸ƒåº”ç”¨ä¸Šä¸‹æ–‡äº‹ä»¶çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬å®¹å™¨å¯åŠ¨äº‹ä»¶ã€å…³é—­äº‹ä»¶ç­‰ã€‚å®ç°äº† ApplicationListener äº‹ä»¶ç›‘å¬æ¥å£çš„ Bean å¯ä»¥æ¥æ”¶åˆ°å®¹å™¨äº‹ä»¶ ï¼Œ å¹¶å¯¹äº‹ä»¶è¿›è¡Œå“åº”å¤„ç† ã€‚ åœ¨ ApplicationContext æŠ½è±¡å®ç°ç±»AbstractApplicationContext ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å­˜åœ¨ä¸€ä¸ª ApplicationEventMulticasterï¼Œå®ƒè´Ÿè´£ä¿å­˜æ‰€æœ‰ç›‘å¬å™¨ï¼Œä»¥ä¾¿åœ¨å®¹å™¨äº§ç”Ÿä¸Šä¸‹æ–‡äº‹ä»¶æ—¶é€šçŸ¥è¿™äº›äº‹ä»¶ç›‘å¬è€…ã€‚ MessageSourceï¼šä¸ºåº”ç”¨æä¾› i18n å›½é™…åŒ–æ¶ˆæ¯è®¿é—®çš„åŠŸèƒ½ï¼› ResourcePatternResolver ï¼š æ‰€ æœ‰ ApplicationContext å®ç°ç±»éƒ½å®ç°äº†ç±»ä¼¼äºPathMatchingResourcePatternResolver çš„åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡å¸¦å‰ç¼€çš„ Ant é£æ ¼çš„èµ„æºæ–‡ä»¶è·¯å¾„è£…è½½ Spring çš„é…ç½®æ–‡ä»¶ã€‚ LifeCycleï¼šè¯¥æ¥å£æ˜¯ Spring 2.0 åŠ å…¥çš„ï¼Œè¯¥æ¥å£æä¾›äº† start()å’Œ stop()ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸»è¦ç”¨äºæ§åˆ¶å¼‚æ­¥å¤„ç†è¿‡ç¨‹ã€‚åœ¨å…·ä½“ä½¿ç”¨æ—¶ï¼Œè¯¥æ¥å£åŒæ—¶è¢« ApplicationContext å®ç°åŠå…·ä½“ Bean å®ç°ï¼Œ ApplicationContext ä¼šå°† start/stop çš„ä¿¡æ¯ä¼ é€’ç»™å®¹å™¨ä¸­æ‰€æœ‰å®ç°äº†è¯¥æ¥å£çš„ Beanï¼Œä»¥è¾¾åˆ°ç®¡ç†å’Œæ§åˆ¶ JMXã€ä»»åŠ¡è°ƒåº¦ç­‰ç›®çš„ã€‚ æ¥å£å®ç°ï¼š ç¬¬ä¸€ï¼Œä»ç±»ç»“æ„è®¾è®¡ä¸Šçœ‹ï¼Œ å›´ç»•ç€æ˜¯å¦éœ€è¦Refreshå®¹å™¨è¡ç”Ÿå‡ºä¸¤ä¸ªæŠ½è±¡ç±»ï¼š GenericApplicationContextï¼š æ˜¯åˆå§‹åŒ–çš„æ—¶å€™å°±åˆ›å»ºå®¹å™¨ï¼Œå¾€åçš„æ¯æ¬¡refreshéƒ½ä¸ä¼šæ›´æ”¹ AbstractRefreshableApplicationContextï¼š AbstractRefreshableApplicationContextåŠå­ç±»çš„æ¯æ¬¡refreshéƒ½æ˜¯å…ˆæ¸…é™¤å·²æœ‰(å¦‚æœä¸å­˜åœ¨å°±åˆ›å»º)çš„å®¹å™¨ï¼Œç„¶åå†é‡æ–°åˆ›å»ºï¼›AbstractRefreshableApplicationContextåŠå­ç±»æ— æ³•åšåˆ°GenericApplicationContextæ··åˆæ­é…ä»ä¸åŒæºå¤´è·å–beançš„å®šä¹‰ä¿¡æ¯ ç¬¬äºŒï¼Œ ä»åŠ è½½çš„æºæ¥çœ‹ï¼ˆæ¯”å¦‚xml,groovy,annotationç­‰ï¼‰ï¼Œ è¡ç”Ÿå‡ºä¼—å¤šç±»å‹çš„ApplicationContext, å…¸å‹æ¯”å¦‚: FileSystemXmlApplicationContextï¼š ä»æ–‡ä»¶ç³»ç»Ÿä¸‹çš„ä¸€ä¸ªæˆ–å¤šä¸ªxmlé…ç½®æ–‡ä»¶ä¸­åŠ è½½ä¸Šä¸‹æ–‡å®šä¹‰ï¼Œä¹Ÿå°±æ˜¯è¯´ç³»ç»Ÿç›˜ç¬¦ä¸­åŠ è½½xmlé…ç½®æ–‡ä»¶ã€‚ ClassPathXmlApplicationContextï¼š ä»ç±»è·¯å¾„ä¸‹çš„ä¸€ä¸ªæˆ–å¤šä¸ªxmlé…ç½®æ–‡ä»¶ä¸­åŠ è½½ä¸Šä¸‹æ–‡å®šä¹‰ï¼Œé€‚ç”¨äºxmlé…ç½®çš„æ–¹å¼ã€‚ AnnotationConfigApplicationContextï¼š ä»ä¸€ä¸ªæˆ–å¤šä¸ªåŸºäºjavaçš„é…ç½®ç±»ä¸­åŠ è½½ä¸Šä¸‹æ–‡å®šä¹‰ï¼Œé€‚ç”¨äºjavaæ³¨è§£çš„æ–¹å¼ã€‚ ConfigurableApplicationContextï¼š æ‰©å±•äº ApplicationContextï¼Œå®ƒæ–°å¢åŠ äº†ä¸¤ä¸ªä¸»è¦çš„æ–¹æ³•ï¼š refresh()å’Œ close()ï¼Œè®© ApplicationContext å…·æœ‰å¯åŠ¨ã€åˆ·æ–°å’Œå…³é—­åº”ç”¨ä¸Šä¸‹æ–‡çš„èƒ½åŠ›ã€‚åœ¨åº”ç”¨ä¸Šä¸‹æ–‡å…³é—­çš„æƒ…å†µä¸‹è°ƒç”¨ refresh()å³å¯å¯åŠ¨åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œåœ¨å·²ç»å¯åŠ¨çš„çŠ¶æ€ä¸‹ï¼Œè°ƒç”¨ refresh()åˆ™æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°è£…è½½é…ç½®ä¿¡æ¯ï¼Œè€Œè°ƒç”¨close()åˆ™å¯å…³é—­åº”ç”¨ä¸Šä¸‹æ–‡ã€‚è¿™äº›æ¥å£æ–¹æ³•ä¸ºå®¹å™¨çš„æ§åˆ¶ç®¡ç†å¸¦æ¥äº†ä¾¿åˆ©ï¼Œä½†ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦è¿‡å¤šå…³å¿ƒè¿™äº›æ–¹æ³•ã€‚ ç¬¬ä¸‰ï¼Œ æ›´è¿›ä¸€æ­¥ç†è§£ï¼š è®¾è®¡è€…åœ¨è®¾è®¡æ—¶AnnotationConfigApplicationContextä¸ºä»€ä¹ˆæ˜¯ç»§æ‰¿GenericApplicationContextï¼Ÿ å› ä¸ºåŸºäºæ³¨è§£çš„é…ç½®ï¼Œæ˜¯ä¸å¤ªä¼šè¢«è¿è¡Œæ—¶ä¿®æ”¹çš„ï¼Œè¿™æ„å‘³ç€ä¸éœ€è¦è¿›è¡ŒåŠ¨æ€Beané…ç½®å’Œåˆ·æ–°å®¹å™¨ï¼Œæ‰€ä»¥åªéœ€è¦GenericApplicationContextã€‚ è€ŒåŸºäºXMLè¿™ç§é…ç½®æ–‡ä»¶ï¼Œè¿™ç§æ–‡ä»¶æ˜¯å®¹æ˜“ä¿®æ”¹çš„ï¼Œéœ€è¦åŠ¨æ€æ€§åˆ·æ–°Beançš„æ”¯æŒï¼Œæ‰€ä»¥XMLç›¸å…³çš„é…ç½®å¿…ç„¶ç»§æ‰¿AbstractRefreshableApplicationContextï¼› ä¸”å­˜åœ¨å¤šç§xmlçš„åŠ è½½æ–¹å¼ï¼ˆä½ç½®ä¸åŒçš„è®¾è®¡ï¼‰ï¼Œæ‰€ä»¥å¿…ç„¶ä¼šè®¾è®¡å‡ºAbstractXmlApplicationContext, å…¶ä¸­åŒ…å«å¯¹XMLé…ç½®è§£ææˆBeanDefinationçš„è¿‡ç¨‹ã€‚ é‚£ä¹ˆç»†å¿ƒçš„ä½ ä»ä¸Šå›¾å¯ä»¥å‘ç°AnnotationWebConfigApplicationContextå´æ˜¯ç»§æ‰¿äº†AbstractRefreshableApplicationContextè€Œä¸æ˜¯GenericApplicationContextï¼Œ ä¸ºä»€ä¹ˆAnnotationWebConfigApplicationContextç»§æ‰¿è‡ªAbstractRefreshableApplicationContextå‘¢ ï¼Ÿ å› ä¸ºç”¨æˆ·å¯ä»¥é€šè¿‡ApplicationContextInitializeræ¥è®¾ç½®contextInitializerClassesï¼ˆcontext-param / init-paramï¼‰ï¼Œ åœ¨è¿™ç§æƒ…å†µä¸‹ç”¨æˆ·å€¾å‘äºåˆ·æ–°Beançš„ï¼Œæ‰€ä»¥è®¾è®¡è€…é€‰æ‹©è®©AnnotationWebConfigApplicationContextç»§æ‰¿äº†AbstractRefreshableApplicationContextã€‚ï¼ˆå¦‚ä¸‹æ˜¯æºç ä¸­Springè®¾è®¡è€…å¯¹å®ƒçš„è§£é‡Šï¼‰ 1234567* &lt;p&gt;As an alternative to setting the &quot;contextConfigLocation&quot; parameter, users may* implement an &#123;@link org.springframework.context.ApplicationContextInitializer* ApplicationContextInitializer&#125; and set the* &#123;@linkplain ContextLoader#CONTEXT_INITIALIZER_CLASSES_PARAM &quot;contextInitializerClasses&quot;&#125;* context-param / init-param. In such cases, users should favor the &#123;@link #refresh()&#125;* and &#123;@link #scan(String...)&#125; methods over the &#123;@link #setConfigLocation(String)&#125;* method, which is primarily for use by &#123;@code ContextLoader&#125;. æŠŠä¹‹å‰çš„è®¾è®¡è¦ç‚¹å’Œè®¾è®¡ç»“æ„ç»“åˆèµ·æ¥çœ‹ï¼š ğŸ”— Spring IOCå®ç°åŸç†è¯¦è§£ä¹‹IOCä½“ç³»ç»“æ„è®¾è®¡ åˆå§‹åŒ–æµç¨‹ //todo è¿›é˜¶ - AOPå®ç°åŸç† // todo æ–‡çŒ®ï¼š å®˜æ–¹ä½¿ç”¨æ–‡æ¡£ï¼šSpring Framework Springå½’æ¡£æ–‡ä»¶ï¼šIndex of /spring-framework/docs Springæºç åœ°å€ï¼šGitHub - spring-projects/spring-framework: Spring Framework","categories":[{"name":"Spring","slug":"Spring","permalink":"https://solitaire-12.github.io/categories/Spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://solitaire-12.github.io/tags/spring/"}]},{"title":"Redis|é›†ç¾¤","slug":"redis/é›†ç¾¤","date":"2024-03-25T05:10:55.000Z","updated":"2024-03-25T05:52:36.611Z","comments":true,"path":"2024/03/25/redis/é›†ç¾¤/","permalink":"https://solitaire-12.github.io/2024/03/25/redis/%E9%9B%86%E7%BE%A4/","excerpt":"","text":"æœªå®Œæˆ é›†ç¾¤ Redisé›†ç¾¤æ˜¯Redisæä¾›çš„åˆ†å¸ƒå¼æ•°æ®åº“æ–¹æ¡ˆï¼Œé›†ç¾¤é€šè¿‡åˆ†ç‰‡ï¼ˆshardingï¼‰æ¥è¿›è¡Œæ•°æ®å…±äº«ï¼Œå¹¶æä¾›å¤åˆ¶å’Œæ•…éšœè½¬ç§»åŠŸèƒ½ã€‚ èŠ‚ç‚¹ æ§½æŒ‡æ´¾ æ‰§è¡Œå‘½ä»¤ é‡æ–°åˆ†ç‰‡ ASKé”™è¯¯ å¤åˆ¶å’Œè½¬ç§» æ¶ˆæ¯","categories":[{"name":"Redis","slug":"Redis","permalink":"https://solitaire-12.github.io/categories/Redis/"}],"tags":[{"name":"redis","slug":"redis","permalink":"https://solitaire-12.github.io/tags/redis/"},{"name":"é«˜å¯ç”¨","slug":"é«˜å¯ç”¨","permalink":"https://solitaire-12.github.io/tags/%E9%AB%98%E5%8F%AF%E7%94%A8/"}]},{"title":"Redis|å“¨å…µ","slug":"redis/å“¨å…µ","date":"2024-03-25T05:10:00.000Z","updated":"2024-03-25T05:51:19.762Z","comments":true,"path":"2024/03/25/redis/å“¨å…µ/","permalink":"https://solitaire-12.github.io/2024/03/25/redis/%E5%93%A8%E5%85%B5/","excerpt":"","text":"Sentinel Sentinelæ˜¯redisçš„é«˜å¯ç”¨æ€§(high availability)è§£å†³æ–¹æ¡ˆï¼šç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªSentinelå®ä¾‹(instance)ç»„æˆçš„Sentinelç³»ç»Ÿï¼Œå¯ä»¥ç›‘è§†ä»»æ„å¤šä¸ªä¸»æœåŠ¡å™¨ï¼Œä»¥åŠè¿™äº›ä¸»æœåŠ¡å™¨å±ä¸‹çš„æ‰€ç”¨ä»æœåŠ¡å™¨ï¼Œå¹¶åœ¨è¢«ç›‘è§†çš„ä¸»æœåŠ¡å™¨è¿›å…¥ä¸‹çº¿çŠ¶æ€æ—¶ï¼Œè‡ªåŠ¨å°†ä¸‹çº¿çš„ä¸»æœåŠ¡å™¨å±ä¸‹çš„æŸä¸ªä»æœåŠ¡å™¨å‡çº§ä¸ºæ–°çš„ä¸»æœåŠ¡å™¨ï¼Œç„¶åç”±æ–°çš„ä¸»æœºæœåŠ¡å™¨ä»£æ›¿å·²ä¸‹çº¿çš„ä¸»æœåŠ¡å™¨ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ã€‚ å¯åŠ¨å¹¶åˆå§‹åŒ– å½“ä¸€ä¸ªSentinelå¯åŠ¨æ—¶ï¼Œå®ƒéœ€è¦æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š åˆå§‹åŒ–æœåŠ¡å™¨ã€‚ å°†æ™®é€šRedisæœåŠ¡å™¨ä½¿ç”¨çš„ä»£ç æ›¿æ¢æˆSentinelä¸“ç”¨ä»£ç ã€‚ åˆå§‹åŒ–SentinelçŠ¶æ€ã€‚ æ ¹æ®ç»™å®šçš„é…ç½®æ–‡ä»¶ï¼Œåˆå§‹åŒ–Sentinelçš„ç›‘è§†ä¸»æœåŠ¡å™¨åˆ—è¡¨ã€‚ åˆ›å»ºè¿å‘ä¸»æœåŠ¡å™¨çš„ç½‘ç»œè¿æ¥ã€‚ åˆå§‹åŒ–æœåŠ¡å™¨ sentinelæœ¬è´¨ä¸Šåªæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ç‰¹æ®Šæ¨¡å¼ä¸‹çš„redisæœåŠ¡å™¨ï¼Œæ‰€ä»¥å¯åŠ¨sentinelçš„ç¬¬ä¸€æ­¥æ˜¯åˆå§‹åŒ–ä¸€ä¸ªæ™®é€šçš„redisæœåŠ¡å™¨ã€‚åªä¸è¿‡è¿™ä¸ªæœåŠ¡å™¨ä¸ä¼šè½½å…¥RDBæ–‡ä»¶æˆ–è€…AOFæ–‡ä»¶ã€‚ ä½¿ç”¨ä¸“ç”¨ä»£ç  ä¾‹å¦‚sentinel.cæ–‡ä»¶ä¸­å®šä¹‰äº†é»˜è®¤çš„sentinelç«¯å£#define REDIS_SENTINEL_PORT 26379ï¼› é™¤æ­¤ä¹‹å¤–ï¼šæ™®é€šæœåŠ¡å™¨ä½¿ç”¨çš„å‘½ä»¤è¡¨ï¼ˆservice.cæ–‡ä»¶ä¸­ã€6.0.6æºç ã€‘ï¼‰ï¼š sentinelä¸­çš„æŒ‡ä»¤è¡¨ï¼šsentinel.cæ–‡ä»¶ä¸­ åˆå§‹åŒ–sentinel åœ¨åº”ç”¨äº†sentinelçš„ä¸“ç”¨ä»£ç ä¹‹åï¼Œæ¥ä¸‹æ¥ï¼ŒæœåŠ¡å™¨ä¼šåˆå§‹åŒ–ä¸€ä¸ªsentinel.c/sentinelStateï¼Œç®€ç§°&quot;sentinelçŠ¶æ€&quot;ã€‚è¿™ä¸ªç»“æ„ä¿å­˜äº†æœåŠ¡å™¨ä¸­æ‰€æœ‰å’ŒsentinelåŠŸèƒ½æœ‰å…³çš„çŠ¶æ€ã€‚ 12345678910111213141516171819202122/* Main state. */struct sentinelState &#123; char myid[CONFIG_RUN_ID_SIZE+1]; /* This sentinel ID. */ // ç”¨äºå®ç°æ•…éšœè½¬ç§» uint64_t current_epoch; /* Current epoch. */ dict *masters; /* Dictionary of master sentinelRedisInstances. Key is the instance name, value is the sentinelRedisInstance structure pointer. */ int tilt; /* Are we in TILT mode? */ int running_scripts; /* Number of scripts in execution right now. */ mstime_t tilt_start_time; /* When TITL started. */ mstime_t previous_time; /* Last time we ran the time handler. */ // ä¸€ä¸ªFIFOé˜Ÿåˆ—ï¼ŒåŒ…å«æ‰€æœ‰éœ€è¦æ‰§è¡Œçš„ç”¨æˆ·è„šæœ¬ list *scripts_queue; /* Queue of user scripts to execute. */ char *announce_ip; /* IP addr that is gossiped to other sentinels if not NULL. */ int announce_port; /* Port that is gossiped to other sentinels if non zero. */ unsigned long simfailure_flags; /* Failures simulation. */ int deny_scripts_reconfig; /* Allow SENTINEL SET ... to change script paths at runtime? */&#125; sentinel; åˆå§‹åŒ–masterså±æ€§ sentinelçŠ¶æ€ä¸­çš„masterså­—å…¸è®°å½•äº†æ‰€æœ‰è¢«sentinelåšå®çš„ä¸»æœåŠ¡å™¨çš„ç›¸å…³ä¿¡æ¯ï¼Œå…¶ä¸­ å­—å…¸çš„é”®æ˜¯è¢«ç›‘è§†ä¸»æœåŠ¡å™¨çš„åå­— è€Œå­—å…¸çš„å€¼åˆ™æ˜¯è¢«ç›‘è§†ä¸»æœåŠ¡å™¨å¯¹åº”çš„sentinel.c/sentinelRedisInstance æ¯ä¸ªsentinelRedisInstanceç»“æ„(å®ä¾‹ç»“æ„)ä»£è¡¨ä¸€ä¸ªè¢«sentinelç›‘è§†çš„redisæœåŠ¡å™¨å®ä¾‹(instance)ï¼Œè¿™ä¸ªå®ä¾‹å¯ä»¥æ˜¯ä¸»æœåŠ¡å™¨ã€ä»æœåŠ¡å™¨æˆ–è€…å¦å¤–ä¸€ä¸ªsentinelã€‚ å®ä¾‹ç»“æ„åŒ…å«çš„å±æ€§éå¸¸å¤šï¼Œæºç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586typedef struct sentinelRedisInstance &#123; // æ ‡è®°ï¼Œè®°å½•äº†å®ä¾‹çš„ç±»å‹ä»¥åŠè¯¥å®ä¾‹çš„å½“å‰çŠ¶æ€ int flags; /* See SRI_... defines */ /* å®ä¾‹åç§° * ä¸»æœåŠ¡å™¨çš„åå­—ç”±ç”¨æˆ·åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½® * ä»æœåŠ¡å™¨ä»¥åŠsentinelçš„åå­—ç”±sentinelè‡ªåŠ¨è®¾ç½®ï¼Œä¸€èˆ¬æ ¼å¼ä¸ºIP:port,ä¾‹ * å¦‚&#x27;127.0.0.1:26379&#x27; */ char *name; /* Master name from the point of view of this sentinel. */ char *runid; /* Run ID of this instance, or unique ID if is a Sentinel.*/ uint64_t config_epoch; /* Configuration epoch. */ sentinelAddr *addr; /* Master host. */ instanceLink *link; /* Link to the instance, may be shared for Sentinels. */ mstime_t last_pub_time; /* Last time we sent hello via Pub/Sub. */ mstime_t last_hello_time; /* Only used if SRI_SENTINEL is set. Last time we received a hello from this Sentinel via Pub/Sub. */ mstime_t last_master_down_reply_time; /* Time of last reply to SENTINEL is-master-down command. */ mstime_t s_down_since_time; /* Subjectively down since time. */ mstime_t o_down_since_time; /* Objectively down since time. */ /* sentinel down-after-milliseconds &lt;master-name&gt; &lt;number&gt; é€‰é¡¹è®¾ç½®çš„å€¼ * å®ä¾‹æ— å“åº”å¤šå°‘æ¯«ç§’ä¹‹åæ‰ä¼šè¢«åˆ¤æ–­ä¸ºä¸»è§‚ä¸‹çº¿(subjectively down) */ mstime_t down_after_period; /* Consider it down after that period. */ mstime_t info_refresh; /* Time at which we received INFO output from it. */ dict *renamed_commands; /* Commands renamed in this instance: Sentinel will use the alternative commands mapped on this table to send things like SLAVEOF, CONFING, INFO, ... */ /* Role and the first time we observed it. * This is useful in order to delay replacing what the instance reports * with our own configuration. We need to always wait some time in order * to give a chance to the leader to report the new configuration before * we do silly things. */ int role_reported; mstime_t role_reported_time; mstime_t slave_conf_change_time; /* Last time slave master addr changed. */ /* Master specific. */ dict *sentinels; /* Other sentinels monitoring the same master. */ dict *slaves; /* Slaves for this master instance. */ /* åˆ¤æ–­è¿™ä¸ªå®ä¾‹ä¸ºå®¢è§‚ä¸‹çº¿(objectively down)æ‰€éœ€çš„æ”¯æŒæŠ•ç¥¨æ•° * ç”±sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;port&gt; &lt;quorum&gt;è®¾å®š */ unsigned int quorum;/* Number of sentinels that need to agree on failure. */ /* åœ¨æ‰§è¡Œæ•…éšœè½¬ç§»æ“ä½œæ—¶ï¼Œå¯ä»¥åŒæ—¶å¯¹æ–°çš„ä¸»æœåŠ¡å™¨è¿›è¡ŒåŒæ­¥çš„ä»æœåŠ¡å™¨æ•°é‡ * ç”±sentinel parallel_syncs &lt;master-name&gt; &lt;number&gt;è®¾å®š */ int parallel_syncs; /* How many slaves to reconfigure at same time. */ char *auth_pass; /* Password to use for AUTH against master &amp; replica. */ char *auth_user; /* Username for ACLs AUTH against master &amp; replica. */ /* Slave specific. */ mstime_t master_link_down_time; /* Slave replication link down time. */ int slave_priority; /* Slave priority according to its INFO output. */ mstime_t slave_reconf_sent_time; /* Time at which we sent SLAVE OF &lt;new&gt; */ struct sentinelRedisInstance *master; /* Master instance if it&#x27;s slave. */ char *slave_master_host; /* Master host as reported by INFO */ int slave_master_port; /* Master port as reported by INFO */ int slave_master_link_status; /* Master link status as reported by INFO */ unsigned long long slave_repl_offset; /* Slave replication offset. */ /* Failover */ char *leader; /* If this is a master instance, this is the runid of the Sentinel that should perform the failover. If this is a Sentinel, this is the runid of the Sentinel that this Sentinel voted as leader. */ uint64_t leader_epoch; /* Epoch of the &#x27;leader&#x27; field. */ uint64_t failover_epoch; /* Epoch of the currently started failover. */ int failover_state; /* See SENTINEL_FAILOVER_STATE_* defines. */ mstime_t failover_state_change_time; mstime_t failover_start_time; /* Last failover attempt start time. */ /* åˆ·æ–°æ•…éšœè¿ç§»çŠ¶æ€çš„æœ€å¤§æ—¶é™ * ç”±sentinel failover_timeout &lt;master-name&gt; &lt;ms&gt;è®¾å®š */ mstime_t failover_timeout; /* Max time to refresh failover state. */ mstime_t failover_delay_logged; /* For what failover_start_time value we logged the failover delay. */ struct sentinelRedisInstance *promoted_slave; /* Promoted slave instance. */ /* Scripts executed to notify admin or reconfigure clients: when they * are set to NULL no script is executed. */ char *notification_script; char *client_reconfig_script; sds info; /* cached INFO output */&#125; sentinelRedisInstance; å…¶ä¸­sentinelRedisInstance.addrå±æ€§æ˜¯ä¸€ä¸ªæŒ‡å‘sentinel.c/sentinelAddrç»“æ„çš„æŒ‡é’ˆï¼Œè¿™ä¸ªç»“æ„ä¿å­˜ç€å®ä¾‹çš„IPåœ°å€å’Œç«¯å£å·ï¼š 12345/* Address object, used to describe an ip:port pair. */typedef struct sentinelAddr &#123; char *ip; int port;&#125; sentinelAddr; å¯¹SentinelçŠ¶æ€çš„åˆå§‹åŒ–å°†å¼•å‘å¯¹masterså­—å…¸çš„åˆå§‹åŒ–ï¼Œè€Œmasterså­—å…¸çš„åˆå§‹åŒ–æ˜¯æ ¹æ®è¢«è½½å…¥çš„Sentinelé…ç½®æ–‡ä»¶æ¥è¿›è¡Œçš„ã€‚ åˆ›å»ºè¿å‘ä¸»æœåŠ¡å™¨çš„ç½‘ç»œè¿æ¥ åˆå§‹åŒ–Sentinelçš„æœ€åä¸€æ­¥æ˜¯åˆ›å»ºè¿å‘è¢«ç›‘è§†ä¸»æœåŠ¡å™¨çš„ç½‘ç»œè¿æ¥ï¼ŒSentinelå°†æˆä¸ºä¸»æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ï¼Œå®ƒå¯ä»¥å‘ä¸»æœåŠ¡å™¨å‘é€å‘½ä»¤ï¼Œå¹¶ä»å‘½ä»¤å›å¤ä¸­è·å–ç›¸å…³çš„ä¿¡æ¯ã€‚ åˆå§‹åŒ–Sentinelçš„æœ€åä¸€æ­¥æ˜¯åˆ›å»ºè¿å‘è¢«ç›‘è§†ä¸»æœåŠ¡å™¨çš„ç½‘ç»œè¿æ¥ï¼ŒSentinelå°†æˆä¸ºä¸»æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ï¼Œå®ƒå¯ä»¥å‘ä¸»æœåŠ¡å™¨å‘é€å‘½ä»¤ï¼Œå¹¶ä»å‘½ä»¤å›å¤ä¸­è·å–ç›¸å…³çš„ä¿¡æ¯ã€‚ ä¸€ä¸ªæ˜¯å‘½ä»¤è¿æ¥ï¼Œè¿™ä¸ªè¿æ¥ä¸“é—¨ç”¨äºå‘ä¸»æœåŠ¡å™¨å‘é€å‘½ä»¤ï¼Œå¹¶æ¥æ”¶å‘½ä»¤å›å¤ã€‚ å¦ä¸€ä¸ªæ˜¯è®¢é˜…è¿æ¥ï¼Œè¿™ä¸ªè¿æ¥ä¸“é—¨ç”¨äºè®¢é˜…ä¸»æœåŠ¡å™¨çš„__sentinel__:helloé¢‘é“ ä¸ºä»€ä¹ˆæœ‰ä¸¤ä¸ªè¿æ¥ï¼Ÿåœ¨Redisç›®å‰çš„å‘å¸ƒä¸è®¢é˜…åŠŸèƒ½ä¸­ï¼Œè¢«å‘é€çš„ä¿¡æ¯éƒ½ä¸ä¼šä¿å­˜åœ¨RedisæœåŠ¡å™¨é‡Œé¢ï¼Œå¦‚æœåœ¨ä¿¡æ¯å‘é€æ—¶ï¼Œæƒ³è¦æ¥æ”¶ä¿¡æ¯çš„å®¢æˆ·ç«¯ä¸åœ¨çº¿æˆ–è€…æ–­çº¿ï¼Œé‚£ä¹ˆè¿™ä¸ªå®¢æˆ·ç«¯å°±ä¼šä¸¢å¤±è¿™æ¡ä¿¡æ¯ã€‚å› æ­¤ï¼Œä¸ºäº†ä¸ä¸¢å¤±__sentinel__:helloé¢‘é“çš„ä»»ä½•ä¿¡æ¯ï¼ŒSentinelå¿…é¡»ä¸“é—¨ç”¨ä¸€ä¸ªè®¢é˜…è¿æ¥æ¥æ¥æ”¶è¯¥é¢‘é“çš„ä¿¡æ¯ã€‚å¦ä¸€æ–¹é¢ï¼Œé™¤äº†è®¢é˜…é¢‘é“ä¹‹å¤–ï¼ŒSentinelè¿˜å¿…é¡»å‘ä¸»æœåŠ¡å™¨å‘é€å‘½ä»¤ï¼Œä»¥æ­¤æ¥ä¸ä¸»æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œæ‰€ä»¥Sentinelè¿˜å¿…é¡»å‘ä¸»æœåŠ¡å™¨åˆ›å»ºå‘½ä»¤è¿æ¥ã€‚å› ä¸ºSentineléœ€è¦ä¸å¤šä¸ªå®ä¾‹åˆ›å»ºå¤šä¸ªç½‘ç»œè¿æ¥ï¼Œæ‰€ä»¥Sentinelä½¿ç”¨çš„æ˜¯å¼‚æ­¥è¿æ¥ã€‚ è·å–ä¸»æœåŠ¡ä¿¡æ¯ Sentinelé»˜è®¤ä¼šä»¥æ¯åç§’ä¸€æ¬¡çš„é¢‘ç‡ï¼Œé€šè¿‡å‘½ä»¤è¿æ¥å‘è¢«ç›‘è§†çš„ä¸»æœåŠ¡å™¨å‘é€INFOå‘½ä»¤ï¼Œå¹¶é€šè¿‡åˆ†æINFOå‘½ä»¤çš„å›å¤æ¥è·å–ä¸»æœåŠ¡å™¨çš„å½“å‰ä¿¡æ¯ã€‚ ğŸ”ä¾‹å­ï¼š ä¸»æœåŠ¡å™¨masteræœ‰ä¸‰ä¸ªä»æœåŠ¡å™¨slave0ã€slave1å’Œslave2ï¼Œå¹¶ä¸”ä¸€ä¸ªSentinelæ­£åœ¨è¿æ¥ä¸»æœåŠ¡å™¨ï¼Œé‚£ä¹ˆSentinelå°†æŒç»­åœ°å‘ä¸»æœåŠ¡å™¨å‘é€INFOå‘½ä»¤ï¼Œå¹¶è·å¾—ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„å›å¤ï¼š 12345678910111213# Server...run_id:7611c59dc3a29aa6fa0609f841bb6a1019008a9c...# Replicationrole:master...slave0:ip=127.0.0.1,port=11111,state=online,offset=43,lag=0slave1:ip=127.0.0.1,port=22222,state=online,offset=43,lag=0slave2:ip=127.0.0.1,port=33333,state=online,offset=43,lag=0...# Other sections... é€šè¿‡åˆ†æä¸»æœåŠ¡å™¨è¿”å›çš„INFOå‘½ä»¤å›å¤ï¼ŒSentinelå¯ä»¥è·å–ä»¥ä¸‹ä¸¤æ–¹é¢çš„ä¿¡æ¯ï¼š å…³äºä¸»æœåŠ¡å™¨æœ¬èº«çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬run_idåŸŸè®°å½•çš„æœåŠ¡å™¨è¿è¡ŒIDï¼Œä»¥åŠroleåŸŸè®°å½•çš„æœåŠ¡å™¨è§’è‰²ï¼› å…³äºä¸»æœåŠ¡å™¨å±ä¸‹æ‰€æœ‰ä»æœåŠ¡å™¨çš„ä¿¡æ¯ï¼Œæ¯ä¸ªä»æœåŠ¡å™¨éƒ½ç”±ä¸€ä¸ª&quot;slave&quot;å­—ç¬¦ä¸²å¼€å¤´çš„è¡Œè®°å½•ï¼Œæ¯è¡Œçš„ip=åŸŸè®°å½•äº†ä»æœåŠ¡å™¨çš„IPåœ°å€ï¼Œè€Œport=åŸŸåˆ™è®°å½•äº†ä»æœåŠ¡å™¨çš„ç«¯å£å·ã€‚æ ¹æ®è¿™äº›IPåœ°å€å’Œç«¯å£å·ï¼ŒSentinelæ— é¡»ç”¨æˆ·æä¾›ä»æœåŠ¡å™¨çš„åœ°å€ä¿¡æ¯ï¼Œå°±å¯ä»¥è‡ªåŠ¨å‘ç°ä»æœåŠ¡å™¨ã€‚ æ ¹æ®run_idåŸŸå’ŒroleåŸŸè®°å½•çš„ä¿¡æ¯ï¼ŒSentinelå°†å¯¹ä¸»æœåŠ¡å™¨çš„å®ä¾‹ç»“æ„è¿›è¡Œæ›´æ–°ï¼Œä¾‹å¦‚ï¼Œä¸»æœåŠ¡å™¨é‡å¯ä¹‹åï¼Œå®ƒçš„è¿è¡ŒIDå°±ä¼šå’Œå®ä¾‹ç»“æ„ä¹‹å‰ä¿å­˜çš„è¿è¡ŒIDä¸åŒï¼ŒSentinelæ£€æµ‹åˆ°è¿™ä¸€æƒ…å†µä¹‹åï¼Œå°±ä¼šå¯¹å®ä¾‹ç»“æ„çš„è¿è¡ŒIDè¿›è¡Œæ›´æ–°ã€‚ è‡³äºä¸»æœåŠ¡å™¨è¿”å›çš„ä»æœåŠ¡å™¨ä¿¡æ¯ï¼Œåˆ™ä¼šè¢«ç”¨äºæ›´æ–°ä¸»æœåŠ¡å™¨å®ä¾‹ç»“æ„çš„slaveså­—å…¸ï¼Œè¿™ä¸ªå­—å…¸è®°å½•äº†ä¸»æœåŠ¡å™¨å±ä¸‹ä»æœåŠ¡å™¨çš„åå•ï¼š å­—å…¸çš„é”®æ˜¯ç”±Sentinelè‡ªåŠ¨è®¾ç½®çš„ä»æœåŠ¡å™¨åå­—ï¼Œæ ¼å¼ä¸ºip:portï¼šå¦‚å¯¹äºIPåœ°å€ä¸º127.0.0.1ï¼Œç«¯å£å·ä¸º11111çš„ä»æœåŠ¡å™¨æ¥è¯´ï¼ŒSentinelä¸ºå®ƒè®¾ç½®çš„åå­—å°±æ˜¯127.0.0.1:11111ã€‚ è‡³äºå­—å…¸çš„å€¼åˆ™æ˜¯ä»æœåŠ¡å™¨å¯¹åº”çš„å®ä¾‹ç»“æ„ï¼šæ¯”å¦‚è¯´ï¼Œå¦‚æœé”®æ˜¯127.0.0.1:11111ï¼Œé‚£ä¹ˆè¿™ä¸ªé”®çš„å€¼å°±æ˜¯IPåœ°å€ä¸º127.0.0.1ï¼Œç«¯å£å·ä¸º11111çš„ä»æœåŠ¡å™¨çš„å®ä¾‹ç»“æ„ã€‚ Sentinelåœ¨åˆ†æINFOå‘½ä»¤ä¸­åŒ…å«çš„ä»æœåŠ¡å™¨ä¿¡æ¯æ—¶ï¼Œä¼šæ£€æŸ¥ä»æœåŠ¡å™¨å¯¹åº”çš„å®ä¾‹ç»“æ„æ˜¯å¦å·²ç»å­˜åœ¨äºslaveså­—å…¸ï¼š å¦‚æœä»æœåŠ¡å™¨å¯¹åº”çš„å®ä¾‹ç»“æ„å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆSentinelå¯¹ä»æœåŠ¡å™¨çš„å®ä¾‹ç»“æ„è¿›è¡Œæ›´æ–°ã€‚ å¦‚æœä»æœåŠ¡å™¨å¯¹åº”çš„å®ä¾‹ç»“æ„ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆè¯´æ˜è¿™ä¸ªä»æœåŠ¡å™¨æ˜¯æ–°å‘ç°çš„ä»æœåŠ¡å™¨ï¼ŒSentinelä¼šåœ¨slaveså­—å…¸ä¸­ä¸ºè¿™ä¸ªä»æœåŠ¡å™¨æ–°åˆ›å»ºä¸€ä¸ªå®ä¾‹ç»“æ„ã€‚ å¯¹äºä¹‹å‰åˆ—ä¸¾çš„ä¸»æœåŠ¡å™¨masterå’Œä¸‰ä¸ªä»æœåŠ¡å™¨slave0ã€slave1å’Œslave2çš„ä¾‹å­æ¥è¯´ï¼ŒSentinelå°†åˆ†åˆ«ä¸ºä¸‰ä¸ªä»æœåŠ¡å™¨åˆ›å»ºå®ƒä»¬å„è‡ªçš„å®ä¾‹ç»“æ„ï¼Œå¹¶å°†è¿™äº›ç»“æ„ä¿å­˜åˆ°ä¸»æœåŠ¡å™¨å®ä¾‹ç»“æ„çš„slaveså­—å…¸é‡Œé¢ï¼š æ³¨æ„å¯¹æ¯”å›¾ä¸­ä¸»æœåŠ¡å™¨å®ä¾‹ç»“æ„å’Œä»æœåŠ¡å™¨å®ä¾‹ç»“æ„ä¹‹é—´çš„åŒºåˆ«ï¼š ä¸»æœåŠ¡å™¨å®ä¾‹ç»“æ„çš„flagså±æ€§çš„å€¼ä¸ºSRI_MASTERï¼Œè€Œä»æœåŠ¡å™¨å®ä¾‹ç»“æ„çš„flagså±æ€§çš„å€¼ä¸ºSRI_SLAVEã€‚ ä¸»æœåŠ¡å™¨å®ä¾‹ç»“æ„çš„nameå±æ€§çš„å€¼æ˜¯ç”¨æˆ·ä½¿ç”¨Sentinelé…ç½®æ–‡ä»¶è®¾ç½®çš„ï¼Œè€Œä»æœåŠ¡å™¨å®ä¾‹ç»“æ„çš„nameå±æ€§çš„å€¼åˆ™æ˜¯Sentinelæ ¹æ®ä»æœåŠ¡å™¨çš„IPåœ°å€å’Œç«¯å£å·è‡ªåŠ¨è®¾ç½®çš„ã€‚ è·å–ä»æœåŠ¡å™¨ä¿¡æ¯ å½“Sentinelå‘ç°ä¸»æœåŠ¡å™¨æœ‰æ–°çš„ä»æœåŠ¡å™¨å‡ºç°æ—¶ï¼ŒSentinelé™¤äº†ä¼šä¸ºè¿™ä¸ªæ–°çš„ä»æœåŠ¡å™¨åˆ›å»ºç›¸åº”çš„å®ä¾‹ç»“æ„ä¹‹å¤–ï¼ŒSentinelè¿˜ä¼šåˆ›å»ºè¿æ¥åˆ°ä»æœåŠ¡å™¨çš„å‘½ä»¤è¿æ¥å’Œè®¢é˜…è¿æ¥ã€‚ ğŸ”ä¾‹å­ï¼š åœ¨åˆ›å»ºå‘½ä»¤è¿æ¥ä¹‹åï¼ŒSentinelåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šä»¥æ¯åç§’ä¸€æ¬¡çš„é¢‘ç‡é€šè¿‡å‘½ä»¤è¿æ¥å‘ä»æœåŠ¡å™¨å‘é€INFOå‘½ä»¤ï¼Œå¹¶è·å¾—ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„å›å¤ï¼š 12345678910111213# Server...run_id:32be0699dd27b410f7c90dada3a6fab17f97899f...# Replicationrole:slavemaster_host:127.0.0.1master_port:6379master_link_status:upslave_repl_offset:11887slave_priority:100# Other sections... æ ¹æ®INFOå‘½ä»¤çš„å›å¤ï¼ŒSentinelä¼šæå–å‡ºä»¥ä¸‹ä¿¡æ¯ï¼š ä»æœåŠ¡å™¨çš„è¿è¡ŒID run_idã€‚ ä»æœåŠ¡å™¨çš„è§’è‰²roleã€‚ ä¸»æœåŠ¡å™¨çš„IPåœ°å€master_hostï¼Œä»¥åŠä¸»æœåŠ¡å™¨çš„ç«¯å£å·master_portã€‚ ä¸»ä»æœåŠ¡å™¨çš„è¿æ¥çŠ¶æ€master_link_statusã€‚ ä»æœåŠ¡å™¨çš„ä¼˜å…ˆçº§slave_priorityã€‚ ä»æœåŠ¡å™¨çš„å¤åˆ¶åç§»é‡slave_repl_offsetã€‚ æ ¹æ®è¿™äº›ä¿¡æ¯ï¼ŒSentinelä¼šå¯¹ä»æœåŠ¡å™¨çš„å®ä¾‹ç»“æ„è¿›è¡Œæ›´æ–°ï¼Œæ›´æ–°ä¹‹åçš„ç»“æ„æ ·å­ï¼š å‘ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨å‘é€ä¿¡æ¯ åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒSentinelä¼šä»¥æ¯ä¸¤ç§’ä¸€æ¬¡çš„é¢‘ç‡ï¼Œé€šè¿‡å‘½ä»¤è¿æ¥å‘æ‰€æœ‰è¢«ç›‘è§†çš„ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨å‘é€ä»¥ä¸‹æ ¼å¼çš„å‘½ä»¤ï¼š 1PUBLISH __sentinel__:hello &quot;ï¼œs_ipï¼,ï¼œs_portï¼,ï¼œs_runidï¼,ï¼œs_epochï¼,ï¼œm_nameï¼,ï¼œm_ipï¼,ï¼œm_portï¼,ï¼œm_epochï¼&quot; è¿™æ¡å‘½ä»¤å‘æœåŠ¡å™¨çš„__sentinel__:helloé¢‘é“å‘é€äº†ä¸€æ¡ä¿¡æ¯ï¼Œä¿¡æ¯çš„å†…å®¹ç”±å¤šä¸ªå‚æ•°ç»„æˆï¼š ä»¥s_å¼€å¤´çš„å‚æ•°è®°å½•çš„æ˜¯Sentinelæœ¬èº«çš„ä¿¡æ¯ m_å¼€å¤´çš„å‚æ•°è®°å½•çš„åˆ™æ˜¯ä¸»æœåŠ¡å™¨çš„ä¿¡æ¯ã€‚å¦‚æœSentinelæ­£åœ¨ç›‘è§†çš„æ˜¯ä¸»æœåŠ¡å™¨ï¼Œé‚£ä¹ˆè¿™äº›å‚æ•°è®°å½•çš„å°±æ˜¯ä¸»æœåŠ¡å™¨çš„ä¿¡æ¯ï¼›å¦‚æœSentinelæ­£åœ¨ç›‘è§†çš„æ˜¯ä»æœåŠ¡å™¨ï¼Œé‚£ä¹ˆè¿™äº›å‚æ•°è®°å½•çš„å°±æ˜¯ä»æœåŠ¡å™¨æ­£åœ¨å¤åˆ¶çš„ä¸»æœåŠ¡å™¨çš„ä¿¡æ¯ å‚æ•°è¡¨ï¼š å‚æ•° æ„ä¹‰ a_ip Sentinelçš„IPåœ°å€ a_port Sentinelçš„ç«¯å£å· s_runid Sentinelçš„è¿è¡ŒID s_epoch Sentinelå½“å‰çš„Configuration epochã€é…ç½®çºªå…ƒã€‘ m_name ä¸»æœåŠ¡å™¨çš„åå­— m_ip ä¸»æœåŠ¡å™¨çš„IPåœ°å€ m_port ä¸»æœåŠ¡å™¨çš„ç«¯å£å· m_epoch ä¸»æœåŠ¡å™¨å½“å‰çš„é…ç½®çºªå…ƒ æ£€æŸ¥ä¸»è§‚ä¸‹çº¿çŠ¶æ€ åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒSentinelä¼šä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡å‘æ‰€æœ‰ä¸å®ƒåˆ›å»ºäº†å‘½ä»¤è¿æ¥çš„å®ä¾‹ï¼ˆåŒ…æ‹¬ä¸»æœåŠ¡å™¨ã€ä»æœåŠ¡å™¨ã€å…¶ä»–Sentinelåœ¨å†…ï¼‰å‘é€PINGå‘½ä»¤ï¼Œå¹¶é€šè¿‡å®ä¾‹è¿”å›çš„PINGå‘½ä»¤å›å¤æ¥åˆ¤æ–­å®ä¾‹æ˜¯å¦åœ¨çº¿ã€‚ å¦‚ä¸Šå›¾ä¸­ï¼ŒSentinel1å°†å‘Sentinel2ã€ä¸»æœåŠ¡å™¨masterã€ä»æœåŠ¡å™¨slave1å’Œslave2å‘é€PINGå‘½ä»¤ã€‚Sentinel2å°†å‘Sentinel1ã€ä¸»æœåŠ¡å™¨masterã€ä»æœåŠ¡å™¨slave1å’Œslave2å‘é€PINGå‘½ä»¤ã€‚å®ä¾‹å¯¹pingå‘½ä»¤çš„å›å¤å¯ä»¥åˆ†æˆä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š æœ‰æ•ˆå›å¤ï¼šå®ä¾‹è¿”å›+PONGã€-LOADINGã€-MASTERDOWNä¸‰ç§å›å¤å…¶ä¸­ä¸€ç§ã€‚ æ— æ•ˆå›å¤ï¼šå®ä¾‹è¿”å›+PONGã€-LOADINGã€-MASTERDOWNä¸‰ç§å›å¤ä¹‹å¤–çš„å…¶ä»–å›å¤ï¼Œæˆ–è€…åœ¨æŒ‡å®šæ—¶é™å†…æ²¡æœ‰è¿”å›ä»»ä½•å›å¤ã€‚ Sentinelé…ç½®æ–‡ä»¶ä¸­çš„down-after-millisecondsé€‰é¡¹æŒ‡å®šäº†Sentinelåˆ¤æ–­å®ä¾‹è¿›å…¥ä¸»è§‚ä¸‹çº¿æ‰€éœ€çš„æ—¶é—´é•¿åº¦ï¼šå¦‚æœä¸€ä¸ªå®ä¾‹åœ¨down-after-millisecondsæ¯«ç§’å†…ï¼Œè¿ç»­å‘Sentinelè¿”å›æ— æ•ˆå›å¤ï¼Œé‚£ä¹ˆSentinelä¼šä¿®æ”¹è¿™ä¸ªå®ä¾‹æ‰€å¯¹åº”çš„å®ä¾‹ç»“æ„ï¼Œåœ¨ç»“æ„çš„flagså±æ€§ä¸­æ‰“å¼€SRI_S_DOWNæ ‡è¯†ï¼Œä»¥æ­¤æ¥è¡¨ç¤ºè¿™ä¸ªå®ä¾‹å·²ç»è¿›å…¥ä¸»è§‚ä¸‹çº¿çŠ¶æ€ã€‚ ç”¨æˆ·è®¾ç½®çš„down-after-millisecondsé€‰é¡¹çš„å€¼ï¼Œä¸ä»…ä¼šè¢«Sentinelç”¨æ¥åˆ¤æ–­ä¸»æœåŠ¡å™¨çš„ä¸»è§‚ä¸‹çº¿çŠ¶æ€ï¼Œè¿˜ä¼šè¢«ç”¨äºåˆ¤æ–­ä¸»æœåŠ¡å™¨å±ä¸‹çš„æ‰€æœ‰ä»æœåŠ¡å™¨ï¼Œä»¥åŠæ‰€æœ‰åŒæ ·ç›‘è§†è¿™ä¸ªä¸»æœåŠ¡å™¨çš„å…¶ä»–Sentinelçš„ä¸»è§‚ä¸‹çº¿çŠ¶æ€ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœç”¨æˆ·å‘Sentinelè®¾ç½®äº†ä»¥ä¸‹é…ç½®ï¼š 12sentinel monitor master 127.0.0.1 6379 2sentinel down-after-milliseconds master 50000 é‚£ä¹ˆ50000æ¯«ç§’ä¸ä»…ä¼šæˆä¸ºSentinelåˆ¤æ–­masterè¿›å…¥ä¸»è§‚ä¸‹çº¿çš„æ ‡å‡†ï¼Œè¿˜ä¼šæˆä¸ºSentinelåˆ¤æ–­masterå±ä¸‹æ‰€æœ‰ä»æœåŠ¡å™¨ï¼Œä»¥åŠæ‰€æœ‰åŒæ ·ç›‘è§†masterçš„å…¶ä»–Sentinelè¿›å…¥ä¸»è§‚ä¸‹çº¿çš„æ ‡å‡†ã€‚ å¤šä¸ªSentinelè®¾ç½®çš„ä¸»è§‚ä¸‹çº¿æ—¶é•¿å¯èƒ½ä¸åŒï¼š down-after-millisecondsé€‰é¡¹å¦ä¸€ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹æ˜¯ï¼Œå¯¹äºç›‘è§†åŒä¸€ä¸ªä¸»æœåŠ¡å™¨çš„å¤šä¸ªSentinelæ¥è¯´ï¼Œè¿™äº›Sentinelæ‰€è®¾ç½®çš„down-after-millisecondsé€‰é¡¹çš„å€¼ä¹Ÿå¯èƒ½ä¸åŒï¼Œå› æ­¤ï¼Œå½“ä¸€ä¸ªSentinelå°†ä¸»æœåŠ¡å™¨åˆ¤æ–­ä¸ºä¸»è§‚ä¸‹çº¿æ—¶ï¼Œå…¶ä»–Sentinelå¯èƒ½ä»ç„¶ä¼šè®¤ä¸ºä¸»æœåŠ¡å™¨å¤„äºåœ¨çº¿çŠ¶æ€ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœSentinel1è½½å…¥äº†ä»¥ä¸‹é…ç½®ï¼š 12sentinel monitor master 127.0.0.1 6379 2sentinel down-after-milliseconds master 50000 è€ŒSentinel2åˆ™è½½å…¥äº†ä»¥ä¸‹é…ç½®ï¼š 12sentinel monitor master 127.0.0.1 6379 2sentinel down-after-milliseconds master 10000 é‚£ä¹ˆå½“masterçš„æ–­çº¿æ—¶é•¿è¶…è¿‡10000æ¯«ç§’ä¹‹åï¼ŒSentinel2ä¼šå°†masteråˆ¤æ–­ä¸ºä¸»è§‚ä¸‹çº¿ï¼Œè€ŒSentinel1å´è®¤ä¸ºmasterä»ç„¶åœ¨çº¿ã€‚åªæœ‰å½“masterçš„æ–­çº¿æ—¶é•¿è¶…è¿‡50000æ¯«ç§’ä¹‹åï¼ŒSentinel1å’ŒSentinel2æ‰ä¼šéƒ½è®¤ä¸ºmasterè¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€ã€‚ æ£€æŸ¥å®¢è§‚ä¸‹çº¿çŠ¶æ€ å½“Sentinelå°†ä¸€ä¸ªä¸»æœåŠ¡å™¨åˆ¤æ–­ä¸ºä¸»è§‚ä¸‹çº¿ä¹‹åï¼Œä¸ºäº†ç¡®è®¤è¿™ä¸ªä¸»æœåŠ¡å™¨æ˜¯å¦çœŸçš„ä¸‹çº¿äº†ï¼Œå®ƒä¼šå‘åŒæ ·ç›‘è§†è¿™ä¸€ä¸»æœåŠ¡å™¨çš„å…¶ä»–Sentinelè¿›è¡Œè¯¢é—®ï¼Œçœ‹å®ƒä»¬æ˜¯å¦ä¹Ÿè®¤ä¸ºä¸»æœåŠ¡å™¨å·²ç»è¿›å…¥äº†ä¸‹çº¿çŠ¶æ€ï¼ˆå¯ä»¥æ˜¯ä¸»è§‚ä¸‹çº¿æˆ–è€…å®¢è§‚ä¸‹çº¿ï¼‰ã€‚å½“Sentinelä»å…¶ä»–Sentinelé‚£é‡Œæ¥æ”¶åˆ°è¶³å¤Ÿæ•°é‡çš„å·²ä¸‹çº¿åˆ¤æ–­ä¹‹åï¼ŒSentinelå°±ä¼šå°†ä»æœåŠ¡å™¨åˆ¤å®šä¸ºå®¢è§‚ä¸‹çº¿ï¼Œå¹¶å¯¹ä¸»æœåŠ¡å™¨æ‰§è¡Œæ•…éšœè½¬ç§»æ“ä½œã€‚ Sentinelä½¿ç”¨ SENTINEL is-master-down-by-addr ï¼œipï¼ ï¼œportï¼ ï¼œcurrent_epochï¼ ï¼œrunidï¼å‘½ä»¤è¯¢é—®å…¶ä»–Sentinelæ˜¯å¦åŒæ„ä¸»æœåŠ¡å™¨å·²ä¸‹çº¿ã€‚ å½“ç›®æ ‡Sentinelæ¥æ”¶åˆ°æºSentinelå‘æ¥çš„ SENTINEL is-master-down-byå‘½ä»¤åŒ…æ—¶ï¼Œç›®æ ‡Sentinelä¼šåˆ†æå¹¶å–å‡ºå‘½ä»¤è¯·æ±‚ä¸­åŒ…å«çš„å„ä¸ªå‚æ•°ï¼Œå¹¶æ ¹æ®å…¶ä¸­çš„ä¸»æœåŠ¡å™¨IPå’Œç«¯å£å·ï¼Œæ£€æŸ¥ä¸»æœåŠ¡å™¨æ˜¯å¦å·²ä¸‹çº¿ï¼Œç„¶åå‘æºSentinelè¿”å›ä¸€æ¡åŒ…å«ä¸‰ä¸ªä¸‰å”çš„MultiBulkå›å¤ã€‚ æ ¹æ®å…¶ä»–Sentinelå‘å›çš„SENTINEL is-master-down-byå‘½ä»¤å›å¤ï¼ŒSentinelå°†ç»Ÿè®¡å…¶ä»–SentinelåŒæ„ä¸»æœåŠ¡å™¨å·²ä¸‹çº¿çš„æ•°é‡ï¼Œå½“è¿™ä¸€æ•°é‡è¾¾åˆ°é…ç½®æŒ‡å®šçš„åˆ¤æ–­å®¢è§‚ä¸‹çº¿æ‰€éœ€è¦çš„æ•°é‡æ—¶ï¼ŒSentinelé¬¼å°†ä¸»æœåŠ¡å™¨å®ä¾‹ç»“æ„flagså±æ€§çš„SRI_O_DOWNæ ‡è¯†æ‰“å¼€ï¼Œæ ‡è¯†ä¸»æœåŠ¡å™¨å·²ç»è¿›å…¥å®¢è§‚ä¸‹çº¿çŠ¶æ€ã€‚ å®¢è§‚ä¸‹çº¿çŠ¶æ€çš„åˆ¤æ–­æ¡ä»¶ï¼š å½“è®¤ä¸ºä¸»æœåŠ¡å™¨å·²ç»è¿›å…¥ä¸‹çº¿çŠ¶æ€çš„Sentinelçš„æ•°é‡ï¼Œè¶…è¿‡Sentinelé…ç½®ä¸­è®¾ç½®çš„quorumå‚æ•°çš„å€¼ï¼Œé‚£ä¹ˆè¯¥Sentinelå°±ä¼šè®¤ä¸ºä¸»æœåŠ¡å™¨å·²ç»è¿›å…¥å®¢è§‚ä¸‹çº¿çŠ¶æ€ã€‚ æ¯”å¦‚ï¼Œsentinelå¯åŠ¨æ—¶åŠ è½½ä¸‹è¿°é…ç½®ï¼š 1sentinel monitor master 127.0.0.1 6379 2 æ„å‘³ç€ åŒ…æ‹¬å½“å‰sentinelåœ¨å†…ï¼Œåªè¦æ€»å…±æœ‰ä¸¤ä¸ªsentinelè®¤ä¸ºä¸»æœåŠ¡å™¨å·²ç»è¿›å…¥ä¸‹çº¿çŠ¶æ€ï¼Œé‚£ä¹ˆå½“å‰sentinelå°±å°†ä¸»æœåŠ¡å™¨åˆ¤æ–­ä¸ºå®¢è§‚ä¸‹çº¿ã€‚ åœ¨åŒä¸€ä¸ªsentinelæœåŠ¡ç³»ç»Ÿä¸­ï¼Œä¸åŒçš„sentinelå®ä¾‹å¯ä»¥æœ‰ä¸åŒçš„åˆ¤æ–­å®¢è§‚ä¸‹çº¿æ¡ä»¶ã€‚ é€‰ä¸¾é¢†å¤´Sentinel å½“ä¸€ä¸ªä¸»æœåŠ¡å™¨è¢«åˆ¤æ–­ä¸ºå®¢è§‚ä¸‹çº¿æ—¶ï¼Œç›‘è§†è¿™ä¸ªä¸‹çº¿ä¸»æœåŠ¡å™¨çš„å„ä¸ªSentinelä¼šè¿›è¡Œåå•†ï¼Œé€‰ä¸¾å‡ºä¸€ä¸ªé¢†å¤´Sentinelï¼Œå¹¶ç”±é¢†å¤´Sentinelå¯¹ä¸‹çº¿ä¸»æœåŠ¡å™¨æ‰§è¡Œæ•…éšœè½¬ç§»æ“ä½œã€‚ // å¾…ç»­ æ•…éšœè½¬ç§» åœ¨é€‰ä¸¾äº§ç”Ÿå‡ºé¢†å¤´Sentinelä¹‹åï¼Œé¢†å¤´Sentinelå°†å¯¹å·²ä¸‹çº¿çš„ä¸»æœåŠ¡å™¨æ‰§è¡Œæ•…éšœè½¬ç§»æ“ä½œï¼Œè¯¥æ“ä½œåŒ…å«ä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š åœ¨å·²ä¸‹çº¿ä¸»æœåŠ¡å™¨å±ä¸‹çš„æ‰€æœ‰ä»æœåŠ¡å™¨é‡Œé¢ï¼ŒæŒ‘é€‰å‡ºä¸€ä¸ªä»æœåŠ¡å™¨ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºä¸»æœåŠ¡å™¨ã€‚ è®©å·²ä¸‹çº¿ä¸»æœåŠ¡å™¨å±ä¸‹çš„æ‰€æœ‰ä»æœåŠ¡å™¨æ”¹ä¸ºå¤åˆ¶æ–°çš„ä¸»æœåŠ¡å™¨ã€‚ å°†å·²ä¸‹çº¿ä¸»æœåŠ¡å™¨è®¾ç½®ä¸ºæ–°çš„ä¸»æœåŠ¡å™¨çš„ä»æœåŠ¡å™¨ï¼Œå½“è¿™ä¸ªæ—§çš„ä¸»æœåŠ¡å™¨é‡æ–°ä¸Šçº¿æ—¶ï¼Œå®ƒå°±ä¼šæˆä¸ºæ–°çš„ä¸»æœåŠ¡å™¨çš„ä»æœåŠ¡å™¨ã€‚ // å¾…ç»­ æ¡ˆä¾‹ ğŸ”ç¯å¢ƒï¼šredis 3.2.1/windowsï¼›ç›®æ ‡ï¼šæ„å»ºä¸€ä¸»äºŒä»ä¸‰å“¨å…µçš„å“¨å…µç³»ç»Ÿã€‚ å‡†å¤‡redis windowsç‰ˆæœ¬ redis windowsç¤¾åŒº ğŸ”—ç¬”è€…æä¾› æå–ç ï¼šemj2 rediså®˜æ–¹ ä¸ºå•¥rediså®˜æ–¹æ²¡æœ‰æä¾›windowsç‰ˆæœ¬å‘¢ å¤åˆ¶ä¸‰ä»½ä»£ç ï¼Œå…¶ä¸­ä¸€ä»½åšmasterï¼Œå¦å¤–ä¸¤ä»½åšslave masteré…ç½® redis.windows.conf 1port 6380 sentinel.conf 12345678910111213#å½“å‰SentinelæœåŠ¡è¿è¡Œçš„ç«¯å£port 26380#master#Sentinelå»ç›‘è§†ä¸€ä¸ªåä¸ºmymasterçš„ä¸»rediså®ä¾‹ï¼Œè¿™ä¸ªä¸»å®ä¾‹çš„IPåœ°å€ä¸ºæœ¬æœºåœ°å€127.0.0.1ï¼Œç«¯å£å·ä¸º6379ï¼Œ#è€Œå°†è¿™ä¸ªä¸»å®ä¾‹åˆ¤æ–­ä¸ºå¤±æ•ˆè‡³å°‘éœ€è¦2ä¸ª Sentinelè¿›ç¨‹çš„åŒæ„ï¼Œåªè¦åŒæ„Sentinelçš„æ•°é‡ä¸è¾¾æ ‡ï¼Œè‡ªåŠ¨failoverå°±ä¸ä¼šæ‰§è¡Œsentinel monitor mymaster 127.0.0.1 6380 1#æŒ‡å®šäº†Sentinelè®¤ä¸ºRediså®ä¾‹å·²ç»å¤±æ•ˆæ‰€éœ€çš„æ¯«ç§’æ•°ã€‚å½“ å®ä¾‹è¶…è¿‡è¯¥æ—¶é—´æ²¡æœ‰è¿”å›PINGï¼Œæˆ–è€…ç›´æ¥è¿”å›é”™è¯¯ï¼Œé‚£ä¹ˆSentinelå°†è¿™ä¸ªå®ä¾‹æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ã€‚#åªæœ‰ä¸€ä¸ª Sentinelè¿›ç¨‹å°†å®ä¾‹æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿å¹¶ä¸ä¸€å®šä¼šå¼•èµ·å®ä¾‹çš„è‡ªåŠ¨æ•…éšœè¿ç§»ï¼šåªæœ‰åœ¨è¶³å¤Ÿæ•°é‡çš„Sentineléƒ½å°†ä¸€ä¸ªå®ä¾‹æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ä¹‹åï¼Œå®ä¾‹æ‰ä¼šè¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼Œè¿™æ—¶è‡ªåŠ¨æ•…éšœè¿ç§»æ‰ä¼šæ‰§è¡Œsentinel down-after-milliseconds mymaster 5000#æŒ‡å®šäº†åœ¨æ‰§è¡Œæ•…éšœè½¬ç§»æ—¶ï¼Œæœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªä»Rediså®ä¾‹åœ¨åŒæ­¥æ–°çš„ä¸»å®ä¾‹ï¼Œåœ¨ä»Rediså®ä¾‹è¾ƒå¤šçš„æƒ…å†µä¸‹è¿™ä¸ªæ•°å­—è¶Šå°ï¼ŒåŒæ­¥çš„æ—¶é—´è¶Šé•¿ï¼Œå®Œæˆæ•…éšœè½¬ç§»æ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿sentinel config-epoch mymaster 12#å¦‚æœåœ¨è¯¥æ—¶é—´ï¼ˆmsï¼‰å†…æœªèƒ½å®Œæˆfailoveræ“ä½œï¼Œåˆ™è®¤ä¸ºè¯¥failoverå¤±è´¥sentinel leader-epoch mymaster 13 slaveé…ç½® redis.windows.conf 123# å¦ä¸€å°æ˜¯6382port 6381slaveof 127.0.0.1 6380 sentinel.conf 12345678910#slave1 å“¨å…µè¿è¡Œçš„ç«¯å£port 26381#slave2 å“¨å…µè¿è¡Œçš„ç«¯å£#port 26382#slavesentinel monitor mymaster 127.0.0.1 6380 1sentinel down-after-milliseconds mymaster 5000sentinel config-epoch mymaster 12sentinel leader-epoch mymaster 13 è¿è¡Œ å¯åŠ¨æœåŠ¡bat 123# å‡å¦‚ä½ ä½¿ç”¨è®°äº‹æœ¬æ¥ç¼–å†™è¿™ä¸ªbatï¼Œä¸­æ–‡ä¼šä¹±ç ï¼›æ¨èä½¿ç”¨notepad+ï¼Œå°†ç¼–ç æ ¼å¼æ”¹ä¸ºANSItitle &quot;6380æœåŠ¡ç«¯&quot;redis-server.exe redis.windows.conf å“¨å…µå¯åŠ¨bat 12title sentinel-6380redis-server.exe sentinel.conf --sentinel å®¢æˆ·ç«¯å¯åŠ¨bat 12title &quot;6380å®¢æˆ·ç«¯&quot;redis-cli.exe -h 127.0.0.1 -p 6380 è¿æ¥åˆ°å“¨å…µ 12redis-cli.exe -h 127.0.0.1 -p 26381info replication æ–­å¼€6380ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°ï¼ŒæŸä¸€å°slaveæˆä¸ºäº†ä¸»æœåŠ¡å™¨ï¼›é‡æ–°è¿æ¥6380ï¼Œå˜æˆä»æœåŠ¡å™¨ å¤´è„‘é£æš´ â“å‡è®¾ç°åœ¨æœ‰ä¸€å¥—redis sentinelæœåŠ¡ç³»ç»Ÿï¼Œå‡è®¾å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€å‘½ä»¤ï¼Œè¿™æ—¶ä¸»æœåŠ¡å™¨å®•æœºäº†ï¼Œè¿™æ¡å‘½ä»¤ä¼šæ€ä¹ˆæ ·ï¼Ÿ åœ¨ä¸»æœåŠ¡å™¨å®•æœºæœŸé—´ï¼Œå®¢æˆ·ç«¯å¯èƒ½ä¼šæ”¶åˆ°ä¸€äº›é”™è¯¯ä¿¡æ¯æˆ–è¶…æ—¶æç¤ºï¼Œè¿™æ˜¯å› ä¸ºä¸»æœåŠ¡å™¨å·²ç»å®•æœºæ— æ³•å¤„ç†è¯·æ±‚ã€‚å®¢æˆ·ç«¯å¯ä»¥é€‰æ‹©ç­‰å¾…ä¸€æ®µæ—¶é—´åé‡æ–°å‘é€å‘½ä»¤ï¼Œæˆ–è€…è¿æ¥åˆ°æ–°çš„ä¸»æœåŠ¡å™¨æ¥ç»§ç»­æ‰§è¡Œæ“ä½œï¼š æœåŠ¡å™¨å®•æœºå‰å®Œå…¨æ¥æ”¶åˆ°è¯¥å‘½ä»¤ åœ¨ä¸»æœåŠ¡å™¨å®•æœºåï¼Œå“¨å…µæ¨¡å¼ä¼šè‡ªåŠ¨å°†æ–°çš„ä¸»æœåŠ¡å™¨ä¸æ—§çš„ä»æœåŠ¡å™¨è¿›è¡ŒåŒæ­¥ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ æœåŠ¡å™¨å·²ç»å¤„ç†å®Œæ¯• å‘½ä»¤å·²ç»å¤„ç†å®Œï¼Œæ–°çš„æœåŠ¡å™¨å°±å¿½ç•¥è¿™æ¡å‘½ä»¤ æœåŠ¡å™¨æœªå¤„ç†å®Œæ¯• æ–°é€‰ä¸¾å‡ºæ¥çš„ä¸»æœåŠ¡å™¨é€šè¿‡å¤åˆ¶æœºåˆ¶æ¥è·å–åˆ°æœªå®Œæˆçš„å‘½ä»¤ï¼Œç„¶åæ‰§è¡Œã€‚ æœåŠ¡å™¨å®•æœºå‰æœªèƒ½ä»‹ç»åˆ°è¯¥å‘½ä»¤ è¿™ç§æƒ…å†µï¼Œsentinel æ˜¯æ²¡åŠæ³•å¤„ç†çš„ï¼Œè¿™å±äºæ•°æ®æŒä¹…åŒ–çš„èŒƒç•´ã€‚","categories":[{"name":"Redis","slug":"Redis","permalink":"https://solitaire-12.github.io/categories/Redis/"}],"tags":[{"name":"redis","slug":"redis","permalink":"https://solitaire-12.github.io/tags/redis/"},{"name":"é«˜å¯ç”¨","slug":"é«˜å¯ç”¨","permalink":"https://solitaire-12.github.io/tags/%E9%AB%98%E5%8F%AF%E7%94%A8/"}]},{"title":"Redis|ä¸»ä»","slug":"redis/ä¸»ä»","date":"2024-03-25T02:16:00.000Z","updated":"2024-03-25T04:06:09.979Z","comments":true,"path":"2024/03/25/redis/ä¸»ä»/","permalink":"https://solitaire-12.github.io/2024/03/25/redis/%E4%B8%BB%E4%BB%8E/","excerpt":"","text":"ä¸»ä»å¤åˆ¶ åœ¨redisä¸­ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ slaveofå‘½ä»¤æˆ–è€…è®¾ç½®slaveofé€‰é¡¹ï¼Œè®©ä¸€ä¸ªæœåŠ¡å™¨å»å¤åˆ¶(replicate)å¦ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæˆ‘ä»¬å°†è¢«å¤åˆ¶çš„æœåŠ¡å™¨ç§°ä¸ºä¸»æœåŠ¡å™¨(master)ï¼Œè€Œå¯¹ä¸»æœåŠ¡å™¨è¿›è¡Œå¤åˆ¶çš„æœåŠ¡å™¨ç§°ä¸ºä»æœåŠ¡å™¨(slave)ã€‚å…³ç³»å›¾å¦‚ä¸‹ï¼š ğŸ”åŸºç¡€æ¡ˆä¾‹ï¼š ç°åœ¨æœ‰ä¸¤å°redisæœåŠ¡å™¨ï¼Œåˆ†åˆ«æ˜¯ 127.0.0.1:6379å’Œ127.0.0.1:6380 åœ¨6380æœåŠ¡å™¨æŒ‡å®šä¸º6379çš„ä»å®¢æˆ·æœº 1slaveof 127.0.0.1 6379 è¿›è¡Œå¤åˆ¶ä¸­çš„ä¸»ä»æœåŠ¡å™¨åŒæ–¹çš„æ•°æ®åº“å°†ä¿å­˜ç›¸åŒçš„æ•°æ®ï¼Œæ¦‚å¿µä¸Šå°†è¿™ç§ç°è±¡ç§°ä½œâ€œæ•°æ®åº“çŠ¶æ€ä¸€è‡´â€ï¼Œæˆ–è€…ç®€ç§°â€œä¸€è‡´â€ã€‚ ç°è±¡ï¼š åœ¨ä¸»æœåŠ¡å™¨æ‰§è¡Œ set test 'hello' åœ¨ä»æœåŠ¡å™¨æ‰§è¡Œ get test è¿™æ—¶ï¼Œä»æœåŠ¡å™¨æ˜¯å¯ä»¥è·å–åˆ°è¿™ä¸ªtestçš„æ•°æ®çš„ã€‚ SYNC redisä¸»ä»å¤åˆ¶åŠŸèƒ½åˆ†ä¸ºåŒæ­¥(sync)å’Œå‘½ä»¤ä¼ æŠ¥(command propagate)ä¸¤ä¸ªæ“ä½œï¼š åŒæ­¥æ“ä½œç”¨æˆ·å°†ä»æœåŠ¡å™¨çš„æ•°æ®åº“çŠ¶æ€æ›´æ–°è‡³ä¸»æœåŠ¡å™¨å½“å‰æ‰€åœ¨çš„æ•°æ®åº“çŠ¶æ€ã€‚ å‘½ä»¤ä¼ æ’­æ“ä½œåˆ™æ˜¯ç”¨äºä¿è¯ä¸»æœåŠ¡å™¨çš„æ•°æ®çŠ¶æ€è¢«ä¿®æ”¹æ—¶ï¼Œä½¿ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®åº“é‡æ–°å›åˆ°ä¸€è‡´çŠ¶æ€ã€‚ åŒæ­¥ å½“å®¢æˆ·ç«¯å‘ä»æœåŠ¡å™¨å‘é€slaveofå‘½ä»¤çš„æ—¶å€™ï¼Œè¦æ±‚ä»æœåŠ¡å™¨å¤åˆ¶ä¸»æœåŠ¡å™¨æ—¶ï¼Œä»æœåŠ¡å™¨é¦–å…ˆéœ€è¦æ‰§è¡ŒåŒæ­¥æ“ä½œã€‚ä¹Ÿå°±æ˜¯ï¼šå°†ä»æœåŠ¡å™¨çš„æ•°æ®åº“çŠ¶æ€æ›´æ–°è‡³ä¸»æœåŠ¡å™¨å½“å‰æ‰€åœ¨çš„æ•°æ®åº“çŠ¶æ€ã€‚ ä»æœåŠ¡å™¨å¯¹ä¸»æœåŠ¡å™¨çš„åŒæ­¥æ“ä½œæ—¶ï¼Œä¼šå‘ä¸»æœåŠ¡å™¨å‘é€ SYNCå‘½ä»¤ï¼Œè¯¥å‘½ä»¤çš„æ‰§è¡Œæ­¥éª¤å¦‚ä¸‹ï¼š ä»æœåŠ¡å™¨å‘ä¸»æœåŠ¡å™¨å‘é€SYNCå‘½ä»¤ æ”¶åˆ°SYNCå‘½ä»¤çš„ä¸»æœåŠ¡å™¨æ‰§è¡Œbgsaveå‘½ä»¤ï¼Œåœ¨åå°ç”Ÿæˆä¸€ä¸ªRDBæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªç¼“å†²åŒºè®°å½•ä»ç°åœ¨å¼€å§‹æ‰§è¡Œçš„æ‰€æœ‰å‘½ä»¤ã€‚ å½“ä¸»æœåŠ¡å™¨çš„bgsaveå‘½ä»¤æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œä¸»æœåŠ¡å™¨ä¼šå°†RDBæ–‡ä»¶å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨æ¥æ”¶å¹¶è½½å…¥è¿™ä¸ªRDBæ–‡ä»¶ï¼Œå°†è‡ªå·±çš„æ•°æ®åº“çŠ¶æ€æ›´æ–°è‡³ä¸»æœåŠ¡å™¨æ‰§è¡Œbgsaveå‘½ä»¤æ—¶çš„æ•°æ®åº“çŠ¶æ€ã€‚ ä¸»æœåŠ¡å™¨å°†è®°å½•åœ¨ç¼“å†²åŒºé‡Œé¢çš„æ‰€æœ‰å†™å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨æ‰§è¡Œè¿™äº›å†™å‘½ä»¤ï¼Œå°†è‡ªå·±çš„æ•°æ®åº“çŠ¶æ€æ›´æ–°è‡³ä¸»æœåŠ¡å™¨æ•°æ®åº“å½“å‰æ‰€å¤„çš„çŠ¶æ€ã€‚ å‘½ä»¤ä¼ æ’­ åœ¨åŒæ­¥æ“ä½œæ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œä¸»ä»æ•°æ®åº“æ˜¯ä¸€è‡´çš„ï¼Œå½“ä¸»æœåŠ¡å™¨æ‰§è¡Œäº†å…¶ä»–å†™å‘½ä»¤ä¹‹åï¼Œä¼šæ‰“ç ´è¿™ç§çŠ¶æ€ã€‚æ•…è€Œï¼Œåœ¨ä¸»æœåŠ¡å™¨æ‰§è¡Œå†™å‘½ä»¤æ—¶ï¼Œå°†è¿™ä¸€å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨æ‰§è¡Œï¼Œä»è€Œä½¿æ•°æ®åº“çŠ¶æ€è¾¾åˆ°ä¸€è‡´ã€‚ ç¼ºé™· å¯¹å¤„ç†ä¸»ä»æœåŠ¡æ–­å¼€åé‡å¤åˆ¶çš„å¤„ç†ä¸æ˜¯å¾ˆç†æƒ³ï¼Œä¸¾ä¸ªä¾‹å­ ä»ä¸Šè¿°ä¾‹å­ä¸­ï¼Œå¯ä»¥çœ‹å‡ºï¼Œä¸»ä»æœåŠ¡å™¨æ–­å¼€é‡è¿ä¹‹åï¼ŒSYNCä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„RDBï¼Œå¯¹äºä»æœåŠ¡å™¨æ¥å°†ï¼Œå®ƒåªç¼ºå¤±äº†ä¸»ä»æœåŠ¡æ–­å¼€ä¹‹åçš„æ•°æ®è€Œå·²ï¼Œä½†æ˜¯SYNCå´æ˜¯é‡æ–°ç”Ÿæˆäº†ä¸€æ•´ä¸ªå®Œæ•´çš„RDBã€‚ SYNCå‘½ä»¤çš„ç¼ºé™· æ¯æ¬¡æ‰§è¡ŒSYNCå‘½ä»¤ï¼Œä¸»ä»æœåŠ¡å™¨éœ€è¦æ‰§è¡Œä»¥ä¸‹åŠ¨ä½œï¼š ä¸»æœåŠ¡å™¨éœ€è¦æ‰§è¡ŒBGSAVEå‘½ä»¤æ¥ç”ŸæˆRDBæ–‡ä»¶ï¼Œè¿™ä¸ªç”Ÿæˆæ“ä½œä¼šè€—è´¹ä¸»æœåŠ¡å™¨å¤§é‡çš„CPUã€å†…å­˜å’Œç£ç›˜I/Oèµ„æºã€‚ ä¸»æœåŠ¡å™¨éœ€è¦å°†è‡ªå·±ç”Ÿæˆçš„RDBæ–‡ä»¶å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œè¿™ä¸ªå‘é€æ“ä½œä¼šè€—è´¹ä¸»ä»æœåŠ¡å™¨å¤§é‡çš„ç½‘ç»œèµ„æºï¼ˆå¸¦å®½å’Œæµé‡ï¼‰ï¼Œå¹¶å¯¹ä¸»æœåŠ¡å™¨å“åº”å‘½ä»¤è¯·æ±‚çš„æ—¶é—´äº§ç”Ÿå½±å“ã€‚ æ¥æ”¶åˆ°RDBæ–‡ä»¶çš„ä»æœåŠ¡å™¨éœ€è¦è½½å…¥ä¸»æœåŠ¡å™¨å‘æ¥çš„RDBæ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨è½½å…¥æœŸé—´ï¼Œä»æœåŠ¡å™¨ä¼šå› ä¸ºé˜»å¡è€Œæ²¡åŠæ³•å¤„ç†å‘½ä»¤è¯·æ±‚ã€‚ â­PSYNC redisä»2.8ä¹‹åï¼Œä½¿ç”¨PSYNCå‘½ä»¤ä»£æ›¿SYNCå‘½ä»¤æ‰§è¡Œå¤åˆ¶æ—¶çš„åŒæ­¥æ“ä½œã€‚ PSYNCå‘½ä»¤å…·æœ‰å®Œæ•´é‡åŒæ­¥(full resynchronization)å’Œéƒ¨åˆ†é‡åŒæ­¥(partial resynchronization)ä¸¤ç§æ¨¡å¼ï¼š å®Œæ•´é‡åŒæ­¥ç”¨äºå¤„ç†åˆæ¬¡å¤åˆ¶æƒ…å†µï¼šå®Œæ•´é‡åŒæ­¥çš„æ‰§è¡Œæ­¥éª¤å’ŒSYNCå‘½ä»¤çš„æ‰§è¡Œæ­¥éª¤åŸºæœ¬ä¸€æ ·ï¼Œå®ƒä»¬éƒ½æ˜¯é€šè¿‡è®©ä¸»æœåŠ¡å™¨åˆ›å»ºå¹¶å‘é€RDBæ–‡ä»¶ï¼Œä»¥åŠå‘ä»æœåŠ¡å™¨å‘é€ä¿å­˜åœ¨ç¼“å†²åŒºé‡Œé¢çš„å†™å‘½ä»¤æ¥è¿›è¡ŒåŒæ­¥ã€‚ éƒ¨åˆ†é‡åŒæ­¥åˆ™ç”¨äºå¤„ç†æ–­çº¿åé‡å¤åˆ¶æƒ…å†µï¼šå½“ä»æœåŠ¡å™¨åœ¨æ–­çº¿åé‡æ–°è¿æ¥ä¸»æœåŠ¡å™¨æ—¶ï¼Œå¦‚æœæ¡ä»¶å…è®¸ï¼Œä¸»æœåŠ¡å™¨å¯ä»¥å°†ä¸»ä»æœåŠ¡å™¨è¿æ¥æ–­å¼€æœŸé—´æ‰§è¡Œçš„å†™å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨åªè¦æ¥æ”¶å¹¶æ‰§è¡Œè¿™äº›å†™å‘½ä»¤ï¼Œå°±å¯ä»¥å°†æ•°æ®åº“æ›´æ–°è‡³ä¸»æœåŠ¡å™¨å½“å‰æ‰€å¤„çš„çŠ¶æ€ã€‚ éƒ¨åˆ†é‡åŒæ­¥ ç”±ä¸€ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š ä¸»æœåŠ¡å™¨çš„å¤åˆ¶åç§»é‡(replication offset)å’Œä»æœåŠ¡å™¨çš„å¤åˆ¶åç§»é‡ ä¸»æœåŠ¡å™¨çš„å¤åˆ¶ç§¯å‹ç¼“å†²åŒº(replication backlog) æœåŠ¡å™¨çš„è¿è¡ŒID(run ID) å¤åˆ¶åç§»é‡ æ‰§è¡Œå¤åˆ¶çš„åŒæ–¹-ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨ä¼šåˆ†åˆ«ç»´æŠ¤ä¸€ä¸ªå¤åˆ¶åç§»é‡ï¼š ä¸»æœåŠ¡å™¨ï¼Œæ¯æ¬¡å‘ä»æœåŠ¡å™¨ä¼ æ’­Nä¸ªå­—èŠ‚çš„æ•°æ®æ—¶ï¼Œå°±å°†è‡ªå·±çš„å¤åˆ¶åç§»é‡çš„å€¼åŠ ä¸ŠN ä»æœåŠ¡å™¨ï¼Œæ¯æ¬¡æ¥æ”¶åˆ°ä¸»æœåŠ¡å™¨ä¼ æ’­æ¥çš„Nä¸ªå­—èŠ‚çš„æ•°æ®æ—¶ï¼Œå°±å°†è‡ªå·±çš„å¤åˆ¶åç§»é‡çš„å€¼åŠ ä¸ŠN é€šè¿‡å¯¹æ¯”ä¸»ä»æœåŠ¡å™¨çš„å¤åˆ¶åç§»é‡ï¼Œç¨‹åºå°±å¯ä»¥ç›´åˆ°ä»æœåŠ¡å™¨æ˜¯å¦å¤„äºä¸€è‡´çŠ¶æ€ï¼šå¦‚æœä¸»ä»æœåŠ¡å™¨å¤„äºä¸€è‡´çŠ¶æ€ï¼Œé‚£ä¹ˆä¸»ä»æœåŠ¡å™¨ä¸¤è€…çš„åç§»é‡æ€»æ˜¯ç›¸åŒçš„ï¼›å¦‚æœåç§»é‡å¹¶ä¸ç›¸åŒï¼Œé‚£ä¹ˆä¸»ä»æœåŠ¡å™¨ä¸ä¸€è‡´ã€‚ â“ä»ä¸Šå›¾ä¸­ï¼ŒæœåŠ¡å™¨Aæ–­çº¿ä¹‹åï¼Œç«‹å³é‡è¿ï¼Œå‘ä¸»æœåŠ¡å™¨å‘é€äº†è‡ªå·±çš„åç§»é‡ã€‚é‚£ä¹ˆä¸»æœåŠ¡å™¨åº”è¯¥å¯¹ä»æœåŠ¡å™¨æ‰§è¡Œå®Œæ•´é‡åŒæ­¥è¿˜æ˜¯éƒ¨åˆ†é‡åŒæ­¥ï¼Ÿå¦‚æœæ˜¯éƒ¨åˆ†é‡åŒæ­¥çš„è¯ï¼Œä¸»æœåŠ¡å™¨æ˜¯å¦‚ä½•è¡¥å¿ä»æœåŠ¡å™¨Aåœ¨æ–­çº¿æœŸé—´ä¸¢å¤±çš„æ•°æ®ï¼Ÿ å¤åˆ¶ç§¯å‹ç¼“å†²åŒº æ˜¯ç”±ä¸»æœåŠ¡å™¨ç»´æŠ¤çš„ä¸€ä¸ªå›ºå®šé•¿åº¦(fixed-size)å…ˆè¿›å…ˆå‡ºçš„(FIFO)é˜Ÿåˆ—ï¼Œé»˜è®¤å¤§å°ä¸º1MBã€‚ å½“ä¸»æœåŠ¡å™¨è¿›è¡Œå‘½ä»¤ä¼ æ’­æ—¶ï¼Œä»–ä¸ä»…ä¼šå°†å‘½ä»¤å‘é€ä¸ªæ‰€æœ‰æœåŠ¡å™¨ï¼Œè¿˜ä¼šå°†å†™å‘½ä»¤å…¥é˜Ÿåˆ°å¤åˆ¶ç§¯å‹ç¼“å†²åŒºé‡Œé¢ï¼Œ å› æ­¤ï¼Œä¸»æœåŠ¡å™¨çš„å¤åˆ¶ç§¯å‹ç¼“å†²åŒºé‡Œé¢ä¼šä¿å­˜ç€ä¸€éƒ¨åˆ†æœ€è¿‘ä¼ æ’­çš„å†™å‘½ä»¤ï¼Œå¹¶ä¸”å¤åˆ¶ç§¯å‹ç¼“å†²åŒºä¼šä¸ºé˜Ÿåˆ—çš„æ¯ä¸ªå­—èŠ‚è®°å½•ç›¸åº”çš„å¤åˆ¶åç§»é‡ï¼Œä¾‹å¦‚ï¼š å½“æœåŠ¡å™¨é‡æ–°è¿ä¸Šä¸»æœåŠ¡å™¨æ—¶ï¼Œä»æœåŠ¡å™¨ä¼šé€šè¿‡PSYNCå‘½ä»¤å°†è‡ªå·±çš„å¤åˆ¶åç§»é‡offsetå‘é€ç»™ä¸»æœåŠ¡å™¨ï¼Œä¸»æœåŠ¡å™¨ä¼šæ ¹æ®è¿™ä¸ªåç§»é‡æ¥å†³å®šå¯¹ä»æœåŠ¡å™¨æ‰§è¡Œä½•ç§åŒæ­¥æ“ä½œï¼š å¦‚æœoffsetåç§»é‡ä¹‹åçš„æ•°æ®ï¼ˆä¹Ÿå³æ˜¯åç§»é‡offset+1å¼€å§‹çš„æ•°æ®ï¼‰ä»ç„¶å­˜åœ¨äºå¤åˆ¶ç§¯å‹ç¼“å†²åŒºé‡Œé¢ï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨å°†å¯¹ä»æœåŠ¡å™¨æ‰§è¡Œéƒ¨åˆ†é‡åŒæ­¥æ“ä½œã€‚ å¦‚æœoffsetåç§»é‡ä¹‹åçš„æ•°æ®ï¼ˆä¹Ÿå³æ˜¯åç§»é‡offset+1å¼€å§‹çš„æ•°æ®ï¼‰ä»ç„¶å­˜åœ¨äºå¤åˆ¶ç§¯å‹ç¼“å†²åŒºé‡Œé¢ï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨å°†å¯¹ä»æœåŠ¡å™¨æ‰§è¡Œéƒ¨åˆ†é‡åŒæ­¥æ“ä½œã€‚ æ‹¿ä¸ŠèŠ‚ä¸­çš„ç¤ºä¾‹å›¾ä¸ºä¾‹ï¼š å½“æœåŠ¡å™¨Aæ–­çº¿ä¹‹åï¼Œç«‹å³é‡æ–°æ¥å‡ç»“ä¸»æœåŠ¡å™¨ï¼Œå¹¶å‘é€PSYNCå‘½ä»¤ï¼ŒæŠ¥å‘Šè‡ªå·±çš„å¤åˆ¶åç§»é‡æ—¶10086ï¼› ä¸»æœåŠ¡å™¨ä»‹ç»åˆ°ä»æœåŠ¡å™¨æ³•æ´›æ–¯çš„PSYNCå‘½ä»¤ä»¥åŠåç§»é‡10086ä¹‹åï¼Œæ£€æŸ¥åç§»é‡ä¹‹åçš„æ•°æ®æ˜¯å¦å­˜åœ¨äºå¤åˆ¶ç§¯å‹ç¼“å†²åŒºé‡Œè¾¹ï¼Œå‘ç°å­˜åœ¨ï¼Œäºæ˜¯å‘ä»æœåŠ¡å™¨å‘é€+CONTINUEå›å¤ï¼Œè¡¨ç¤ºæ•°æ®åŒæ­¥å°†ä»¥éƒ¨åˆ†å†²åŒæ­¥æ¨¡å¼æ¥è¿›è¡Œã€‚ æ¥ç€ä¸»æœåŠ¡å™¨å°†å¤åˆ¶ç§¯å‹ç¼“å†²åŒº10086åç§»é‡ä¹‹åçš„æ‰€æœ‰æ•°æ®éƒ½å‘é€ç»™ä»æœåŠ¡å™¨ Redisä¸ºå¤åˆ¶ç§¯å‹ç¼“å†²åŒºè®¾ç½®çš„é»˜è®¤å¤§å°ä¸º1MBï¼Œå¦‚æœä¸»æœåŠ¡å™¨éœ€è¦æ‰§è¡Œå¤§é‡å†™å‘½ä»¤ï¼Œæˆ–è€…ä¸»ä»æœåŠ¡å™¨çŸ­çº¿ä¹‹åé‡è¿æ‰€éœ€è¦çš„äº‹ä»¶æ¯”è¾ƒé•¿ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤§å°ä¹Ÿè®¸å¹¶ä¸åˆé€‚ã€‚å¦‚æœå¤åˆ¶ç§¯å‹ç¼“å†²åŒºçš„å¤§å°è®¾ç½®å¾—ä¸æ°å½“ï¼Œé‚£ä¹ˆPSYNCå‘½ä»¤çš„å¤åˆ¶é‡åŒæ­¥æ¨¡å¼å°±ä¸èƒ½æ­£å¸¸å‘æŒ¥ä½œç”¨ï¼Œå› æ­¤ï¼Œæ­£ç¡®ä¼°ç®—å’Œè®¾ç½®å¤åˆ¶ç§¯å‹ç¼“å†²åŒºçš„å¤§å°éå¸¸é‡è¦ã€‚å¤åˆ¶ç§¯å‹ç¼“å†²åŒºçš„æœ€å°å¤§å°å¯ä»¥æ ¹æ®å…¬å¼second*write_size_per_secondæ¥ä¼°ç®—ï¼šã€å…¶ä¸­ï¼Œsecondä¸ºä»æœåŠ¡å™¨æ–­çº¿åé‡æ–°è¿æ¥ä¸Šä¸»æœåŠ¡å™¨æ‰€éœ€è¦çš„æ—¶é—´(ä»¥ç§’è¡¡é‡)ï¼›write_size_per_secondåˆ™æ˜¯ä¸»æœåŠ¡å™¨å¹³å‡æ¯ç§’äº§ç”Ÿçš„å†™å‘½ä»¤æ•°æ®é‡(åè®®æ ¼å¼çš„å†™å‘½ä»¤çš„é•¿åº¦æ€»å’Œ)ã€‘ ä¾‹å¦‚ï¼Œå¦‚æœä¸»æœåŠ¡å™¨å¹³å‡æ¯ç§’äº§ç”Ÿ1 MBçš„å†™æ•°æ®ï¼Œè€Œä»æœåŠ¡å™¨æ–­çº¿ä¹‹åå¹³å‡è¦5ç§’æ‰èƒ½é‡æ–°è¿æ¥ä¸Šä¸»æœåŠ¡å™¨ï¼Œé‚£ä¹ˆå¤åˆ¶ç§¯å‹ç¼“å†²åŒºçš„å¤§å°å°±ä¸èƒ½ä½äº5MBã€‚ ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå¯ä»¥å°†å¤åˆ¶ç§¯å‹ç¼“å†²åŒºçš„å¤§å°è®¾ä¸º2*second*write_size_per_secondï¼Œè¿™æ ·å¯ä»¥ä¿è¯ç»å¤§éƒ¨åˆ†æ–­çº¿æƒ…å†µéƒ½èƒ½ç”¨éƒ¨åˆ†é‡åŒæ­¥æ¥å¤„ç†ã€‚ è‡³äºå¤åˆ¶ç§¯å‹ç¼“å†²åŒºå¤§å°çš„ä¿®æ”¹æ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒé…ç½®æ–‡ä»¶ä¸­å…³äºrepl-backlog-sizeé€‰é¡¹çš„è¯´æ˜ã€‚ æœåŠ¡å™¨è¿è¡ŒID â€‹ æ¯ä¸ªRedisæœåŠ¡å™¨ï¼Œä¸è®ºä¸»æœåŠ¡å™¨è¿˜æ˜¯ä»æœåŠ¡ï¼Œéƒ½ä¼šæœ‰è‡ªå·±çš„è¿è¡ŒIDã€‚è¿è¡ŒIDåœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œç”±40ä¸ªéšæœºçš„åå…­è¿›åˆ¶å­—ç¬¦ç»„æˆã€‚ â€‹ å½“ä»æœåŠ¡å™¨å¯¹ä¸»æœåŠ¡å™¨è¿›è¡Œåˆæ¬¡å¤åˆ¶æ—¶ï¼Œä¸»æœåŠ¡å™¨ä¼šå°†è‡ªå·±çš„è¿è¡ŒIDä¼ é€ç»™ä»æœåŠ¡å™¨ï¼Œè€Œä»æœåŠ¡å™¨åˆ™ä¼šå°†è¿™ä¸ªè¿è¡ŒIDä¿å­˜èµ·æ¥ã€‚å½“ä»æœåŠ¡å™¨æ–­çº¿å¹¶é‡æ–°è¿ä¸Šä¸€ä¸ªä¸»æœåŠ¡å™¨æ—¶ï¼Œä»æœåŠ¡å™¨å°†å‘å½“å‰è¿æ¥çš„ä¸»æœåŠ¡å™¨å‘é€ä¹‹å‰ä¿å­˜çš„è¿è¡ŒIDï¼š å¦‚æœä»æœåŠ¡å™¨ä¿å­˜çš„è¿è¡ŒIDå’Œå½“å‰è¿æ¥çš„ä¸»æœåŠ¡å™¨çš„è¿è¡ŒIDç›¸åŒï¼Œé‚£ä¹ˆè¯´æ˜ä»æœåŠ¡å™¨æ–­çº¿ä¹‹å‰å¤åˆ¶çš„å°±æ˜¯å½“å‰è¿æ¥çš„è¿™ä¸ªä¸»æœåŠ¡å™¨ï¼Œä¸»æœåŠ¡å™¨å¯ä»¥ç»§ç»­å°è¯•æ‰§è¡Œéƒ¨åˆ†é‡åŒæ­¥æ“ä½œã€‚ ç›¸ååœ°ï¼Œå¦‚æœä»æœåŠ¡å™¨ä¿å­˜çš„è¿è¡ŒIDå’Œå½“å‰è¿æ¥çš„ä¸»æœåŠ¡å™¨çš„è¿è¡ŒIDå¹¶ä¸ç›¸åŒï¼Œé‚£ä¹ˆè¯´æ˜ä»æœåŠ¡å™¨æ–­çº¿ä¹‹å‰å¤åˆ¶çš„ä¸»æœåŠ¡å™¨å¹¶ä¸æ˜¯å½“å‰è¿æ¥çš„è¿™ä¸ªä¸»æœåŠ¡å™¨ï¼Œä¸»æœåŠ¡å™¨å°†å¯¹ä»æœåŠ¡å™¨æ‰§è¡Œå®Œæ•´é‡åŒæ­¥æ“ä½œã€‚ PSYNCçš„å®ç° PSYNCå‘½ä»¤çš„è°ƒç”¨æ–¹æ³•æœ‰ä¸¤ç§ï¼š å¦‚æœä»æœåŠ¡å™¨ä»¥å‰æ²¡æœ‰å¤åˆ¶è¿‡ä»»ä½•ä¸»æœåŠ¡å™¨ï¼Œæˆ–è€…ä¹‹å‰æ‰§è¡Œè¿‡SLAVEOF no oneå‘½ä»¤ï¼Œé‚£ä¹ˆä»æœåŠ¡å™¨åœ¨å¼€å§‹ä¸€æ¬¡æ–°çš„å¤åˆ¶æ—¶å°†å‘ä¸»æœåŠ¡å™¨å‘é€PSYNC ? -1å‘½ä»¤ï¼Œä¸»åŠ¨è¯·æ±‚ä¸»æœåŠ¡å™¨è¿›è¡Œå®Œæ•´é‡åŒæ­¥ï¼ˆå› ä¸ºè¿™æ—¶ä¸å¯èƒ½æ‰§è¡Œéƒ¨åˆ†é‡åŒæ­¥ï¼‰ã€‚ ç›¸ååœ°ï¼Œå¦‚æœä»æœåŠ¡å™¨å·²ç»å¤åˆ¶è¿‡æŸä¸ªä¸»æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä»æœåŠ¡å™¨åœ¨å¼€å§‹ä¸€æ¬¡æ–°çš„å¤åˆ¶æ—¶å°†å‘ä¸»æœåŠ¡å™¨å‘é€PSYNC ï¼œrunidï¼ ï¼œoffsetï¼å‘½ä»¤ï¼šå…¶ä¸­runidæ˜¯ä¸Šä¸€æ¬¡å¤åˆ¶çš„ä¸»æœåŠ¡å™¨çš„è¿è¡ŒIDï¼Œè€Œoffsetåˆ™æ˜¯ä»æœåŠ¡å™¨å½“å‰çš„å¤åˆ¶åç§»é‡ï¼Œæ¥æ”¶åˆ°è¿™ä¸ªå‘½ä»¤çš„ä¸»æœåŠ¡å™¨ä¼šé€šè¿‡è¿™ä¸¤ä¸ªå‚æ•°æ¥åˆ¤æ–­åº”è¯¥å¯¹ä»æœåŠ¡å™¨æ‰§è¡Œå“ªç§åŒæ­¥æ“ä½œã€‚ æ ¹æ®æƒ…å†µï¼Œæ¥æ”¶åˆ°PSYNCå‘½ä»¤çš„ä¸»æœåŠ¡å™¨ä¼šå‘ä»æœåŠ¡å™¨è¿”å›ä»¥ä¸‹ä¸‰ç§å›å¤çš„å…¶ä¸­ä¸€ç§ï¼š å¦‚æœä¸»æœåŠ¡å™¨è¿”å›+FULLRESYNC ï¼œrunidï¼ ï¼œoffsetï¼å›å¤ï¼Œé‚£ä¹ˆè¡¨ç¤ºä¸»æœåŠ¡å™¨å°†ä¸ä»æœåŠ¡å™¨æ‰§è¡Œå®Œæ•´é‡åŒæ­¥æ“ä½œï¼šå…¶ä¸­runidæ˜¯è¿™ä¸ªä¸»æœåŠ¡å™¨çš„è¿è¡ŒIDï¼Œä»æœåŠ¡å™¨ä¼šå°†è¿™ä¸ªIDä¿å­˜èµ·æ¥ï¼Œåœ¨ä¸‹ä¸€æ¬¡å‘é€PSYNCå‘½ä»¤æ—¶ä½¿ç”¨ï¼›è€Œoffsetåˆ™æ˜¯ä¸»æœåŠ¡å™¨å½“å‰çš„å¤åˆ¶åç§»é‡ï¼Œä»æœåŠ¡å™¨ä¼šå°†è¿™ä¸ªå€¼ä½œä¸ºè‡ªå·±çš„åˆå§‹åŒ–åç§»é‡ã€‚ å¦‚æœä¸»æœåŠ¡å™¨è¿”å›+CONTINUEå›å¤ï¼Œé‚£ä¹ˆè¡¨ç¤ºä¸»æœåŠ¡å™¨å°†ä¸ä»æœåŠ¡å™¨æ‰§è¡Œéƒ¨åˆ†é‡åŒæ­¥æ“ä½œï¼Œä»æœåŠ¡å™¨åªè¦ç­‰ç€ä¸»æœåŠ¡å™¨å°†è‡ªå·±ç¼ºå°‘çš„é‚£éƒ¨åˆ†æ•°æ®å‘é€è¿‡æ¥å°±å¯ä»¥äº†ã€‚ å¦‚æœä¸»æœåŠ¡å™¨è¿”å›-ERRå›å¤ï¼Œé‚£ä¹ˆè¡¨ç¤ºä¸»æœåŠ¡å™¨çš„ç‰ˆæœ¬ä½äºRedis 2.8ï¼Œå®ƒè¯†åˆ«ä¸äº†PSYNCå‘½ä»¤ï¼Œä»æœåŠ¡å™¨å°†å‘ä¸»æœåŠ¡å™¨å‘é€SYNCå‘½ä»¤ï¼Œå¹¶ä¸ä¸»æœåŠ¡å™¨æ‰§è¡Œå®Œæ•´åŒæ­¥æ“ä½œã€‚ å¤åˆ¶çš„å®ç° è®¾ç½®ä¸»æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£ 1slaveof 127.0.0.1 6379 â€‹ ä»æœåŠ¡å™¨é¦–å…ˆè¦åšçš„å°±æ˜¯å°†å®¢æˆ·ç«¯ç»™å®šçš„ä¸»æœåŠ¡IPåœ°å€127.0.0.1ä»¥åŠç«¯å£6379ä¿å­˜åˆ°æœåŠ¡å™¨çŠ¶æ€çš„masterhostå±æ€§å’Œmasterportå±æ€§ä¸­ 123456struct redisServer&#123; //... char *masterhost; // ä¸»æœåŠ¡å™¨åœ°å€ int masterport; // ä¸»æœåŠ¡ç«¯å£ //...&#125; â€‹ slaveofå‘½ä»¤æ˜¯ä¸€ä¸ªå¼‚æ­¥å‘½ä»¤ï¼Œåœ¨å®Œæˆmasterhostå±æ€§å’Œmasterportå±æ€§çš„è®¾ç½®å·¥ä½œä¹‹åï¼Œä»æœåŠ¡å™¨å°†å‘å‘é€slaveofå‘½ä»¤çš„å®¢æˆ·ç«¯è¿”å›OKï¼Œè¡¨ç¤ºå¤åˆ¶æŒ‡ä»¤å·²ç»è¢«æ¥æ”¶ï¼Œè€Œå®é™…çš„å¤åˆ¶å·¥ä½œå°†åœ¨OKè¿”å›ä¹‹åæ‰çœŸæ­£å¼€å§‹æ‰§è¡Œã€‚ å»ºç«‹å¥—æ¥å­—è¿æ¥ â€‹ åœ¨slaveofå‘½ä»¤æ‰§è¡Œä¹‹åï¼Œä»æœåŠ¡å™¨å°†æ ¹æ®å‘½ä»¤æ‰€è®¾ç½®çš„IPåœ°å€å’Œç«¯å£ï¼Œåˆ›å»ºè¿å‘ä¸»æœåŠ¡å™¨çš„å¥—æ¥å­—è¿æ¥ â€‹ å¦‚æœä»æœåŠ¡å™¨åˆ›å»ºçš„å¥—æ¥å­—èƒ½æˆåŠŸè¿æ¥ï¼ˆconnectï¼‰åˆ°ä¸»æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä»æœåŠ¡å™¨å°†ä¸ºè¿™ä¸ªå¥—æ¥å­—å…³è”ä¸€ä¸ªä¸“é—¨ç”¨äºå¤„ç†å¤åˆ¶å·¥ä½œçš„æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼Œè¿™ä¸ªå¤„ç†å™¨å°†è´Ÿè´£æ‰§è¡Œåç»­çš„å¤åˆ¶å·¥ä½œï¼Œæ¯”å¦‚æ¥æ”¶RDBæ–‡ä»¶ï¼Œä»¥åŠæ¥æ”¶ä¸»æœåŠ¡å™¨ä¼ æ’­æ¥çš„å†™å‘½ä»¤ï¼Œè¯¸å¦‚æ­¤ç±»ã€‚ â€‹ è€Œä¸»æœåŠ¡å™¨åœ¨æ¥å—ï¼ˆacceptï¼‰ä»æœåŠ¡å™¨çš„å¥—æ¥å­—è¿æ¥ä¹‹åï¼Œå°†ä¸ºè¯¥å¥—æ¥å­—åˆ›å»ºç›¸åº”çš„å®¢æˆ·ç«¯çŠ¶æ€ï¼Œå¹¶å°†ä»æœåŠ¡å™¨çœ‹ä½œæ˜¯ä¸€ä¸ªè¿æ¥åˆ°ä¸»æœåŠ¡å™¨çš„å®¢æˆ·ç«¯æ¥å¯¹å¾…ï¼Œè¿™æ—¶ä»æœåŠ¡å™¨å°†åŒæ—¶å…·æœ‰æœåŠ¡å™¨ï¼ˆserverï¼‰å’Œå®¢æˆ·ç«¯ï¼ˆclientï¼‰ä¸¤ä¸ªèº«ä»½ï¼šä»æœåŠ¡å™¨å¯ä»¥å‘ä¸»æœåŠ¡å™¨å‘é€å‘½ä»¤è¯·æ±‚ï¼Œè€Œä¸»æœåŠ¡å™¨åˆ™ä¼šå‘ä»æœåŠ¡å™¨è¿”å›å‘½ä»¤å›å¤ã€‚ â€‹ å› ä¸ºå¤åˆ¶å·¥ä½œæ¥ä¸‹æ¥çš„å‡ ä¸ªæ­¥éª¤éƒ½ä¼šä»¥ä»æœåŠ¡å™¨å‘ä¸»æœåŠ¡å™¨å‘é€å‘½ä»¤è¯·æ±‚çš„å½¢å¼æ¥è¿›è¡Œï¼Œæ‰€ä»¥ç†è§£â€œä»æœåŠ¡å™¨æ˜¯ä¸»æœåŠ¡å™¨çš„å®¢æˆ·ç«¯â€è¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚ å‘é€PINGå‘½ä»¤ â€‹ ä»æœåŠ¡å™¨æˆä¸ºä¸»æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ä¹‹åï¼Œåšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯å‘ä¸»æœåŠ¡å™¨å‘é€ä¸€ä¸ªPINGå‘½ä»¤ã€‚ PINGå‘½ä»¤èµ·åˆ°ä¸¤ä¸ªä½œç”¨ï¼š ä¸»ä»æœåŠ¡å™¨æˆåŠŸå»ºç«‹èµ·äº†å¥—æ¥å­—è¿æ¥ï¼Œä½†åŒæ–¹å¹¶æœªä½¿ç”¨è¯¥å¥—æ¥å­—è¿›è¡Œä»»ä½•é€šä¿¡ï¼Œé€šè¿‡å‘é€PINGå‘½ä»¤å¯ä»¥æ£€æŸ¥å¥—æ¥å­—çš„è¯»å†™çŠ¶æ€æ˜¯å¦æ­£å¸¸ æ£€æŸ¥ä¸»æœåŠ¡å™¨èƒ½å¦æ­£å¸¸å¤„ç†å‘½ä»¤è¯·æ±‚ã€‚ â€‹ ä»æœåŠ¡å™¨åœ¨å‘é€PINGå‘½ä»¤ä¹‹åå°†é‡åˆ°ä»¥ä¸‹ä¸‰ç§æƒ…å†µçš„å…¶ä¸­ä¸€ç§ï¼š å¦‚æœä¸»æœåŠ¡å™¨å‘ä»æœåŠ¡å™¨è¿”å›äº†ä¸€ä¸ªå‘½ä»¤å›å¤ï¼Œä½†ä»æœåŠ¡å™¨å´ä¸èƒ½åœ¨è§„å®šçš„æ—¶é™ï¼ˆtimeoutï¼‰å†…è¯»å–å‡ºå‘½ä»¤å›å¤çš„å†…å®¹ï¼Œé‚£ä¹ˆè¡¨ç¤ºä¸»ä»æœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œè¿æ¥çŠ¶æ€ä¸ä½³ï¼Œä¸èƒ½ç»§ç»­æ‰§è¡Œå¤åˆ¶å·¥ä½œçš„åç»­æ­¥éª¤ã€‚å½“å‡ºç°è¿™ç§æƒ…å†µæ—¶ï¼Œä»æœåŠ¡å™¨æ–­å¼€å¹¶é‡æ–°åˆ›å»ºè¿å‘ä¸»æœåŠ¡å™¨çš„å¥—æ¥å­—ã€‚ å¦‚æœä¸»æœåŠ¡å™¨å‘ä»æœåŠ¡å™¨è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œé‚£ä¹ˆè¡¨ç¤ºä¸»æœåŠ¡å™¨æš‚æ—¶æ²¡åŠæ³•å¤„ç†ä»æœåŠ¡å™¨çš„å‘½ä»¤è¯·æ±‚ï¼Œä¸èƒ½ç»§ç»­æ‰§è¡Œå¤åˆ¶å·¥ä½œçš„åç»­æ­¥éª¤ã€‚å½“å‡ºç°è¿™ç§æƒ…å†µæ—¶ï¼Œä»æœåŠ¡å™¨æ–­å¼€å¹¶é‡æ–°åˆ›å»ºè¿å‘ä¸»æœåŠ¡å™¨çš„å¥—æ¥å­—ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœä¸»æœåŠ¡å™¨æ­£åœ¨å¤„ç†ä¸€ä¸ªè¶…æ—¶è¿è¡Œçš„è„šæœ¬ï¼Œé‚£ä¹ˆå½“ä»æœåŠ¡å™¨å‘ä¸»æœåŠ¡å™¨å‘é€PINGå‘½ä»¤æ—¶ï¼Œä»æœåŠ¡å™¨å°†æ”¶åˆ°ä¸»æœåŠ¡å™¨è¿”å›çš„BUSY Redisis busy running a script.You can only call SCRIPT KILL or SHUTDOWN NOSAVE.é”™è¯¯ã€‚ å¦‚æœä»æœåŠ¡å™¨è¯»å–åˆ°&quot;PONG&quot;å›å¤ï¼Œé‚£ä¹ˆè¡¨ç¤ºä¸»ä»æœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œè¿æ¥çŠ¶æ€æ­£å¸¸ï¼Œå¹¶ä¸”ä¸»æœåŠ¡å™¨å¯ä»¥æ­£å¸¸å¤„ç†ä»æœåŠ¡å™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰å‘é€çš„å‘½ä»¤è¯·æ±‚ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»æœåŠ¡å™¨å¯ä»¥ç»§ç»­æ‰§è¡Œå¤åˆ¶å·¥ä½œçš„ä¸‹ä¸ªæ­¥éª¤ã€‚ èº«ä»½éªŒè¯ â€‹ ä»æœåŠ¡å™¨åœ¨æ”¶åˆ°ä¸»æœåŠ¡å™¨è¿”å›çš„&quot;PONG&quot;å›å¤ä¹‹åï¼Œä¸‹ä¸€æ­¥è¦åšçš„å°±æ˜¯å†³å®šæ˜¯å¦è¿›è¡Œèº«ä»½éªŒè¯ï¼š å¦‚æœä»æœåŠ¡å™¨è®¾ç½®äº†masterauthé€‰é¡¹ï¼Œé‚£ä¹ˆè¿›è¡Œèº«ä»½éªŒè¯ã€‚ å¦‚æœä»æœåŠ¡å™¨æ²¡æœ‰è®¾ç½®masterauthé€‰é¡¹ï¼Œé‚£ä¹ˆä¸è¿›è¡Œèº«ä»½éªŒè¯ã€‚ â€‹ åœ¨éœ€è¦è¿›è¡Œèº«ä»½éªŒè¯çš„æƒ…å†µä¸‹ï¼Œä»æœåŠ¡å™¨å°†å‘ä¸»æœåŠ¡å™¨å‘é€ä¸€æ¡AUTHå‘½ä»¤ï¼Œå‘½ä»¤çš„å‚æ•°ä¸ºä»æœåŠ¡å™¨masterauthé€‰é¡¹çš„å€¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä»æœåŠ¡å™¨masterauthé€‰é¡¹çš„å€¼ä¸º10086ï¼Œé‚£ä¹ˆä»æœåŠ¡å™¨å°†å‘ä¸»æœåŠ¡å™¨å‘é€å‘½ä»¤AUTH 10086ã€‚ â€‹ ä»æœåŠ¡å™¨åœ¨èº«ä»½éªŒè¯é˜¶æ®µå¯èƒ½é‡åˆ°çš„æƒ…å†µæœ‰ä»¥ä¸‹å‡ ç§ï¼š å¦‚æœä¸»æœåŠ¡å™¨æ²¡æœ‰è®¾ç½®requirepassé€‰é¡¹ï¼Œå¹¶ä¸”ä»æœåŠ¡å™¨ä¹Ÿæ²¡æœ‰è®¾ç½®masterauthé€‰é¡¹ï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨å°†ç»§ç»­æ‰§è¡Œä»æœåŠ¡å™¨å‘é€çš„å‘½ä»¤ï¼Œå¤åˆ¶å·¥ä½œå¯ä»¥ç»§ç»­è¿›è¡Œã€‚ å¦‚æœä»æœåŠ¡å™¨é€šè¿‡AUTHå‘½ä»¤å‘é€çš„å¯†ç å’Œä¸»æœåŠ¡å™¨requirepassé€‰é¡¹æ‰€è®¾ç½®çš„å¯†ç ç›¸åŒï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨å°†ç»§ç»­æ‰§è¡Œä»æœåŠ¡å™¨å‘é€çš„å‘½ä»¤ï¼Œå¤åˆ¶å·¥ä½œå¯ä»¥ç»§ç»­è¿›è¡Œã€‚ä¸æ­¤ç›¸åï¼Œå¦‚æœä¸»ä»æœåŠ¡å™¨è®¾ç½®çš„å¯†ç ä¸ç›¸åŒï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨å°†è¿”å›ä¸€ä¸ªinvalid passwordé”™è¯¯ã€‚ å¦‚æœä¸»æœåŠ¡å™¨è®¾ç½®äº†requirepassé€‰é¡¹ï¼Œä½†ä»æœåŠ¡å™¨å´æ²¡æœ‰è®¾ç½®masterauthé€‰é¡¹ï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨å°†è¿”å›ä¸€ä¸ªNOAUTHé”™è¯¯ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä¸»æœåŠ¡å™¨æ²¡æœ‰è®¾ç½®requirepassé€‰é¡¹ï¼Œä½†ä»æœåŠ¡å™¨å´è®¾ç½®äº†masterauthé€‰é¡¹ï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨å°†è¿”å›ä¸€ä¸ªno password is seté”™è¯¯ã€‚ æ‰€æœ‰é”™è¯¯æƒ…å†µéƒ½ä¼šä»¤ä»æœåŠ¡å™¨ä¸­æ­¢ç›®å‰çš„å¤åˆ¶å·¥ä½œï¼Œå¹¶ä»åˆ›å»ºå¥—æ¥å­—å¼€å§‹é‡æ–°æ‰§è¡Œå¤åˆ¶ï¼Œç›´åˆ°èº«ä»½éªŒè¯é€šè¿‡ï¼Œæˆ–è€…ä»æœåŠ¡å™¨æ”¾å¼ƒæ‰§è¡Œå¤åˆ¶ä¸ºæ­¢ã€‚ å‘é€ç«¯å£ä¿¡æ¯ â€‹ åœ¨èº«ä»½éªŒè¯æ­¥éª¤ä¹‹åï¼Œä»æœåŠ¡å™¨å°†æ‰§è¡Œå‘½ä»¤REPLCONF listening-port ï¼œport-numberï¼ï¼Œå‘ä¸»æœåŠ¡å™¨å‘é€ä»æœåŠ¡å™¨çš„ç›‘å¬ç«¯å£å·ã€‚ä¾‹å¦‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œä»æœåŠ¡å™¨çš„ç›‘å¬ç«¯å£ä¸º6380ï¼Œé‚£ä¹ˆä»æœåŠ¡å™¨å°†å‘ä¸»æœåŠ¡å™¨å‘é€å‘½ä»¤REPLCONF listening-port 6380ã€‚ â€‹ ä¸»æœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°è¿™ä¸ªå‘½ä»¤ä¹‹åï¼Œä¼šå°†ç«¯å£å·è®°å½•åœ¨ä»æœåŠ¡å™¨æ‰€å¯¹åº”çš„å®¢æˆ·ç«¯çŠ¶æ€çš„slave_listening_portå±æ€§ä¸­ï¼š 123456typedef struct redisClient &#123; // ... //ä»æœåŠ¡å™¨çš„ç›‘å¬ç«¯å£å· int slave_listening_port; // ...&#125; redisClient; â€‹ slave_listening_portå±æ€§ç›®å‰å”¯ä¸€çš„ä½œç”¨å°±æ˜¯åœ¨ä¸»æœåŠ¡å™¨æ‰§è¡ŒINFO replicationå‘½ä»¤æ—¶æ‰“å°å‡ºä»æœåŠ¡å™¨çš„ç«¯å£å·ã€‚ä¸»æœåŠ¡å™¨å®¢æˆ·ç«¯é€šè¿‡ info relicationå‘½ä»¤æŸ¥çœ‹ã€‚ åŒæ­¥ åœ¨è¿™ä¸€æ­¥ï¼Œä»æœåŠ¡å™¨å°†å‘ä¸»æœåŠ¡å™¨å‘é€PSYNCå‘½ä»¤ï¼Œæ‰§è¡ŒåŒæ­¥æ“ä½œï¼Œå¹¶å°†è‡ªå·±çš„æ•°æ®åº“æ›´æ–°è‡³ä¸»æœåŠ¡å™¨æ•°æ®åº“å½“å‰æ‰€å¤„çš„çŠ¶æ€ã€‚ å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨åŒæ­¥æ“ä½œæ‰§è¡Œä¹‹å‰ï¼Œåªæœ‰ä»æœåŠ¡å™¨æ˜¯ä¸»æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ï¼Œä½†æ˜¯åœ¨æ‰§è¡ŒåŒæ­¥æ“ä½œä¹‹åï¼Œä¸»æœåŠ¡å™¨ä¹Ÿä¼šæˆä¸ºä»æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ï¼š å¦‚æœPSYNCå‘½ä»¤æ‰§è¡Œçš„æ˜¯å®Œæ•´é‡åŒæ­¥æ“ä½œï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨éœ€è¦æˆä¸ºä»æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ï¼Œæ‰èƒ½å°†ä¿å­˜åœ¨ç¼“å†²åŒºé‡Œé¢çš„å†™å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨æ‰§è¡Œã€‚ å¦‚æœPSYNCå‘½ä»¤æ‰§è¡Œçš„æ˜¯éƒ¨åˆ†é‡åŒæ­¥æ“ä½œï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨éœ€è¦æˆä¸ºä»æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ï¼Œæ‰èƒ½å‘ä»æœåŠ¡å™¨å‘é€ä¿å­˜åœ¨å¤åˆ¶ç§¯å‹ç¼“å†²åŒºé‡Œé¢çš„å†™å‘½ä»¤ã€‚ æ­£å› ä¸ºä¸»æœåŠ¡å™¨æˆä¸ºäº†ä»æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ï¼Œæ‰€ä»¥ä¸»æœåŠ¡å™¨æ‰å¯ä»¥é€šè¿‡å‘é€å†™å‘½ä»¤æ¥æ”¹å˜ä»æœåŠ¡å™¨çš„æ•°æ®åº“çŠ¶æ€ï¼Œä¸ä»…åŒæ­¥æ“ä½œéœ€è¦ç”¨åˆ°è¿™ä¸€ç‚¹ï¼Œè¿™ä¹Ÿæ˜¯ä¸»æœåŠ¡å™¨å¯¹ä»æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤ä¼ æ’­æ“ä½œçš„åŸºç¡€ã€‚ å‘½ä»¤ä¼ æ’­ å½“å®Œæˆäº†åŒæ­¥ä¹‹åï¼Œä¸»ä»æœåŠ¡å™¨å°±ä¼šè¿›å…¥å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œè¿™æ—¶ä¸»æœåŠ¡å™¨åªè¦ä¸€ç›´å°†è‡ªå·±æ‰§è¡Œçš„å†™å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œè€Œä»æœåŠ¡å™¨åªè¦ä¸€ç›´æ¥æ”¶å¹¶æ‰§è¡Œä¸»æœåŠ¡å™¨å‘æ¥çš„å†™å‘½ä»¤ï¼Œå°±å¯ä»¥ä¿è¯ä¸»ä»æœåŠ¡å™¨ä¸€ç›´ä¿æŒä¸€è‡´äº†ã€‚ å¿ƒè·³æ£€æŸ¥ åœ¨å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œä»æœåŠ¡å™¨é»˜è®¤ä¼šä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡ï¼Œå‘ä¸»æœåŠ¡å™¨å‘é€å‘½ä»¤ï¼š replconf ack ï¼œreplication_offsetï¼ å…¶ä¸­replication_offsetæ˜¯ä»æœåŠ¡å™¨å½“å‰çš„å¤åˆ¶åç§»é‡ã€‚å‘é€replconf ackå‘½ä»¤å¯¹äºä¸»ä»æœåŠ¡å™¨æœ‰ä¸‰ä¸ªä½œç”¨ï¼š æ£€æµ‹ä¸»ä»æœåŠ¡å™¨çš„ç½‘ç»œè¿æ¥çŠ¶æ€ã€‚ é€šè¿‡åœ¨ä¸»æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ info replicationå‘½ä»¤æŸ¥çœ‹å…¶ä¸­çš„lagä¸€æ ï¼Œè¿™è¡¨ç¤ºä»æœåŠ¡å™¨æœ€åä¸€æ¬¡å‘ä¸»æœåŠ¡å™¨å‘é€ replconf ackå‘½ä»¤è·ç¦»ç°åœ¨è¿‡å»äº†å¤šå°‘ç§’ã€‚ä¸€èˆ¬åœ¨0æˆ–è€…1ä¹‹é—´è·³åŠ¨ï¼Œå¦‚æœè¶…è¿‡1ç§’ï¼Œè¯´æ˜ä¸»ä»æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥å‡ºç°äº†é—®é¢˜ã€‚ è¾…åŠ©å®ç°min-slavesé€‰é¡¹ã€‚ redisçš„min-slaves-to-writeå’Œmin-slaves-max-lagä¸¤ä¸ªé€‰é¡¹å¯ä»¥é˜²æ­¢ä¸»æœåŠ¡å™¨åœ¨ä¸å®‰å…¨çš„æƒ…å†µä¸‹æ‰§è¡Œå†™å‘½ä»¤ã€‚ 12min-slaves-to-write 3min-slaves-max-lag 10 ä¾‹å¦‚ä¸Šè¿°ä»£ç å°±æ„å‘³ç€ï¼šåœ¨ä»æœåŠ¡å™¨çš„æ•°é‡å°‘äº3æˆ–è€…3ä¸ªä»æœåŠ¡å™¨çš„å»¶è¿Ÿ(lag)å€¼éƒ½å¤§äºç­‰äº10ç§’æ—¶ï¼Œä¸»æœåŠ¡å™¨å°†æ‹’ç»æ‰§è¡Œå†™å‘½ä»¤ã€‚ æ£€æµ‹å‘½ä»¤ä¸¢å¤±ã€‚ å¦‚æœå› ä¸ºç½‘ç»œæ•…éšœï¼Œä¸»æœåŠ¡å™¨ä¼ æ’­ç»™ä»æœåŠ¡å™¨çš„å†™å‘½ä»¤åœ¨åŠè·¯ä¸¢å¤±ï¼Œé‚£ä¹ˆå½“ä»æœåŠ¡å™¨å‘ä¸»æœåŠ¡å™¨å‘é€replconf ackå‘½ä»¤æ—¶ï¼Œä¸»æœåŠ¡å™¨å°†å‘è§‰ä»æœåŠ¡å™¨å½“å‰çš„å¤åˆ¶åç§»é‡å°‘äºè‡ªå·±çš„å¤åˆ¶åç§»é‡ï¼Œç„¶åä¸»æœåŠ¡å™¨å°±ä¼šæ ¹æ®ä»æœåŠ¡å™¨æäº¤çš„å¤åˆ¶åç§»é‡ï¼Œåœ¨å¤åˆ¶ç§¯å‹ç¼“å†²åŒºé‡Œé¢æ‰¾åˆ°ä»æœåŠ¡å™¨ç¼ºå°‘çš„æ•°æ®ï¼Œå¹¶å°†è¿™äº›æ•°æ®é‡æ–°å‘é€ç»™ä»æœåŠ¡å™¨ã€‚","categories":[{"name":"Redis","slug":"Redis","permalink":"https://solitaire-12.github.io/categories/Redis/"}],"tags":[{"name":"redis","slug":"redis","permalink":"https://solitaire-12.github.io/tags/redis/"},{"name":"é«˜å¯ç”¨","slug":"é«˜å¯ç”¨","permalink":"https://solitaire-12.github.io/tags/%E9%AB%98%E5%8F%AF%E7%94%A8/"}]},{"title":"Redis|AOFæŒä¹…åŒ–","slug":"redis/AOFæŒä¹…åŒ–","date":"2024-03-25T02:15:00.000Z","updated":"2024-03-25T06:00:02.834Z","comments":true,"path":"2024/03/25/redis/AOFæŒä¹…åŒ–/","permalink":"https://solitaire-12.github.io/2024/03/25/redis/AOF%E6%8C%81%E4%B9%85%E5%8C%96/","excerpt":"","text":"AOFæŒä¹…åŒ– AOFæŒä¹…åŒ–æ˜¯é€šè¿‡ä¿å­˜redisæœåŠ¡å™¨æ‰€æ‰§è¡Œçš„å†™å‘½ä»¤æ¥è®°å½•æ•°æ®åº“çŠ¶æ€çš„ã€‚ å†™å…¥åˆ°AOFæ–‡ä»¶çš„å‘½ä»¤éƒ½æ˜¯ä»¥redisçš„å‘½ä»¤è¯·æ±‚æ ¼å¼ä¿å­˜çš„ï¼Œä¸”redisçš„å‘½ä»¤è¯·æ±‚æ˜¯çº¯æ–‡æœ¬æ ¼å¼ï¼Œå››äº¿å¯ä»¥ç›´æ¥æ‰“å¼€AOFæ–‡ä»¶æŸ¥çœ‹å†…å®¹ã€‚ å…·ä½“å®ç° AOFæŒä¹…åŒ–åŠŸèƒ½çš„å®ç°å¯ä»¥åˆ†ä¸ºå‘½ä»¤è¿½åŠ (append)ã€æ–‡ä»¶å†™å…¥ã€æ–‡ä»¶åŒæ­¥(sync)ä¸‰ä¸ªæ­¥éª¤ã€‚ å‘½ä»¤è¿½åŠ  å½“AOFæŒä¹…åŒ–åŠŸèƒ½å¤„äºå¼€å¯çŠ¶æ€æ—¶ï¼ŒæœåŠ¡å™¨åœ¨æ‰§è¡Œå®Œä¸€ä¸ªå†™å‘½ä»¤ä¹‹åï¼Œä¼šä»¥åè®®æ ¼å¼å°†è¢«æ‰§è¡Œçš„å†™å‘½ä»¤è¿½åŠ åˆ°æœåŠ¡å™¨çŠ¶æ€çš„aof_bufç¼“å†²åŒºçš„æœ«å°¾ï¼š 12345struct redisServer &#123; // ... sds aof_buf; // AOFç¼“å†²åŒº // ...&#125;; å†™å…¥å’ŒåŒæ­¥ redisçš„æœåŠ¡å™¨è¿›ç¨‹å°±æ˜¯ä¸€ä¸ªäº‹ä»¶å¾ªç¯(loop)ï¼Œè¿™ä¸ªå¾ªç¯ä¸­çš„æ–‡ä»¶äº‹ä»¶è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„å‘½ä»¤è¯·æ±‚ï¼Œä»¥åŠå‘å®¢æˆ·ç«¯å‘é€å‘½ä»¤å›å¤ï¼Œè€Œæ—¶é—´äº‹ä»¶åˆ™è´Ÿè´£æ‰§è¡ŒåƒserverCronå‡½æ•°è¿™æ ·éœ€è¦å®šæ—¶è¿è¡Œçš„å‡½æ•°ã€‚ åœ¨å¤„ç†æ–‡ä»¶äº‹ä»¶çš„å¯èƒ½ä¼šæ‰§è¡Œå†™å‘½ä»¤ï¼Œä½¿å¾—ä¸€äº›å†…å®¹è¢«è¿½åŠ åˆ°aof_bufç¼“å†²åŒºé‡Œé¢ï¼Œæ‰€ä»¥åœ¨æœåŠ¡å™¨æ¯æ¬¡ç»“æŸä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¹‹å‰ï¼Œå®ƒéƒ½ä¼šè°ƒç”¨flushAppendOnlyFileå‡½æ•°ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦å°†aof_bufç¼“å†²åŒºçš„å†…å®¹å†™å…¥å’Œä¿å­˜åˆ°AOFæ–‡ä»¶ä¸­ï¼Œç”¨ä¸€æ®µä¼ªä»£ç è¡¨ç¤ºè¿™ä¸€è¿‡ç¨‹ã€‚ 1234567891011void eventLoop()&#123; while True&#123; //å¤„ç†æ–‡ä»¶äº‹ä»¶ï¼Œæ¥æ”¶å‘½ä»¤è¯·æ±‚ä»¥åŠå‘é€å‘½ä»¤å›å¤ //å¤„ç†å‘½ä»¤è¯·æ±‚æ—¶å¯èƒ½ä¼šæœ‰æ–°å†…å®¹è¢«è¿½åŠ åˆ° aof_bufç¼“å†²åŒºä¸­ processFileEvents() //å¤„ç†æ—¶é—´äº‹ä»¶ processTimeEvents() //è€ƒè™‘æ˜¯å¦è¦å°† aof_bufä¸­çš„å†…å®¹å†™å…¥å’Œä¿å­˜åˆ° AOFæ–‡ä»¶é‡Œé¢ flushAppendOnlyFile() &#125;&#125; flushAppendOnlyFileå‡½æ•°çš„è¡Œä¸ºç”±æœåŠ¡å™¨é…ç½®çš„appendfsyncé€‰é¡¹çš„å€¼æ¥å†³å®šï¼Œå„ä¸ªä¸åŒå€¼äº§ç”Ÿçš„è¡Œä¸ºå¦‚ä¸‹ appendfsyncé€‰é¡¹çš„å€¼ flushAppendOnlyFileå‡½æ•°çš„è¡Œä¸º always å°†aof_bufç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†…å®¹å†™å…¥å¹¶åŒæ­¥åˆ°AOFæ–‡ä»¶ä¸­ everysec(é»˜è®¤å€¼) å°†aof_bufç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†…å®¹å†™å…¥åˆ°AOFæ–‡ä»¶ä¸­ï¼Œå¦‚æœä¸Šä¸€æ¬¡åŒæ­¥AOFæ–‡ä»¶çš„æ—¶é—´è·ç¦»ç°åœ¨è¶…è¿‡ä¸€ç§’é’Ÿï¼Œé‚£ä¹ˆå†æ¬¡å¯¹AOFæ–‡ä»¶è¿›è¡ŒåŒæ­¥ï¼Œå¹¶ä¸”è¿™ä¸ªåŒæ­¥æ“ä½œäº‹ç”±ä¸€ä¸ªçº¿ç¨‹ä¸“é—¨è´Ÿè´£æ‰§è¡Œçš„ã€‚ no å°†aof_bufç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†…å®¹å†™å…¥åˆ°AOFæ–‡ä»¶ä¸­ï¼Œä½†æ˜¯å¹¶ä¸å¯¹AOFæ–‡ä»¶è¿›è¡ŒåŒæ­¥ï¼Œä½•æ—¶åŒæ­¥ç”±æ“ä½œç³»ç»Ÿæ¥å†³å®šã€‚ å¦‚æœç”¨æˆ·æ²¡æœ‰ä¸»åŠ¨ä¸ºappendfsyncé€‰é¡¹è®¾ç½®å€¼ï¼Œé‚£ä¹ˆappendfsyncé€‰é¡¹çš„é»˜è®¤å€¼ä¸ºeverysecï¼Œå…³äºappendfsyncé€‰é¡¹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒRedisé¡¹ç›®é™„å¸¦çš„ç¤ºä¾‹é…ç½®æ–‡ä»¶redis.confã€‚ å¦‚ä½•é€‰æ‹©ï¼š å½“appendfsyncçš„å€¼ä¸ºalwaysæ—¶ï¼ŒæœåŠ¡å™¨åœ¨æ¯ä¸ªäº‹ä»¶å¾ªç¯éƒ½è¦å°†aof_bufç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†…å®¹å†™å…¥åˆ°AOFæ–‡ä»¶ï¼Œå¹¶ä¸”åŒæ­¥AOFæ–‡ä»¶ï¼Œæ‰€ä»¥alwaysçš„æ•ˆç‡æ˜¯appendfsyncé€‰é¡¹ä¸‰ä¸ªå€¼å½“ä¸­æœ€æ…¢çš„ä¸€ä¸ªï¼Œä½†ä»å®‰å…¨æ€§æ¥è¯´ï¼Œalwaysä¹Ÿæ˜¯æœ€å®‰å…¨çš„ï¼Œå› ä¸ºå³ä½¿å‡ºç°æ•…éšœåœæœºï¼ŒAOFæŒä¹…åŒ–ä¹Ÿåªä¼šä¸¢å¤±ä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­æ‰€äº§ç”Ÿçš„å‘½ä»¤æ•°æ®ã€‚ å½“appendfsyncçš„å€¼ä¸ºeverysecæ—¶ï¼ŒæœåŠ¡å™¨åœ¨æ¯ä¸ªäº‹ä»¶å¾ªç¯éƒ½è¦å°†aof_bufç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†…å®¹å†™å…¥åˆ°AOFæ–‡ä»¶ï¼Œå¹¶ä¸”æ¯éš”ä¸€ç§’å°±è¦åœ¨å­çº¿ç¨‹ä¸­å¯¹AOFæ–‡ä»¶è¿›è¡Œä¸€æ¬¡åŒæ­¥ã€‚ä»æ•ˆç‡ä¸Šæ¥è®²ï¼Œeverysecæ¨¡å¼è¶³å¤Ÿå¿«ï¼Œå¹¶ä¸”å°±ç®—å‡ºç°æ•…éšœåœæœºï¼Œæ•°æ®åº“ä¹Ÿåªä¸¢å¤±ä¸€ç§’é’Ÿçš„å‘½ä»¤æ•°æ®ã€‚ å½“appendfsyncçš„å€¼ä¸ºnoæ—¶ï¼ŒæœåŠ¡å™¨åœ¨æ¯ä¸ªäº‹ä»¶å¾ªç¯éƒ½è¦å°†aof_bufç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†…å®¹å†™å…¥åˆ°AOFæ–‡ä»¶ï¼Œè‡³äºä½•æ—¶å¯¹AOFæ–‡ä»¶è¿›è¡ŒåŒæ­¥ï¼Œåˆ™ç”±æ“ä½œç³»ç»Ÿæ§åˆ¶ã€‚å› ä¸ºå¤„äºnoæ¨¡å¼ä¸‹çš„flushAppendOnlyFileè°ƒç”¨æ— é¡»æ‰§è¡ŒåŒæ­¥æ“ä½œï¼Œæ‰€ä»¥è¯¥æ¨¡å¼ä¸‹çš„AOFæ–‡ä»¶å†™å…¥é€Ÿåº¦æ€»æ˜¯æœ€å¿«çš„ï¼Œä¸è¿‡å› ä¸ºè¿™ç§æ¨¡å¼ä¼šåœ¨ç³»ç»Ÿç¼“å­˜ä¸­ç§¯ç´¯ä¸€æ®µæ—¶é—´çš„å†™å…¥æ•°æ®ï¼Œæ‰€ä»¥è¯¥æ¨¡å¼çš„å•æ¬¡åŒæ­¥æ—¶é•¿é€šå¸¸æ˜¯ä¸‰ç§æ¨¡å¼ä¸­æ—¶é—´æœ€é•¿çš„ã€‚ä»å¹³æ‘Šæ“ä½œçš„è§’åº¦æ¥çœ‹ï¼Œnoæ¨¡å¼å’Œeverysecæ¨¡å¼çš„æ•ˆç‡ç±»ä¼¼ï¼Œå½“å‡ºç°æ•…éšœåœæœºæ—¶ï¼Œä½¿ç”¨noæ¨¡å¼çš„æœåŠ¡å™¨å°†ä¸¢å¤±ä¸Šæ¬¡åŒæ­¥AOFæ–‡ä»¶ä¹‹åçš„æ‰€æœ‰å†™å‘½ä»¤æ•°æ®ã€‚ æ–‡ä»¶è½½å…¥ä¸è¿˜åŸ å› ä¸ºAOFæ–‡ä»¶é‡Œé¢åŒ…å«äº†é‡å»ºæ•°æ®åº“çŠ¶æ€çš„æ‰€æœ‰å‘½ä»¤ï¼Œæ‰€ä»¥æœåŠ¡å™¨åªè¦è¯»å…¥å¹¶é‡æ–°æ‰§è¡Œä¸€è¾¹AOFæ–‡ä»¶é‡Œé¢ä¿å­˜çš„å†™å‘½ä»¤ï¼Œå°±å¯ä»¥è¿˜åŸæœåŠ¡å™¨å…³é—­ä¹‹å‰çš„æ•°æ®åº“ã€‚è¿˜åŸæ­¥éª¤å¤§è‡´å¦‚ä¸‹ï¼š åˆ›å»ºä¸€ä¸ªä¸å¸¦ç½‘ç»œè¿æ¥çš„ä¼ªå®¢æˆ·ç«¯(fake client)ï¼šå› ä¸ºredisçš„å‘½ä»¤åªèƒ½åœ¨å®¢æˆ·ç«¯ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼Œè€Œè½½å…¥AOFæ–‡ä»¶æ—¶ä½¿ç”¨çš„å‘½ä»¤ç›´æ¥æ¥æºäºAOFæ–‡ä»¶è€Œä¸æ˜¯ç½‘ç»œè¿æ¥ï¼Œæ‰€ä»¥æœåŠ¡å™¨ä½¿ç”¨äº†ä¸€ä¸ªæ²¡æœ‰ç½‘ç»œè¿æ¥çš„å®¢æˆ·ç«¯æ¥æ‰§è¡ŒAOFæ–‡ä»¶æ‰€ä¿å­˜çš„å†™å‘½ä»¤ï¼Œä¼ªå®¢æˆ·ç«¯æ‰§è¡Œå‘½ä»¤çš„æ•ˆæœå’Œå¸¦ç½‘ç»œè¿æ¥çš„å®¢æˆ·ç«¯æ‰§è¡Œå‘½ä»¤æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚ ä»AOFæ–‡ä»¶ä¸­åˆ†æå¹¶è¯»å–ä¸€æ¡å†™å‘½ä»¤ ä½¿ç”¨ä¼ªå®¢æˆ·ç«¯æ‰§è¡Œè¢«è¯»å‡ºçš„å†™å‘½ä»¤ ä¸€ç›´æ‰§è¡Œæ­¥éª¤2ã€3ï¼Œç›´åˆ°AOFæ–‡ä»¶ä¸­çš„å‘½ä»¤éƒ½è¢«å¤„ç†å®Œæ¯•ã€‚ AOFé‡å†™ ä»ä¸Šè¿°è¡¨è¾¾çš„å†…å®¹æ¥çœ‹ï¼Œä¼šæš´éœ²å‡ºä¸€ä¸ªé—®é¢˜ï¼šéšç€æœåŠ¡å™¨çš„è¿è¡Œï¼ŒAOFæ–‡ä»¶è®°å½•çš„å†…å®¹ä¹Ÿä¼šè¶Šæ¥è¶Šå¤šï¼Œæ–‡ä»¶ä½“ç§¯ä¹Ÿä¼šè¶Šæ¥è¶Šå¤§ï¼Œå¦‚æœä¸åŠ ä»¥æ§åˆ¶ï¼Œå¹¶ä¸”AOFæ–‡ä»¶çš„ä½“ç§¯è¶Šå¤§ï¼Œä½¿ç”¨AOFæ–‡ä»¶æ¥è¿›è¡Œæ•°æ®è¿˜åŸæ‰€éœ€çš„æ—¶é—´å°±è¶Šå¤šã€‚ ä¸¾ä¸ªä¾‹å­ï¼š 1234567rpush list &#x27;a&#x27; &#x27;b&#x27;rpush list &#x27;c&#x27;rpush list &#x27;d&#x27; &#x27;e&#x27;lpop listlpop listrpush list &#x27;f&#x27; &#x27;g&#x27;# æ­¤æ—¶çš„æ•°æ®åº“çŠ¶æ€ï¼š[&#x27;c&#x27;,&#x27;d&#x27;,&#x27;e&#x27;,&#x27;f&#x27;,&#x27;g&#x27;] å½“å®¢æˆ·ç«¯æ‰§è¡Œäº†ä¸Šè¿°6æ¡å‘½ä»¤ï¼ŒAOFæ–‡ä»¶å°±ä¼šä¾æ¬¡è®°å½•è¿™6æ¡å‘½ä»¤ã€‚åœ¨ä¸šåŠ¡ä¸­ï¼Œè¿™ç±»å†™æ“ä½œä¼šå¾ˆé¢‘ç¹ï¼Œä¹Ÿå°±å¯¼è‡´äº†AOFçš„ä½“ç§¯ä¸æ–­è†¨èƒ€ã€‚ ä¸ºäº†è§£å†³AOFæ–‡ä»¶ä½“ç§¯ä¸æ–­è†¨èƒ€çš„é—®é¢˜ï¼Œredisæä¾›äº†AOFæ–‡ä»¶é‡å†™(rewrite)åŠŸèƒ½ã€‚é€šè¿‡è¯¥åŠŸèƒ½ï¼ŒredisæœåŠ¡å™¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„AOFæ–‡ä»¶æ¥ä»£æ›¿ç°åœ¨çš„AOFæ–‡ä»¶ï¼Œæ–°æ—§ä¸¤ä¸ªAOFæ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€ç›¸åŒï¼Œä½†æ˜¯æ–°çš„AOFæ–‡ä»¶ä¸ä¼šåŒ…å«ä»»ä½•å†—ä½™çš„å‘½ä»¤ï¼Œæ‰€ä»¥æ–°çš„AOFæ–‡ä»¶çš„ä½“ç§¯ä¼šæ¯”åŸå…ˆå°å¾—å¤šã€‚ å®ç°ï¼š ğŸš¨æ³¨æ„ï¼šredisé‡å†™åçš„ç”Ÿæˆçš„æ–°AOFæ–‡ä»¶æ›¿æ¢æ‰æ—§çš„AOFæ–‡ä»¶ã€‚æ–°çš„AOFå¹¶éé€šè¿‡å¯¹ç°æœ‰AOFæ–‡ä»¶è¿›è¡Œè¯»å–åˆ†ææˆ–è€…å…¶ä»–æ“ä½œäº§ç”Ÿçš„ï¼Œè€Œæ˜¯é€šè¿‡è¯»å–æœåŠ¡å™¨å½“å‰çš„æ•°æ®åº“çŠ¶æ€æ¥å®ç°çš„ã€‚ å¥½æ¯”ä¸Šè¿°ä¾‹å­ä¸­ï¼Œæ—§çš„AOFæ–‡ä»¶è®°å½•äº†6æ¡æ•°æ®ï¼Œé‡å†™ä¹‹åçš„AOFæ–‡ä»¶åªä¿ç•™äº†rpush list 'c' 'd' 'e' 'f' 'g'è¿™ä¹ˆä¸€æ¡å‘½ä»¤ã€‚ ä¹¦ä¸­å¯¹æ•´ä¸ªé‡å†™è¿‡ç¨‹çš„ä¼ªä»£ç è§£æï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859def aof_rewrite(new_aof_file_name): #åˆ›å»ºæ–° AOFæ–‡ä»¶ f = create_file(new_aof_file_name) #éå†æ•°æ®åº“ for db in redisServer.db: #å¿½ç•¥ç©ºæ•°æ®åº“ if db.is_empty(): continue #å†™å…¥SELECTå‘½ä»¤ï¼ŒæŒ‡å®šæ•°æ®åº“å·ç  f.write_command(&quot;SELECT&quot; + db.id) #éå†æ•°æ®åº“ä¸­çš„æ‰€æœ‰é”® for key in db: #å¿½ç•¥å·²è¿‡æœŸçš„é”® if key.is_expired(): continue #æ ¹æ®é”®çš„ç±»å‹å¯¹é”®è¿›è¡Œé‡å†™ if key.type == String: rewrite_string(key) elif key.type == List: rewrite_list(key) elif key.type == Hash: rewrite_hash(key) elif key.type == Set: rewrite_set(key) elif key.type == SortedSet: rewrite_sorted_set(key) #å¦‚æœé”®å¸¦æœ‰è¿‡æœŸæ—¶é—´ï¼Œé‚£ä¹ˆè¿‡æœŸæ—¶é—´ä¹Ÿè¦è¢«é‡å†™ if key.have_expire_time(): rewrite_expire_time(key) #å†™å…¥å®Œæ¯•ï¼Œå…³é—­æ–‡ä»¶ f.close() def rewrite_string(key): #ä½¿ç”¨GETå‘½ä»¤è·å–å­—ç¬¦ä¸²é”®çš„å€¼ value = GET(key) #ä½¿ç”¨SETå‘½ä»¤é‡å†™å­—ç¬¦ä¸²é”® f.write_command(SET, key, value) def rewrite_list(key): #ä½¿ç”¨LRANGEå‘½ä»¤è·å–åˆ—è¡¨é”®åŒ…å«çš„æ‰€æœ‰å…ƒç´  item1, item2, ..., itemN = LRANGE(key, 0, -1) #ä½¿ç”¨RPUSHå‘½ä»¤é‡å†™åˆ—è¡¨é”® f.write_command(RPUSH, key, item1, item2, ..., itemN) def rewrite_hash(key): #ä½¿ç”¨HGETALLå‘½ä»¤è·å–å“ˆå¸Œé”®åŒ…å«çš„æ‰€æœ‰é”®å€¼å¯¹ field1, value1, field2, value2, ..., fieldN, valueN = HGETALL(key) #ä½¿ç”¨HMSETå‘½ä»¤é‡å†™å“ˆå¸Œé”® f.write_command(HMSET, key, field1, value1, field2, value2, ..., fieldN, valueN) def rewrite_set(key); #ä½¿ç”¨SMEMBERSå‘½ä»¤è·å–é›†åˆé”®åŒ…å«çš„æ‰€æœ‰å…ƒç´  elem1, elem2, ..., elemN = SMEMBERS(key) #ä½¿ç”¨SADDå‘½ä»¤é‡å†™é›†åˆé”® f.write_command(SADD, key, elem1, elem2, ..., elemN) def rewrite_sorted_set(key): #ä½¿ç”¨ZRANGEå‘½ä»¤è·å–æœ‰åºé›†åˆé”®åŒ…å«çš„æ‰€æœ‰å…ƒç´  member1, score1, member2, score2, ..., memberN, scoreN = ZRANGE(key, 0, -1, &quot;WITHSCORES&quot;) #ä½¿ç”¨ZADDå‘½ä»¤é‡å†™æœ‰åºé›†åˆé”® f.write_command(ZADD, key, score1, member1, score2, member2, ..., scoreN, memberN) def rewrite_expire_time(key): #è·å–æ¯«ç§’ç²¾åº¦çš„é”®è¿‡æœŸæ—¶é—´æˆ³ timestamp = get_expire_time_in_unixstamp(key) #ä½¿ç”¨PEXPIREATå‘½ä»¤é‡å†™é”®çš„è¿‡æœŸæ—¶é—´ f.write_command(PEXPIREAT, key, timestamp) å› ä¸ºaof_rewirteå‡½æ•°ç”Ÿæˆçš„æ–°AOFæ–‡ä»¶åªåŒ…å«è¿˜è¿œå½“å‰æ•°æ®åº“çŠ¶æ€æ‰€å¿…é¡»çš„å‘½ä»¤ï¼Œæ‰€ä»¥æ–°AOFæ–‡ä»¶ä¸ä¼šæµªè´¹ä»»ä½•ç£ç›˜ç©ºé—´ã€‚ âš ï¸æ³¨æ„ï¼šåœ¨å®é™…ä¸­ï¼Œä¸ºäº†é¿å…åœ¨æ‰§è¡Œå‘½ä»¤æ—¶é€ æˆå®¢æˆ·ç«¯è¾“å…¥ç¼“å†²åŒºæº¢å‡ºï¼Œé‡å†™ç¨‹åºåœ¨å¤„ç†åˆ—è¡¨ã€å“ˆå¸Œè¡¨ã€é›†åˆã€æœ‰åºé›†åˆè¿™å››ç§å¯èƒ½ä¼šå¸¦æœ‰å¤šä¸ªå…ƒç´ çš„é”®æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥é”®æ‰€åŒ…å«çš„å…ƒç´ æ•°é‡ï¼Œå¦‚æœå…ƒç´ æ•°é‡è¶…è¿‡äº†**AOF_REWRITE_ITMES_PER_CMD**å¸¸é‡çš„å€¼ï¼Œé‚£ä¹ˆé‡å†™ç¨‹åºå°†ä½¿ç”¨å¤šæ¡å‘½ä»¤æ¥è®°å½•é”®çš„å€¼ï¼Œè€Œä¸å•å•æ˜¯ç”¨ä¸€æ¡å‘½ä»¤ã€‚ ç®€å•è¯´åä¹‰ä¸‹ï¼Œã€ å…³äºAOFçš„åŠŸèƒ½éƒ½å†™åœ¨äº†aof.cæ–‡ä»¶ä¸­ï¼Œå…¶ä¸­**AOF_REWRITE_ITMES_PER_CMDå¸¸é‡å®šä¹‰åœ¨server.hæ–‡ä»¶ä¸­ï¼Œå€¼ä¸º64**ã€‚è¿™é‡Œä¸ã€ŠRedisè®¾è®¡ä¸å®ç°ã€‹è¿™æœ¬ä¹¦ä¸­çš„æè¿°æœ‰æ‰€å·®åˆ«ï¼ŒåŸæ–‡æ˜¯redis.h/REDIS_AOF_REWRITE_ITEMS_PER_CMDï¼Œè¯¥ä¹¦ä½œè€…åœ¨ä¹¦ä¸­æåˆ°ï¼Œæ˜¯åŸºäºRedis 2.9æ¥ç¼–å†™ã€‚è€Œç¬”è€…æ‰€æŸ¥çœ‹çš„redisæºç æ˜¯6.0.6ç‰ˆæœ¬ï¼Œæ•…è€Œæœ‰æ‰€å·®å¼‚ã€‚ åå°é‡å†™ ä»ä¸Šè¿°ä¸­å¯ä»¥äº†è§£åˆ°ï¼ŒAOFé‡å†™ç¨‹åºå¯ä»¥å¾ˆå¥½çš„åˆ›å»ºä¸€ä¸ªæ–°AOFæ–‡ä»¶çš„ä»»åŠ¡ï¼Œä½†æ˜¯å› ä¸ºè¿™ä¸ªå‡½æ•°ä¼šè¿›è¡Œå¤§é‡çš„å†™æ“ä½œï¼Œæ‰€æœ‰è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„çº¿ç¨‹å°†è¢«é•¿æ—¶é—´é˜»å¡ï¼Œè€Œä¸”redisæœåŠ¡å™¨æ˜¯ä½¿ç”¨å•çº¿ç¨‹æ¥å¤„ç†å‘½ä»¤è¯·æ±‚çš„ã€‚æ‰€ä»¥ä¸ºäº†åœ¨é‡å†™AOFæ–‡ä»¶æœŸé—´ï¼Œä¸å½±å“redisæœåŠ¡å™¨å¤„ç†å‘½ä»¤ï¼Œrediså°†AOFé‡å†™æ”¾åœ¨å­è¿›ç¨‹é‡Œæ‰§è¡Œï¼Œå¦‚æ­¤è¾¾åˆ°ä¸¤ä¸ªç›®çš„ï¼š å­è¿›ç¨‹è¿›è¡ŒAOFé‡å†™æœŸé—´ï¼ŒæœåŠ¡å™¨è¿›ç¨‹å¯ä»¥ç»§ç»­å¤„ç†å‘½ä»¤ å­è¿›ç¨‹å¸¦æœ‰æœåŠ¡å™¨è¿›ç¨‹çš„æ•°æ®å‰¯æœ¬ï¼Œä½¿ç”¨å­è¿›ç¨‹è€Œä¸æ˜¯çº¿ç¨‹ï¼Œå¯ä»¥åœ¨é¿å…ä½¿ç”¨é”çš„æƒ…å†µä¸‹ï¼Œä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚ è¿™æ ·çš„è¯ï¼Œä¼šäº§ç”Ÿå¦ä¸€ä¸ªé—®é¢˜ï¼šå­è¿›ç¨‹åœ¨è¿›è¡ŒAOFæœŸé—´ï¼ŒæœåŠ¡å™¨è¿›ç¨‹è¿˜åœ¨å¤„ç†æ–°çš„å‘½ä»¤è¯·æ±‚ï¼Œè¿™å›å¯¼è‡´é‡å†™åçš„AOFæ–‡ä»¶ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€ä¸å½“å‰æ•°æ®åº“çŠ¶æ€ä¸ä¸€è‡´ã€‚ ä¸ºè§£å†³æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼šredisæœåŠ¡å™¨è®¾ç½®äº†ä¸€ä¸ªAOFé‡å†™ç¼“å†²åŒºï¼Œè¿™ä¸ªç¼“å†²åŒºåœ¨æœåŠ¡å™¨åˆ›å»ºå­è¿›ç¨‹ä¹‹åå¼€å§‹ä½¿ç”¨ï¼Œå½“redisæœåŠ¡å™¨æ‰§è¡Œå®Œä¸€ä¸ªå‘½ä»¤ä¹‹åï¼Œå®ƒä¼šåŒæ—¶å°†è¿™ä¸ªå†™å‘½ä»¤å‘é€ç»™AOFç¼“å†²åŒºå’ŒAOFé‡å†™ç¼“å†²åŒºã€‚ å¦‚æ­¤ä¸€æ¥ï¼Œå­è¿›ç¨‹æ‰§è¡ŒAOFé‡å†™æœŸé—´ï¼ŒæœåŠ¡å™¨è¿›è¡Œéœ€è¦æ‰§è¡Œä¸€ä¸‹ä¸‰ä¸ªå·¥ä½œï¼š æ‰§è¡Œå®¢æˆ·ç«¯å‘é€çš„å‘½ä»¤ å°†æ‰§è¡Œåçš„å†™å‘½ä»¤è¿½åŠ åˆ°AOFç¼“å†²åŒº å°†æ‰§è¡Œåçš„å†™å‘½ä»¤è¿½åŠ åˆ°AOFé‡å†™ç¼“å†²åŒº è¿™æ ·å³å¯ä¿è¯ï¼š AOFç¼“å†²åŒºçš„å†…å®¹ä¼šå®šæœŸè¢«å†™å…¥å’ŒåŒæ­¥åˆ°AOFæ–‡ä»¶ï¼Œå¯¹ç°æœ‰çš„AOFæ–‡ä»¶çš„å¤„ç†å·¥ä½œæ­£å¸¸è¿›è¡Œã€‚ ä»åˆ›å»ºå­è¿›ç¨‹å¼€å§‹ï¼ŒæœåŠ¡å™¨æ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤éƒ½ä¼šè¢«è®°å½•åˆ°AOFé‡å†™ç¼“å†²åŒºã€‚ å½“å­è¿›ç¨‹å®Œæˆäº†AOFé‡å†™å·¥ä½œä¹‹åï¼Œå®ƒä¼šå‘çˆ¶è¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å·ï¼Œçˆ¶è¿›ç¨‹æ¥æ”¶åˆ°ä¿¡å·ä¹‹åï¼Œä¼šè°ƒç”¨å¤„ç†ä¿¡å·çš„å‡½æ•°ï¼Œå¹¶æ‰§è¡Œä»¥ä¸‹å·¥ä½œï¼š å°†AOFé‡å†™ç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†…å®¹å†™å…¥åˆ°æ–°AOFæ–‡ä»¶ä¸­ï¼Œè¿™æ—¶æ–°AOFæ–‡ä»¶æ‰€ä¿ç•™çš„æ•°æ®åº“çŠ¶æ€å°†å’ŒæœåŠ¡å™¨å½“å‰çš„æ•°æ®åº“çŠ¶æ€ä¸€è‡´ã€‚ å¯¹æ–°çš„AOFæ–‡ä»¶è¿›è¡Œæ”¹åï¼ŒåŸå­çš„è¦†ç›–ç°æœ‰çš„AOFæ–‡ä»¶ï¼Œå®Œæˆæ–°æ—§ä¸¤ä¸ªAOFæ–‡ä»¶çš„æ›¿æ¢ã€‚ ç­‰è¿™ä¸ªä¿¡å·å¤„ç†å‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œçˆ¶è¿›ç¨‹å°±å¯ä»¥ç»§ç»­æ‰§è¡Œå‘½ä»¤è¯·æ±‚ã€‚ åœ¨æ•´ä¸ªAOFåå°é‡å†™è¿‡ç¨‹ä¸­ï¼Œåªæœ‰ä¿¡å·å¤„ç†å‡½æ•°æ‰§è¡Œæ—¶ä¼šå¯¹æœåŠ¡å™¨è¿›ç¨‹ï¼ˆçˆ¶è¿›ç¨‹ï¼‰é€ æˆé˜»å¡ï¼Œåœ¨å…¶ä»–æ—¶å€™ï¼ŒAOFåå°é‡å†™éƒ½ä¸ä¼šé˜»å¡çˆ¶è¿›ç¨‹ï¼Œè¿™å°†AOFé‡å†™å¯¹æœåŠ¡å™¨æ€§èƒ½é€ æˆçš„å½±å“é™åˆ°äº†æœ€ä½ã€‚","categories":[{"name":"Redis","slug":"Redis","permalink":"https://solitaire-12.github.io/categories/Redis/"}],"tags":[{"name":"redis","slug":"redis","permalink":"https://solitaire-12.github.io/tags/redis/"},{"name":"æŒä¹…åŒ–","slug":"æŒä¹…åŒ–","permalink":"https://solitaire-12.github.io/tags/%E6%8C%81%E4%B9%85%E5%8C%96/"}]},{"title":"Redis|RDBæŒä¹…åŒ–","slug":"redis/RDBæŒä¹…åŒ–","date":"2024-03-25T02:15:00.000Z","updated":"2024-03-25T06:00:17.913Z","comments":true,"path":"2024/03/25/redis/RDBæŒä¹…åŒ–/","permalink":"https://solitaire-12.github.io/2024/03/25/redis/RDB%E6%8C%81%E4%B9%85%E5%8C%96/","excerpt":"","text":"RDBæŒä¹…åŒ– RDBæŒä¹…åŒ–æ—¢å¯ä»¥æ‰‹åŠ¨æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥æ ¹æ®æœåŠ¡å™¨é…ç½®é€‰é¡¹å®šæœŸæ‰§è¡Œï¼Œè¯¥åŠŸèƒ½å¯ä»¥å°†æŸä¸€æ—¶åˆ»ä¸Šçš„æ•°æ®ä¿å­˜åˆ°ä¸€ä¸ªRDBæ–‡ä»¶ä¸­ï¼ŒRDBæ–‡ä»¶ä¿å­˜åœ¨ç¡¬ç›˜é‡Œï¼Œæ‰€ä»¥å³ä½¿redisæœåŠ¡å™¨è¿›ç¨‹é€€å‡ºï¼Œç”šè‡³è¿è¡ŒredisæœåŠ¡å™¨çš„è®¡ç®—æœºå®•æœºï¼Œåªè¦RDBæ–‡ä»¶å­˜åœ¨ï¼ŒredisæœåŠ¡å™¨å°±èƒ½é€šè¿‡RDBæ–‡ä»¶è¿˜åŸã€‚ RDBæ–‡ä»¶çš„åˆ›å»ºå’Œè½½å…¥ åˆ›å»º saveå‘½ä»¤ ä¼šé˜»å¡redisæœåŠ¡å™¨è¿›ç¨‹ï¼Œç›´åˆ°RDBæ–‡ä»¶åˆ›å»ºå®Œæ¯•ä¸ºæ­¢ã€‚åœ¨æœåŠ¡å™¨è¿›ç¨‹é˜»å¡æœŸé—´ï¼ŒæœåŠ¡å™¨ä¸èƒ½å¤„ç†ä»»ä½•å‘½ä»¤è¯·æ±‚ã€‚ bgsaveå‘½ä»¤ æˆ–æ´¾ç”Ÿå‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œç„¶åç”±å­è¿›ç¨‹è´Ÿè´£åˆ›å»ºRDBæ–‡ä»¶ï¼ŒæœåŠ¡å™¨è¿›ç¨‹(çˆ¶è¿›ç¨‹)ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ã€‚ åˆ›å»ºRDBæ–‡ä»¶çš„å®é™…å·¥ä½œæ˜¯ç”±rdb.c/rdbSaveå‡½æ•°å®Œæˆçš„ã€‚saveå’Œbgsaveå‘½ä»¤ä¼šä»¥ä¸åŒçš„æ–¹å¼è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚ 123456789101112131415// ä¼ªä»£ç ç†è§£è¿™ä¸¤ä¸ªå‘½ä»¤void save()&#123; rdbSave(); //åˆ›å»ºRDBæ–‡ä»¶ &#125;void bgsave()&#123; pid = fork();//åˆ›å»ºå­è¿›ç¨‹ if(pid == 0) rdbSave();//å­è¿›ç¨‹è´Ÿè´£åˆ›å»ºRDBæ–‡ä»¶ signal_parent(); //å®Œæˆä¹‹åå‘çˆ¶è¿›ç¨‹å‘é€ä¿¡å· else if (pid &gt; 0) //çˆ¶è¿›ç¨‹ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ï¼Œå¹¶é€šè¿‡è½®è¯¢ç­‰å¾…å­è¿›ç¨‹çš„ä¿¡å· handle_request_and_wait_signal(); else handle_fork_error();//å¤„ç†å‡ºé”™æƒ…å†µ&#125; å‘½ä»¤æ‰§è¡Œæ—¶çš„æœåŠ¡çŠ¶æ€ï¼š saveå‘½ä»¤ï¼šå½“saveå‘½ä»¤æ‰§è¡Œæ—¶ï¼ŒredisæœåŠ¡å™¨ä¼šé˜»å¡ã€‚saveå‘½ä»¤å¤„ç†æœŸé—´ï¼Œå®¢æˆ·ç«¯å‘é€çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«æ‹’ç»ï¼›åªæœ‰åœ¨saveå‘½ä»¤æ‰§è¡Œç»“æŸã€é‡æ–°å¼€å§‹æ¥å—å‘½ä»¤è¯·æ±‚ä¹‹åï¼Œå®¢æˆ·ç«¯å‘é€çš„å‘½ä»¤æ‰ä¼šè¢«å¤„ç†ã€‚ bgsaveå‘½ä»¤ï¼šç”±äºbgsaveå‘½ä»¤çš„ä¿å­˜å·¥ä½œæ˜¯ç”±å­è¿›ç¨‹æ‰§è¡Œçš„ï¼Œæ‰€ä»¥å­è¿›ç¨‹åœ¨æ‰§è¡Œåˆ›å»ºRDBæ–‡ä»¶çš„è¿‡ç¨‹ä¸­ï¼ŒredisæœåŠ¡å™¨ä»ç„¶å¯ä»¥ç»§ç»­å¤„ç†å®¢æˆ·ç«¯çš„å‘½ä»¤è¯·æ±‚ã€‚ä½†æ˜¯ï¼Œåœ¨bgsaveå‘½ä»¤æ‰§è¡ŒæœŸé—´ï¼ŒæœåŠ¡å™¨å¤„ç†saveã€bgsaveã€bgrewriteaofä¸‰ä¸ªå‘½ä»¤çš„æ–¹å¼ä¼šæœ‰æ‰€ä¸åŒã€‚ bgsaveæ‰§è¡ŒæœŸé—´ï¼Œå®¢æˆ·ç«¯å‘é€çš„savaå‘½ä»¤ä¼šè¢«æœåŠ¡å™¨æ‹’ç»ï¼ŒæœåŠ¡å™¨ç¦æ­¢saveå’Œbgsaveå‘½ä»¤åŒæ—¶æ‰§è¡Œï¼ˆä¸ºäº†é¿å…çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹åŒæ—¶æ‰§è¡ŒrdbSaveå‡½æ•°ï¼Œé˜²æ­¢äº§ç”Ÿç«äº‰æ¡ä»¶ï¼‰ã€‚ bgsaveæ‰§è¡ŒæœŸé—´ï¼Œå®¢æˆ·ç«¯å‘é€çš„bgsavaå‘½ä»¤ä¼šè¢«æœåŠ¡å™¨æ‹’ç»ï¼Œå› ä¸ºåŒæ—¶æ‰§è¡Œä¸¤ä¸ªbgsaveä¼šäº§ç”Ÿç«äº‰æ¡ä»¶ã€‚ bgsaveå’Œbgrewriteaofä¸¤ä¸ªå‘½ä»¤ä¸èƒ½åŒæ—¶æ‰§è¡Œ å¦‚æœbasaveå‘½ä»¤æ­£åœ¨æ‰§è¡Œï¼Œå®¢æˆ·ç«¯å‘é€çš„bgrewriteaofæˆ–è¢«å»¶è¿Ÿåˆ°bgsavaæ‰§è¡Œç»“æŸåæ‰§è¡Œã€‚ å¦‚æœbgrewriteaofæ­£åœ¨æ‰§è¡Œï¼Œå®¢æˆ·ç«¯å‘é€çš„bgsaveä¼šè¢«æœåŠ¡å™¨æ‹’ç»ã€‚ å› ä¸ºbgrewriteaofå’Œbgsaveå‘½ä»¤çš„å®é™…å·¥ä½œéƒ½æ˜¯ç”±å­çº¿ç¨‹æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ä¸¤ä¸ªå‘½ä»¤åœ¨æ“ä½œæ–¹é¢å¹¶æ²¡æœ‰å†²çªï¼Œä¸èƒ½åŒæ—¶æ‰§è¡Œæ˜¯ä»æ€§èƒ½ä¸Šè€ƒè™‘çš„(å¹¶å‘å‡ºä¸¤ä¸ªå­çº¿ç¨‹ï¼Œä¸”è¿™ä¸¤ä¸ªå­çº¿ç¨‹åŒæ—¶æ‰§è¡Œå¤§é‡çš„ç£ç›˜å†™å…¥æ“ä½œ)ã€‚ è½½å…¥ ä¸åˆ›å»ºæ–¹å¼ä¸åŒï¼ŒRDBæ–‡ä»¶çš„è½½å…¥å·¥ä½œæ˜¯åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œçš„ï¼Œæ²¡æœ‰è®¾ç½®ä¸“é—¨ç”¨äºè½½å…¥RDBæ–‡ä»¶çš„å‘½ä»¤ï¼Œåªè¦redisæœåŠ¡å™¨åœ¨å¯åŠ¨æ—¶ï¼Œæ£€æµ‹åˆ°RDBæ–‡ä»¶å­˜åœ¨ï¼Œå°±ä¼šè‡ªåŠ¨è½½å…¥RDBæ–‡ä»¶ã€‚ åœ¨å¯åŠ¨æ—¶æ‰“å°çš„æ—¥å¿—ä¸­ï¼šçº¢è‰²æ¡†é€‰å‡ºæ¥çš„å†…å®¹ï¼Œå°±æ˜¯redisæœåŠ¡å™¨æˆåŠŸåŠ è½½RDBæ–‡ä»¶ä¹‹åæ‰“å°çš„ã€‚ ç”±äºAOFæ–‡ä»¶çš„æ›´æ–°é¢‘ç‡é€šå¸¸æ¯”RDBæ–‡ä»¶çš„æ›´æ–°é¢‘ç‡é«˜ï¼Œæ‰€ä»¥ï¼š å¦‚æœæœåŠ¡å™¨å¼€å¯äº†AOFæŒä¹…åŒ–åŠŸèƒ½ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ä¼šä¼˜å…ˆä½¿ç”¨AOFæ–‡ä»¶æ¥è¿˜åŸæ•°æ® å¦‚æœæœåŠ¡å™¨AOFæŒä¹…åŒ–åŠŸèƒ½å¤„äºå…³é—­çŠ¶æ€ï¼Œé‚£ä¹ˆæœåŠ¡å™¨æ‰ä¼šä½¿ç”¨RDBæ–‡ä»¶æ¥è¿˜åŸæ•°æ® è½½å…¥RDBæ–‡ä»¶çš„å®é™…å·¥ä½œç”±rdb.c/rdbLoadå‡½æ•°å®Œæˆï¼Œè¿™ä¸ªå‡½æ•°å’ŒrdbSaveå‡½æ•°ä¹‹é—´çš„å…³ç³»å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š æœåŠ¡å™¨åœ¨è½½å…¥æ—¶çš„çŠ¶æ€ï¼šæœåŠ¡å™¨è½½å…¥RDBæ–‡ä»¶æœŸé—´ï¼Œä¼šä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œç›´åˆ°è½½å…¥å·¥ä½œæ‰§è¡Œå®Œæˆã€‚ è‡ªåŠ¨é—´éš”æ€§ä¿å­˜ ç”±äºbgsaveå‘½ä»¤å¯ä»¥åœ¨ä¸é˜»å¡æœåŠ¡å™¨è¿›ç¨‹çš„æƒ…å†µä¸‹æ‰§è¡Œï¼Œæ‰€ä»¥rediså…è®¸ç”¨æˆ·é€šè¿‡è®¾ç½®æœåŠ¡å™¨é…ç½®ä¸­çš„saveé€‰é¡¹ï¼Œè®©æœåŠ¡å™¨æ¯éš”ä¸€æ®µæ—¶é—´è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡bgsaveå‘½ä»¤ã€‚ ç”¨æˆ·å¯ä»¥é€šè¿‡saveé€‰é¡¹è®¾ç½®å¤šä¸ªä¿å­˜æ¡ä»¶ï¼Œä½†æ˜¯å…¶ä¸­ä»»æ„ä¸€ä¸ªæ¡ä»¶è¢«æ»¡è¶³ï¼ŒæœåŠ¡å™¨å°±ä¼šæ‰§è¡Œbgsaveå‘½ä»¤ã€‚å¦‚ä¸‹redisæœåŠ¡é…ç½®æ–‡ä»¶ä¸­é»˜è®¤çš„saveé…ç½®ï¼š 123save 900 1 #æœåŠ¡å™¨åœ¨900ç§’ä¹‹å†…ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œäº†è‡³å°‘1æ¬¡ä¿®æ”¹ã€‚save 300 10 #æœåŠ¡å™¨åœ¨300ç§’ä¹‹å†…ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œäº†è‡³å°‘10æ¬¡ä¿®æ”¹ã€‚save 60 10000 #æœåŠ¡å™¨åœ¨60ç§’ä¹‹å†…ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œäº†è‡³å°‘10000æ¬¡ä¿®æ”¹ã€‚ ä¿å­˜æ¡ä»¶ å½“redisæœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æŒ‡å®šé…ç½®æ–‡ä»¶æˆ–è€…ä¼ å…¥å¯åŠ¨å‚æ•°çš„æ–¹å¼è®¾ç½®saveé€‰é¡¹ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰ä¸»åŠ¨è®¾ç½®saveé€‰é¡¹ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ä¼šä¸ºsaveè®¾ç½®é»˜è®¤æ¡ä»¶ã€‚ 123save 900 1save 300 10save 60 10000 æ¥ç€ï¼ŒæœåŠ¡å™¨ç¨‹åºä¼šæ ¹æ®saveé€‰é¡¹è®¾ç½®çš„æ¡ä»¶ï¼Œè®¾ç½®æœåŠ¡å™¨çŠ¶æ€redisServerç»“æ„çš„saveparamså±æ€§ã€‚ 123456struct redisServer &#123; // ... //è®°å½•äº†ä¿å­˜æ¡ä»¶çš„æ•°ç»„ struct saveparam *saveparams; // ...&#125;; saveparamså±æ€§æ—¶ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªsaveparamç»“æ„ï¼Œæ¯ä¸ªsaveparamç»“æ„éƒ½ä¿å­˜äº†ä¸€ä¸ªsaveé€‰é¡¹è®¾ç½®çš„ä¿å­˜æ¡ä»¶ï¼š 123456struct saveparam &#123; //ç§’æ•° time_t seconds; //ä¿®æ”¹æ•° int changes;&#125;; ä¾‹å¦‚ï¼Œä¸Šè¿°ä¸­é»˜è®¤çš„é…ç½®ï¼Œå°±ä¼šå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ dirtyè®¡æ•°å™¨å’Œlastsaveå±æ€§ é™¤äº†saveparamsæ•°ç»„ä¹‹å¤–ï¼ŒæœåŠ¡å™¨çŠ¶æ€è¿˜ç»´æŒç€ä¸€ä¸ªdirtyè®¡æ•°å™¨ï¼Œä»¥åŠä¸€ä¸ªlastsaveå±æ€§ã€‚ dirtyè®¡æ•°å™¨è®°å½•è·ç¦»ä¸Šä¸€æ¬¡æˆåŠŸæ‰§è¡Œsaveå‘½ä»¤æˆ–è€…bgsaveå‘½ä»¤ä¹‹åï¼ŒæœåŠ¡å™¨å¯¹æ•°æ®è¿›è¡Œäº†å¤šå°‘æ¬¡å†™æ“ä½œ(åŒ…å«å†™å…¥ã€åˆ é™¤ã€æ›´æ–°ç­‰) lastsaveå±æ€§æ˜¯ä¸€ä¸ªunixæ—¶é—´æˆ³ï¼Œè®°å½•äº†æœåŠ¡å™¨ä¸Šä¸€æ¬¡æˆåŠŸæ‰§è¡Œsaveå‘½ä»¤æˆ–bgsaveå‘½ä»¤çš„æ—¶é—´ã€‚ 12345678struct redisServer &#123; // ... //ä¿®æ”¹è®¡æ•°å™¨ long long dirty; //ä¸Šä¸€æ¬¡æ‰§è¡Œä¿å­˜çš„æ—¶é—´ time_t lastsave; // ...&#125;; æ£€æŸ¥ä¿å­˜æ¡ä»¶æ˜¯å¦æ»¡è¶³ redisçš„æœåŠ¡å™¨å‘¨æœŸæ€§æ“ä½œå‡½æ•°serverCroné»˜è®¤æ¯ä¸ª100æ¯«ç§’å°±ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œè¯¥å‡½æ•°ç”¨äºå¯¹æ­£åœ¨æ‰§è¡Œçš„æœåŠ¡å™¨è¿›è¡Œç»´æŠ¤ï¼Œå®ƒçš„å…¶ä¸­ä¸€é¡¹å·¥ä½œå°±æ˜¯æ£€æŸ¥saveé€‰é¡¹è®¾ç½®çš„ä¿å­˜æ¡ä»¶æ˜¯å¦å·²ç»æ»¡è¶³ï¼Œå¦‚æœæ»¡è¶³çš„è¯ï¼Œå°±æ‰§è¡Œbgsaveå‘½ä»¤ã€‚ 123456789101112131415void saverCron()&#123; // ... // éå†æ‰€æœ‰ä¿å­˜æ¡ä»¶ server.saveparams.forEach(saveparam-&gt;&#123; // è®¡ç®—è·ç¦»ä¸Šæ¬¡æ‰§è¡Œä¿å­˜æ“ä½œæœ‰å¤šå°‘ç§’ save_interval = unixtime_now()-server.lastsave // å¦‚æœæ•°æ®åº“çŠ¶æ€çš„ä¿®æ”¹æ¬¡æ•°è¶…è¿‡æ¡ä»¶æ‰€è®¾ç½®çš„æ¬¡æ•° ///å¹¶ä¸”è·ç¦»ä¸Šæ¬¡ä¿å­˜çš„æ—¶é—´è¶…è¿‡æ¡ä»¶æ‰€è®¾ç½®çš„æ—¶é—´ ///é‚£ä¹ˆæ‰§è¡Œä¿å­˜æ“ä½œ if (server.dirty &gt;= saveparam.changes &amp;&amp; save_interval &gt; saveparam.seconds)&#123; bgsave() &#125; &#125;)&#125; ç¨‹åºæˆ–éå†å¹¶æ£€æŸ¥saveparamsæ•°ç»„ä¸­çš„æ‰€æœ‰ä¿å­˜æ¡ä»¶ï¼Œåªè¦ä»»æ„ä¸€ä¸ªæ¡ä»¶æ»¡è¶³ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¼šæ‰§è¡Œbgsaveã€‚ ç¤ºä¾‹ï¼š ä¸€å°redisæœåŠ¡å™¨çš„å½“å‰çŠ¶æ€ï¼š é‚£ä¹ˆå½“æ—¶é—´æ¥åˆ°1378271101ï¼Œä¹Ÿå³æ˜¯1378270800çš„301ç§’ä¹‹åï¼Œä¸”æ•°æ®æœ‰10æ”¹åŠ¨ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°†è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡bgsaveã€‚å‡è®¾ï¼Œbgsaveæ‰§è¡Œäº†5ç§’ï¼Œé‚£ä¹ˆå…¶ä¸­çš„dirtyåŠæ•°æ®ä¼šè¢«é‡é‡ä¸º0ï¼Œè€Œlastsaveå±æ€§æˆ–è¢«æ›´æ–°æˆ1378271106ã€‚æ­¤æ—¶æœåŠ¡å™¨çš„å½“å‰çŠ¶æ€ä¸ºï¼š RDBæ–‡ä»¶ç»“æ„ todo","categories":[{"name":"Redis","slug":"Redis","permalink":"https://solitaire-12.github.io/categories/Redis/"}],"tags":[{"name":"redis","slug":"redis","permalink":"https://solitaire-12.github.io/tags/redis/"},{"name":"æŒä¹…åŒ–","slug":"æŒä¹…åŒ–","permalink":"https://solitaire-12.github.io/tags/%E6%8C%81%E4%B9%85%E5%8C%96/"}]},{"title":"Redis|å¯¼èˆª","slug":"redis/å¯¼èˆª","date":"2024-03-25T02:14:55.000Z","updated":"2024-03-25T06:12:39.853Z","comments":true,"path":"2024/03/25/redis/å¯¼èˆª/","permalink":"https://solitaire-12.github.io/2024/03/25/redis/%E5%AF%BC%E8%88%AA/","excerpt":"","text":"æŒä¹…åŒ– æŒä¹…åŒ–å¯¼è¯»ï¼šredisæ˜¯å†…å­˜æ•°æ®åº“ï¼Œå®ƒå°†è‡ªå·±çš„æ•°æ®åº“çŠ¶æ€å‚¨å­˜åœ¨å†…å­˜ä¸­ã€‚æ‰€ä»¥å½“redisæœåŠ¡è¿›ç¨‹é€€å‡ºæ—¶ï¼ŒæœåŠ¡å™¨ä¸­çš„æ•°æ®ä¹Ÿå°†æ¶ˆå¤±ï¼Œæ•…è€Œéœ€è¦å°†å…¶æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸­ã€‚ RDBæŒä¹…åŒ– åšå®¢è·³è½¬â†—ï¸ AOFæŒä¹…åŒ– åšå®¢è·³è½¬â†—ï¸ RDB RDBï¼ˆRedis DataBaseï¼‰æ˜¯redisé»˜è®¤çš„æŒä¹…åŒ–æ–¹å¼ã€‚é€šè¿‡å¿«ç…§ï¼ˆsnapshottingï¼‰å®Œæˆã€‚ä»ä¸Šè¿°çš„å®ç°æ–¹å¼çœ‹ï¼Œå®ƒæ‰€ä¿å­˜çš„æ•°æ®æ˜¯æŸä¸€æ—¶åˆ»çš„æ•°æ®ï¼Œå³RDBä¿å­˜redisæŸä¸€æ—¶åˆ»çš„æ•°æ®å¿«ç…§ã€‚ è§¦å‘æ–¹å¼ ç¬¦åˆè‡ªå®šä¹‰é…ç½®çš„å¿«ç…§è§„åˆ™ æ‰§è¡Œäº†saveæˆ–è€…bgsaveå‘½ä»¤ æ‰§è¡Œäº†flushallï¼ˆæ¸…ç©ºï¼‰å‘½ä»¤ æ‰§è¡Œä¸»ä»å¤åˆ¶æ“ä½œï¼ˆç¬¬ä¸€æ¬¡ï¼‰ ç‰¹ç‚¹ ä¼˜ç‚¹ï¼š RDBæ˜¯äºŒè¿›åˆ¶å‹ç¼©æ–‡ä»¶ï¼Œå ç”¨ç©ºé—´å°ï¼Œä¾¿äºä¼ è¾“ ä¸»è¿›ç¨‹forkå­è¿›ç¨‹ï¼Œå¯ä»¥æœ€å¤§åŒ–redisæ€§èƒ½ ä½¿ç”¨RDBæ–‡ä»¶æ¥æ¢å¤æ•°æ®è¾ƒå¿« ç¼ºç‚¹ï¼š ä¸èƒ½ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œä¼šä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§ä»¥åæ›´æ”¹çš„æ•°æ® çˆ¶è¿›ç¨‹åœ¨forkå­è¿›ç¨‹çš„æ—¶å€™ï¼Œå¦‚æœä¸»è¿›ç¨‹è¾ƒå¤§ï¼Œå®¹æ˜“é˜»å¡ å®ç°æ–¹å¼ windowsç¯å¢ƒï¼š æ‰‹åŠ¨ä¿å­˜ pushd [your redis path] redis-cli.exe save ä¿å­˜ä¹‹åï¼Œä¼šåœ¨redisç›®å½•ä¸‹ï¼Œé»˜è®¤ç”Ÿæˆdump.rdbæ–‡ä»¶ã€‚ redis.conf é…ç½® 1234567891011# 900såæœ‰1æ¬¡æ›´æ–°ï¼Œè¿›è¡ŒæŒä¹…åŒ–save 900 1# 300såæœ‰10æ¬¡æ›´æ–°ï¼Œè¿›è¡ŒæŒä¹…åŒ–save 300 10# 60ç§’åæœ‰10_000æ¬¡æ›´æ–°ï¼Œè¿›è¡ŒæŒä¹…åŒ–save 60 10000## é…ç½®é»˜è®¤æ–‡ä»¶ådbfilename dump.rdb## æ–‡ä»¶å­˜å‚¨ä½ç½®dir ./ #æ ¹ç›®å½•ä¸‹ Linuxç¯å¢ƒï¼š å¾…ç»­ AOF AOFï¼ˆappend only fileï¼‰ï¼Œredisé»˜è®¤æƒ…å†µä¸‹ä¸å¼€å¯ã€‚å¼€å¯AOFæŒä¹…åŒ–åï¼Œredisä¼šå°†æ‰€æœ‰çš„å†™æ“ä½œä»¥åŠå‚æ•°(RESP)è®°å½•åˆ°AOFæ–‡ä»¶ä¸­ã€‚ å®ç°æ–¹å¼ 1234567# redis.confé…ç½®æ–‡ä»¶ä¸­## å¼€å¯AOFçš„æŒä¹…åŒ–appendonly yes## AOFæ–‡ä»¶çš„ä¿å­˜ä½ç½®(RDB AOFå…±ç”¨)dir ./ ## é…ç½®é»˜è®¤æ–‡ä»¶åappendfilename appendonly.aof é«˜å¯ç”¨ é«˜å¯ç”¨å¯¼è¯»ï¼šé«˜å¯ç”¨ï¼Œä¹Ÿç§°HAï¼ˆHigh Availabilityï¼‰ï¼Œæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„è®¾è®¡ä¸­å¿…é¡»è€ƒè™‘çš„å› ç´ ä¹‹ä¸€ï¼Œé€šå¸¸æŒ‡é€šè¿‡è®¾è®¡å‡å°‘ç³»ç»Ÿä¸æä¾›æœåŠ¡çš„æ—¶é—´ã€‚ åœ¨Redisä¸­è¡¨ç°ä¸ºï¼Œå•ä¸€çš„RedisæœåŠ¡èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶ï¼Œæ•´ä¸ªæœåŠ¡éƒ½ä¸èƒ½æä¾›æœåŠ¡ã€‚ä»¥ä¸‹æ˜¯Redisä¸‰ç§é«˜å¯ç”¨æ¨¡å¼ï¼š ä¸»ä» åšå®¢è·³è½¬â†—ï¸ å“¨å…µ åšå®¢è·³è½¬â†—ï¸ é›†ç¾¤ åšå®¢è·³è½¬â†—ï¸ Luaè„šæœ¬ Redisä»2.6ç‰ˆæœ¬å¼€å§‹å¼•å…¥å¯¹Luaè„šæœ¬çš„æ”¯æŒï¼Œé€šè¿‡åœ¨æœåŠ¡å™¨ä¸­åµŒå…¥Luaç¯å¢ƒï¼ŒRediså®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨Luaè„šæœ¬ï¼Œç›´æ¥åœ¨æœåŠ¡å™¨ç«¯åŸå­åœ°æ‰§è¡Œå¤šä¸ªRediså‘½ä»¤ 123eval &quot;return &#x27;hello lua&#x27;&quot; 0script load &quot;return 1+1&quot; -- è¿”å›ä¸€ä¸²SHA1æ ¡éªŒç evalsha &quot;sha1æ ¡éªŒç &quot; åˆ›å»ºLuaç¯å¢ƒ redisæœåŠ¡å™¨å†…åµŒäº†ä¸€ä¸ªLuaç¯å¢ƒ(environ-ment)ï¼Œå¹¶å¯¹è¿™ä¸ªLuaç¯å¢ƒè¿›è¡Œäº†ä¸€ç³»åˆ—çš„ä¿®æ”¹ï¼Œä»è€Œç¡®ä¿Luaç¯å¢ƒå¯ä»¥æ»¡è¶³RedisæœåŠ¡å™¨çš„ä½¿ç”¨ã€‚ åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„Luaç¯å¢ƒã€‚ æœåŠ¡å™¨è°ƒç”¨Luaçš„Cè¯­è¨€çš„APIå‡½æ•°lua_open è½½å…¥å¤šä¸ªå‡½æ•°åº“åˆ°Luaç¯å¢ƒã€‚ åŸºæœ¬åº“ åŒ…å«Luaçš„æ ¸å¿ƒï¼ˆcoreï¼‰å‡½æ•°ï¼Œæ¯”å¦‚assertã€errorã€pairsã€tostringã€pcallç­‰ã€‚å¦å¤–ï¼Œä¸ºäº†é˜²æ­¢ç”¨æˆ·ä»å¤–éƒ¨æ–‡ä»¶ä¸­å¼•å…¥ä¸å®‰å…¨çš„ä»£ç ï¼Œåº“ä¸­çš„loadfileå‡½æ•°ä¼šè¢«åˆ é™¤ã€‚ è¡¨æ ¼åº“ åŒ…å«ç”¨äºå¤„ç†è¡¨æ ¼çš„é€šç”¨å‡½æ•°ï¼Œæ¯”å¦‚table.concatã€table.insertã€table.removeã€table.sortç­‰ã€‚ å­—ç¬¦ä¸²åº“ åŒ…å«ç”¨äºå¤„ç†å­—ç¬¦ä¸²çš„é€šç”¨å‡½æ•°ï¼Œæ¯”å¦‚ç”¨äºå¯¹å­—ç¬¦ä¸²è¿›è¡ŒæŸ¥æ‰¾çš„string.findå‡½æ•°ï¼Œå¯¹å­—ç¬¦ä¸²è¿›è¡Œæ ¼å¼åŒ–çš„string.formatå‡½æ•°ï¼ŒæŸ¥çœ‹å­—ç¬¦ä¸²é•¿åº¦çš„string.lenå‡½æ•°ï¼Œå¯¹å­—ç¬¦ä¸²è¿›è¡Œç¿»è½¬çš„string.reverseå‡½æ•°ç­‰ã€‚ æ•°å­¦åº“ æ˜¯æ ‡å‡†Cè¯­è¨€æ•°å­¦åº“çš„æ¥å£ï¼Œå®ƒåŒ…æ‹¬è®¡ç®—ç»å¯¹å€¼çš„math.abså‡½æ•°ï¼Œè¿”å›å¤šä¸ªæ•°ä¸­çš„æœ€å¤§å€¼å’Œæœ€å°å€¼çš„math.maxå‡½æ•°å’Œmath.minå‡½æ•°ï¼Œè®¡ç®—äºŒæ¬¡æ–¹æ ¹çš„math.sqrtå‡½æ•°ï¼Œè®¡ç®—å¯¹æ•°çš„math.logå‡½æ•°ç­‰ã€‚ è°ƒè¯•åº“ æä¾›äº†å¯¹ç¨‹åºè¿›è¡Œè°ƒè¯•æ‰€éœ€çš„å‡½æ•°ï¼Œæ¯”å¦‚å¯¹ç¨‹åºè®¾ç½®é’©å­å’Œå–å¾—é’©å­çš„debug.sethookå‡½æ•°å’Œdebug.gethookå‡½æ•°ï¼Œè¿”å›ç»™å®šå‡½æ•°ç›¸å…³ä¿¡æ¯çš„debug.getinfoå‡½æ•°ï¼Œä¸ºå¯¹è±¡è®¾ç½®å…ƒæ•°æ®çš„debug.setmetatableå‡½æ•°ï¼Œè·å–å¯¹è±¡å…ƒæ•°æ®çš„debug.getmetatableå‡½æ•°ç­‰ã€‚ Lua CJSONåº“ ğŸ”—ç”¨äºå¤„ç†UTF-8ç¼–ç çš„JSONæ ¼å¼ï¼Œå…¶ä¸­cjson.decodeå‡½æ•°å°†ä¸€ä¸ªJSONæ ¼å¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªLuaå€¼ï¼Œè€Œcjson.encodeå‡½æ•°å°†ä¸€ä¸ªLuaå€¼åºåˆ—åŒ–ä¸ºJSONæ ¼å¼çš„å­—ç¬¦ä¸²ã€‚ Structåº“ ğŸ”—ç”¨äºåœ¨Luaå€¼å’ŒCç»“æ„ï¼ˆstructï¼‰ä¹‹é—´è¿›è¡Œè½¬æ¢ï¼Œå‡½æ•°struct.packå°†å¤šä¸ªLuaå€¼æ‰“åŒ…æˆä¸€ä¸ªç±»ç»“æ„ï¼ˆstruct-likeï¼‰å­—ç¬¦ä¸²ï¼Œè€Œå‡½æ•°struct.unpackåˆ™ä»ä¸€ä¸ªç±»ç»“æ„å­—ç¬¦ä¸²ä¸­è§£åŒ…å‡ºå¤šä¸ªLuaå€¼ã€‚ Lua cmsgpackåº“ ğŸ”—ç”¨äºå¤„ç†MessagePackæ ¼å¼çš„æ•°æ®ï¼Œå…¶ä¸­cmsgpack.packå‡½æ•°å°†Luaå€¼è½¬æ¢ä¸ºMessagePackæ•°æ®ï¼Œè€Œcmsgpack.unpackå‡½æ•°åˆ™å°†MessagePackæ•°æ®è½¬æ¢ä¸ºLuaå€¼ã€‚ åˆ›å»ºå…¨å±€è¡¨æ ¼redisï¼ŒåŒ…å«äº†å¯¹redisè¿›è¡Œæ“ä½œçš„å‡½æ•°ã€‚ æœåŠ¡å™¨å°†åœ¨Luaç¯å¢ƒä¸­åˆ›å»ºä¸€ä¸ªredisè¡¨æ ¼ï¼ˆtableï¼‰ï¼Œå¹¶å°†å®ƒè®¾ä¸ºå…¨å±€å˜é‡ã€‚è¿™ä¸ªredisè¡¨æ ¼åŒ…å«ä»¥ä¸‹å‡½æ•°ï¼š ç”¨äºæ‰§è¡ŒRediså‘½ä»¤çš„redis.callå’Œredis.pcallå‡½æ•°ã€‚ ç”¨äºè®°å½•Redisæ—¥å¿—ï¼ˆlogï¼‰çš„redis.logå‡½æ•°ï¼Œä»¥åŠç›¸åº”çš„æ—¥å¿—çº§åˆ«ï¼ˆlevelï¼‰å¸¸é‡ï¼šredis.LOG_DEBUGï¼Œredis.LOG_VERBOSEï¼Œredis.LOG_NOTICEï¼Œredis.LOG_WARNINGã€‚ ç”¨äºè®¡ç®—SHA1æ ¡éªŒå’Œçš„redis.sha1hexå‡½æ•°ã€‚â‘ç”¨äºè¿”å›é”™è¯¯ä¿¡æ¯çš„redis.error_replyå‡½æ•°å’Œredis.status_replyå‡½æ•°ã€‚åœ¨è¿™äº›å‡½æ•°é‡Œé¢ï¼Œæœ€å¸¸ç”¨ä¹Ÿæœ€é‡è¦çš„è¦æ•°redis.callå‡½æ•°å’Œredis.pcallå‡½æ•°ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥åœ¨Luaè„šæœ¬ä¸­æ‰§è¡ŒRediså‘½ä»¤ï¼š 12EVAL &quot;return redis.call(&#x27;PING&#x27;)&quot; 0# PONG ä½¿ç”¨redisè‡ªåˆ¶çš„éšæœºå‡½æ•°æ›¿æ¢æ‰Luaè‡ªå¸¦çš„å¸¦æœ‰å‰¯ä½œç”¨çš„éšæœºå‡½æ•°ã€‚ ä¸ºäº†ä¿è¯ç›¸åŒçš„è„šæœ¬å¯ä»¥åœ¨ä¸åŒçš„æœºå™¨ä¸Šäº§ç”Ÿç›¸åŒçš„ç»“æœï¼ŒRedisè¦æ±‚æ‰€æœ‰ä¼ å…¥æœåŠ¡å™¨çš„Luaè„šæœ¬ï¼Œä»¥åŠLuaç¯å¢ƒä¸­çš„æ‰€æœ‰å‡½æ•°ï¼Œéƒ½å¿…é¡»æ˜¯æ— å‰¯ä½œç”¨ï¼ˆside effectï¼‰çš„çº¯å‡½æ•°ï¼ˆpure functionï¼‰ã€‚ ä½†æ˜¯ï¼Œåœ¨ä¹‹å‰è½½å…¥Luaç¯å¢ƒçš„mathå‡½æ•°åº“ä¸­ï¼Œç”¨äºç”Ÿæˆéšæœºæ•°çš„math.randomå‡½æ•°å’Œmath.randomseedå‡½æ•°éƒ½æ˜¯å¸¦æœ‰å‰¯ä½œç”¨çš„ï¼Œå®ƒä»¬ä¸ç¬¦åˆRediså¯¹Luaç¯å¢ƒçš„æ— å‰¯ä½œç”¨è¦æ±‚ã€‚ å› ä¸ºè¿™ä¸ªåŸå› ï¼ŒRedisä½¿ç”¨è‡ªåˆ¶çš„å‡½æ•°æ›¿æ¢äº†mathåº“ä¸­åŸæœ‰çš„math.randomå‡½æ•°å’Œmath.randomseedå‡½æ•°ï¼Œæ›¿æ¢ä¹‹åçš„ä¸¤ä¸ªå‡½æ•°æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š å¯¹äºç›¸åŒçš„seedæ¥è¯´ï¼Œmath.randomæ€»äº§ç”Ÿç›¸åŒçš„éšæœºæ•°åºåˆ—ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ã€‚ é™¤éåœ¨è„šæœ¬ä¸­ä½¿ç”¨math.randomseedæ˜¾å¼åœ°ä¿®æ”¹seedï¼Œå¦åˆ™æ¯æ¬¡è¿è¡Œè„šæœ¬æ—¶ï¼ŒLuaç¯å¢ƒéƒ½ä½¿ç”¨å›ºå®šçš„math.randomseedï¼ˆ0ï¼‰è¯­å¥æ¥åˆå§‹åŒ–seedã€‚ åˆ›å»ºæ’åºè¾…åŠ©å‡½æ•°ã€‚ ä¸ºäº†é˜²æ­¢å¸¦æœ‰å‰¯ä½œç”¨çš„å‡½æ•°ä»¤è„šæœ¬äº§ç”Ÿä¸ä¸€è‡´çš„æ•°æ®ï¼ŒRediså¯¹mathåº“çš„math.randomå‡½æ•°å’Œmath.randomseedå‡½æ•°è¿›è¡Œäº†æ›¿æ¢ã€‚å¯¹äºLuaè„šæœ¬æ¥è¯´ï¼Œå¦ä¸€ä¸ªå¯èƒ½äº§ç”Ÿä¸ä¸€è‡´æ•°æ®çš„åœ°æ–¹æ˜¯é‚£äº›å¸¦æœ‰ä¸ç¡®å®šæ€§è´¨çš„å‘½ä»¤ã€‚æ¯”å¦‚å¯¹äºä¸€ä¸ªé›†åˆé”®æ¥è¯´ï¼Œå› ä¸ºé›†åˆå…ƒç´ çš„æ’åˆ—æ˜¯æ— åºçš„ï¼Œæ‰€ä»¥å³ä½¿ä¸¤ä¸ªé›†åˆçš„å…ƒç´ å®Œå…¨ç›¸åŒï¼Œå®ƒä»¬çš„è¾“å‡ºç»“æœä¹Ÿå¯èƒ½å¹¶ä¸ç›¸åŒã€‚ Rediså°†SMEMBERSè¿™ç§åœ¨ç›¸åŒæ•°æ®é›†ä¸Šå¯èƒ½ä¼šäº§ç”Ÿä¸åŒè¾“å‡ºçš„å‘½ä»¤ç§°ä¸ºâ€œå¸¦æœ‰ä¸ç¡®å®šæ€§çš„å‘½ä»¤â€ï¼Œè¿™äº›å‘½ä»¤åŒ…æ‹¬ï¼šSINTERã€SUNIONã€SDIFFã€SMEMBERSã€HKEYSã€HVALSã€KEYSä¸ºäº†æ¶ˆé™¤è¿™äº›å‘½ä»¤å¸¦æ¥çš„ä¸ç¡®å®šæ€§ï¼ŒæœåŠ¡å™¨ä¼šä¸ºLuaç¯å¢ƒåˆ›å»ºä¸€ä¸ªæ’åºè¾…åŠ©å‡½æ•°__redis__compare_helperï¼Œå½“Luaè„šæœ¬æ‰§è¡Œå®Œä¸€ä¸ªå¸¦æœ‰ä¸ç¡®å®šæ€§çš„å‘½ä»¤ä¹‹åï¼Œç¨‹åºä¼šä½¿ç”¨__redis__compare_helperä½œä¸ºå¯¹æ¯”å‡½æ•°ï¼Œè‡ªåŠ¨è°ƒç”¨table.sortå‡½æ•°å¯¹å‘½ä»¤çš„è¿”å›å€¼åšä¸€æ¬¡æ’åºï¼Œä»¥æ­¤æ¥ä¿è¯ç›¸åŒçš„æ•°æ®é›†æ€»æ˜¯äº§ç”Ÿç›¸åŒçš„è¾“å‡ºã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬åœ¨Luaè„šæœ¬ä¸­å¯¹fruité›†åˆå’Œanother-fruité›†åˆæ‰§è¡ŒSMEMBERSå‘½ä»¤ï¼Œé‚£ä¹ˆä¸¤ä¸ªè„šæœ¬å°†å¾—å‡ºç›¸åŒçš„ç»“æœï¼Œå› ä¸ºè„šæœ¬å·²ç»å¯¹SMEMBERSå‘½ä»¤çš„è¾“å‡ºè¿›è¡Œè¿‡æ’åºäº†ï¼š 12345678redisï¼ EVAL &quot;return redis.call(&#x27;SMEMBERS&#x27;, KEYS[1])&quot; 1 fruit1) &quot;apple&quot;2) &quot;banana&quot;3) &quot;cherry&quot;redisï¼ EVAL &quot;return redis.call(&#x27;SMEMBERS&#x27;, KEYS[1])&quot; 1 another-fruit1) &quot;apple&quot;2) &quot;banana&quot;3) &quot;cherry&quot; åˆ›å»º redis.pcallå‡½æ•°çš„å†Œæ•°æŠ¥å‘Šè¾…åŠ©å‡½æ•°ã€‚ æœåŠ¡å™¨å°†ä¸ºLuaç¯å¢ƒåˆ›å»ºä¸€ä¸ªåä¸º__redis__err__handlerçš„é”™è¯¯å¤„ç†å‡½æ•°ï¼Œå½“è„šæœ¬è°ƒç”¨redis.pcallå‡½æ•°æ‰§è¡ŒRediså‘½ä»¤ï¼Œå¹¶ä¸”è¢«æ‰§è¡Œçš„å‘½ä»¤å‡ºç°é”™è¯¯æ—¶ï¼Œ__redis__err__handlerå°±ä¼šæ‰“å°å‡ºé”™ä»£ç çš„æ¥æºå’Œå‘ç”Ÿé”™è¯¯çš„è¡Œæ•°ï¼Œä¸ºç¨‹åºçš„è°ƒè¯•æä¾›æ–¹ä¾¿ã€‚ å¯¹Luaç¯å¢ƒä¸­çš„å…¨å±€ç¯å¢ƒè¿›è¡Œä¿æŠ¤ï¼Œé˜²æ­¢ç”¨æˆ·åœ¨æ‰§è¡ŒLuaè„šæœ¬çš„æ—¶å€™ï¼Œå°†é¢å¤–çš„å…¨å±€å˜é‡æ·»åŠ åˆ°Luaç¯å¢ƒä¸­ã€‚ æœåŠ¡å™¨å°†å¯¹Luaç¯å¢ƒä¸­çš„å…¨å±€ç¯å¢ƒè¿›è¡Œä¿æŠ¤ï¼Œç¡®ä¿ä¼ å…¥æœåŠ¡å™¨çš„è„šæœ¬ä¸ä¼šå› ä¸ºå¿˜è®°ä½¿ç”¨localå…³é”®å­—è€Œå°†é¢å¤–çš„å…¨å±€å˜é‡æ·»åŠ åˆ°Luaç¯å¢ƒé‡Œé¢ã€‚ å°†å®Œæˆä¿®æ”¹çš„Luaç¯å¢ƒä¿å­˜åˆ°æœåŠ¡å™¨çŠ¶æ€çš„Luaå±æ€§ä¸­ï¼Œç­‰å¾…æ‰§è¡ŒæœåŠ¡å™¨ä¼ æ¥çš„Luaè„šæœ¬ã€‚ ç»è¿‡ä»¥ä¸Šçš„ä¸€ç³»åˆ—ä¿®æ”¹ï¼ŒRedisæœåŠ¡å™¨å¯¹Luaç¯å¢ƒçš„ä¿®æ”¹å·¥ä½œåˆ°æ­¤å°±ç»“æŸäº†ï¼Œåœ¨æœ€åçš„è¿™ä¸€æ­¥ï¼ŒæœåŠ¡å™¨ä¼šå°†Luaç¯å¢ƒå’ŒæœåŠ¡å™¨çŠ¶æ€çš„luaå±æ€§å…³è”èµ·æ¥ã€‚ å› ä¸ºRedisä½¿ç”¨ä¸²è¡ŒåŒ–çš„æ–¹å¼æ¥æ‰§è¡ŒRediså‘½ä»¤ï¼Œæ‰€ä»¥åœ¨ä»»ä½•ç‰¹å®šæ—¶é—´é‡Œï¼Œæœ€å¤šéƒ½åªä¼šæœ‰ä¸€ä¸ªè„šæœ¬èƒ½å¤Ÿè¢«æ”¾è¿›Luaç¯å¢ƒé‡Œé¢è¿è¡Œï¼Œå› æ­¤ï¼Œæ•´ä¸ªRedisæœåŠ¡å™¨åªéœ€è¦åˆ›å»ºä¸€ä¸ªLuaç¯å¢ƒå³å¯ æœ¬ç«™ï¼ˆRedis|xæ ‡é¢˜ï¼‰ç³»åˆ—çš„æ–‡ç« æ˜¯æ¥æºäºç«™é•¿é˜…è¯»é»„å¥å®ã€ŠRedisè®¾è®¡ä¸å®ç°ã€‹åçš„æ€»ç»“å’Œæ‘˜å½•ã€‚","categories":[{"name":"Redis","slug":"Redis","permalink":"https://solitaire-12.github.io/categories/Redis/"}],"tags":[{"name":"redis","slug":"redis","permalink":"https://solitaire-12.github.io/tags/redis/"}]},{"title":"ç®—æ³•|æ•°æ®ç»“æ„(Java)","slug":"algorithm/æ•°æ®ç»“æ„","date":"2024-03-19T08:49:57.890Z","updated":"2024-03-25T02:14:15.739Z","comments":true,"path":"2024/03/19/algorithm/æ•°æ®ç»“æ„/","permalink":"https://solitaire-12.github.io/2024/03/19/algorithm/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/","excerpt":"","text":"çº¿æ€§è¡¨ æ•°ç»„å’ŒçŸ©é˜µ ä¼˜ç‚¹ è¯»å–é€Ÿåº¦å¿« ç¼ºç‚¹ äº‹å…ˆå¿…é¡»ç›´åˆ°æ•°ç»„çš„é•¿åº¦ æ’å…¥åˆ é™¤å…ƒç´ å¾ˆæ…¢ï¼Œæ•ˆç‡å¾ˆä½ ç©ºé—´é€šå¸¸æ˜¯æœ‰é™åˆ¶çš„ éœ€è¦å¤§å—è¿ç»­çš„å†…å­˜å— ArrayListæºç è§£æ ç›¸å…³é¢˜ç›® é“¾è¡¨ ä¼˜ç‚¹ ç©ºé—´æ²¡æœ‰é™åˆ¶ æ’å…¥åˆ é™¤å…ƒç´ å¾ˆå¿« ç¼ºç‚¹ å­˜å–é€Ÿåº¦å¾ˆæ…¢ åˆ†ç±» å•å‘é“¾è¡¨ï¼ˆæ¯ä¸ªèŠ‚ç‚¹ï¼Œå­˜åœ¨ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆï¼‰ åŒå‘é“¾è¡¨ï¼ˆæ¯ä¸ªèŠ‚ç‚¹ï¼Œå­˜åœ¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼‰ å¾ªç¯é“¾è¡¨ï¼ˆä¸Šè¿°ä¸¤ç§é“¾è¡¨çš„åŸºç¡€ä¸Šï¼Œæ‹¥æœ‰å¤´å°¾äº’æŒ‡æŒ‡é’ˆï¼‰ 12345678910111213141516public class Node &#123; //æ•°æ®åŸŸ public int data; //æŒ‡é’ˆåŸŸï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ public Node next; public Node() &#123; &#125; public Node(int data) &#123; this.data = data; &#125; public Node(int data, Node next) &#123; this.data = data; this.next = next; &#125;&#125; LinkedListæºç è§£æ ç›¸å…³é¢˜ç›® å“ˆå¸Œè¡¨ æ ˆå’Œé˜Ÿåˆ— æ ˆ - LIFO æ•°ç»„å®ç°çš„å«é™æ€æ ˆ é“¾è¡¨å®ç°çš„å«åŠ¨æ€æ ˆ é˜Ÿåˆ— - FIFO æ•°ç»„å®ç°çš„å«é™æ€é˜Ÿåˆ— é“¾è¡¨å®ç°çš„å«åŠ¨æ€é˜Ÿåˆ— æ ‘ çŸ¥è¯†è„‰ç»œ ç»“æ„è¯´æ˜ â€‹ æ ‘æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå®ƒæ˜¯n(n&gt;=0)ä¸ªèŠ‚ç‚¹çš„æœ‰é™é›†ã€‚n=0æ—¶ç§°ä¸ºç©ºæ ‘ã€‚n&gt;0æ—¶ï¼Œæœ‰é™é›†çš„å…ƒç´ æ„æˆä¸€ä¸ªå…·æœ‰å±‚æ¬¡æ„Ÿçš„æ•°æ®ç»“æ„ã€‚ â€‹ åŒºåˆ«åœ¨äºçº¿æ€§è¡¨æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œæ ‘ä¸­çš„èŠ‚ç‚¹æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚æ ‘å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š n&gt;0æ—¶ï¼Œæ ¹èŠ‚ç‚¹æ˜¯å”¯ä¸€çš„ï¼Œä¸å¯èƒ½å­˜åœ¨å¤šä¸ªæ ¹èŠ‚ç‚¹ã€‚ æ¯ä¸ªèŠ‚ç‚¹æœ‰é›¶ä¸ªæˆ–è€…å¤šä¸ªå­èŠ‚ç‚¹ï¼›é™¤äº†æ ¹èŠ‚ç‚¹å¤–ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ã€‚æ ¹èŠ‚ç‚¹æ²¡æœ‰çˆ¶èŠ‚ç‚¹ã€‚ æ ‘çš„ç›¸å…³æ¦‚å¿µ å­æ ‘ï¼šé™¤äº†æ ¹èŠ‚ç‚¹å¤–ï¼Œæ¯ä¸ªå­èŠ‚ç‚¹éƒ½å¯ä»¥ç”±å¤šä¸ªä¸ç›¸äº¤çš„å­æ ‘ã€‚ å­©å­ä¸åŒäº²ï¼šè‹¥ä¸€ä¸ªèŠ‚ç‚¹æœ‰å­æ ‘ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹ç§°ä¸ºå­æ ‘æ ¹çš„&quot;åŒäº²&quot;ï¼Œå­æ ‘çš„æ ¹æ˜¯è¯¥èŠ‚ç‚¹çš„&quot;å­©å­&quot;ã€‚åœ¨å›¾ä¸€ä¸­ï¼ŒBã€Hæ˜¯Açš„å­©å­ï¼ŒAæ˜¯Bã€Hçš„åŒäº²ã€‚ å…„å¼Ÿï¼šå…·æœ‰ç›¸åŒåŒäº²çš„èŠ‚ç‚¹äº’ä¸ºå…„å¼Ÿã€‚ä¾‹å¦‚Bå’ŒHäº’ä¸ºå…„å¼Ÿã€‚ èŠ‚ç‚¹çš„åº¦ï¼šä¸€ä¸ªèŠ‚ç‚¹æ‹¥æœ‰å­æ ‘çš„æ•°ç›®ã€‚ä¾‹å¦‚Açš„åº¦å°±æ˜¯2ï¼ŒBçš„åº¦å°±æ˜¯1ï¼ŒCçš„åº¦å°±æ˜¯3ã€‚ å¶å­ï¼šæ²¡æœ‰å­æ ‘ï¼Œä¹Ÿå³åº¦ä¸º0çš„èŠ‚ç‚¹ã€‚ åˆ†æ”¯èŠ‚ç‚¹ï¼šé™¤äº†å¶å­èŠ‚ç‚¹ä¹‹å¤–çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯åº¦ä¸ä¸º0çš„èŠ‚ç‚¹ã€‚ å†…éƒ¨èŠ‚ç‚¹ï¼šé™¤äº†æ ¹èŠ‚ç‚¹ä¹‹å¤–çš„åˆ†æ”¯èŠ‚ç‚¹ã€‚ å±‚æ¬¡ï¼šæ ¹èŠ‚ç‚¹ä¸ºç¬¬ä¸€å±‚ï¼Œå…¶ä½™èŠ‚ç‚¹çš„å±‚æ¬¡ç­‰äºå…¶åŒäº²èŠ‚ç‚¹çš„å±‚æ¬¡åŠ 1ã€‚ æ ‘çš„é«˜åº¦ï¼šä¹Ÿç§°ä¸ºæ ‘çš„æ·±åº¦ï¼Œæ ‘ä¸­èŠ‚ç‚¹çš„æœ€å¤§å±‚æ¬¡ã€‚ æœ‰åºæ ‘ï¼šæ ‘ä¸­èŠ‚ç‚¹å„ä¸ªå­æ ‘ä¹‹é—´çš„æ¬¡åºæ˜¯é‡è¦çš„ï¼Œä¸å¯ä»¥éšæ„äº¤æ¢ä½ç½®ã€‚ æ— åºæ ‘ï¼šæ ‘ä¸­èŠ‚ç‚¹å„ä¸ªå­æ ‘ä¹‹é—´çš„æ¬¡åºæ˜¯ä¸é‡è¦çš„ï¼Œå¯ä»¥éšæ„äº¤æ¢ä½ç½®ã€‚ æ£®æ—ï¼š0æˆ–è€…å¤šé¢—äº’ä¸ç›¸äº¤çš„æ ‘çš„é›†åˆã€‚ äºŒå‰æ ‘ äºŒå‰æ ‘ æœ€å¤šæœ‰ä¸¤é¢—å­æ ‘çš„æ ‘ äºŒå‰æ ‘çš„äº”ç§çŠ¶æ€ æ–œæ ‘ æ‰€æœ‰èŠ‚ç‚¹éƒ½åªæœ‰å·¦å­æ ‘çš„äºŒå‰æ ‘å«åšå·¦æ–œæ ‘ï¼›æ‰€æœ‰èŠ‚ç‚¹éƒ½åªæœ‰å³å­æ ‘çš„äºŒå‰æ ‘å«åšå³æ–œæ ‘ã€‚å…¶æœ¬è´¨æ˜¯é“¾è¡¨ æ»¡äºŒå‰æ ‘ äºŒå‰æ ‘ä¸­æ‰€æœ‰éå¶å­èŠ‚ç‚¹çš„çš„åº¦éƒ½æ˜¯2ï¼Œä¸”å¶å­èŠ‚ç‚¹éƒ½å¤„äºåŒä¸€ä¸ªå±‚æ¬¡ä¸Šã€‚ å®Œå…¨äºŒå‰æ ‘ å¦‚æœä¸€ä¸ªäºŒå‰æ ‘ä¸æ»¡äºŒå‰æ ‘å‰mä¸ªèŠ‚ç‚¹çš„ç»“æ„ç›¸åŒï¼Œè¿™æ ·çš„äºŒå‰æ ‘è¢«ç§°ä¸ºå®Œå…¨äºŒå‰æ ‘ã€‚ äºŒå‰æŸ¥æ‰¾æ ‘ - BST äºŒå‰æŸ¥æ‰¾æ ‘(Binary Search Tree)æ˜¯æŒ‡ä¸€æ£µç©ºæ ‘æˆ–è€…å…·æœ‰ä¸‹åˆ—æ€§è´¨çš„äºŒå‰æ ‘ï¼š è‹¥ä»»æ„èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ï¼› è‹¥ä»»æ„èŠ‚ç‚¹çš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å¤§äºäºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ï¼› ä»»æ„èŠ‚ç‚¹çš„å·¦å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘ï¼› æ²¡æœ‰é”®å€¼ç›¸ç­‰çš„èŠ‚ç‚¹ã€‚ äºŒå‰æŸ¥æ‰¾æ ‘ç›¸æ¯”è¾ƒå…¶ä»–æ•°æ®ç»“æ„çš„ä¼˜åŠ¿åœ¨äºæŸ¥æ‰¾ã€æ’å…¥çš„æ—¶é—´å¤æ‚åº¦è¾ƒä½ï¼Œä¸º$O(log_{}n)$ã€‚ äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯åŸºç¡€æ€§çš„æ•°æ®ç»“æ„ï¼Œç”¨äºæ„å»ºæ›´ä¸ºæŠ½è±¡çš„æ•°æ®ç»“æ„ï¼Œå¦‚é›†åˆï¼Œå¤šé‡é›†åˆï¼Œå…³è”æ•°ç»„ç­‰ã€‚ äºŒå‰æŸ¥æ‰¾æ ‘çš„å®ç°ä»¥åŠæµ‹è¯• å¹³è¡¡äºŒå‰æ ‘ - AVL å«æœ‰ç›¸åŒèŠ‚ç‚¹çš„äºŒå‰æ ‘å¯ä»¥æœ‰ä¸åŒçš„å½¢æ€ï¼Œè€ŒäºŒå‰æŸ¥æ‰¾æ ‘çš„å¹³å‡é•¿åº¦ä¸æ ‘çš„æ·±åº¦æœ‰å…³ï¼Œæ‰€ä»¥éœ€è¦æ‰¾å‡ºä¸€ä¸ªæŸ¥åˆ°å¹³å‡é•¿åº¦æœ€å°çš„ä¸€æ£µï¼Œé‚£å°±æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Œå…·æœ‰ä¸€ä¸‹æ€§è´¨ï¼š è¦ä¹ˆæ˜¯æ£µç©ºæ ‘ï¼Œè¦ä¹ˆå…¶æ ¹èŠ‚ç‚¹å·¦å³å­æ ‘çš„æ·±åº¦ä¹‹å·®ç»å¯¹å€¼ä¸è¶…è¿‡1ï¼› å…¶å·¦å³å­æ ‘ä¹Ÿéƒ½æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼› äºŒå‰æ ‘èŠ‚ç‚¹çš„å¹³è¡¡å› å­å®šä¹‰ï¼šï¼ˆè¯¥èŠ‚ç‚¹çš„å·¦å­æ ‘çš„æ·±åº¦ - å³å­æ ‘çš„æ·±åº¦ï¼‰ã€‚åˆ™å¹³è¡¡äºŒå‰æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹çš„å¹³è¡¡å› å­åªå¯èƒ½æ˜¯-1ï¼Œ0ï¼Œ1ã€‚ å¹³è¡¡äºŒå‰æ ‘çš„å®ç°ä»¥åŠæµ‹è¯• çº¢é»‘æ ‘ çº¢é»‘æ ‘ä¹Ÿæ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œå®ƒçš„æ¯ä¸ªèŠ‚ç‚¹å¢åŠ äº†ä¸€ä¸ªå­˜å‚¨ä½æ¥è®°å½•èŠ‚ç‚¹çš„é¢œè‰²ï¼Œå¯ä»¥æ˜¯REDï¼Œä¹Ÿå¯ä»¥æ˜¯BLACKï¼›é€šè¿‡ä»»æ„ä¸€æ¡ä»æ ¹åˆ°å¶å­æ£€ç‚¹è·¯å¾„ä¸Šé¢œè‰²çš„çº¦æŸï¼Œçº¢é»‘æ ‘ä¿è¯æœ€é•¿è·¯å¾„ä¸è¶…è¿‡æœ€çŸ­è·¯å¾„çš„ä¸¤å€ï¼Œå› è€Œè¿‘ä¼¼å¹³è¡¡ã€‚ æ¯ä¸ªèŠ‚ç‚¹è¦ä¹ˆæ˜¯çº¢çš„è¦å’Œæ˜¯é»‘çš„ã€‚ï¼ˆçº¢æˆ–é»‘ï¼‰ æ ¹èŠ‚ç‚¹æ˜¯é»‘çš„ã€‚ï¼ˆæ ¹é»‘ï¼‰ æ¯ä¸ªå¶èŠ‚ç‚¹ï¼ˆæŒ‡æ ‘å°¾ç«¯NILæŒ‡é’ˆæˆ–NULLèŠ‚ç‚¹ï¼‰éƒ½æ˜¯é»‘çš„ã€‚ï¼ˆå¶é»‘ï¼‰ å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯çº¢çš„ï¼Œé‚£ä¹ˆä»–çš„ä¸¤ä¸ªå„¿å­éƒ½æ˜¯é»‘çš„ã€‚ï¼ˆçº¢å­é»‘ï¼‰ å¯¹äºä»»æ„èŠ‚ç‚¹è€Œè¨€ï¼Œå…¶åˆ°å¶èŠ‚ç‚¹æ ‘å°¾ç«¯NILæŒ‡é’ˆçš„æ¯æ¡è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘èŠ‚ç‚¹ã€‚ï¼ˆè·¯å¾„ä¸‹é»‘ç›¸åŒï¼‰ã€‚ åº”ç”¨ï¼š Java ConcurrentHashMap &amp; TreeMap C++ STL: map &amp; set linuxè¿›ç¨‹è°ƒåº¦Completely Fair Scheduler,ç”¨çº¢é»‘æ ‘ç®¡ç†è¿›ç¨‹æ§åˆ¶å— epollåœ¨å†…æ ¸ä¸­çš„å®ç°ï¼Œç”¨çº¢é»‘æ ‘ç®¡ç†äº‹ä»¶å— nginxä¸­ï¼Œç”¨çº¢é»‘æ ‘ç®¡ç†timerç­‰ AVLæ ‘å’Œçº¢é»‘æ ‘çš„æ¯”è¾ƒï¼š AVLæ ‘çš„æ—¶é—´å¤æ‚åº¦è™½ç„¶ä¼˜äºçº¢é»‘æ ‘ï¼Œä½†æ˜¯å¯¹äºç°åœ¨çš„è®¡ç®—æœºï¼ŒCPUæ•ˆç‡å¾ˆé«˜ï¼Œæ‰€ä»¥æ€§èƒ½å·®è·ä¹Ÿå°±å˜å°äº† çº¢é»‘æ ‘çš„æ’å…¥åˆ é™¤æ¯”AVLæ ‘æ›´ä¾¿äºæ§åˆ¶æ“ä½œ çº¢é»‘æ ‘æ•´ä½“æ€§èƒ½ç•¥ä¼˜äºAVLæ ‘ï¼ˆçº¢é»‘æ ‘æ—‹è½¬çš„æƒ…å†µå°‘äºAVLæ ‘ï¼‰ çº¢é»‘æ ‘çš„å®ç°ä»¥åŠæµ‹è¯• å“ˆå¤«æ›¼æ ‘ å“ˆå¤«æ›¼æ ‘åˆç§°æœ€ä¼˜äºŒå‰æ ‘ã€‚æ˜¯ä¸€ç§å¸¦æƒè·¯å¾„é•¿åº¦æœ€çŸ­çš„äºŒå‰æ ‘ï¼Œä¸€èˆ¬å¯ä»¥æŒ‰ä¸‹é¢çš„æ­¥éª¤æ„å»ºï¼š å°†æ‰€æœ‰å·¦å³å­æ ‘éƒ½ä¸ºç©ºçš„èŠ‚ç‚¹ä½œä¸ºæ ¹èŠ‚ç‚¹ã€‚ åœ¨æ£®æ—ä¸­é€‰å‡ºä¸¤é¢—æ ¹èŠ‚ç‚¹çš„æƒå€¼æœ€å°çš„æ ‘ä½œä¸ºä¸€æ£µæ–°æ ‘çš„å·¦å³å­æ ‘ï¼Œä¸”æ–°æ ‘çš„é™„åŠ èŠ‚ç‚¹çš„æƒå€¼ä¸ºå…¶å·¦å³å­æ ‘æ ¹èŠ‚ç‚¹çš„æƒå€¼ä¹‹å’Œã€‚æ³¨æ„ï¼Œå·¦å­æ ‘çš„æƒå€¼è¦å°äºå³å­æ ‘çš„æƒå€¼ã€‚ ä»æ£®æ—ä¸­åˆ é™¤è¿™ä¸¤æ£µæ ‘ï¼ŒåŒæ—¶æŠŠæ–°çš„æ ‘åŠ å…¥åˆ°æ£®æ—ä¸­ã€‚ é‡å¤2ï¼Œ3æ­¥éª¤ï¼Œç›´åˆ°æ£®æ—ä¸­åªæœ‰ä¸€æ£µæ ‘ä¸ºæ­¢ï¼Œè¿™æ£µæ ‘å°±æ˜¯å“ˆå¤«æ›¼æ ‘ã€‚ Bæ ‘ Bæ ‘ï¼ˆB-Treeï¼‰æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„æ ‘ï¼Œèƒ½å¤Ÿä¿æŒæ•°æ®çš„æœ‰åºï¼Œè¿™ç§æ•°æ®ç»“æ„èƒ½å¤Ÿè®©æŸ¥æ‰¾æ•°æ®ã€é¡ºåºè®¿é—®ã€æ’å…¥æ•°æ®ä»¥åŠåˆ é™¤çš„åŠ¨ä½œï¼Œéƒ½åœ¨å¯¹æ•°æ—¶é—´å†…å®Œæˆã€‚Bæ ‘ï¼Œæ¦‚æ‹¬æ¥è¯´æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„mé˜¶æ ‘ï¼Œä¸è‡ªå¹³è¡¡äºŒå‰æ ‘ä¸åŒï¼ŒBæ ‘é€‚ç”¨äºè¯»å†™ç›¸å¯¹å¤§çš„æ•°æ®å—çš„å­˜å‚¨ç³»ç»Ÿï¼Œä¾‹å¦‚ç£ç›˜ã€‚ æ ¹èŠ‚ç‚¹è‡³å°‘æœ‰ä¸¤ä¸ªå­å¥³ï¼› æ¯ä¸ªä¸­é—´èŠ‚ç‚¹éƒ½åŒ…å«k-1ä¸ªå…ƒç´ å’Œkä¸ªå­©å­ï¼Œå…¶ä¸­$\\frac{m}{2}\\leq k \\leq m$ï¼› æ¯ä¸ªå¶å­èŠ‚ç‚¹éƒ½åŒ…å«k-1ä¸ªå…ƒç´ ï¼Œå…¶ä¸­$\\frac{m}{2}\\leq k \\leq m$ï¼› æ‰€æœ‰çš„å¶å­èŠ‚ç‚¹éƒ½ä½äºåŒä¸€å±‚ï¼› æ¯ä¸ªèŠ‚ç‚¹ä¸­çš„å…ƒç´ ä»å°åˆ°å¤§æ’åˆ—ï¼ŒèŠ‚ç‚¹å½“ä¸­k-1ä¸ªå…ƒç´ æ­£å¥½æ˜¯kä¸ªå­©å­åŒ…å«çš„å…ƒç´ çš„å€¼åŸŸåˆ†åˆ’ã€‚ B-Treeä¸­çš„æ¯ä¸ªèŠ‚ç‚¹æ ¹æ®å®é™…æƒ…å†µå¯ä»¥åŒ…å«å¤§é‡çš„å…³é”®å­—ä¿¡æ¯å’Œåˆ†æ”¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºä¸ºä¸€ä¸ª3é˜¶çš„B-Tree: B+æ ‘ é€šå¸¸ç”¨äºå…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚MySQLï¼‰å’Œæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚ ç‰¹ç‚¹æ˜¯èƒ½å¤Ÿä¿æŒæ•°æ®çš„ç¨³å®šæœ‰åºï¼Œå…¶ä¸­æ’å…¥ä¸ä¿®æ”¹æ‹¥æœ‰ç¨³å®šçš„å¯¹æ•°æ—¶é—´å¤æ‚åº¦ã€‚ å…ƒç´ è‡ªåº•å‘ä¸Šæ’å…¥ï¼Œè¿™ä¸äºŒå‰æ ‘ç›¸åã€‚ åœ¨Bæ ‘çš„åŸºç¡€ä¸Šï¼Œä¸ºå¶å­èŠ‚ç‚¹å¢åŠ é“¾è¡¨æŒ‡é’ˆ(Bæ ‘+å¶å­æœ‰åºé“¾è¡¨)ï¼Œæ‰€æœ‰å…³é”®å­—éƒ½åœ¨å¶å­èŠ‚ç‚¹ä¸­å‡ºç°ï¼Œéå¶å­èŠ‚ç‚¹ä½œä¸ºå¶å­èŠ‚ç‚¹çš„ç´¢å¼•ï¼›B+æ ‘æ€»æ˜¯åˆ°å¶å­èŠ‚ç‚¹æ‰å‘½ä¸­ã€‚ B+æ ‘çš„éå¶å­èŠ‚ç‚¹ä¸ä¿å­˜æ•°æ®ï¼Œåªä¿å­˜å­æ ‘çš„ä¸´ç•Œå€¼(æœ€å¤§æˆ–è€…æœ€å°)ï¼Œæ‰€ä»¥åŒæ ·å¤§å°çš„èŠ‚ç‚¹ï¼ŒB+æ ‘è¦æ¯”Bæ ‘æœ‰æ›´å¤šçš„åˆ†æ”¯ï¼Œä½¿å¾—è¿™æ£µæ ‘æ›´åŠ çŸ®èƒ–ï¼ŒæŸ¥è¯¢æ—¶åšçš„I/Oæ“ä½œæ¬¡æ•°å°±ä¼šæ›´å°‘ã€‚ å°†ä¸Šä¸€èŠ‚ä¸­çš„B-Treeä¼˜åŒ–ï¼Œç”±äºB+Treeçš„éå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼ä¿¡æ¯ï¼Œå‡è®¾æ¯ä¸ªç£ç›˜å—èƒ½å­˜å‚¨4ä¸ªé”®å€¼åŠæŒ‡é’ˆä¿¡æ¯ï¼Œåˆ™å˜æˆB+Treeåå…¶ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º: B+æ ‘çš„ Ræ ‘ Ræ ‘æ˜¯ç”¨æ¥åšç©ºé—´æ•°æ®å­˜å‚¨çš„æ ‘çŠ¶æ•°æ®ç»“æ„ã€‚ä¾‹å¦‚ç»™åœ°ç†ä½ç½®ï¼ŒçŸ©å½¢å’Œå¤šè¾¹å½¢è¿™ç±»å¤šç»´æ•°æ®å»ºç«‹ç´¢å¼•ã€‚ Ræ ‘çš„æ ¸å¿ƒæ€æƒ³æ˜¯èšåˆè·ç¦»ç›¸è¿‘çš„èŠ‚ç‚¹å¹¶åœ¨æ ‘ç»“æ„çš„ä¸Šä¸€å±‚å°†å…¶è¡¨ç¤ºä¸ºè¿™äº›èŠ‚ç‚¹çš„æœ€å°å¤–æ¥çŸ©å½¢(MBR)ï¼Œè¿™ä¸ªæœ€å°å¤–æ¥çŸ©å½¢å°±æˆä¸ºä¸Šä¸€å±‚çš„ä¸€ä¸ªèŠ‚ç‚¹ã€‚å› ä¸ºæ‰€æœ‰èŠ‚ç‚¹éƒ½åœ¨å®ƒä»¬çš„æœ€å°å¤–æ¥çŸ©å½¢ä¸­ï¼Œæ‰€ä»¥è·ŸæŸä¸ªçŸ©å½¢ä¸ç›¸äº¤çš„æŸ¥è¯¢å°±ä¸€å®šè·Ÿè¿™ä¸ªçŸ©å½¢ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¸ç›¸äº¤ã€‚å¶å­èŠ‚ç‚¹ä¸Šçš„æ¯ä¸ªçŸ©å½¢éƒ½ä»£è¡¨ä¸€ä¸ªå¯¹è±¡ï¼ŒèŠ‚ç‚¹éƒ½æ˜¯å¯¹è±¡çš„èšåˆï¼Œå¹¶ä¸”è¶Šå¾€ä¸Šå±‚èšåˆçš„å¯¹è±¡å°±è¶Šå¤šã€‚ä¹Ÿå¯ä»¥æŠŠæ¯ä¸€å±‚çœ‹åšæ˜¯å¯¹æ•°æ®é›†çš„è¿‘ä¼¼ï¼Œå¶å­èŠ‚ç‚¹å±‚æ˜¯æœ€ç»†ç²’åº¦çš„è¿‘ä¼¼ï¼Œä¸æ•°æ®é›†ç›¸ä¼¼åº¦100%ï¼Œè¶Šå¾€ä¸Šå±‚è¶Šç²—ç³™ã€‚ æ€»ç»“ æˆ‘ä»¬çŸ¥é“ï¼Œå®é™…åº”ç”¨å½“ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„æ˜¯æŸ¥æ‰¾å’Œæ’åºæ“ä½œï¼Œè¿™åœ¨æˆ‘ä»¬çš„å„ç§ç®¡ç†ç³»ç»Ÿã€æ•°æ®åº“ç³»ç»Ÿã€æ“ä½œç³»ç»Ÿç­‰å½“ä¸­ï¼Œååˆ†å¸¸ç”¨ã€‚ æ•°ç»„çš„ä¸‹æ ‡å¯»å€ååˆ†è¿…é€Ÿï¼Œä½†è®¡ç®—æœºçš„å†…å­˜æ˜¯æœ‰é™çš„ï¼Œæ•…æ•°ç»„çš„é•¿åº¦ä¹Ÿæ˜¯æœ‰é™çš„ï¼Œå®é™…åº”ç”¨å½“ä¸­çš„æ•°æ®å¾€å¾€ååˆ†åºå¤§ï¼›è€Œä¸”æ— åºæ•°ç»„çš„æŸ¥æ‰¾æœ€åæƒ…å†µéœ€è¦éå†æ•´ä¸ªæ•°ç»„ï¼›åæ¥äººä»¬æå‡ºäº†äºŒåˆ†æŸ¥æ‰¾ï¼ŒäºŒåˆ†æŸ¥æ‰¾è¦æ±‚æ•°ç»„çš„æ„é€ ä¸€å®šæœ‰åºï¼ŒäºŒåˆ†æ³•æŸ¥æ‰¾è§£å†³äº†æ™®é€šæ•°ç»„æŸ¥æ‰¾å¤æ‚åº¦è¿‡é«˜çš„é—®é¢˜ã€‚ä»»ä½•ä¸€ç§æ•°ç»„æ— æ³•è§£å†³çš„é—®é¢˜å°±æ˜¯æ’å…¥ã€åˆ é™¤æ“ä½œæ¯”è¾ƒå¤æ‚ï¼Œå› æ­¤ï¼Œåœ¨ä¸€ä¸ªå¢åˆ æŸ¥æ”¹æ¯”è¾ƒé¢‘ç¹çš„æ•°æ®ç»“æ„ä¸­ï¼Œæ•°ç»„ä¸ä¼šè¢«ä¼˜å…ˆè€ƒè™‘ æ™®é€šé“¾è¡¨ç”±äºå®ƒçš„ç»“æ„ç‰¹ç‚¹è¢«è¯æ˜æ ¹æœ¬ä¸é€‚åˆè¿›è¡ŒæŸ¥æ‰¾ å“ˆå¸Œè¡¨æ˜¯æ•°ç»„å’Œé“¾è¡¨çš„æŠ˜ä¸­ï¼ŒåŒæ—¶å®ƒçš„è®¾è®¡ä¾èµ–æ•£åˆ—å‡½æ•°çš„è®¾è®¡ï¼Œæ•°ç»„ä¸èƒ½æ— é™é•¿ã€é“¾è¡¨ä¹Ÿä¸é€‚åˆæŸ¥æ‰¾ï¼Œæ‰€ä»¥ä¹Ÿä¸é€‚åˆå¤§è§„æ¨¡çš„æŸ¥æ‰¾ äºŒå‰æŸ¥æ‰¾æ ‘å› ä¸ºå¯èƒ½é€€åŒ–æˆé“¾è¡¨ï¼ŒåŒæ ·ä¸é€‚åˆè¿›è¡ŒæŸ¥æ‰¾ AVLæ ‘æ˜¯ä¸ºäº†è§£å†³å¯èƒ½é€€åŒ–æˆé“¾è¡¨é—®é¢˜ï¼Œä½†æ˜¯AVLæ ‘çš„æ—‹è½¬è¿‡ç¨‹éå¸¸éº»çƒ¦ï¼Œå› æ­¤æ’å…¥å’Œåˆ é™¤å¾ˆæ…¢ï¼Œä¹Ÿå°±æ˜¯æ„å»ºAVLæ ‘æ¯”è¾ƒéº»çƒ¦ çº¢é»‘æ ‘æ˜¯å¹³è¡¡äºŒå‰æ ‘å’ŒAVLæ ‘çš„æŠ˜ä¸­ï¼Œå› æ­¤æ˜¯æ¯”è¾ƒåˆé€‚çš„ã€‚é›†åˆç±»ä¸­çš„Mapã€å…³è”æ•°ç»„å…·æœ‰è¾ƒé«˜çš„æŸ¥è¯¢æ•ˆç‡ï¼Œå®ƒä»¬çš„åº•å±‚å®ç°å°±æ˜¯çº¢é»‘æ ‘ã€‚ å¤šè·¯æŸ¥æ‰¾æ ‘ æ˜¯å¤§è§„æ¨¡æ•°æ®å­˜å‚¨ä¸­ï¼Œå®ç°ç´¢å¼•æŸ¥è¯¢è¿™æ ·ä¸€ä¸ªå®é™…èƒŒæ™¯ä¸‹ï¼Œæ ‘èŠ‚ç‚¹å­˜å‚¨çš„å…ƒç´ æ•°é‡æ˜¯æœ‰é™çš„(å¦‚æœå…ƒç´ æ•°é‡éå¸¸å¤šçš„è¯ï¼ŒæŸ¥æ‰¾å°±é€€åŒ–æˆèŠ‚ç‚¹å†…éƒ¨çš„çº¿æ€§æŸ¥æ‰¾äº†)ï¼Œè¿™æ ·å¯¼è‡´äºŒå‰æŸ¥æ‰¾æ ‘ç»“æ„ç”±äºæ ‘çš„æ·±åº¦è¿‡å¤§è€Œé€ æˆç£ç›˜I/Oè¯»å†™è¿‡äºé¢‘ç¹ï¼Œè¿›è€Œå¯¼è‡´æŸ¥è¯¢æ•ˆç‡ä½ä¸‹ã€‚ Bæ ‘ä¸è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ä¸åŒï¼ŒBæ ‘é€‚ç”¨äºè¯»å†™ç›¸å¯¹å¤§çš„æ•°æ®å—çš„å­˜å‚¨ç³»ç»Ÿï¼Œä¾‹å¦‚ç£ç›˜ã€‚å®ƒçš„åº”ç”¨æ˜¯æ–‡ä»¶ç³»ç»ŸåŠéƒ¨åˆ†éå…³ç³»å‹æ•°æ®åº“ç´¢å¼•ã€‚ B+æ ‘åœ¨Bæ ‘åŸºç¡€ä¸Šï¼Œä¸ºå¶å­ç»“ç‚¹å¢åŠ é“¾è¡¨æŒ‡é’ˆ(Bæ ‘+å¶å­æœ‰åºé“¾è¡¨)ï¼Œæ‰€æœ‰å…³é”®å­—éƒ½åœ¨å¶å­ç»“ç‚¹ ä¸­å‡ºç°ï¼Œéå¶å­ç»“ç‚¹ä½œä¸ºå¶å­ç»“ç‚¹çš„ç´¢å¼•ï¼›B+æ ‘æ€»æ˜¯åˆ°å¶å­ç»“ç‚¹æ‰å‘½ä¸­ã€‚é€šå¸¸ç”¨äºå…³ç³»å‹æ•°æ®åº“(å¦‚MySQL)å’Œæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚ B*æ ‘æ˜¯B+æ ‘çš„å˜ä½“ï¼Œåœ¨B+æ ‘çš„éæ ¹å’Œéå¶å­ç»“ç‚¹å†å¢åŠ æŒ‡å‘å…„å¼Ÿçš„æŒ‡é’ˆ, åœ¨B+æ ‘åŸºç¡€ä¸Šï¼Œä¸ºéå¶å­ç»“ç‚¹ä¹Ÿå¢åŠ é“¾è¡¨æŒ‡é’ˆï¼Œå°†ç»“ç‚¹çš„æœ€ä½åˆ©ç”¨ç‡ä»1/2æé«˜åˆ°2/3ã€‚ Ræ ‘æ˜¯ç”¨æ¥åšç©ºé—´æ•°æ®å­˜å‚¨çš„æ ‘çŠ¶æ•°æ®ç»“æ„ã€‚ä¾‹å¦‚ç»™åœ°ç†ä½ç½®ï¼ŒçŸ©å½¢å’Œå¤šè¾¹å½¢è¿™ç±»å¤šç»´æ•°æ®å»ºç«‹ç´¢å¼•ã€‚ Trieæ ‘æ˜¯è‡ªç„¶è¯­è¨€å¤„ç†ä¸­æœ€å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œå¾ˆå¤šå­—ç¬¦ä¸²å¤„ç†ä»»åŠ¡éƒ½ä¼šç”¨åˆ°ã€‚Trieæ ‘æœ¬èº«æ˜¯ä¸€ç§æœ‰é™çŠ¶æ€è‡ªåŠ¨æœºï¼Œè¿˜æœ‰å¾ˆå¤šå˜ä½“ã€‚ä»€ä¹ˆæ¨¡å¼åŒ¹é…ã€æ­£åˆ™è¡¨è¾¾å¼ï¼Œéƒ½ä¸è¿™æœ‰å…³ã€‚ é’ˆå¯¹å¤§é‡æ•°æ®ï¼Œå¦‚æœåœ¨å†…å­˜ä¸­ä½œä¸šä¼˜å…ˆè€ƒè™‘çº¢é»‘æ ‘(map,setä¹‹ç±»å¤šä¸ºRB-treeå®ç°)ï¼Œå¦‚æœåœ¨ç¡¬ç›˜ä¸­ä½œä¸šä¼˜å…ˆè€ƒè™‘Bç³»åˆ—æ ‘(B+, B, B*) å›¾ å¾…ç»­ Javaé›†åˆæºç è§£æ ArrayList æ¦‚è¿° â€‹ ArrayListå®ç°äº†Listæ¥å£ï¼Œæ˜¯é¡ºåºå®¹å™¨ï¼Œå³å…ƒç´ å­˜æ”¾çš„æ•°æ®ä¸æ”¾è¿›å»çš„é¡ºåºæ˜¯ç›¸åŒçš„ï¼Œå…è®¸æ”¾å…¥nullå…ƒç´ ï¼Œåº•å±‚é€šè¿‡Objectæ•°ç»„å®ç°ï¼Œæœªå®ç°åŒæ­¥ã€‚ â€‹ æ¯ä¸ªArrayListéƒ½æœ‰ä¸€ä¸ªå®¹é‡(capacity)ï¼Œè¡¨ç¤ºåº•å±‚æ•°ç»„çš„å®é™…å¤§å°ï¼Œå®¹é‡å†…å­˜å‚¨å…ƒç´ çš„ä¸ªæ•°ä¸èƒ½å¤šäºå½“å‰å®¹é‡ã€‚åœ¨å‘å®¹å™¨ä¸­æ·»åŠ å…ƒç´ æ—¶ï¼Œå¦‚æœå®¹é‡ä¸è¶³ï¼Œå®¹å™¨ä¼šè‡ªåŠ¨å¢å¤§åº•å±‚æ•°ç»„çš„å¤§å°ï¼ˆæ‰©å®¹æœºåˆ¶ï¼‰ã€‚ â€‹ size()ï¼ŒisEmpty()ï¼Œget()ï¼Œset()æ–¹æ³•å‡èƒ½åœ¨å¸¸æ•°æ—¶é—´å†…å®Œæˆï¼Œadd()æ–¹æ³•çš„æ—¶é—´å¼€é”€è·Ÿæ’å…¥çš„ä½ç½®æœ‰å…³ï¼ŒaddAll()æ–¹æ³•çš„æ—¶é—´å¼€é”€è·Ÿæ·»åŠ å…ƒç´ çš„ä¸ªæ•°æˆæ­£æ¯”ã€‚å…¶ä½™æ–¹æ³•å¤§éƒ½æ—¶çº¿æ€§æ—¶é—´ã€‚ â€‹ è¿½æ±‚æ•ˆç‡ï¼ŒArrayListä¹Ÿæ²¡æœ‰å®ç°åŒæ­¥(synchronized)ï¼Œå¦‚æœéœ€è¦å¤šä¸ªçº¿ç¨‹è®¿é—®çš„ï¼Œç”¨æˆ·éœ€è¦æ‰‹åŠ¨åŒæ­¥ï¼ˆåˆ†ææŸ¥çœ‹ï¼‰ã€‚ æºç è§£æ åº•å±‚æ•°æ®ç»“æ„ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879/** * Default initial capacity. */private static final int DEFAULT_CAPACITY = 10;/** * Shared empty array instance used for empty instances. */private static final Object[] EMPTY_ELEMENTDATA = &#123;&#125;;/** * Shared empty array instance used for default sized empty instances. We * distinguish this from EMPTY_ELEMENTDATA to know how much to inflate when * first element is added. */private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;/** * The array buffer into which the elements of the ArrayList are stored. * The capacity of the ArrayList is the length of this array buffer. Any * empty ArrayList with elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA * will be expanded to DEFAULT_CAPACITY when the first element is added. */transient Object[] elementData; // non-private to simplify nested class access/** * The size of the ArrayList (the number of elements it contains). * * @serial */private int size;/** * Constructs an empty list with the specified initial capacity. * * @param initialCapacity the initial capacity of the list * @throws IllegalArgumentException if the specified initial capacity * is negative */public ArrayList(int initialCapacity) &#123; if (initialCapacity &gt; 0) &#123; this.elementData = new Object[initialCapacity]; &#125; else if (initialCapacity == 0) &#123; this.elementData = EMPTY_ELEMENTDATA; &#125; else &#123; throw new IllegalArgumentException(&quot;Illegal Capacity: &quot;+ initialCapacity); &#125;&#125;/** * Constructs an empty list with an initial capacity of ten. */public ArrayList() &#123; this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;&#125;/** * Constructs a list containing the elements of the specified * collection, in the order they are returned by the collection&#x27;s * iterator. * * @param c the collection whose elements are to be placed into this list * @throws NullPointerException if the specified collection is null */public ArrayList(Collection&lt;? extends E&gt; c) &#123; Object[] a = c.toArray(); if ((size = a.length) != 0) &#123; if (c.getClass() == ArrayList.class) &#123; elementData = a; &#125; else &#123; elementData = Arrays.copyOf(a, size, Object[].class); &#125; &#125; else &#123; // replace with empty array. elementData = EMPTY_ELEMENTDATA; &#125;&#125; æ³¨æ„ï¼š åœ¨æ— å‚æ„é€ æ–¹æ³•ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ArrayListåˆå§‹åŒ–äº†ä¸€ä¸ªDEFAULTCAPACITY_EMPTY_ELEMENTDATAï¼Œè¿™æ˜¯ä¸€ä¸ªå®¹é‡ä¸º0çš„ç©ºObjectæ•°ç»„ã€‚ åœ¨æœ‰å‚æ„é€ æ–¹æ³•ä¸­ï¼Œå½“ä¼ å…¥çš„å‚æ•°ä¸ºé›¶ï¼Œæˆ–è€…é›†åˆå¤§å°ä¸º0çš„æ—¶å€™ï¼Œåˆå§‹åŒ–ä¸€ä¸ªEMPTY_ELEMENTDATAï¼Œè¿™æ˜¯åŒæ ·æ˜¯ä¸€ä¸ªå®¹é‡ä¸º0çš„ç©ºObjectæ•°ç»„ã€‚ ç»¼ä¸Šä¸¤ç‚¹ï¼Œå‡è‹¥æ²¡æœ‰è§„å®šåˆå§‹å®¹é‡ï¼ŒArrayListä¼šåˆå§‹åŒ–å‡ºä¸€ä¸ªå®¹é‡ä¸º0çš„ç©ºObjectæ•°ç»„ã€‚éšååœ¨å¾€å…¶ä¸­ç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œè¿›è¡Œæ‰©å®¹ï¼Œé»˜è®¤å®¹é‡(DEFAULT_CAPACITY)ä¸º10ã€‚ æ‰©å®¹æœºåˆ¶ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586/** * Trims the capacity of this &lt;tt&gt;ArrayList&lt;/tt&gt; instance to be the * list&#x27;s current size. An application can use this operation to minimize * the storage of an &lt;tt&gt;ArrayList&lt;/tt&gt; instance. */public void trimToSize() &#123; modCount++; if (size &lt; elementData.length) &#123; elementData = (size == 0) ? EMPTY_ELEMENTDATA : Arrays.copyOf(elementData, size); &#125;&#125;/** * Increases the capacity of this &lt;tt&gt;ArrayList&lt;/tt&gt; instance, if * necessary, to ensure that it can hold at least the number of elements * specified by the minimum capacity argument. * * @param minCapacity the desired minimum capacity */public void ensureCapacity(int minCapacity) &#123; int minExpand = (elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATA) // any size if not default element table ? 0 // larger than default for default empty table. It&#x27;s already // supposed to be at default size. : DEFAULT_CAPACITY; if (minCapacity &gt; minExpand) &#123; ensureExplicitCapacity(minCapacity); &#125;&#125;private static int calculateCapacity(Object[] elementData, int minCapacity) &#123; if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123; return Math.max(DEFAULT_CAPACITY, minCapacity); &#125; return minCapacity;&#125;private void ensureCapacityInternal(int minCapacity) &#123; ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));&#125;private void ensureExplicitCapacity(int minCapacity) &#123; modCount++; // overflow-conscious code if (minCapacity - elementData.length &gt; 0) grow(minCapacity);&#125;/** * The maximum size of array to allocate. * Some VMs reserve some header words in an array. * Attempts to allocate larger arrays may result in * OutOfMemoryError: Requested array size exceeds VM limit */private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;/** * Increases the capacity to ensure that it can hold at least the * number of elements specified by the minimum capacity argument. * * @param minCapacity the desired minimum capacity */private void grow(int minCapacity) &#123; // overflow-conscious code int oldCapacity = elementData.length; int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1); if (newCapacity - minCapacity &lt; 0) newCapacity = minCapacity; if (newCapacity - MAX_ARRAY_SIZE &gt; 0) newCapacity = hugeCapacity(minCapacity); // minCapacity is usually close to size, so this is a win: elementData = Arrays.copyOf(elementData, newCapacity);&#125;private static int hugeCapacity(int minCapacity) &#123; if (minCapacity &lt; 0) // overflow throw new OutOfMemoryError(); return (minCapacity &gt; MAX_ARRAY_SIZE) ? Integer.MAX_VALUE : MAX_ARRAY_SIZE;&#125; æè¿°ï¼š â€‹ æ¯å½“æ·»åŠ å…ƒç´ æ—¶ï¼Œéƒ½ä¼šå»æ£€æŸ¥æ·»åŠ åå…ƒç´ çš„ä¸ªæ•°æ˜¯å¦ä¼šè¶…å‡ºå½“å‰æ•°ç»„çš„é•¿åº¦ï¼Œå¦‚æœè¶…å‡ºï¼Œæ•°ç»„å°†ä¼šè¿›è¡Œæ‰©å®¹ï¼Œä»¥æ»¡è¶³æ·»åŠ æ•°æ®çš„è¦æ±‚ã€‚æ•°ç»„æ‰©å®¹é€šè¿‡ä¸€ä¸ªå…¬å¼€çš„æ–¹æ³•ensureCapacity(int minCapacity)æ¥å®ç°ã€‚æ‰€ä»¥ï¼Œåœ¨æ·»åŠ å¤§é‡å…ƒç´ å‰ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥å®ç°æ‰‹åŠ¨æ‰©å®¹ï¼Œå‡å°‘åœ¨æ·»åŠ å…ƒç´ è¿‡ç¨‹ä¸­ï¼Œè‡ªåŠ¨æ‰©å®¹çš„æ¬¡æ•°ï¼Œå› ä¸ºæ‰©å®¹çš„è¿‡ç¨‹éœ€è¦å»å¤åˆ¶æºæ•°ç»„åˆ°æ–°æ•°ç»„ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹è´¹æ—¶è´¹ç©ºé—´ã€‚ â€‹ æ•°ç»„è¿›è¡Œæ‰©å®¹æ—¶ï¼Œä¼šå°†è€æ•°ç»„ä¸­çš„å…ƒç´ æ‹·è´ä¸€ä»½åˆ°æ–°çš„æ•°ç»„ä¸­ï¼Œåœ¨growæ–¹æ³•ä¸­æœ‰è¿™ä¹ˆä¸€æ¡ä»£ç ï¼šint newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1);å¯ä»¥çœ‹å‡ºï¼Œæ•°ç»„æ¯æ¬¡æ‰©å®¹çš„æ—¶å€™ï¼Œä¼šæ‰©å®¹åˆ°å½“å‰å®¹é‡çš„1.5å€ã€‚è¦æ˜¯newCapacityè¶…è¿‡äº†Integer.MAX_VALUE - 8($2^{31}-1-8$)å°±ä¼šæŠŠå®¹é‡æ‰©å¤§åˆ°(Integer.MAX_VALUE)ï¼Œè¿™æ ·å°±ä¸ä¼šå†æ‰©å®¹äº†ã€‚ add 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384/** * Appends the specified element to the end of this list. * * @param e element to be appended to this list * @return &lt;tt&gt;true&lt;/tt&gt; (as specified by &#123;@link Collection#add&#125;) */public boolean add(E e) &#123; ensureCapacityInternal(size + 1); // Increments modCount!! elementData[size++] = e; return true;&#125;/** * Inserts the specified element at the specified position in this * list. Shifts the element currently at that position (if any) and * any subsequent elements to the right (adds one to their indices). * * @param index index at which the specified element is to be inserted * @param element element to be inserted * @throws IndexOutOfBoundsException &#123;@inheritDoc&#125; */public void add(int index, E element) &#123; rangeCheckForAdd(index); ensureCapacityInternal(size + 1); // Increments modCount!! System.arraycopy(elementData, index, elementData, index + 1, size - index); elementData[index] = element; size++;&#125;/** * Appends all of the elements in the specified collection to the end of * this list, in the order that they are returned by the * specified collection&#x27;s Iterator. The behavior of this operation is * undefined if the specified collection is modified while the operation * is in progress. (This implies that the behavior of this call is * undefined if the specified collection is this list, and this * list is nonempty.) * * @param c collection containing elements to be added to this list * @return &lt;tt&gt;true&lt;/tt&gt; if this list changed as a result of the call * @throws NullPointerException if the specified collection is null */public boolean addAll(Collection&lt;? extends E&gt; c) &#123; Object[] a = c.toArray(); int numNew = a.length; ensureCapacityInternal(size + numNew); // Increments modCount System.arraycopy(a, 0, elementData, size, numNew); size += numNew; return numNew != 0;&#125;/** * Inserts all of the elements in the specified collection into this * list, starting at the specified position. Shifts the element * currently at that position (if any) and any subsequent elements to * the right (increases their indices). The new elements will appear * in the list in the order that they are returned by the * specified collection&#x27;s iterator. * * @param index index at which to insert the first element from the * specified collection * @param c collection containing elements to be added to this list * @return &lt;tt&gt;true&lt;/tt&gt; if this list changed as a result of the call * @throws IndexOutOfBoundsException &#123;@inheritDoc&#125; * @throws NullPointerException if the specified collection is null */public boolean addAll(int index, Collection&lt;? extends E&gt; c) &#123; rangeCheckForAdd(index); Object[] a = c.toArray(); int numNew = a.length; ensureCapacityInternal(size + numNew); // Increments modCount int numMoved = size - index; if (numMoved &gt; 0) System.arraycopy(elementData, index, elementData, index + numNew, numMoved); System.arraycopy(a, 0, elementData, index, numNew); size += numNew; return numNew != 0;&#125; â€‹ add(int index,E e)éœ€è¦å¯¹å…ƒç´ è¿›è¡Œç§»åŠ¨ï¼Œç„¶åå®Œæˆæ’å…¥æ“ä½œï¼Œä¹Ÿå°±æ„å‘³ç€è¯¥æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯çº¿æ€§çš„ã€‚ â€‹ addAll()æ–¹æ³•èƒ½å¤Ÿä¸€æ¬¡æ·»åŠ å¤šä¸ªå…ƒç´ ï¼Œæ ¹æ®ä½ç½®çš„ä¸åŒï¼Œä¹Ÿæœ‰ä¸¤ä¸ªç‰ˆæœ¬ã€‚ä¸€ç§æ˜¯å°¾æ’æ³•ï¼šaddAll(Collection&lt;? extends E&gt; c)ï¼Œä¸€ç§æ˜¯æŒ‡å®šä½ç½®æ’å…¥ï¼šaddAll(int index, Collection&lt;? extends E&gt; c)ã€‚è·Ÿadd()æ–¹æ³•ç±»ä¼¼ï¼Œåœ¨æ’å…¥ä¹‹å‰éœ€è¦è¿›è¡Œç©ºé—´æ£€æŸ¥ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ï¼›å¦‚æœä»æŒ‡å®šçš„ä½ç½®æ’å…¥ï¼Œä¹Ÿä¼šç§»åŠ¨å…ƒç´ ã€‚ç»¼ä¸Šï¼šaddAll()æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦å’Œæ’å…¥çš„å…ƒç´ ä¸ªæ•°ä»¥åŠæ’å…¥ä½ç½®æœ‰å…³ã€‚ set 1234567891011121314151617181920212223242526272829303132/** * Replaces the element at the specified position in this list with * the specified element. * * @param index index of the element to replace * @param element element to be stored at the specified position * @return the element previously at the specified position * @throws IndexOutOfBoundsException &#123;@inheritDoc&#125; */public E set(int index, E element) &#123; rangeCheck(index); E oldValue = elementData(index); elementData[index] = element; return oldValue;&#125;/** * Checks if the given index is in range. If not, throws an appropriate * runtime exception. This method does *not* check if the index is * negative: It is always used immediately prior to an array access, * which throws an ArrayIndexOutOfBoundsException if index is negative. */private void rangeCheck(int index) &#123; if (index &gt;= size) throw new IndexOutOfBoundsException(outOfBoundsMsg(index));&#125;@SuppressWarnings(&quot;unchecked&quot;)E elementData(int index) &#123; return (E) elementData[index];&#125; get 123456789101112/** * Returns the element at the specified position in this list. * * @param index index of the element to return * @return the element at the specified position in this list * @throws IndexOutOfBoundsException &#123;@inheritDoc&#125; */public E get(int index) &#123; rangeCheck(index); return elementData(index);&#125; remove 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253/** * Removes the element at the specified position in this list. * Shifts any subsequent elements to the left (subtracts one from their * indices). * * @param index the index of the element to be removed * @return the element that was removed from the list * @throws IndexOutOfBoundsException &#123;@inheritDoc&#125; */public E remove(int index) &#123; rangeCheck(index); modCount++; E oldValue = elementData(index); int numMoved = size - index - 1; if (numMoved &gt; 0) System.arraycopy(elementData, index+1, elementData, index, numMoved); elementData[--size] = null; // clear to let GC do its work return oldValue;&#125;/** * Removes the first occurrence of the specified element from this list, * if it is present. If the list does not contain the element, it is * unchanged. More formally, removes the element with the lowest index * &lt;tt&gt;i&lt;/tt&gt; such that * &lt;tt&gt;(o==null&amp;nbsp;?&amp;nbsp;get(i)==null&amp;nbsp;:&amp;nbsp;o.equals(get(i)))&lt;/tt&gt; * (if such an element exists). Returns &lt;tt&gt;true&lt;/tt&gt; if this list * contained the specified element (or equivalently, if this list * changed as a result of the call). * * @param o element to be removed from this list, if present * @return &lt;tt&gt;true&lt;/tt&gt; if this list contained the specified element */public boolean remove(Object o) &#123; if (o == null) &#123; for (int index = 0; index &lt; size; index++) if (elementData[index] == null) &#123; fastRemove(index); return true; &#125; &#125; else &#123; for (int index = 0; index &lt; size; index++) if (o.equals(elementData[index])) &#123; fastRemove(index); return true; &#125; &#125; return false;&#125; ä¸¤ä¸ªç‰ˆæœ¬ï¼š ä¸€ä¸ªæ˜¯remove(int index)åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ ï¼Œå¦ä¸€ä¸ªæ˜¯remove(Object o)åˆ é™¤ç¬¬ä¸€ä¸ªæ»¡è¶³o.equals(elementData[index])çš„å…ƒç´  ã€‚ æ³¨æ„ï¼š â€‹ elementData[--size] = null; // clear to let GC do its workï¼Œè¿™æ˜¯ä¸ºäº†è®©GCèµ·ä½œç”¨ã€‚é‚£ä¸ºä»€ä¹ˆè¿™é‡Œéœ€è¦è¿™ç§æ˜¾ç¤ºèµ‹nullå€¼å‘¢ï¼Ÿ â€‹ è¿™æ˜¯å› ä¸ºGCåœ¨åˆ¤æ–­å¯¹è±¡èƒ½å¦å›æ”¶æ˜¯æ ¹æ®å®ƒæ˜¯å¦åœ¨å¼•ç”¨é“¾ä¸Šï¼Œè€Œåº•å±‚çš„æ•°ç»„ç»´ç³»ç€è¿™ä¸ªå¼•ç”¨é“¾ã€‚å½“åˆ é™¤ä¸€ä¸ªå…ƒç´ ä¹‹åï¼Œå…ƒç´ æ•°é‡å‘ç”Ÿå˜åŒ–ï¼Œæ‰€æœ‰åç»­å…ƒç´ å¾€å‰ç§»åŠ¨ï¼Œè¿™æ ·åœ¨å¼•ç”¨é“¾ä¸Šå°±ä¼šå¤šå‡ºæ¥ä¸€ä¸ªå…ƒç´ ï¼ŒæŒ‰ç†è¿™ä¸ªå…ƒç´ åº”è¯¥æ˜¯æ²¡æœ‰å€¼çš„ï¼Œè¦è¢«GCæ‰ã€‚ä½†æ˜¯åœ¨åç»­å…ƒç´ å¾€å‰ç§»åŠ¨çš„æ—¶å€™ï¼Œæ˜¯å°†åç»­å…ƒç´ æ‹·è´ä¸€ä»½ï¼Œä»åˆ é™¤ä½ç½®å¼€å§‹ä»å†™åŸå§‹ä½ç½®ä¸Šçš„å€¼ï¼Œè¿™æ ·çš„ç»“æœå°±å¯¼è‡´äº†æœ€åä¸€ä¸ªä½ç½®ä¸Šæ˜¯å­˜åœ¨å€¼çš„ï¼ŒGCç¡®å®šä¸äº†è¿™ä¸ªå¯¹è±¡æ˜¯å¦è¯¥å›æ”¶ï¼Œæ•…è€Œåœ¨é€šè¿‡æ˜¾ç¤ºçš„èµ‹nullå€¼ï¼Œå‘Šè¯‰GCå¯ä»¥å›æ”¶è¯¥å¯¹è±¡ã€‚ indexOf 123456789101112131415161718192021222324252627282930313233343536373839/** * Returns the index of the first occurrence of the specified element * in this list, or -1 if this list does not contain the element. * More formally, returns the lowest index &lt;tt&gt;i&lt;/tt&gt; such that * &lt;tt&gt;(o==null&amp;nbsp;?&amp;nbsp;get(i)==null&amp;nbsp;:&amp;nbsp;o.equals(get(i)))&lt;/tt&gt;, * or -1 if there is no such index. */public int indexOf(Object o) &#123; if (o == null) &#123; for (int i = 0; i &lt; size; i++) if (elementData[i]==null) return i; &#125; else &#123; for (int i = 0; i &lt; size; i++) if (o.equals(elementData[i])) return i; &#125; return -1;&#125;/** * Returns the index of the last occurrence of the specified element * in this list, or -1 if this list does not contain the element. * More formally, returns the highest index &lt;tt&gt;i&lt;/tt&gt; such that * &lt;tt&gt;(o==null&amp;nbsp;?&amp;nbsp;get(i)==null&amp;nbsp;:&amp;nbsp;o.equals(get(i)))&lt;/tt&gt;, * or -1 if there is no such index. */public int lastIndexOf(Object o) &#123; if (o == null) &#123; for (int i = size-1; i &gt;= 0; i--) if (elementData[i]==null) return i; &#125; else &#123; for (int i = size-1; i &gt;= 0; i--) if (o.equals(elementData[i])) return i; &#125; return -1;&#125; Fail-Fastæœºåˆ¶ ArrayListé‡‡ç”¨äº†å¿«é€Ÿå¤±è´¥æœºåˆ¶ï¼Œé€šè¿‡AbstractListæŠ½è±¡ç±»ä¸­çš„modCountå‚æ•°æ¥å®ç°ã€‚æºç æ³¨è§£ç¬¬äºŒæ®µæåˆ°ï¼šå¦‚æœè¯¥å­—æ®µçš„å€¼å‘ç”Ÿæ„å¤–å˜åŒ–ï¼Œè¿­ä»£å™¨ä¼šå¿«é€Ÿå¤±è´¥ï¼ŒæŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ï¼Œä»¥å“åº”nextï¼Œremoveï¼Œpreviousï¼Œsetæˆ–addæ“ä½œï¼Œä»¥é¿å…åœ¨è¿­ä»£æœŸé—´é¢å¯¹å¹¶å‘ä¿®æ”¹æ—¶çš„ä¸ç¡®å®šæ€§è¡Œä¸ºã€‚ 123456789101112131415161718192021222324252627/** * The number of times this list has been &lt;i&gt;structurally modified&lt;/i&gt;. * Structural modifications are those that change the size of the * list, or otherwise perturb it in such a fashion that iterations in * progress may yield incorrect results. * * &lt;p&gt;This field is used by the iterator and list iterator implementation * returned by the &#123;@code iterator&#125; and &#123;@code listIterator&#125; methods. * If the value of this field changes unexpectedly, the iterator (or list * iterator) will throw a &#123;@code ConcurrentModificationException&#125; in * response to the &#123;@code next&#125;, &#123;@code remove&#125;, &#123;@code previous&#125;, * &#123;@code set&#125; or &#123;@code add&#125; operations. This provides * &lt;i&gt;fail-fast&lt;/i&gt; behavior, rather than non-deterministic behavior in * the face of concurrent modification during iteration. * * &lt;p&gt;&lt;b&gt;Use of this field by subclasses is optional.&lt;/b&gt; If a subclass * wishes to provide fail-fast iterators (and list iterators), then it * merely has to increment this field in its &#123;@code add(int, E)&#125; and * &#123;@code remove(int)&#125; methods (and any other methods that it overrides * that result in structural modifications to the list). A single call to * &#123;@code add(int, E)&#125; or &#123;@code remove(int)&#125; must add no more than * one to this field, or the iterators (and list iterators) will throw * bogus &#123;@code ConcurrentModificationExceptions&#125;. If an implementation * does not wish to provide fail-fast iterators, this field may be * ignored. */protected transient int modCount = 0; LinkedList æ¦‚è¿° LinkedListåŒæ—¶å®ç°äº†Listæ¥å£å’ŒDequeæ¥å£ï¼Œå®ƒå¯ä»¥å½“ä½œé¡ºåºå®¹å™¨ï¼Œé˜Ÿåˆ—ï¼Œæ ˆã€‚ LinkedListçš„å®ç°æ–¹å¼å†³å®šäº†æ‰€æœ‰è·Ÿä¸‹è¡¨ç›¸å…³çš„æ“ä½œéƒ½æ˜¯çº¿æ€§æ—¶é—´ï¼Œè€Œåœ¨é¦–æ®µæˆ–è€…æœ«å°¾åˆ é™¤å…ƒç´ åªéœ€è¦å¸¸æ•°æ—¶é—´ã€‚ä¸ºäº†è¿½æ±‚æ•ˆç‡ï¼ŒLinkedListæ²¡æœ‰å®ç°åŒæ­¥ï¼Œå¦‚æœéœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»è¿™é‡Œäº†è§£ã€‚ æºç è§£æ åº•å±‚æ•°æ®ç»“æ„ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546transient int size = 0;/** * Pointer to first node. * Invariant: (first == null &amp;&amp; last == null) || * (first.prev == null &amp;&amp; first.item != null) */transient Node&lt;E&gt; first;/** * Pointer to last node. * Invariant: (first == null &amp;&amp; last == null) || * (last.next == null &amp;&amp; last.item != null) */transient Node&lt;E&gt; last;private static class Node&lt;E&gt; &#123; E item; Node&lt;E&gt; next; Node&lt;E&gt; prev; Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) &#123; this.item = element; this.next = next; this.prev = prev; &#125;&#125;/** * Constructs an empty list. */public LinkedList() &#123;&#125;/** * Constructs a list containing the elements of the specified * collection, in the order they are returned by the collection&#x27;s * iterator. * * @param c the collection whose elements are to be placed into this list * @throws NullPointerException if the specified collection is null */public LinkedList(Collection&lt;? extends E&gt; c) &#123; this(); addAll(c);&#125; LinkedListåº•å±‚æ˜¯åŒå‘é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç”¨å†…éƒ¨ç±»Nodeè¡¨ç¤ºã€‚é€šè¿‡firstå’Œlastå¼•ç”¨åˆ†åˆ«æŒ‡å‘é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå…ƒç´ ã€‚å½“é“¾è¡¨ä¸ºç©ºæ—¶ï¼Œfirstå’Œlastéƒ½æŒ‡å‘nullã€‚ getFirstï¼ŒgetLast è·å–ç¬¬ä¸€ä¸ªå…ƒç´ å’Œè·å–æœ€åä¸€ä¸ªå…ƒç´ ï¼š 12345678910111213141516171819202122232425/** * Returns the first element in this list. * * @return the first element in this list * @throws NoSuchElementException if this list is empty */public E getFirst() &#123; final Node&lt;E&gt; f = first; if (f == null) throw new NoSuchElementException(); return f.item;&#125;/** * Returns the last element in this list. * * @return the last element in this list * @throws NoSuchElementException if this list is empty */public E getLast() &#123; final Node&lt;E&gt; l = last; if (l == null) throw new NoSuchElementException(); return l.item;&#125; remove 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138/** * Removes and returns the first element from this list. * * @return the first element from this list * @throws NoSuchElementException if this list is empty */public E removeFirst() &#123; final Node&lt;E&gt; f = first; if (f == null) throw new NoSuchElementException(); return unlinkFirst(f);&#125;/** * Unlinks non-null first node f. */private E unlinkFirst(Node&lt;E&gt; f) &#123; // assert f == first &amp;&amp; f != null; final E element = f.item; final Node&lt;E&gt; next = f.next; f.item = null; f.next = null; // help GC first = next; if (next == null) last = null; else next.prev = null; size--; modCount++; return element;&#125;/** * Removes and returns the last element from this list. * * @return the last element from this list * @throws NoSuchElementException if this list is empty */public E removeLast() &#123; final Node&lt;E&gt; l = last; if (l == null) throw new NoSuchElementException(); return unlinkLast(l);&#125;/** * Unlinks non-null last node l. */private E unlinkLast(Node&lt;E&gt; l) &#123; // assert l == last &amp;&amp; l != null; final E element = l.item; final Node&lt;E&gt; prev = l.prev; l.item = null; l.prev = null; // help GC last = prev; if (prev == null) first = null; else prev.next = null; size--; modCount++; return element;&#125;/** * Removes the first occurrence of the specified element from this list, * if it is present. If this list does not contain the element, it is * unchanged. More formally, removes the element with the lowest index * &#123;@code i&#125; such that * &lt;tt&gt;(o==null&amp;nbsp;?&amp;nbsp;get(i)==null&amp;nbsp;:&amp;nbsp;o.equals(get(i)))&lt;/tt&gt; * (if such an element exists). Returns &#123;@code true&#125; if this list * contained the specified element (or equivalently, if this list * changed as a result of the call). * * @param o element to be removed from this list, if present * @return &#123;@code true&#125; if this list contained the specified element */public boolean remove(Object o) &#123; if (o == null) &#123; for (Node&lt;E&gt; x = first; x != null; x = x.next) &#123; if (x.item == null) &#123; unlink(x); return true; &#125; &#125; &#125; else &#123; for (Node&lt;E&gt; x = first; x != null; x = x.next) &#123; if (o.equals(x.item)) &#123; unlink(x); return true; &#125; &#125; &#125; return false;&#125;/** * Removes the element at the specified position in this list. Shifts any * subsequent elements to the left (subtracts one from their indices). * Returns the element that was removed from the list. * * @param index the index of the element to be removed * @return the element previously at the specified position * @throws IndexOutOfBoundsException &#123;@inheritDoc&#125; */public E remove(int index) &#123; checkElementIndex(index); return unlink(node(index));&#125;/** * Unlinks non-null node x. */E unlink(Node&lt;E&gt; x) &#123; // assert x != null; final E element = x.item; final Node&lt;E&gt; next = x.next; final Node&lt;E&gt; prev = x.prev; if (prev == null) &#123; first = next; &#125; else &#123; prev.next = next; x.prev = null; &#125; if (next == null) &#123; last = prev; &#125; else &#123; next.prev = prev; x.next = null; &#125; x.item = null; size--; modCount++; return element;&#125; removeæœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä¸€ä¸ªç”¨æ¥åˆ é™¤æŒ‡å®šä¸‹è¡¨çš„å…ƒç´ remove(int index)ï¼Œä¸€ä¸ªç”¨æ¥åˆ é™¤ä¸æŒ‡å®šå…ƒç´ ç›¸ç­‰çš„ç¬¬ä¸€ä¸ªå…ƒç´ remove(Object o) åˆ é™¤å…ƒç´ ï¼šæŒ‡åˆ é™¤ç¬¬ä¸€æ¬¡å‡ºç°çš„å…ƒç´ ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªå…ƒç´ ï¼Œåˆ™è¿”å›falseï¼›åˆ¤æ–­çš„ä¾æ®æ˜¯equalsæ–¹æ³•ï¼Œå¦‚æœequalsï¼Œåˆ™ç›´æ¥unlinkè¿™ä¸ªnodeï¼›ç”±äºLinkedListå¯ä»¥å­˜æ”¾nullå…ƒç´ ï¼Œæ•…è€Œä¹Ÿå¯ä»¥åˆ é™¤ç¬¬ä¸€æ¬¡å‡ºç°çš„nullå…ƒç´ ã€‚ add 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667/** * Appends the specified element to the end of this list. * * &lt;p&gt;This method is equivalent to &#123;@link #addLast&#125;. * * @param e element to be appended to this list * @return &#123;@code true&#125; (as specified by &#123;@link Collection#add&#125;) */public boolean add(E e) &#123; linkLast(e); return true;&#125;/** * Links e as last element. */void linkLast(E e) &#123; final Node&lt;E&gt; l = last; final Node&lt;E&gt; newNode = new Node&lt;&gt;(l, e, null); last = newNode; if (l == null) first = newNode; else l.next = newNode; size++; modCount++;&#125;/** * Inserts the specified element at the specified position in this list. * Shifts the element currently at that position (if any) and any * subsequent elements to the right (adds one to their indices). * * @param index index at which the specified element is to be inserted * @param element element to be inserted * @throws IndexOutOfBoundsException &#123;@inheritDoc&#125; */public void add(int index, E element) &#123; checkPositionIndex(index); if (index == size) linkLast(element); else linkBefore(element, node(index));&#125;/** * Inserts element e before non-null Node succ. */void linkBefore(E e, Node&lt;E&gt; succ) &#123; // assert succ != null; final Node&lt;E&gt; pred = succ.prev; final Node&lt;E&gt; newNode = new Node&lt;&gt;(pred, e, succ); succ.prev = newNode; if (pred == null) first = newNode; else pred.next = newNode; size++; modCount++;&#125;private void checkPositionIndex(int index) &#123; if (!isPositionIndex(index)) throw new IndexOutOfBoundsException(outOfBoundsMsg(index));&#125; add(E e)å°¾æ’æ³• add(int index,E e)åœ¨æŒ‡å®šä¸‹æ ‡ä½ç½®æ’å…¥å…ƒç´ ã€‚å½“index == sizeæ—¶ï¼Œç­‰åŒäºadd(E e)ï¼›å¦‚æœä¸æ˜¯ï¼Œåˆ™åˆ†æˆä¸¤æ­¥ï¼š1. æ ¹æ®indexæ‰¾åˆ°è¦æ’å…¥çš„ä½ç½®ï¼Œå³node(index)æ–¹æ³•ï¼›2. ä¿®æ”¹å¼•ç”¨ï¼Œå®Œæˆæ’å…¥æ“ä½œã€‚ 123456789101112131415161718/** * Returns the (non-null) Node at the specified element index. */Node&lt;E&gt; node(int index) &#123; // assert isElementIndex(index); if (index &lt; (size &gt;&gt; 1)) &#123; Node&lt;E&gt; x = first; for (int i = 0; i &lt; index; i++) x = x.next; return x; &#125; else &#123; Node&lt;E&gt; x = last; for (int i = size - 1; i &gt; index; i--) x = x.prev; return x; &#125;&#125; node(int index)æ–¹æ³•ä¸­ï¼Œé€šè¿‡index &lt; (size &gt;&gt; 1)æ¥æé«˜èŠ‚ç‚¹æŸ¥è¯¢çš„æ•ˆç‡ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O($\\frac{n}{2}$)ã€‚ addAll addAll(index, c) å®ç°æ–¹å¼å¹¶ä¸æ˜¯ç›´æ¥è°ƒç”¨add(index,e)æ¥å®ç°ï¼Œä¸»è¦æ˜¯å› ä¸ºæ•ˆç‡çš„é—®é¢˜ï¼Œå¦ä¸€ä¸ªæ˜¯fail-fastä¸­modCountåªä¼šå¢åŠ 1æ¬¡ï¼› 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768/** * Appends all of the elements in the specified collection to the end of * this list, in the order that they are returned by the specified * collection&#x27;s iterator. The behavior of this operation is undefined if * the specified collection is modified while the operation is in * progress. (Note that this will occur if the specified collection is * this list, and it&#x27;s nonempty.) * * @param c collection containing elements to be added to this list * @return &#123;@code true&#125; if this list changed as a result of the call * @throws NullPointerException if the specified collection is null */public boolean addAll(Collection&lt;? extends E&gt; c) &#123; return addAll(size, c);&#125;/** * Inserts all of the elements in the specified collection into this * list, starting at the specified position. Shifts the element * currently at that position (if any) and any subsequent elements to * the right (increases their indices). The new elements will appear * in the list in the order that they are returned by the * specified collection&#x27;s iterator. * * @param index index at which to insert the first element * from the specified collection * @param c collection containing elements to be added to this list * @return &#123;@code true&#125; if this list changed as a result of the call * @throws IndexOutOfBoundsException &#123;@inheritDoc&#125; * @throws NullPointerException if the specified collection is null */public boolean addAll(int index, Collection&lt;? extends E&gt; c) &#123; checkPositionIndex(index); Object[] a = c.toArray(); int numNew = a.length; if (numNew == 0) return false; Node&lt;E&gt; pred, succ; if (index == size) &#123; succ = null; pred = last; &#125; else &#123; succ = node(index); pred = succ.prev; &#125; for (Object o : a) &#123; @SuppressWarnings(&quot;unchecked&quot;) E e = (E) o; Node&lt;E&gt; newNode = new Node&lt;&gt;(pred, e, null); if (pred == null) first = newNode; else pred.next = newNode; pred = newNode; &#125; if (succ == null) &#123; last = pred; &#125; else &#123; pred.next = succ; succ.prev = pred; &#125; size += numNew; modCount++; return true;&#125; clear ä¸ºäº†è®©GCæ›´å¿«å¯ä»¥å›æ”¶æ”¾ç½®çš„å…ƒç´ ï¼Œéœ€è¦å°†nodeä¹‹é—´çš„å¼•ç”¨å…³ç³»èµ‹ç©ºã€‚ 1234567891011121314151617181920/** * Removes all of the elements from this list. * The list will be empty after this call returns. */public void clear() &#123; // Clearing all of the links between nodes is &quot;unnecessary&quot;, but: // - helps a generational GC if the discarded nodes inhabit // more than one generation // - is sure to free memory even if there is a reachable Iterator for (Node&lt;E&gt; x = first; x != null; ) &#123; Node&lt;E&gt; next = x.next; x.item = null; x.next = null; x.prev = null; x = next; &#125; first = last = null; size = 0; modCount++;&#125; getï¼Œset 123456789101112131415161718192021222324252627/** * Returns the element at the specified position in this list. * * @param index index of the element to return * @return the element at the specified position in this list * @throws IndexOutOfBoundsException &#123;@inheritDoc&#125; */public E get(int index) &#123; checkElementIndex(index); return node(index).item;&#125;/** * Replaces the element at the specified position in this list with the * specified element. * * @param index index of the element to replace * @param element element to be stored at the specified position * @return the element previously at the specified position * @throws IndexOutOfBoundsException &#123;@inheritDoc&#125; */public E set(int index, E element) &#123; checkElementIndex(index); Node&lt;E&gt; x = node(index); E oldVal = x.item; x.item = element; return oldVal;&#125; æŸ¥æ‰¾ æ‰¾åˆ°è¿”å›ä¸‹æ ‡ï¼Œåœ¨ã€æ²¡æ‰¾åˆ°è¿”å›-1ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657/** * Returns the index of the first occurrence of the specified element * in this list, or -1 if this list does not contain the element. * More formally, returns the lowest index &#123;@code i&#125; such that * &lt;tt&gt;(o==null&amp;nbsp;?&amp;nbsp;get(i)==null&amp;nbsp;:&amp;nbsp;o.equals(get(i)))&lt;/tt&gt;, * or -1 if there is no such index. * * @param o element to search for * @return the index of the first occurrence of the specified element in * this list, or -1 if this list does not contain the element */public int indexOf(Object o) &#123; int index = 0; if (o == null) &#123; for (Node&lt;E&gt; x = first; x != null; x = x.next) &#123; if (x.item == null) return index; index++; &#125; &#125; else &#123; for (Node&lt;E&gt; x = first; x != null; x = x.next) &#123; if (o.equals(x.item)) return index; index++; &#125; &#125; return -1;&#125;/** * Returns the index of the last occurrence of the specified element * in this list, or -1 if this list does not contain the element. * More formally, returns the highest index &#123;@code i&#125; such that * &lt;tt&gt;(o==null&amp;nbsp;?&amp;nbsp;get(i)==null&amp;nbsp;:&amp;nbsp;o.equals(get(i)))&lt;/tt&gt;, * or -1 if there is no such index. * * @param o element to search for * @return the index of the last occurrence of the specified element in * this list, or -1 if this list does not contain the element */public int lastIndexOf(Object o) &#123; int index = size; if (o == null) &#123; for (Node&lt;E&gt; x = last; x != null; x = x.prev) &#123; index--; if (x.item == null) return index; &#125; &#125; else &#123; for (Node&lt;E&gt; x = last; x != null; x = x.prev) &#123; index--; if (o.equals(x.item)) return index; &#125; &#125; return -1;&#125; Coding codeï¼šæ•°ç»„å’ŒçŸ©é˜µ 283. Move Zeroes (Easy) ç›®æ ‡ï¼šç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå°†æ•°ç»„ä¸­çš„0ï¼Œç§»åŠ¨åˆ°æ•°ç»„çš„å³è¾¹ã€‚ä¾‹å¦‚[0,1,2,0,3],æ”¹æˆ[1,2,3,0,0] 1234567891011121314public static void moveZeroes(int[] nums) &#123; // è®°å½•å½“å‰éé›¶æ•°çš„ä½ç½® int idx = 0; for (int num : nums) &#123; if (num != 0) &#123; // å…ƒç´ ä¸ä¸º0ï¼Œå°†è¯¥å…ƒç´ æ”¾åˆ°éé›¶ä½ç½®ä¸Š nums[idx++] = num; &#125; &#125; // å°†å‰©ä½™çš„å…ƒç´ å…¨éƒ¨èµ‹å€¼ä¸º0 while (idx &lt; nums.length) &#123; nums[idx++] = 0; &#125;&#125; 566. Reshape the Matrix (Easy) ç›®çš„ï¼šæ”¹å˜çŸ©é˜µçš„ç»´åº¦ï¼Œ 123456789101112131415public int[][] matrixReshape(int[][] nums, int r, int c) &#123; int m = nums.length, n = nums[0].length; if (m * n != r * c) &#123; return nums; &#125; int[][] reshapedNums = new int[r][c]; int index = 0; for (int i = 0; i &lt; r; i++) &#123; for (int j = 0; j &lt; c; j++) &#123; reshapedNums[i][j] = nums[index / n][index % n]; index++; &#125; &#125; return reshapedNums;&#125; 485. Max Consecutive Ones (Easy) ç›®çš„ï¼šæ‰¾åˆ°æ•°ç»„ä¸­æœ€é•¿è¿ç»­çš„1çš„é•¿åº¦ 12345678public int findMaxConsecutiveOnes(int[] nums) &#123; int max = 0, cur = 0; for (int x : nums) &#123; cur = x == 0 ? 0 : cur + 1; max = Math.max(max, cur); &#125; return max;&#125; codeï¼šé“¾è¡¨ å‚è€ƒ â™¥æ•°æ®ç»“æ„åŸºç¡€çŸ¥è¯†ä½“ç³»è¯¦è§£â™¥ | Java å…¨æ ˆçŸ¥è¯†ä½“ç³» (pdai.tech) javaå®ç°AVLæ ‘_javaå®ç°2-3æ ‘-CSDNåšå®¢ çº¢é»‘æ ‘(äº”)ä¹‹ Javaçš„å®ç° - å¦‚æœå¤©ç©ºä¸æ­» - åšå®¢å›­ (cnblogs.com)","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://solitaire-12.github.io/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://solitaire-12.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"author":"ç»‡ç§‹"},{"title":"Java|é›†åˆç‰¹æ€§æµ‹è¯•","slug":"Java/é›†åˆ","date":"2024-03-19T08:40:55.000Z","updated":"2024-03-19T08:47:27.895Z","comments":true,"path":"2024/03/19/Java/é›†åˆ/","permalink":"https://solitaire-12.github.io/2024/03/19/Java/%E9%9B%86%E5%90%88/","excerpt":"","text":"å°ç»“ Collection æ¥å£çš„æ¥å£ å¯¹è±¡çš„é›†åˆï¼ˆå•åˆ—é›†åˆï¼‰ List æ¥å£ï¼šå…ƒç´ æŒ‰è¿›å…¥å…ˆåæœ‰åºä¿å­˜ï¼Œå¯é‡å¤ LinkedListï¼šé“¾è¡¨ï¼Œ æ’å…¥åˆ é™¤ï¼Œ æ²¡æœ‰åŒæ­¥ï¼Œ çº¿ç¨‹ä¸å®‰å…¨ ArrayListï¼šæ•°ç»„ï¼Œ éšæœºè®¿é—®ï¼Œ æ²¡æœ‰åŒæ­¥ï¼Œ çº¿ç¨‹ä¸å®‰å…¨ Vector ï¼šæ•°ç»„ï¼Œ åŒæ­¥ï¼Œ çº¿ç¨‹å®‰å…¨ Stackï¼šæ˜¯Vectorç±»çš„å®ç°ç±» Set æ¥å£ï¼š ä»…æ¥æ”¶ä¸€æ¬¡ï¼Œä¸å¯é‡å¤ï¼Œå¹¶åšå†…éƒ¨æ’åº HashSetï¼šä½¿ç”¨hashè¡¨ï¼ˆæ•°ç»„ï¼‰å­˜å‚¨å…ƒç´  LinkedHashSetï¼šé“¾è¡¨ç»´æŠ¤å…ƒç´ çš„æ’å…¥æ¬¡åº TreeSetï¼šåº•å±‚å®ç°ä¸ºäºŒå‰æ ‘ï¼Œå…ƒç´ æ’å¥½åº Map æ¥å£ï¼šé”®å€¼å¯¹çš„é›†åˆ ï¼ˆåŒåˆ—é›†åˆï¼‰ Hashtableï¼šåŒæ­¥ï¼Œ çº¿ç¨‹å®‰å…¨ HashMapï¼šæ²¡æœ‰åŒæ­¥ï¼Œ çº¿ç¨‹ä¸å®‰å…¨ LinkedHashMapï¼šåŒå‘é“¾è¡¨å’Œå“ˆå¸Œè¡¨å®ç° WeakHashMap TreeMapï¼šçº¢é»‘æ ‘å¯¹æ‰€æœ‰çš„keyè¿›è¡Œæ’åº IdentifyHashMap 123456789101112131415161718192021222324252627282930private static &lt;T extends AbstractCollection&gt; void setInfo(T s) &#123;setInfo(s,null);&#125;private static &lt;T extends AbstractCollection&gt; void setInfo(T s, String info) &#123; String typeName = s.getClass().getTypeName().split(&quot;\\\\.&quot;)[2]; System.out.println(&quot;+======&quot; + typeName + &quot;=======================&quot;); System.out.print(&quot;| &quot; + typeName + &quot;æºæ•°æ®ï¼š&quot;); for (int i = 0; i &lt; 10; i++) &#123; Random random = new Random(); int i1 = random.nextInt(10); if (info != null &amp;&amp; !info.isEmpty()) &#123; System.out.print(info + i1 + &quot;,&quot;); s.add(info + i1); &#125; else &#123; System.out.print(i1 + &quot;,&quot;); s.add(i1); &#125; try &#123; if (i == 7)&#123; s.add(null); &#125; &#125;catch (Exception e)&#123; System.out.print(&quot;[å°è¯•å†™å…¥nullæ•°æ®,å‡ºç°å¼‚å¸¸ï¼še = &quot; + e.getClass().getTypeName().split(&quot;\\\\.&quot;)[2]+&quot;],&quot;); &#125; &#125; System.out.println(); System.out.print(&quot;| &quot; + typeName + &quot;å¤„ç†åï¼š&quot;); s.forEach(a -&gt; System.out.print(a + &quot;,&quot;)); System.out.println(); System.out.println(&quot;+========================================&quot;);&#125; List æ ¡éªŒarrayå’Œlinkedçš„åŒºåˆ« 123456789101112131415161718192021222324252627282930313233343536373839404142434445private static &lt;T extends AbstractList&gt; T setList(T t, int num) &#123; for (int i = 0; i &lt; num; i++) &#123; Random random = new Random(); int i1 = random.nextInt(10); t.add(i1); &#125; return t;&#125;private static &lt;T extends AbstractList&gt; T addOne(T t, int e) &#123; t.add(50000,e); return t;&#125;private static &lt;T extends AbstractList&gt; T removeOne(T t, int index) &#123; t.remove(index); return t;&#125;private static &lt;T extends AbstractList&gt; void getOne(T t, int index)&#123; t.get(index);&#125;private static &lt;T extends AbstractList&gt; T consume(T t, String a, int num) &#123; String typeName = t.getClass().getTypeName().split(&quot;\\\\.&quot;)[2]; if (a != null &amp;&amp; a.equals(&quot;a&quot;)) &#123; long startTime = System.currentTimeMillis(); addOne(t, num); System.out.println(typeName + &quot;:addOne:æ€»è®¡è€—æ—¶ï¼š&quot; + (System.currentTimeMillis() - startTime) + &quot;ms&quot;); &#125; if (a != null &amp;&amp; a.equals(&quot;r&quot;)) &#123; long startTime = System.currentTimeMillis(); removeOne(t, num); System.out.println(typeName + &quot;:removeOne:æ€»è®¡è€—æ—¶ï¼š&quot; + (System.currentTimeMillis() - startTime) + &quot;ms&quot;); &#125; if (a != null &amp;&amp; a.equals(&quot;g&quot;)) &#123; long startTime = System.currentTimeMillis(); getOne(t, num); System.out.println(typeName + &quot;:getOne:æ€»è®¡è€—æ—¶ï¼š&quot; + (System.currentTimeMillis() - startTime) + &quot;ms&quot;); &#125; if (a == null) &#123; long startTime = System.currentTimeMillis(); setList(t, num); System.out.println(typeName + &quot;:setList:æ€»è®¡è€—æ—¶ï¼š&quot; + (System.currentTimeMillis() - startTime) + &quot;ms&quot;); &#125; return t;&#125; 123456789101112public void testList() &#123; ArrayList&lt;Integer&gt; arrayList = new ArrayList&lt;&gt;(); ArrayList&lt;Integer&gt; list = consume(arrayList, null, 10_000_000); consume(list, &quot;a&quot;, 5); consume(list, &quot;r&quot;, 5_000); consume(list, &quot;g&quot;, 1000_000); LinkedList&lt;Integer&gt; linkedList = new LinkedList&lt;&gt;(); LinkedList&lt;Integer&gt; list1 = consume(linkedList, null, 10_000_000); consume(list1, &quot;a&quot;, 5); consume(list1, &quot;r&quot;, 5_000); consume(list1, &quot;g&quot;, 1000_000);&#125; 12345678ArrayList:setList:æ€»è®¡è€—æ—¶ï¼š629msArrayList:addOne:æ€»è®¡è€—æ—¶ï¼š4msArrayList:removeOne:æ€»è®¡è€—æ—¶ï¼š4msArrayList:getOne:æ€»è®¡è€—æ—¶ï¼š0msLinkedList:setList:æ€»è®¡è€—æ—¶ï¼š1901msLinkedList:addOne:æ€»è®¡è€—æ—¶ï¼š1msLinkedList:removeOne:æ€»è®¡è€—æ—¶ï¼š0msLinkedList:getOne:æ€»è®¡è€—æ—¶ï¼š3ms æ ¡éªŒnullå€¼ 123456public void testList1() &#123; ArrayList&lt;Integer&gt; arrayList = new ArrayList&lt;&gt;(); setInfo(arrayList); LinkedList&lt;Integer&gt; linkedList = new LinkedList&lt;&gt;(); setInfo(linkedList);&#125; 12345678+======ArrayList=======================| ArrayListæºæ•°æ®ï¼š4,5,1,1,8,9,8,2,2,8,| ArrayListå¤„ç†åï¼š4,5,1,1,8,9,8,2,null,2,8,+========================================+======LinkedList=======================| LinkedListæºæ•°æ®ï¼š7,6,4,8,0,3,5,9,4,2,| LinkedListå¤„ç†åï¼š7,6,4,8,0,3,5,9,null,4,2,+======================================== æ ¡éªŒçº¿ç¨‹å®‰å…¨é—®é¢˜ 123456789101112131415161718192021222324252627282930313233public void testSafe() &#123; ArrayList&lt;Integer&gt; arrayList = new ArrayList&lt;&gt;(); inThread(arrayList, 3, 1000); LinkedList&lt;Integer&gt; linkedList = new LinkedList&lt;&gt;(); inThread(linkedList, 3, 1000);&#125;private static &lt;T extends AbstractList&gt; void inThread(T t, int tNum, int eNum) &#123; Thread thread = new Thread(() -&gt; &#123; for (int i = 0; i &lt; tNum; i++) &#123; Thread thread1 = new Thread(() -&gt; setList(t, eNum)); thread1.start(); &#125; &#125;); thread.start(); try &#123; thread.join(); Thread.sleep(eNum); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; //System.out.println( // MessageFormat.format(&quot;åœ¨&#123;0&#125;ä¸ªçº¿ç¨‹,æ¯çº¿ç¨‹æ·»åŠ &#123;1&#125;ä¸ªå…ƒç´ çš„æƒ…å†µä¸‹,&#123;2&#125;ä¸­å…ƒç´ æ•°é‡æ˜¯:&#123;3&#125;&quot;, // tNum,eNum,t.getClass().getTypeName().split(&quot;\\\\.&quot;)[2],t.size())); System.out.println( String.format(&quot;åœ¨%1$sä¸ªçº¿ç¨‹,æ¯çº¿ç¨‹æ·»åŠ %2$sä¸ªå…ƒç´ çš„æƒ…å†µä¸‹,%3$sä¸­å…ƒç´ æ•°é‡æ˜¯:%4$s&quot;, tNum,eNum,t.getClass().getTypeName().split(&quot;\\\\.&quot;)[2],t.size()));&#125;// åœ¨3ä¸ªçº¿ç¨‹,æ¯çº¿ç¨‹æ·»åŠ 1000ä¸ªå…ƒç´ çš„æƒ…å†µä¸‹,ArrayListä¸­å…ƒç´ æ•°é‡æ˜¯:1242// åœ¨3ä¸ªçº¿ç¨‹,æ¯çº¿ç¨‹æ·»åŠ 1000ä¸ªå…ƒç´ çš„æƒ…å†µä¸‹,LinkedListä¸­å…ƒç´ æ•°é‡æ˜¯:2887 listæ€»ç»“ æ•°æ®å¯é‡å¤,å¯ä¸ºnull ArrayListå’ŒLinkedListåŒºåˆ« ä¸¤è€…éƒ½ä¸ä¿è¯çº¿ç¨‹å®‰å…¨ ArrayListæŸ¥è¯¢å¿«,å¢åˆ æ…¢LinkedListæŸ¥è¯¢æ…¢,å¢åˆ å¿« ä¸Šè¿°ä»£ç ä¸­ï¼šä¸ºä»€ä¹ˆä¸¤è€…åŒæ ·æ˜¯æ’å…¥10_000_000æ¡æ•°æ®,LinkedListè¦æ¯”ArrayListæ…¢è¿™ä¹ˆå¤šï¼Ÿ è¿™æ˜¯å› ä¸ºsetListæ–¹æ³•ä¸­ç”¨æ¥æ·»åŠ å…ƒç´ çš„æ–¹å¼æ˜¯å°¾æ’æ³•ï¼Œ å‚è€ƒå¯ä»¥äº†è§£åˆ°ï¼Œåœ¨å¤§æ•°æ®é‡çš„æƒ…å†µä¸‹ï¼ŒArrayListçš„æ‰©å®¹æœºåˆ¶åŒLinkedListçš„Nodeæœºåˆ¶è¦æ›´æœ‰ä¼˜åŠ¿ã€‚ ä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨å‘¢ï¼Ÿ ArrayListä¸å®‰å…¨çš„åŸå› ï¼š é¦–å…ˆæ˜ç¡®ArrayListæ·»åŠ å…ƒç´ çš„æ“ä½œæ˜¯åœ¨addå…ƒç´ æ—¶ï¼Œé€šè¿‡sizeä¸‹æ ‡è¿›è¡Œå†™å…¥é›†åˆï¼Œè¿™ä¸€è¿‡ç¨‹ä¸­ç”¨åˆ°äº†size++æ“ä½œï¼Œè¿™æ˜¯æ— æ³•ä¿è¯åŸå­æ€§çš„æ“ä½œï¼Œä¹Ÿå°±å¯¼è‡´ArrayListåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯èƒ½ä¼šè§¦å‘æ•°ç»„ä¸‹æ ‡è¶Šç•Œçš„é”™è¯¯ArrayIndexOutOfBoundsExceptionï¼Œæˆ–è€…sizeåŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹è¯»å–çš„é—®é¢˜ã€‚ LinkdedListä¸å®‰å…¨çš„åŸå› ï¼š é¦–å…ˆæ˜ç¡®LinkedList APIä¸­æ·»åŠ å…ƒç´ æ–¹æ³•æœ‰å¤šç§ï¼Œè¿™é‡Œå°±ç”¨linkLastæ–¹æ³•ä¸ºä¾‹ã€‚è¯¥æ–¹æ³•æ¶‰åŠå˜é‡å°¾æŒ‡é’ˆ``Node lastï¼Œä¸‹ä¸€ä¸ªæŒ‡é’ˆ Node newNodeï¼Œå¤§å°size,ä»¥åŠä¿®æ”¹æ¬¡æ•°modCountã€‚æ–¹æ³•å†…size++å’ŒmodCount++è¿™ä¸¤ä¸ªæ“ä½œæ— æ³•ä¿è¯åŸå­æ€§ï¼Œå¯¼è‡´åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå­˜åœ¨å¤šä¸ªåŒæ—¶è·å–ç›¸åŒçš„sizeå’ŒmodCount`æ•°å€¼çš„çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´å°¾æŒ‡é’ˆå‡ºç°å¼‚å¸¸æƒ…å†µã€‚ å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨å‘¢ï¼Ÿ 12Collection&lt;Integer&gt; synchronizedCollection = Collections.synchronizedCollection(new ArrayList&lt;Integer&gt;()); 1CopyOnWriteArrayList&lt;Integer&gt; copyOnWriteArrayList = new CopyOnWriteArrayList&lt;&gt;(); æ–¹å¼1ï¼šå±äºjava.util.Collectionsï¼Œé€šè¿‡synchronizedå®ç°çº¿ç¨‹å®‰å…¨ã€‚ç›´æ¥é”é›†åˆå¯¹è±¡ï¼Œæ€§èƒ½ä¸å¤ªè¡Œã€‚ 12345SynchronizedCollection(Collection&lt;E&gt; c) &#123; this.c = Objects.requireNonNull(c); mutex = this;&#125;public boolean add(E e) &#123;synchronized (mutex) &#123;return c.add(e);&#125;&#125; æ–¹å¼2ï¼šå±äºjava.util.concurrent.CopyOnWriteArrayListï¼Œè¯¸å¦‚addï¼Œremoveï¼Œsetä¸­å­˜åœ¨ç€copyOfæ“ä½œï¼Œå¯¼è‡´è¯¥apiåœ¨å¤„ç†å¤§æ•°æ®é‡çš„æ—¶å€™ï¼Œæ€§èƒ½è¡¨ç°æå·®ã€‚ä¸‹é¢æ˜¯æºç ï¼š 1234567891011121314151617181920public boolean add(E e) &#123; final ReentrantLock lock = this.lock; // åŠ é” lock.lock(); try &#123; // è·å–å½“å‰å…ƒç´ é›† Object[] elements = getArray(); // è·å–é•¿åº¦ int len = elements.length; // æ‹·è´ä¸€ä»½å®¹é‡æ¯”åŸå…ˆå¤§1 Object[] newElements = Arrays.copyOf(elements, len + 1); // å°†å…ƒç´ åŠ å…¥åˆ°æ–°å…ƒç´ é›†åˆ newElements[len] = e; // å°†æ–°å…ƒç´ é›†åˆå†™åˆ°listä¸­ setArray(newElements); return true; &#125; finally &#123; lock.unlock(); &#125;&#125; ä¸¤è€…éƒ½æ²¡æœ‰ç»§æ‰¿AbstractList Set æ ¡éªŒç‰¹æ€§ 1234567891011121314TreeSet&lt;Integer&gt; treeSet = new TreeSet&lt;&gt;();setInfo(treeSet,null);HashSet&lt;Integer&gt; hashSet = new HashSet&lt;&gt;();setInfo(hashSet, null);LinkedHashSet&lt;Integer&gt; linkedHashSet = new LinkedHashSet&lt;&gt;();setInfo(linkedHashSet,null);System.out.println(&quot;TreeSetå’ŒHashSetçš„åŒºåˆ«&quot;);TreeSet&lt;Integer&gt; treeSet2 = new TreeSet&lt;&gt;();setInfo(treeSet2, &quot;å·&quot;);HashSet&lt;Integer&gt; hashSet2 = new HashSet&lt;&gt;();setInfo(hashSet2, &quot;å·&quot;); 123456789101112131415161718192021+======TreeSet=======================| TreeSetæºæ•°æ®ï¼š6,0,8,6,6,9,6,2,[å°è¯•å†™å…¥nullæ•°æ®,å‡ºç°å¼‚å¸¸ï¼še = NullPointerException],1,3,| TreeSetå¤„ç†åï¼š0,1,2,3,6,8,9,+========================================+======HashSet=======================| HashSetæºæ•°æ®ï¼š4,0,2,5,5,7,1,7,5,5,| HashSetå¤„ç†åï¼š0,null,1,2,4,5,7,+========================================+======LinkedHashSet=======================| LinkedHashSetæºæ•°æ®ï¼š4,4,1,7,5,3,1,1,0,3,| LinkedHashSetå¤„ç†åï¼š4,1,7,5,3,null,0,+========================================TreeSetå’ŒHashSetçš„åŒºåˆ«+======TreeSet=======================| TreeSetæºæ•°æ®ï¼šå·1,å·5,å·5,å·4,å·4,å·5,å·6,å·0,[å°è¯•å†™å…¥nullæ•°æ®,å‡ºç°å¼‚å¸¸ï¼še = NullPointerException],å·7,å·0,| TreeSetå¤„ç†åï¼šå·0,å·1,å·4,å·5,å·6,å·7,+========================================+======HashSet=======================| HashSetæºæ•°æ®ï¼šå·8,å·6,å·9,å·2,å·1,å·5,å·0,å·6,å·8,å·8,| HashSetå¤„ç†åï¼šå·1,null,å·2,å·0,å·5,å·6,å·9,å·8,+======================================== æ ¡éªŒçº¿ç¨‹å®‰å…¨ 123456789101112131415161718private static &lt;T extends AbstractSet&gt; void inThread(T t, int tNum, int eNum) &#123; Thread thread = new Thread(() -&gt; &#123; for (int i = 0; i &lt; tNum; i++) &#123; Thread thread1 = new Thread(() -&gt; setSet(t, eNum)); thread1.start(); &#125; &#125;); thread.start(); try &#123; thread.join(); Thread.sleep(eNum); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println( String.format(&quot;åœ¨%1$sä¸ªçº¿ç¨‹,æ¯çº¿ç¨‹æ·»åŠ %2$sä¸ªå…ƒç´ çš„æƒ…å†µä¸‹,%3$sä¸­å…ƒç´ æ•°é‡æ˜¯:%4$s&quot;, tNum, eNum, t.getClass().getTypeName().split(&quot;\\\\.&quot;)[2], t.size()));&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475public void testSetSafe() &#123; // Testing whether a TreeSet is thread-safe TreeSet&lt;Integer&gt; treeSet = new TreeSet&lt;&gt;(); inThread(treeSet, 3, 1000); // Implementing thread-safe TreeSet Collection&lt;Integer&gt; synchronizedTreeSet = Collections.synchronizedCollection(new TreeSet&lt;Integer&gt;()); Thread thread = new Thread(() -&gt; &#123; for (int i = 0; i &lt; 3; i++) &#123; Thread thread1 = new Thread(() -&gt; &#123; for (int j = 0; j &lt; 1000; j++) &#123; synchronizedTreeSet.add(j); &#125; &#125;); thread1.start(); &#125; &#125;); thread.start(); try &#123; thread.join(); Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(&quot;synchronizedTreeSet:&quot; + synchronizedTreeSet.size()); // Testing whether a HashSet is thread-safe HashSet&lt;Integer&gt; hashSet = new HashSet&lt;&gt;(); inThread(hashSet,3,1000); // Implementing thread-safe HashSet Collection&lt;Integer&gt; synchronizedHashSet = Collections.synchronizedCollection(new HashSet&lt;&gt;()); Thread thread = new Thread(() -&gt; &#123; for (int i = 0; i &lt; 3; i++) &#123; Thread thread1 = new Thread(() -&gt; &#123; for (int j = 0; j &lt; 1000; j++) &#123; synchronizedHashSet.add(j); &#125; &#125;); thread1.start(); &#125; &#125;); thread.start(); try &#123; thread.join(); Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(&quot;synchronizedHashSet:&quot; + synchronizedHashSet.size()); // Testing whether a LinkedHashSet is thread-safe LinkedHashSet&lt;Integer&gt; linkedHashSet = new LinkedHashSet&lt;&gt;(); inThread(linkedHashSet,3,1000); // Implementing thread-safe LinkedHashSet Collection&lt;Integer&gt; synchronizedLinkedHashSet = Collections.synchronizedCollection(new LinkedHashSet&lt;&gt;()); Thread thread = new Thread(() -&gt; &#123; for (int i = 0; i &lt; 3; i++) &#123; Thread thread1 = new Thread(() -&gt; &#123; for (int j = 0; j &lt; 1000; j++) &#123; synchronizedLinkedHashSet.add(j); &#125; &#125;); thread1.start(); &#125; &#125;); thread.start(); try &#123; thread.join(); Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(&quot;synchronizedLinkedHashSet:&quot; + synchronizedLinkedHashSet.size());&#125; ç»“æœ 123456789java.lang.NullPointerExceptionåœ¨3ä¸ªçº¿ç¨‹,æ¯çº¿ç¨‹æ·»åŠ 1000ä¸ªå…ƒç´ çš„æƒ…å†µä¸‹,TreeSetä¸­å…ƒç´ æ•°é‡æ˜¯:1005synchronizedTreeSet::1000åœ¨3ä¸ªçº¿ç¨‹,æ¯çº¿ç¨‹æ·»åŠ 1000ä¸ªå…ƒç´ çš„æƒ…å†µä¸‹,HashSetä¸­å…ƒç´ æ•°é‡æ˜¯:1110synchronizedHashSet:1000åœ¨3ä¸ªçº¿ç¨‹,æ¯çº¿ç¨‹æ·»åŠ 1000ä¸ªå…ƒç´ çš„æƒ…å†µä¸‹,LinkedHashSetä¸­å…ƒç´ æ•°é‡æ˜¯:1055synchronizedLinkedHashSet:1000 setæ€»ç»“ ä¿è¯æ•°æ®æ˜¯å”¯ä¸€çš„ TreeSetï¼ŒHashSetï¼ŒLinkedHashSetä¸‰è€…çš„åŒºåˆ« TreeSetä¸èƒ½å­˜å‚¨nullæ•°æ®HashSetå’ŒLinkedHashSetå¯ä»¥å­˜å‚¨nullæ•°æ® TreeSetå¯ä»¥ä¿è¯æ•°æ®æœ‰åºHashSetå¯ä»¥ä¿è¯é‡å†™hashcodeçš„æ•°æ®ç±»å‹æœ‰åºLinkedHashSetå¯ä»¥ä¿ç•™æ’å…¥é¡ºåº TreeSetåº•å±‚æ˜¯äºŒå‰æ ‘HashSetåº•å±‚æ˜¯hashLinkedHashSetåº•å±‚æ˜¯é“¾è¡¨hash TreeSetè°ƒäº†ä¸€ä¸ªNavigableMapï¼Œå…¶æ’å…¥æ“ä½œä¼šå»è°ƒç”¨TreeMapä¸­çš„putæ–¹æ³•ã€‚å¤šçº¿ç¨‹ä¸­ï¼Œåœ¨è°ƒç”¨putæ—¶ï¼Œå¯èƒ½é‡åˆ°å¤šä¸ªçº¿ç¨‹åœ¨æ·»åŠ åŒä¸€ä¸ªå…ƒç´ çš„æƒ…å†µå‡ºç°ï¼Œè¿™ä½¿compareçš„ç»“æœä¸€è‡´ï¼Œä»è€Œè§¦å‘æ’å…¥å¤šä¸ªåŒä¸€å…ƒç´ çš„æƒ…å†µã€‚ 1234567891011private transient NavigableMap&lt;E,Object&gt; m; private static final Object PRESENT = new Object(); TreeSet(NavigableMap&lt;E,Object&gt; m) &#123; this.m = m;&#125; public TreeSet() &#123; this(new TreeMap&lt;E,Object&gt;());&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public V put(K key, V value) &#123; Entry&lt;K,V&gt; t = root; if (t == null) &#123; compare(key, key); // type (and possibly null) check root = new Entry&lt;&gt;(key, value, null); size = 1; modCount++; return null; &#125; int cmp; Entry&lt;K,V&gt; parent; // split comparator and comparable paths Comparator&lt;? super K&gt; cpr = comparator; if (cpr != null) &#123; do &#123; parent = t; cmp = cpr.compare(key, t.key); if (cmp &lt; 0) t = t.left; else if (cmp &gt; 0) t = t.right; else return t.setValue(value); &#125; while (t != null); &#125; else &#123; if (key == null) throw new NullPointerException(); @SuppressWarnings(&quot;unchecked&quot;) Comparable&lt;? super K&gt; k = (Comparable&lt;? super K&gt;) key; do &#123; parent = t; cmp = k.compareTo(t.key); if (cmp &lt; 0) t = t.left; else if (cmp &gt; 0) t = t.right; else return t.setValue(value); &#125; while (t != null); &#125; Entry&lt;K,V&gt; e = new Entry&lt;&gt;(key, value, parent); if (cmp &lt; 0) parent.left = e; else parent.right = e; fixAfterInsertion(e); size++; modCount++; return null;&#125; HashSetå†…éƒ¨è°ƒäº†ä¸ªHashMapï¼Œå…¶æ’å…¥æ“ä½œä¼šå»è°ƒç”¨HashMapä¸­çš„putæ–¹æ³•ã€‚å¤šçº¿ç¨‹ä¸­ï¼Œåœ¨è°ƒç”¨putæ—¶ï¼Œå¯èƒ½é‡åˆ°å¤šä¸ªçº¿ç¨‹åœ¨æ·»åŠ åŒä¸€ä¸ªå…ƒç´ çš„æƒ…å†µå‡ºç°ï¼Œè¿™ä½¿å¯¹æ¯”hashçš„ç»“æœä¸€è‡´ï¼Œä»è€Œè§¦å‘æ’å…¥å¤šä¸ªåŒä¸€å…ƒç´ çš„æƒ…å†µã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445public V put(K key, V value) &#123; return putVal(hash(key), key, value, false, true);&#125; final V putVal(int hash, K key, V value, boolean onlyIfAbsent,boolean evict) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; if ((p = tab[i = (n - 1) &amp; hash]) == null) tab[i] = newNode(hash, key, value, null); else &#123; Node&lt;K,V&gt; e; K k; if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; else if (p instanceof TreeNode) e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); else &#123; for (int binCount = 0; ; ++binCount) &#123; if ((e = p.next) == null) &#123; p.next = newNode(hash, key, value, null); if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st treeifyBin(tab, hash); break; &#125; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; p = e; &#125; &#125; if (e != null) &#123; // existing mapping for key V oldValue = e.value; if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); return oldValue; &#125; &#125; ++modCount; if (++size &gt; threshold) resize(); afterNodeInsertion(evict); return null;&#125; LinkedHashSetæ˜¯é“¾è¡¨ç»“æ„çš„HashSetï¼Œè°ƒçš„éƒ½æ˜¯HashMapã€‚ Map æ ¡éªŒç‰¹æ€§ Hashtable 123456789101112131415161718Hashtable&lt;Integer, Integer&gt; hashtable = new Hashtable&lt;&gt;();try &#123; hashtable.put(1,1); hashtable.put(1,2); hashtable.put(3,3); hashtable.put(4,null); hashtable.put(null,2);&#125;catch (Exception e)&#123; System.out.println(&quot;e = &quot; + e);&#125;hashtable.keySet().forEach((key)-&gt;&#123; System.out.print(&quot;key = &quot; + key); System.out.println(&quot;,value = &quot;+ hashtable.get(key));&#125;);// e = java.lang.NullPointerException// key = 3,value = 3// key = 1,value = 2 ç»“æœï¼š keyå’Œvalueéƒ½ä¸èƒ½ä¸ºç©º åŒkeyè¦†ç›– ä¸å»ºè®®ä½¿ç”¨HashTableï¼ŒOracleå®˜æ–¹ä¹Ÿå°†å…¶åºŸå¼ƒï¼Œå»ºè®®åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨ConcurrentHashMapç±»ã€‚ çº¿ç¨‹å®‰å…¨ 1234567891011121314151617181920212223242526272829Hashtable&lt;Integer, Integer&gt; hashtable = new Hashtable&lt;&gt;();inThread(hashtable,3,1000);private static &lt;T extends Dictionary&gt; void inThread(T t, int tNum, int eNum) &#123; Thread thread = new Thread(() -&gt; &#123; for (int i = 0; i &lt; tNum; i++) &#123; Thread thread1 = new Thread(() -&gt; setMap(t, eNum)); thread1.start(); &#125; &#125;); thread.start(); try &#123; thread.join(); Thread.sleep(eNum); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println( String.format(&quot;åœ¨%1$sä¸ªçº¿ç¨‹,æ¯çº¿ç¨‹æ·»åŠ %2$sä¸ªå…ƒç´ çš„æƒ…å†µä¸‹,%3$sä¸­å…ƒç´ æ•°é‡æ˜¯:%4$s&quot;, tNum, eNum, t.getClass().getTypeName().split(&quot;\\\\.&quot;)[2], t.size()));&#125;private static &lt;T extends Dictionary&gt; T setMap(T t, int num) &#123; for (int i = 0; i &lt; num; i++) &#123; t.put(i, i); &#125; return t;&#125;// åœ¨3ä¸ªçº¿ç¨‹,æ¯çº¿ç¨‹æ·»åŠ 1000ä¸ªå…ƒç´ çš„æƒ…å†µä¸‹,Hashtableä¸­å…ƒç´ æ•°é‡æ˜¯:1000 HashMap 12345678910111213141516171819202122HashMap&lt;Integer, Integer&gt; hashMap = new HashMap&lt;&gt;();try&#123; hashMap.put(1,1); hashMap.put(1,2); hashMap.put(3,3); hashMap.put(4,null); hashMap.put(null,2);&#125;catch (Exception e)&#123; System.out.println(&quot;e = &quot; + e);&#125;hashMap.keySet().forEach((key)-&gt;&#123; System.out.print(&quot;key = &quot; + key); System.out.println(&quot;,value = &quot;+ hashMap.get(key));&#125;);//key = null,value = 2//key = 1,value = 2//key = 3,value = 3//key = 4,value = nullHashMap&lt;Integer, Integer&gt; hashMap = new HashMap&lt;&gt;();inThread(hashMap,3,1000);//åœ¨3ä¸ªçº¿ç¨‹,æ¯çº¿ç¨‹æ·»åŠ 1000ä¸ªå…ƒç´ çš„æƒ…å†µä¸‹,HashMapä¸­å…ƒç´ æ•°é‡æ˜¯:1020 ç»“æœï¼š å…è®¸keyå’Œvalueä¸ºnull çº¿ç¨‹ä¸å®‰å…¨ LinkedMap 1234567891011121314151617181920212223LinkedHashMap&lt;Integer, Integer&gt; linkedHashMap = new LinkedHashMap&lt;&gt;();try&#123; linkedHashMap.put(1,1); linkedHashMap.put(1,2); linkedHashMap.put(3,3); linkedHashMap.put(4,null); linkedHashMap.put(null,2);&#125;catch (Exception e)&#123; System.out.println(&quot;e = &quot; + e);&#125;linkedHashMap.keySet().forEach(key-&gt;&#123; System.out.print(&quot;key = &quot; + key); System.out.println(&quot;,value = &quot;+ linkedHashMap.get(key));&#125;);//key = 1,value = 2//key = 3,value = 3//key = 4,value = null//key = null,value = 2LinkedHashMap&lt;Integer, Integer&gt; linkedHashMap = new LinkedHashMap&lt;&gt;();inThread(linkedHashMap,3,1000);// åœ¨3ä¸ªçº¿ç¨‹,æ¯çº¿ç¨‹æ·»åŠ 1000ä¸ªå…ƒç´ çš„æƒ…å†µä¸‹,LinkedHashMapä¸­å…ƒç´ æ•°é‡æ˜¯:1157 ç»“æœï¼š æºç ï¼Œå…¶ç»§æ‰¿è‡ªHashMap 1public class LinkedHashMap&lt;K,V&gt; extends HashMap&lt;K,V&gt; çº¿ç¨‹ä¸å®‰å…¨ TreeMap 1234567891011121314151617181920212223TreeMap&lt;Integer, Integer&gt; treeMap = new TreeMap&lt;&gt;();try &#123; treeMap.put(1, 1); treeMap.put(1, 2); treeMap.put(3, 3); treeMap.put(4, null); treeMap.put(null, 2);&#125; catch (Exception e) &#123; System.out.println(&quot;e = &quot; + e);&#125;treeMap.keySet().forEach((key) -&gt; &#123; System.out.print(&quot;key = &quot; + key); System.out.println(&quot;,value = &quot; + treeMap.get(key));&#125;);//e = java.lang.NullPointerException//key = 1,value = 2//key = 3,value = 3//key = 4,value = nullTreeMap&lt;Integer, Integer&gt; treeMap = new TreeMap&lt;&gt;();inThread(treeMap,3,1000);// NullPointerException// åœ¨3ä¸ªçº¿ç¨‹,æ¯çº¿ç¨‹æ·»åŠ 1000ä¸ªå…ƒç´ çš„æƒ…å†µä¸‹,TreeMapä¸­å…ƒç´ æ•°é‡æ˜¯:1016 ç»“æœï¼š ä¸å…è®¸keyä¸ºnullï¼Œvalueå¯ä»¥ä¸ºnull åŒkeyè¦†ç›– çº¿ç¨‹ä¸å®‰å…¨ ConcurrentHashMap 12345678910111213141516171819202122ConcurrentHashMap&lt;Integer, Integer&gt; concurrentHashMap = new ConcurrentHashMap&lt;&gt;();try &#123; concurrentHashMap.put(1, 1); concurrentHashMap.put(1, 2); concurrentHashMap.put(3, 3); concurrentHashMap.put(4, null); concurrentHashMap.put(null, 2);&#125; catch (Exception e) &#123; System.out.println(&quot;e = &quot; + e);&#125;concurrentHashMap.keySet().forEach((key) -&gt; &#123; System.out.print(&quot;key = &quot; + key); System.out.println(&quot;,value = &quot; + concurrentHashMap.get(key));&#125;);// e = java.lang.NullPointerException// key = 1,value = 2// key = 3,value = 3ConcurrentHashMap&lt;Integer, Integer&gt; concurrentHashMap = new ConcurrentHashMap&lt;&gt;();inThread(concurrentHashMap,3,1000);//åœ¨3ä¸ªçº¿ç¨‹,æ¯çº¿ç¨‹æ·»åŠ 1000ä¸ªå…ƒç´ çš„æƒ…å†µä¸‹,concurrentä¸­å…ƒç´ æ•°é‡æ˜¯:1000 ç»“æœï¼š å±äºjava.util.concurrentï¼Œä½†ç»§æ‰¿äº†AbstractMap ä¸å…è®¸keyï¼Œvalueä¸ºnull çº¿ç¨‹å®‰å…¨ æ£€éªŒçº¿ç¨‹å®‰å…¨ä»£ç  123456789101112131415161718192021222324private static &lt;T extends AbstractMap&gt; void inThread(T t, int tNum, int eNum) &#123; Thread thread = new Thread(() -&gt; &#123; for (int i = 0; i &lt; tNum; i++) &#123; Thread thread1 = new Thread(() -&gt; setMap(t, eNum)); thread1.start(); &#125; &#125;); thread.start(); try &#123; thread.join(); Thread.sleep(eNum); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println( String.format(&quot;åœ¨%1$sä¸ªçº¿ç¨‹,æ¯çº¿ç¨‹æ·»åŠ %2$sä¸ªå…ƒç´ çš„æƒ…å†µä¸‹,%3$sä¸­å…ƒç´ æ•°é‡æ˜¯:%4$s&quot;, tNum, eNum, t.getClass().getTypeName().split(&quot;\\\\.&quot;)[2], t.size()));&#125;private static &lt;T extends AbstractMap&gt; T setMap(T t, int num) &#123; for (int i = 0; i &lt; num; i++) &#123; t.put(i, i); &#125; return t;&#125; java.util.concurrent é›†åˆç±»åœ¨java.utilï¼Œä¸ºè§£å†³å¹¶å‘é—®é¢˜ï¼Œæä¾›äº†java.util.concurrentè§£å†³æ–¹æ¡ˆã€‚æ¯”å¦‚å¸¸ç”¨çš„HashMapå¹¶å‘è§£å†³æ–¹æ¡ˆçš„ConcurrentHashMapå°±åœ¨è¿™ä¸ªåŒ…ä¸‹ã€‚æ›´å¤šå†…å®¹å¤šçº¿ç¨‹-concurrentä¸­ä»‹ç»ã€‚ Collections å¯¹collectionæ“ä½œçš„å·¥å…·ç±»ã€‚ æ‘˜è¦å‡ ä¸ªå¸¸ç”¨çš„API æ–¹æ³• æè¿° sort(List&lt;T&gt; list [, Comparator&lt;? super T&gt; c]) å¯¹listè¿›è¡Œæ’åºï¼›é‡è½½ä¸€ä¸ªæ¯”è¾ƒå™¨ç‰ˆæœ¬ synchronizedCollection(Collection&lt;T&gt; c) synchronizedList(List&lt;T&gt; list)synchronizedMap(Map&lt;K,V&gt; map)synchronizedSet(Set&lt;T&gt; set) æä¾›å¹¶å‘è§£å†³æ–¹æ¡ˆ min/max (Collection&lt;T&gt; c [, Comparator&lt;? super T&gt; c]) è·å–æœ€å°/æœ€å¤§å€¼ reverse(List&lt;T&gt; list) åè½¬åˆ—è¡¨ replaceAll(List&lt;T&gt; list,T oldVal,T newVal) æ›¿æ¢åˆ—è¡¨ä¸­å…ƒç´  swap(List&lt;T&gt; list,int i,int j) åˆ—è¡¨ä¸­å…ƒç´ äº¤æ¢ä½ç½® copy(List&lt;? super T&gt; dest, List&lt;? extends T&gt; src) srcå¾€destæ‹·è´ï¼Œç¡®ä¿src.sizeæ¯”dest.sizeå°","categories":[{"name":"Java","slug":"Java","permalink":"https://solitaire-12.github.io/categories/Java/"}],"tags":[{"name":"JavaåŸºç¡€","slug":"JavaåŸºç¡€","permalink":"https://solitaire-12.github.io/tags/Java%E5%9F%BA%E7%A1%80/"}]},{"title":"Java|æ³›å‹","slug":"Java/æ³›å‹","date":"2024-03-19T08:10:55.000Z","updated":"2024-03-27T01:40:14.201Z","comments":true,"path":"2024/03/19/Java/æ³›å‹/","permalink":"https://solitaire-12.github.io/2024/03/19/Java/%E6%B3%9B%E5%9E%8B/","excerpt":"","text":"ä¸ºå•¥å¼•å…¥æ³›å‹ è¿›å…¥è¯é¢˜å‰ï¼Œå…ˆçœ‹ä¸€æ®µä»£ç ï¼š 123456private static Integer add(Integer a,Integer b)&#123; return a+b;&#125;private static Double add(Double a,Double b)&#123; return a+b;&#125; é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç»™ä¸€ä¸ªæ–¹æ³•è®¾å®šå½¢å‚æ—¶ï¼Œä¼šç›´æ¥å†™ä¸Šå½¢å‚çš„ç±»å‹ã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬çš„æ–¹æ³•ä¼ å‚ä¸ç¡®å®šç±»å‹æ—¶ï¼Œä¾‹å¦‚æ–¹æ³•addçš„å½¢å‚æ˜¯Integer,Integeræˆ–è€…æ˜¯Double,Double,è¿™æ—¶è¦æ˜¯ä¼ æ¥Integer,Doubleï¼Œä½ å¯èƒ½ä¼šå»å†™é‡è½½è¯¥æ–¹æ³•ï¼Œä½¿å…¶è¾¾åˆ°ä¸€ä¸ªæ–¹æ³•å®ç°æ¥å—å‡ ç§å‚æ•°ç±»å‹è¿™å°±å¾ˆæŠ˜ç£¨äººäº†ã€‚ä¸ºäº†è§£å†³è¿™ç§éº»çƒ¦ï¼Œå¼•å…¥æ³›å‹ã€‚ å¼•ç”¨æ³›å‹ 123private static &lt;T extends Number&gt; double addt(T a,T b)&#123; return a.doubleValue()+b.doubleValue();&#125; è¿™æ ·ï¼Œæ— è®ºè°ƒç”¨è¿™ä¼ é€’ä»€ä¹ˆæ ·çš„æ•°å­—ç±»å‹ï¼Œéƒ½å¯ä»¥è°ƒç”¨è¯¥æ–¹æ³•ï¼Œä¸ç”¨å†å»é‡è½½æ–¹æ³•äº†ã€‚ åœ¨é›†åˆä¸­ï¼ŒList&lt;String&gt;ä»£è¡¨ç€Liståªèƒ½å­˜æ”¾Stringç±»å‹ï¼Œç”¨æ¥è¡¨ç¤ºçº¦æŸã€‚ æ³›å‹çš„ä½¿ç”¨ æ³›å‹ç±» å•ä¸€æ³›å‹ç±»ï¼š 123456789101112131415161718192021222324class Hello&lt;T&gt;&#123; private T word; public T getWord() &#123; return word; &#125; public void setWord(T word) &#123; this.word = word; &#125;&#125;public class test &#123; public static void main(String[] args) &#123; Hello&lt;String&gt; hello = new Hello&lt;String&gt;(); hello.setWord(&quot;ä½ å¥½ï¼Œæ³›å‹&quot;); // ä½ å¥½ï¼Œæ³›å‹ System.out.println(hello.getWord()); Hello&lt;Integer&gt; hello1 = new Hello&lt;Integer&gt;(); hello1.setWord(12323); // 12323 System.out.println(hello1.getWord()); &#125;&#125; å¤šå…ƒæ³›å‹ç±»ï¼š 123456789101112131415161718192021222324252627282930class Notepad&lt;K,V&gt;&#123; private K key; private V value; public K getKey() &#123; return key; &#125; public void setKey(K key) &#123; this.key = key; &#125; public V getValue() &#123; return value; &#125; public void setValue(V value) &#123; this.value = value; &#125;&#125;public class test &#123; public static void main(String[] args) &#123; Notepad&lt;String, Integer&gt; notepad = new Notepad&lt;&gt;(); notepad.setKey(&quot;tom&quot;); notepad.setValue(20); System.out.println(notepad.getKey()); System.out.println(notepad.getValue()); &#125;&#125; æ³›å‹æ¥å£ 1234567891011121314151617181920212223242526interface Hello&lt;T&gt;&#123; public T getWord();&#125;class HelloImpl&lt;T&gt; implements Hello&lt;T&gt;&#123; private T word; public HelloImpl(T word) &#123; this.word = word; &#125; public void setWord(T word) &#123; this.word = word; &#125; @Override public T getWord() &#123; return this.word; &#125;&#125;public class test &#123; public static void main(String[] args) &#123; HelloImpl&lt;String&gt; hello = new HelloImpl&lt;String&gt;(&quot;ä½ å¥½,æ¥å£æ³›å‹&quot;); System.out.println(hello.getWord()); &#125;&#125; æ³›å‹æ–¹æ³• 123public &lt;T&gt; T get(T a) &#123; return a;&#125; &lt;T&gt;:å£°æ˜ä¸€ä¸ªæ³›å‹T T:å£°æ˜æ–¹æ³•çš„è¿”å›ç±»å‹æ˜¯æ³›å‹T get(T a):æ–¹æ³•çš„å½¢å‚æ˜¯ä¸€ä¸ªæ³›å‹Tçš„å˜é‡ ä¸Šè¿°ä¸­ï¼Œ1æ˜¯å¿…é¡»ç”³æ˜çš„ï¼Œ2ï¼Œ3å¯ä»¥è§†æƒ…å†µä½¿ç”¨å…¶ä¸­ä¹‹ä¸€æˆ–è€…ä¸¤è€…ä¸€èµ·ä½¿ç”¨ã€‚å‡å¦‚ä¸¤è€…éƒ½ä½¿ç”¨ï¼Œè™½ç„¶æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ–¹æ³•å´æ²¡æœ‰æ¶‰åŠ&lt;T&gt;ï¼Œå±äºæ— æ•ˆä»£ç ã€‚ å‚è€ƒï¼šæ³›å‹æœºåˆ¶è¯¦è§£](https://pdai.tech/md/java/basic/java-basic-x-generic.html)","categories":[{"name":"Java","slug":"Java","permalink":"https://solitaire-12.github.io/categories/Java/"}],"tags":[{"name":"JavaåŸºç¡€","slug":"JavaåŸºç¡€","permalink":"https://solitaire-12.github.io/tags/Java%E5%9F%BA%E7%A1%80/"}]},{"title":"ç®—æ³•|æ’åº","slug":"algorithm/sort","date":"2024-03-19T07:33:11.324Z","updated":"2024-03-19T08:13:17.393Z","comments":true,"path":"2024/03/19/algorithm/sort/","permalink":"https://solitaire-12.github.io/2024/03/19/algorithm/sort/","excerpt":"","text":"è®¤è¯†ä½è¿ç®—ç¬¦ è·å–æ•´æ•°çš„äºŒè¿›åˆ¶32ä½å­—ç¬¦ 123456public static void print(int num) &#123; for (byte i = 31; i &gt;= 0; i--) &#123; System.out.print((num &amp; (1 &lt;&lt; i)) == 0 ? &quot;0&quot; : &quot;1&quot;); &#125; System.out.println();&#125; ç»“æœï¼š 123456789101112131415byte a = 43;byte b = 120;System.out.print(&quot;a :&quot;);print(a); //a :00101011System.out.print(&quot;b :&quot;);print(b); //b :01111000System.out.print(&quot;a|b:&quot;);print(a | b); //a|b:01111011System.out.print(&quot;a&amp;b:&quot;);print(a &amp; b); //a&amp;b:00101000System.out.print(&quot;a^b:&quot;);print(a ^ b); //a^b:01010011System.out.print(&quot; ~b:&quot;);print(~b); // ~b:10000111System.out.print(&quot;135:&quot;);print(135); //135:10000111System.out.print(&quot;a :&quot;);print(a); //a :00101011System.out.print(&quot;&lt;&lt;3:&quot;);print(a&lt;&lt;3); //&lt;&lt;3:01011000System.out.print(&quot;&gt;&gt;1:&quot;);print(a&gt;&gt;1); //&gt;&gt;1:00010101System.out.print(&quot;&gt;&gt;&gt;1:&quot;);print(a&gt;&gt;&gt;1); //&gt;&gt;&gt;1:00010101System.out.println(~b); //-121print(~b&gt;&gt;7); //11111111 |ï¼šæˆ– 1234//00101011//01111000//01111011print(43 | 120); //01111011 æœ‰1ä¸º1 &amp;ï¼šä¸ 1234//00101011//01111000//00101000print(43 &amp; 120); //00101000 æœ‰0ä¸º0 ^ï¼šäº¦æˆ– 1234//00101011//01111000//01010011print(43 ^ 120); //01010011 æ— è¿›ä½ç›¸åŠ  ~ï¼šé å–å 1234//01111000//10000111print(~120); //10000111print(135); //10000111 ~120å’Œ135çš„å­—ç¬¦æ˜¯ä¸€æ ·çš„ï¼Œä¸ºä»€ä¹ˆå®ƒæ˜¯-121ä¸æ˜¯135å‘¢ï¼Ÿ é¦–å…ˆç†è§£ï¼Œbyte å  8ä½ï¼ˆ-128-127ï¼‰ï¼Œå…¶ä¸­[ç¬¦å·ä½]å ä¸€ä½ï¼Œå…¶ä½™æ•°æ®å ç”¨ å…¶æ¬¡å½“ä¸€ä¸ªæ•°æ˜¯è´Ÿæ•°çš„æ—¶å€™ï¼Œç¬¦å·ä½ä»¥åŠå…¶å·¦è¾¹çš„ä½ç½®ï¼Œå‡ä¸º1ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ-121æ˜¯//1111....110000111ï¼Œè€Œ135æ˜¯//0000.....010000111 æœ€åï¼Œ~æ“ä½œå¯ä»¥ç†è§£æˆåœ¨ä¸€æ¡ç›´çº¿ä¸Šï¼Œä»[0å’Œ-1çš„ä¸­é—´ä½ç½®]åæ–¹å‘å»æ‰¾åˆ°ç¬¬nä¸ªç‚¹ æ³¨æ„ï¼šåœ¨ç¨‹åºä¸­ï¼Œ0ç®—æ­£æ•°ã€‚åæ–‡ä¼šéªŒè¯è¿™ä¸€ç»“è®ºã€‚ &lt;&lt;ï¼šå·¦ç§» 12print(43); //00101011print(43&lt;&lt;3); //01011000 &gt;&gt;ï¼šå³ç§» 12print(43); //00101011print(43&gt;&gt;1); //00010101 &gt;&gt;&gt;ï¼šæ— ç¬¦å·å³ç§» 123print(43&gt;&gt;&gt;1); //00010101print(~120); //10000111print(~120&gt;&gt;7); //11111111 æ­£æ•°&gt;&gt;&gt; ç­‰ä»· &gt;&gt; å¸¸è§ä½¿ç”¨ åˆ¤æ–­å¥‡å¶æ€§ 1(num &amp; 1) == 1 ? &quot;å¥‡æ•°&quot; : &quot;å¶æ•°&quot; ä¸¤ä¸ªæ•°åšäº¤æ¢ 123456789a = a ^ b;b = a ^ b;a = a ^ b;// æ³¨æ„ï¼šåœ¨æ•°ç»„æ“ä½œä¸­æ—¶ï¼Œåˆ‡è®°ä¸èƒ½è¿›è¡Œç”¨ä½ç½®äº¦æˆ–ï¼Œä¸ç„¶æ•°æ®ä¼šä¸¢å¤±//å¯ä»¥ç®€åŒ–æˆa ^= b;b ^= a;a ^= b; å–ç»å¯¹å€¼ 12int b = -327int a = (b ^ (b&gt;&gt;31)) - (b&gt;&gt;31); åˆ¤æ–­ä¸¤ä¸ªæ•°æ˜¯å¦å¼‚å· 123456boolean f = ((x ^ y) &lt; 0);// åŒå·falseï¼Œå¼‚å·true// boolean f = ((0 ^ 1) &lt; 0);// System.out.println(f);// ç»“æœæ˜¯false å¤§å°å†™è½¬æ¢ 123456// (&#x27;A&#x27; | &#x27; &#x27;) = &#x27;a&#x27;// (&#x27;a&#x27; | &#x27; &#x27;) = &#x27;a&#x27;// (&#x27;A&#x27; &amp; &#x27;_&#x27;) = &#x27;A&#x27;// (&#x27;a&#x27; &amp; &#x27;_&#x27;) = &#x27;A&#x27;// (&#x27;A&#x27; ^ &#x27; &#x27;) = &#x27;a&#x27;// (&#x27;a&#x27; ^ &#x27; &#x27;) = &#x27;A&#x27; +1 12int n = 10;n = -~n; -1 12int n = 10;n = ~-n; æ’åº æ’åºåŠ¨æ€å±•ç¤ºï¼ˆå†’æ³¡æ’åºï¼Œé€‰æ‹©æ’åºï¼Œæ’å…¥æ’åºï¼Œå½’å¹¶æ’åºï¼Œå¿«é€Ÿæ’åºï¼Œè®¡æ•°æ’åºï¼ŒåŸºæ•°æ’åºï¼‰ - VisuAlgo æ‰“å° 1Arrays.stream(arr).forEach(a-&gt; System.out.print(a + &quot; &quot;)); äº¤æ¢ 12345public static void swap(int[] arr, int i, int j) &#123; int tmp = arr[j]; arr[j] = arr[i]; arr[i] = tmp;&#125; é€‰æ‹©æ’åº 12345678910111213public static void selectSort(int[] arr) &#123; if (arr == null || arr.length &lt; 2) &#123; return; &#125; int N = arr.length; for (int i = 0; i &lt; N; i++) &#123; int minValueIndex = i; for (int j = i + 1; j &lt; N; j++) &#123; minValueIndex = arr[j] &lt; arr[minValueIndex] ? j : minValueIndex; &#125; swap(arr, i, minValueIndex); &#125;&#125; å†’æ³¡æ’åº 12345678910111213public static void bubbleSort(int[] arr) &#123; if (arr == null || arr.length &lt; 2) &#123; return; &#125; int N = arr.length; for (int end = N - 1; end &gt;= 0; end--) &#123; for (int second = 1; second &lt;= end; second++) &#123; if (arr[second - 1] &gt; arr[second]) &#123; swap(arr, second - 1, second); &#125; &#125; &#125;&#125; æ’å…¥æ’åº 12345678910111213141516171819202122232425public static void insertSort1(int[] arr) &#123; if (arr == null || arr.length &lt; 2) &#123; return; &#125; int N = arr.length; for (int end = 1; end &lt; N; end++) &#123; int newNumIndex = end; while (newNumIndex - 1 &gt;= 0 &amp;&amp; arr[newNumIndex - 1] &gt; arr[newNumIndex]) &#123; swap(arr, newNumIndex - 1, newNumIndex); newNumIndex--; &#125; &#125;&#125;public static void insertSort2(int[] arr) &#123; if (arr == null || arr.length &lt; 2) &#123; return; &#125; int N = arr.length; for (int end = 1; end &lt; N; end++) &#123; for (int pre = end - 1; pre &gt;= 0 &amp;&amp; arr[pre] &gt; arr[pre + 1]; pre--) &#123; swap(arr, pre, pre + 1); &#125; &#125;&#125; å½’å¹¶æ’åº 123456789101112131415161718192021222324252627282930public static void mergeSort(int[] arr, int left, int right) &#123; if (left == right) return; //åˆ†æˆä¸¤åŠ int mid = left + (right-left)/2; //å·¦è¾¹æ’åº mergeSort(arr, left, mid); //å³è¾¹æ’åº mergeSort(arr, mid+1, right); merge(arr, left, mid+1, right);&#125;static void merge(int[] arr, int leftPtr, int rightPtr, int rightBound) &#123; int mid = rightPtr - 1; int[] temp = new int[rightBound - leftPtr + 1]; int i = leftPtr; int j = rightPtr; int k = 0; while(i &lt;= mid &amp;&amp; j &lt;= rightBound) &#123; temp[k++] = arr[i] &lt;= arr[j] ? arr[i++] : arr[j++]; &#125; while(i&lt;=mid) temp[k++] = arr[i++]; while(j&lt;=rightBound) temp[k++] = arr[j++]; for(int m=0; m&lt;temp.length; m++) arr[leftPtr +m] = temp[m];&#125; å¿«é€Ÿæ’åº 123456789101112131415161718192021222324public static void quickSort(int[] arr, int leftBound, int rightBound) &#123; if(leftBound &gt;= rightBound) return; int mid = partition(arr, leftBound, rightBound); quickSort(arr, leftBound, mid-1); quickSort(arr, mid+1, rightBound);&#125;static int partition(int[] arr, int leftBound, int rightBound) &#123; //adding the following code blocks is the random quick sort &#123; int random = leftBound + (int) (Math.random() * (rightBound - leftBound + 1)); swap(arr, random, rightBound); &#125; int pivot = arr[rightBound]; int left = leftBound; int right = rightBound - 1; while(left &lt;= right) &#123; while(left &lt;= right &amp;&amp; arr[left] &lt;= pivot) left ++; while(left &lt;= right &amp;&amp; arr[right] &gt; pivot) right --; if(left &lt; right) BaseCoding.swap(arr, left, right); &#125; BaseCoding.swap(arr, left, rightBound); return left;&#125; è®¡æ•°æ’åº 12345678910111213141516171819202122232425/** * è®¡æ•°æ’åºï¼š * éå†æºæ•°ç»„æ‰¾åˆ°æœ€å¤§å€¼ï¼Œé€šè¿‡è¿™æœ€å¤§å€¼åˆ›å»ºä¸€ä¸ªè®¡æ•°æ•°ç»„ï¼› * éå†æºæ•°ç»„ï¼Œåœ¨è®¡æ•°æ•°ç»„ï¼Œæºæ•°ç»„å€¼ä½ç½®ï¼Œ++ï¼› * éå†è®¡æ•°æ•°ç»„ï¼Œå°†æ•°å€¼å¤§äº0ä½ç½®ï¼Œä»¥æ­¤å†™å…¥æºæ•°ç»„ã€‚ * * @param arr åŸæ•°ç»„ */public static void countSort(int[] arr) &#123; if (arr == null || arr.length &lt; 2) return; int max = Integer.MIN_VALUE; for (int i = 0; i &lt; arr.length; i++) &#123; max = Math.max(max, arr[i]); &#125; int[] bucket = new int[max + 1]; for (int i = 0; i &lt; arr.length; i++) &#123; bucket[arr[i]]++; &#125; int i = 0; for (int j = 0; j &lt; bucket.length; j++) &#123; while (bucket[j]-- &gt; 0) &#123; arr[i++] = j; &#125; &#125;&#125; å †æ’åº 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950/** * å †æ’åº: * * @param arr æºæ•°ç»„ */public static void heapSort(int[] arr) &#123; if (arr == null || arr.length &lt; 2) return; // O(N*logN) // for (int i = 0; i &lt; arr.length; i++) &#123; // heapInsert(arr, i); // &#125; // O(N) for (int i = arr.length - 1; i &gt;= 0; i--) &#123; heapify(arr, i, arr.length); &#125; int heapSize = arr.length; swap(arr, 0, --heapSize); // O(N*logN) while (heapSize &gt; 0) &#123; heapify(arr, 0, heapSize); swap(arr, 0, --heapSize); &#125;&#125;private static void heapify(int[] arr, int index, int heapSize) &#123; int left = (index &lt;&lt; 1) + 1; while (left &lt; heapSize) &#123; // ä¸‹æ–¹è¿˜æœ‰å­©å­çš„æ—¶å€™ // ä¸¤ä¸ªå­©å­ä¸­ï¼Œè°çš„å€¼å¤§ï¼ŒæŠŠä¸‹æ ‡ç»™largest // 1ï¼‰åªæœ‰å·¦å­©å­ï¼Œleft -&gt; largest // 2) åŒæ—¶æœ‰å·¦å­©å­å’Œå³å­©å­ï¼Œå³å­©å­çš„å€¼&lt;= å·¦å­©å­çš„å€¼ï¼Œleft -&gt; largest // 3) åŒæ—¶æœ‰å·¦å­©å­å’Œå³å­©å­å¹¶ä¸”å³å­©å­çš„å€¼&gt; å·¦å­©å­çš„å€¼ï¼Œ right -&gt; largest int largest = left + 1 &lt; heapSize &amp;&amp; arr[left + 1] &gt; arr[left] ? left + 1 : left; // çˆ¶å’Œè¾ƒå¤§çš„å­©å­ä¹‹é—´ï¼Œè°çš„å€¼å¤§ï¼ŒæŠŠä¸‹æ ‡ç»™largest largest = arr[largest] &gt; arr[index] ? largest : index; if (largest == index) &#123; break; &#125; swap(arr, largest, index); index = largest; left = (index &lt;&lt; 1) + 1; &#125;&#125;private static void heapInsert(int[] arr, int index) &#123; while (arr[index] &gt; arr[(index - 1) / 2]) &#123; swap(arr, index, (index - 1) / 2); index = (index - 1) / 2; &#125;&#125; åŸºæ•°æ’åº 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051/** * åŸºæ•°æ’åº * @param arr */public static void radixSort(int[] arr) &#123; if (arr == null || arr.length &lt; 2) &#123; return; &#125; radixSort(arr, 0, arr.length - 1, maxbits(arr));&#125;private static int maxbits(int[] arr) &#123; int max = Integer.MIN_VALUE; for (int i = 0; i &lt; arr.length; i++) &#123; max = Math.max(max, arr[i]); &#125; int res = 0; while (max != 0) &#123; res++; max /= 10; &#125; return res;&#125;private static void radixSort(int[] arr, int L, int R, int digit) &#123; final int radix = 10; int i = 0, j = 0; int[] help = new int[R - L + 1]; for (int d = 1; d &lt;= digit; d++) &#123; int[] count = new int[radix]; // count[0..9] for (i = L; i &lt;= R; i++) &#123; j = getDigit(arr[i], d); count[j]++; &#125; for (i = 1; i &lt; radix; i++) &#123; count[i] = count[i] + count[i - 1]; &#125; for (i = R; i &gt;= L; i--) &#123; j = getDigit(arr[i], d); help[count[j] - 1] = arr[i]; count[j]--; &#125; for (i = L, j = 0; i &lt;= R; i++, j++) &#123; arr[i] = help[j]; &#125; &#125;&#125;public static int getDigit(int x, int d) &#123; return ((x / ((int) Math.pow(10, d - 1))) % 10);&#125;","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://solitaire-12.github.io/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"æ’åº","slug":"æ’åº","permalink":"https://solitaire-12.github.io/tags/%E6%8E%92%E5%BA%8F/"}],"author":"ç»‡ç§‹"},{"title":"Java|Java8","slug":"Java/Java8","date":"2024-03-18T12:14:55.000Z","updated":"2024-03-19T00:38:25.379Z","comments":true,"path":"2024/03/18/Java/Java8/","permalink":"https://solitaire-12.github.io/2024/03/18/Java/Java8/","excerpt":"","text":"java8å®æˆ˜æ±‡æ€» Lambdaè¡¨è¾¾å¼ Lambdaè¡¨è¾¾å¼æœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå‚æ•°-&gt;ä¸»ä½“ 12(parameters) -&gt; expression(parameters) -&gt;&#123; statements; &#125; 123456789() -&gt; &#123;&#125; () -&gt; &quot;Raoul&quot;() -&gt; &#123;return &quot;Mario&quot;; &#125;// returnæ˜¯ä¸€ä¸ªæ§åˆ¶æµè¯­å¥ã€‚è¦ä½¿ç”¨æ­¤Lambdaæœ‰æ•ˆï¼Œéœ€è¦ä½¿ç”¨èŠ±æ‹¬å·(Integer i) -&gt; return &quot;Alan&quot; + i; (Integer i) -&gt; &#123;return &quot;Alan&quot; + i;&#125;// â€œIron Manâ€æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä¸æ˜¯ä¸€ä¸ªè¯­å¥ã€‚è¦ä½¿æ­¤Lambdaæœ‰æ•ˆï¼Œå¯ä»¥å»é™¤èŠ±æ‹¬å·å’Œåˆ†å·(String s) -&gt; &#123;&quot;Iron Man&quot;; &#125; (String s) -&gt; &quot;Iron Man&quot;; æ¼”ç¤ºä»£ç  1 streamæµçš„æ“ä½œ â å…ƒç´ åºåˆ—â€”â€”å°±åƒé›†åˆä¸€æ ·ï¼Œæµä¹Ÿæä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œå¯ä»¥è®¿é—®ç‰¹å®šå…ƒç´ ç±»å‹çš„ä¸€ç»„æœ‰åºå€¼ã€‚å› ä¸ºé›†åˆæ˜¯æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥å®ƒçš„ä¸»è¦ç›®çš„æ˜¯ä»¥ç‰¹å®šçš„æ—¶é—´/ç©ºé—´å¤æ‚åº¦å­˜å‚¨å’Œè®¿é—®å…ƒç´ ï¼ˆå¦‚ArrayListä¸LinkedListï¼‰ã€‚ä½†æµçš„ç›®çš„åœ¨äºè¡¨è¾¾è®¡ç®—ï¼Œæ¯”å¦‚ä½ å‰é¢è§åˆ°çš„filterã€sortedå’Œmapã€‚é›†åˆè®²çš„æ˜¯æ•°æ®ï¼Œæµè®²çš„æ˜¯è®¡ç®—ã€‚åé¢å‡ èŠ‚ä¼šè¯¦ç»†è§£é‡Šè¿™ä¸ªæ€æƒ³ã€‚ â æºâ€”â€”æµä¼šä½¿ç”¨ä¸€ä¸ªæä¾›æ•°æ®çš„æºï¼Œæ¯”å¦‚é›†åˆã€æ•°ç»„æˆ–I/Oèµ„æºã€‚è¯·æ³¨æ„ï¼Œä»æœ‰åºé›†åˆç”Ÿæˆæµæ—¶ä¼šä¿ç•™åŸæœ‰çš„é¡ºåºã€‚ç”±åˆ—è¡¨ç”Ÿæˆçš„æµï¼Œå…¶å…ƒç´ é¡ºåºä¸åˆ—è¡¨ä¸€è‡´ã€‚ â æ•°æ®å¤„ç†æ“ä½œâ€”â€”æµçš„æ•°æ®å¤„ç†åŠŸèƒ½æ”¯æŒç±»ä¼¼äºæ•°æ®åº“çš„æ“ä½œï¼Œä»¥åŠå‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­çš„å¸¸ç”¨æ“ä½œï¼Œæ¯”å¦‚filterã€mapã€reduceã€findã€matchã€sortç­‰ã€‚æµæ“ä½œå¯ä»¥é¡ºåºæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥å¹¶è¡Œæ‰§è¡Œã€‚ æµæ“ä½œæœ‰ä¸¤ä¸ªé‡è¦çš„ç‰¹ç‚¹ã€‚ â æµæ°´çº¿â€”â€”å¾ˆå¤šæµæ“ä½œæœ¬èº«ä¼šè¿”å›ä¸€ä¸ªæµï¼Œè¿™æ ·å¤šä¸ªæ“ä½œå°±å¯ä»¥é“¾æ¥èµ·æ¥ï¼Œæ„æˆä¸€ä¸ªæ›´å¤§çš„æµæ°´çº¿ã€‚è¿™ä½¿å¾—ä¸€äº›ä¼˜åŒ–æˆä¸ºå¯èƒ½ï¼Œæ¯”å¦‚å¤„ç†å»¶è¿Ÿå’ŒçŸ­è·¯ã€‚æµæ°´çº¿çš„æ“ä½œå¯ä»¥çœ‹ä½œç±»ä¼¼å¯¹æ•°æ®æºè¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ã€‚ â å†…éƒ¨è¿­ä»£â€”â€”ä¸é›†åˆä½¿ç”¨è¿­ä»£å™¨è¿›è¡Œæ˜¾å¼è¿­ä»£ä¸åŒï¼Œæµçš„è¿­ä»£æ“ä½œæ˜¯åœ¨åå°è¿›è¡Œçš„ã€‚ ç¤ºä¾‹ä»£ç  12345678910List&lt;Dish&gt; menu = Arrays.asList( new Dish(&quot;pork&quot;, false, 800, Dish.Type.MEAT), new Dish(&quot;beef&quot;, false, 700, Dish.Type.MEAT), new Dish(&quot;chicken&quot;, false, 400, Dish.Type.MEAT), new Dish(&quot;french fries&quot;, true, 530, Dish.Type.OTHER), new Dish(&quot;rice&quot;, true, 350, Dish.Type.OTHER), new Dish(&quot;season fruit&quot;, true, 120, Dish.Type.OTHER), new Dish(&quot;pizza&quot;, true, 550, Dish.Type.OTHER), new Dish(&quot;prawns&quot;, false, 300, Dish.Type.FISH), new Dish(&quot;salmon&quot;, false, 450, Dish.Type.FISH) ); 1234567891011121314151617181920212223242526272829public class Dish &#123; private final String name; private final boolean vegetarian; private final int calories; private final Type type; public Dish(String name, boolean vegetarian, int calories, Type type) &#123; this.name = name; this.vegetarian = vegetarian; this.calories = calories; this.type = type; &#125; public String getName() &#123; return name; &#125; public boolean isVegetarian() &#123; return vegetarian; &#125; public int getCalories() &#123; return calories; &#125; public Type getType() &#123; return type; &#125; @Override public String toString() &#123; return name; &#125; public enum Type &#123; MEAT, FISH, OTHER &#125;&#125; åˆæ¬¡ä½¿ç”¨stream 1234567// toList()æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œéœ€è¦ import static java.util.stream.Collectors.toList;// è¦æ˜¯ä¸æƒ³å¯¼åŒ…ï¼Œå¯ä»¥æŠŠtoList() æ”¹æˆ Collectors.toList()List&lt;String&gt; collect = menu.stream().filter(dish -&gt; dish.getCalories() &gt; 300) .map(Dish::getName) .limit(3) .collect(toList());System.out.println(collect); ä¸Šè¿°ä¸­Dish::getNameç›¸å½“äºLambda d -&gt; d.getName() ç­›é€‰ï¼ˆfilterï¼‰ã€æå–ï¼ˆmapï¼‰æˆ–æˆªæ–­ï¼ˆlimitï¼‰åŠŸèƒ½ æµçš„ç‰¹æ€§ åªèƒ½éå†ä¸€é 123Stream&lt;Dish&gt; stream = menu.stream();stream.forEach(System.out::println);stream.forEach(System.out::println); å†…éƒ¨è¿­ä»£ 1234567891011121314151617// ç”¨for-eachå¾ªç¯å¤–éƒ¨è¿­ä»£ArrayList&lt;String&gt; names = new ArrayList&lt;&gt;();for (Dish dish : menu) &#123; names.add(dish.getName());&#125;/** * for-eachç»“æ„æ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œå…¶èƒŒåé€»è¾‘æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼ŒIterator */ArrayList&lt;String&gt; names = new ArrayList&lt;&gt;();Iterator&lt;Dish&gt; iterator = menu.iterator();while (iterator.hasNext())&#123; names.add(iterator.next().getName());&#125;// streamçš„å†…éƒ¨è¿­ä»£List&lt;String&gt; names = menu.stream().map(Dish::getName).collect(toList());System.out.println(names); é‡æ„æµ‹è¯• 12345678List&lt;String&gt; highCaloricDishes = new ArrayList&lt;&gt;();Iterator&lt;String&gt; iterator = menu.iterator();while(iterator.hasNext()) &#123; Dish dish = iterator.next(); if(dish.getCalories() &gt; 300) &#123; highCaloricDishes.add(d.getName()); &#125;&#125; 1234List&lt;String&gt; highCaloricDishes = menu.stream() .filter(dish -&gt; dish.getCalories() &gt; 300) .collect(toList()); æµçš„æ“ä½œ ä»ä¸Šè¿°ä»£ç ä¸­,ä¸éš¾çœ‹å‡ºï¼Œstream()ä¹‹åè·Ÿç€filterï¼Œmapï¼Œlimitï¼Œcollectç­‰æ“ä½œï¼Œè¿™æ˜¯java.util.stream.Streamä¸­çš„Streamæ¥å£å®šä¹‰çš„æ“ä½œï¼Œå®ƒä»¬å¯ä»¥åˆ†æˆä¸¤ç±»ã€‚ â ä¸­é—´æ“ä½œï¼šfilterã€mapå’Œlimitå¯ä»¥è¿æˆä¸€æ¡æµæ°´çº¿ï¼› âç»ˆç«¯æ“ä½œï¼š collectè§¦å‘æµæ°´çº¿æ‰§è¡Œå¹¶å…³é—­å®ƒã€‚ æ€»ç»“ï¼š ä¸€ä¸ªæ•°æ®æº ä¸€ä¸ªä¸­é—´æ“ä½œé“¾ï¼Œå½¢æˆæµæ°´çº¿ ä¸€ä¸ªç»ˆç«¯æ“ä½œï¼Œæ‰§è¡Œæµæ°´çº¿ï¼Œå¹¶ç”Ÿæˆç»“æœ ä¸­é—´æ“ä½œ ç±»å‹ æ“ä½œ è¿”å›ç±»å‹ æ“ä½œå‚æ•° å‡½æ•°æè¿° ä½œç”¨ filter Stream&lt;T&gt; Predicate&lt;T&gt; T -&gt; boolean ç­›é€‰ map Stream&lt;R&gt; Function&lt;T,R&gt; T -&gt; R è·å– æœ‰çŠ¶æ€-æ— ç•Œ limit Stream&lt;T&gt; æˆªé€‰ æœ‰çŠ¶æ€-æ— ç•Œ skip Stream&lt;T&gt; è·³è¿‡ æœ‰çŠ¶æ€-æ— ç•Œ sorted Stream&lt;T&gt; Comparator&lt;T&gt; (T,T) -&gt; int æœ‰çŠ¶æ€-æ— ç•Œ distinct Stream&lt;T&gt; å»é‡ ç»ˆç«¯æ“ä½œ ç±»å‹ æ“ä½œ è¿”å›ç±»å‹ ä½œç”¨ forEach void æ¶ˆè´¹æµä¸­çš„æ¯ä¸ªå…ƒç´ å¹¶å¯¹å…¶åº”ç”¨Lambda count long è¿”å›æµä¸­å…ƒç´ çš„ä¸ªæ•° collect (generic) æŠŠæµæ•´åˆæˆä¸€ä¸ªé›†åˆï¼Œæ¯”å¦‚Listï¼ŒMapï¼Œç”šè‡³æ˜¯Iterator anyMatch boolean noneMatch boolean allMatch boolean findAny Optinal&lt;T&gt; findFirst Optinal&lt;T&gt; æœ‰çŠ¶æ€-æœ‰ç•Œ reduce Optinal&lt;T&gt; ä½¿ç”¨æµ ç­›é€‰ è°“è¯ç­›é€‰ 12List&lt;Dish&gt; collect = menu.stream().filter(Dish::isVegetarian).collect(toList());System.out.println(collect); ç­›é€‰å„å¼‚çš„å…ƒç´  æµè¿˜æ”¯æŒä¸€ä¸ªå«ä½œdistinctçš„æ–¹æ³•ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªå…ƒç´ å„å¼‚ï¼ˆæ ¹æ®æµæ‰€ç”Ÿæˆå…ƒç´ çš„hashCodeå’Œequalsæ–¹æ³•å®ç°ï¼‰çš„æµã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç ä¼šç­›é€‰å‡ºåˆ—è¡¨ä¸­æ‰€æœ‰çš„å¶æ•°ï¼Œå¹¶ç¡®ä¿æ²¡æœ‰é‡å¤ï¼ˆä½¿ç”¨equalsæ–¹æ³•è¿›è¡Œæ¯”è¾ƒ) 12345List&lt;Integer&gt; numbers = Arrays.asList(1, 2, 1, 3, 3, 2, 4);numbers.stream() .filter(i -&gt; i % 2 == 0) .distinct() .forEach(System.out::println); åˆ‡ç‰‡ è°“è¯åˆ‡ç‰‡ takeWhileå’ŒdropWhileï¼Œè¿™ä¸¤ä¸ªæ˜¯java9å¼•å…¥çš„æ–°æ–¹æ³•ã€‚ å¼•å…¥åŸå› ï¼šå€˜è‹¥æ•°æ®æºå·²ç»æŒ‰ç…§çƒ­é‡ä»å°åˆ°å¤§æ’åºäº†ï¼Œè¿˜è¦ç­›é€‰å‡ºçƒ­é‡å°äº320çš„æ•°æ®ï¼Œfilterç­›é€‰ä¼šå»éå†æ‰€æœ‰æ•°æ®ï¼Œè¿™æ ·æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ã€‚æ‰€ä»¥å¼•å…¥äº†takeWhileå’ŒdropWhileã€‚ takeWhile:é€šè¿‡è°“è¯å»é€‰å–å‡ºç¬¦åˆçš„æ•°æ®ï¼Œé­é‡åˆ°ç¬¬ä¸€ä¸ªä¸ç¬¦åˆçš„å…ƒç´ æ—¶ï¼Œåœæ­¢å¤„ç† dropWhile:å’ŒtaskWhileæ˜¯ç›¸åçš„æ“ä½œï¼Œå®ƒä¼šåˆ é™¤æ‰ç¬¦åˆè¦æ±‚çš„æ•°æ® æˆªçŸ­æµ æµæ”¯æŒlimit(n)æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›å¦ä¸€ä¸ªä¸è¶…è¿‡ç»™å®šé•¿åº¦çš„æµã€‚æ‰€éœ€çš„é•¿åº¦ä½œä¸ºå‚æ•°ä¼ é€’ç»™limitã€‚å¦‚æœæµæ˜¯æœ‰åºçš„ï¼Œåˆ™æœ€å¤šä¼šè¿”å›å‰nä¸ªå…ƒç´ ã€‚ è·³è¿‡å…ƒç´  æµè¿˜æ”¯æŒskip(n)æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªæ‰”æ‰äº†å‰nä¸ªå…ƒç´ çš„æµã€‚å¦‚æœæµä¸­å…ƒç´ ä¸è¶³nä¸ªï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºæµã€‚è¯·æ³¨æ„ï¼Œlimit(n)å’Œskip(n)æ˜¯äº’è¡¥çš„ æ˜ å°„ æµæ”¯æŒmapæ–¹æ³•ï¼Œå®ƒä¼šæ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ã€‚è¿™ä¸ªå‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶å°†å…¶æ˜ å°„æˆä¸€ä¸ªæ–°çš„å…ƒç´ ï¼ˆä½¿ç”¨æ˜ å°„ä¸€è¯ï¼Œæ˜¯å› ä¸ºå®ƒå’Œè½¬æ¢ç±»ä¼¼ï¼Œä½†å…¶ä¸­çš„ç»†å¾®å·®åˆ«åœ¨äºå®ƒæ˜¯â€œåˆ›å»ºä¸€ä¸ªæ–°ç‰ˆæœ¬â€è€Œä¸æ˜¯å»â€œä¿®æ”¹â€ï¼‰ æµçš„æ‰å¹³åŒ– æ¡ˆä¾‹ å¯¹äºä¸€å¼ å•è¯è¡¨ï¼Œå¦‚ä½•è¿”å›ä¸€å¼ åˆ—è¡¨ï¼Œåˆ—å‡ºé‡Œé¢å„ä¸ç›¸åŒçš„å­—ç¬¦? ä¾‹å¦‚ï¼Œç»™å®šå•è¯åˆ—è¡¨[â€œHelloâ€,â€œWorldâ€]ï¼Œè¦è¿”å›åˆ—è¡¨[â€œHâ€, â€œeâ€, â€œlâ€, â€œoâ€, â€œWâ€, â€œrâ€, â€œdâ€] å°è¯•1ï¼šä¸è¡Œ 1234567List&lt;String&gt; words = Arrays.asList(&quot;hello&quot;, &quot;world&quot;);List&lt;String[]&gt; collect = words.stream() .map(word -&gt; word.split(&quot;&quot;)) .distinct() .collect(toList());System.out.println(&quot;words = &quot; + words); å°è¯•2ï¼šä¸è¡Œ 12345678List&lt;String&gt; words = Arrays.asList(&quot;hello&quot;, &quot;world&quot;);List&lt;Stream&lt;String&gt;&gt; collect = words.stream() .map(word -&gt; word.split(&quot;&quot;)) .map(Arrays::stream) .distinct() .collect(toList());System.out.println(&quot;words = &quot; + words); è§£é‡ŠArrays::streamï¼š 1234String[] arrayOfWords = &#123;&quot;Goodbye&quot;, &quot;World&quot;&#125;;List&lt;String&gt; streamOfwords = Arrays .stream(arrayOfWords) // è¿™æ˜¯Stream&lt;String&gt;ç±»å‹çš„ .collect(toList()); å°è¯•3ï¼šä½¿ç”¨flatMap,æˆåŠŸ flatMap 12345678List&lt;String&gt; words = Arrays.asList(&quot;hello&quot;, &quot;world&quot;);List&lt;String&gt; collect = words.stream() .map(word -&gt; word.split(&quot;&quot;)) .flatMap(Arrays::stream) .distinct() .collect(toList());System.out.println(&quot;words = &quot; + words); æŸ¥æ‰¾å’ŒåŒ¹é… å¦ä¸€ä¸ªå¸¸è§çš„æ•°æ®å¤„ç†å¥—è·¯æ˜¯çœ‹çœ‹æ•°æ®é›†ä¸­çš„æŸäº›å…ƒç´ æ˜¯å¦åŒ¹é…ä¸€ä¸ªç»™å®šçš„å±æ€§ã€‚Stream APIé€šè¿‡allMatchã€anyMatchã€noneMatchã€findFirstå’ŒfindAnyæ–¹æ³•æä¾›äº†è¿™æ ·çš„å·¥å…·ã€‚ anyMatch anyMatchæ–¹æ³•å¯ä»¥å›ç­”â€œæµä¸­æ˜¯å¦æœ‰ä¸€ä¸ªå…ƒç´ èƒ½åŒ¹é…ç»™å®šçš„è°“è¯â€ æ¯”å¦‚â†“ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥çœ‹çœ‹èœå•é‡Œé¢æ˜¯å¦æœ‰ç´ é£Ÿå¯é€‰æ‹© 1234if(menu.stream().anyMatch(Dish::isVegetarian))&#123; System.out.println(&quot;The menu is (somewhat) vegetarian friendly! ! &quot;);&#125;//anyMatchæ–¹æ³•è¿”å›ä¸€ä¸ªboolean allMatch allMatchæ–¹æ³•ä¼šçœ‹æµä¸­çš„å…ƒç´ æ˜¯å¦éƒ½èƒ½åŒ¹é…ç»™å®šçš„è°“è¯ã€‚ æ¯”å¦‚â†“ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥çœ‹çœ‹èœå“æ˜¯å¦æœ‰åˆ©å¥åº·ï¼ˆå³æ‰€æœ‰èœçš„çƒ­é‡éƒ½ä½äº1000å¡è·¯é‡Œï¼‰ï¼š 1boolean isHealthy = menu.stream().allMatch(dish -&gt; dish.getCalories() &lt; 1000); noneMatch å®ƒå¯ä»¥ç¡®ä¿æµä¸­æ²¡æœ‰ä»»ä½•å…ƒç´ ä¸ç»™å®šçš„è°“è¯åŒ¹é… æ¯”å¦‚â†“ï¼Œä½ å¯ä»¥ç”¨noneMatché‡å†™å‰é¢çš„ä¾‹å­ 1boolean isHealthy = menu.stream().noneMatch(dish -&gt; dish.getCalories() &gt;= 1000); findAny findAnyæ–¹æ³•å°†è¿”å›å½“å‰æµä¸­çš„ä»»æ„å…ƒç´ ã€‚å®ƒå¯ä»¥ä¸å…¶ä»–æµæ“ä½œç»“åˆä½¿ç”¨ æ¯”å¦‚â†“ï¼Œä½ å¯èƒ½æƒ³æ‰¾åˆ°ä¸€é“ç´ é£Ÿèœè‚´ã€‚å¯ä»¥ç»“åˆä½¿ç”¨filterå’ŒfindAnyæ–¹æ³•æ¥å®ç°è¿™ä¸ªæŸ¥è¯¢ Optional 1Optional&lt;Dish&gt; dish = menu.stream().filter(Dish::isVegetarian).findAny(); findFirst æœ‰äº›æµç”±ä¸€ä¸ªå‡ºç°é¡ºåºï¼ˆencounter orderï¼‰æ¥æŒ‡å®šæµä¸­é¡¹ç›®å‡ºç°çš„é€»è¾‘é¡ºåºï¼ˆæ¯”å¦‚ç”±Listæˆ–æ’åºå¥½çš„æ•°æ®åˆ—ç”Ÿæˆçš„æµï¼‰ã€‚å¯¹äºè¿™ç§æµï¼Œä½ å¯èƒ½æƒ³è¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ä¸ºæ­¤æœ‰ä¸€ä¸ªfindFirstæ–¹æ³•ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼ç±»ä¼¼äºfindAny 123456List&lt;Integer&gt; someNumbers = Arrays.asList(1, 2, 3, 4, 5);Optional&lt;Integer&gt; firstSquareDivisibleByThree = someNumbers.stream() .map(n -&gt; n * n) .filter(n -&gt; n % 3 == 0) .findFirst(); // 9 å½’çº¦-reduce æ­¤ç±»æŸ¥è¯¢éœ€è¦å°†æµä¸­æ‰€æœ‰å…ƒç´ åå¤ç»“åˆèµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼ï¼Œæ¯”å¦‚ä¸€ä¸ªIntegerã€‚è¿™æ ·çš„æŸ¥è¯¢å¯ä»¥è¢«å½’ç±»ä¸ºå½’çº¦æ“ä½œï¼ˆå°†æµå½’çº¦æˆä¸€ä¸ªå€¼ï¼‰ã€‚ç”¨å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€çš„æœ¯è¯­æ¥è¯´ï¼Œè¿™ç§°ä¸ºæŠ˜å ï¼ˆfoldï¼‰ï¼Œå› ä¸ºä½ å¯ä»¥å°†è¿™ä¸ªæ“ä½œçœ‹æˆæŠŠä¸€å¼ é•¿é•¿çš„çº¸ï¼ˆä½ çš„æµï¼‰åå¤æŠ˜å æˆä¸€ä¸ªå°æ–¹å—ï¼Œè€Œè¿™å°±æ˜¯æŠ˜å æ“ä½œçš„ç»“æœ æ±‚å’Œ åœ¨ç ”ç©¶å¦‚ä½•ä½¿ç”¨reduceæ–¹æ³•ä¹‹å‰ï¼Œå…ˆæ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨for-eachå¾ªç¯æ¥å¯¹æ•°å­—åˆ—è¡¨ä¸­çš„å…ƒç´ æ±‚å’Œ 1234int sum = 0;for (int x : numbers) &#123; sum += x;&#125; ä»ä¸Šè¿°ä»£ç çœ‹ï¼Œfor-eachçš„æ±‚å’Œè¿‡ç¨‹å¹¶ä¸å¤æ‚ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦å¼•å…¥reduceå‘¢ï¼Ÿ for-eachä»£ç å¤ç”¨ç‡ä½ï¼Œreduceå¯¹é‡å¤åº”ç”¨çš„æ¨¡å¼åšäº†æŠ½è±¡ 12// å¼•å…¥reduceæ±‚å’Œint sum = numbers.stream().reduce(0,(a,b)-&gt;a+b); reduceæ¥æ”¶çš„å‚æ•°ï¼š åˆå§‹å€¼ï¼Œå³å¯¹åº”for-eachä¸­çš„sum BinaryOperator&lt;T&gt;ç”¨æ¥å°†ä¸¤ä¸ªå…ƒç´ ç»“åˆèµ·æ¥äº§ç”Ÿä¸€ä¸ªæ–°çš„å€¼ã€‚ä¸Šè¿°ä»£ç ä¸­æ˜¯ä¸€ä¸ªlambdaè¡¨è¾¾å¼ (a,b)-&gt;a+b æ‰€ä»¥ï¼Œå½“æœ‰ç´¯ä¹˜çš„ä¸šåŠ¡æ—¶ï¼Œæˆ‘ä»¬å¯ä¹Ÿå†™æˆï¼š 1int product = numbers.stream().reduce(1,(a,b)-&gt;a*b); å¼•å…¥java8é™æ€æ–¹æ³•sumè¿›è¡Œæ±‚å’Œ 1int sum = numbers.stream().reduce(0,Integer::sum); æ— åˆå§‹å€¼ reduceè¿˜æœ‰ä¸€ä¸ªé‡è½½çš„å˜ä½“ï¼Œå®ƒä¸æ¥å—åˆå§‹å€¼ï¼Œä½†æ˜¯ä¼šè¿”å›ä¸€ä¸ªOptionalå¯¹è±¡ 1int sum = numbers.stream().reduce((a,b)-&gt;a+b); æœ€å¤§å€¼å’Œæœ€å°å€¼ 12Optional&lt;Integer&gt; max = numbers.stream().reduce(Integer::max);Optional&lt;Integer&gt; min = numbers.stream().reduce(Integer::min); å½’çº¦æ–¹æ³•çš„ä¼˜åŠ¿ä¸å¹¶è¡ŒåŒ– ä»for-eachå¾ªç¯æ±‚å’Œæ¥çœ‹ï¼Œè¿™ç§è¿­ä»£æ±‚å’Œæ–¹å¼ä¸€æ—¦å¹¶è¡Œï¼Œé—®é¢˜æ—¶è‡´å‘½çš„ã€‚è€Œreduceæä¾›äº†æ›´åŠ å®‰å…¨ï¼Œç®€ä¾¿çš„å®ç°æ–¹å¼ã€‚ 123// use stream to sum all elements in parallel// ä½¿ç”¨æµå¯¹æ‰€æœ‰å…ƒç´ å¹¶è¡Œæ±‚å’Œint sum = numbers.parallelStream().reduce(0,Integer::sum); åŸå§‹ç±»å‹æµç‰¹åŒ– 1int calories = menu.stream().map(Dish::getCalories).reduce(0, Integer::sum); åƒä¸Šè¿°ä»£ç ï¼Œç›´æ¥å†™æˆint calories = menu.stream().map(Dish::getCalories).sum();ä¸æ˜¯æ›´å¥½ï¼Ÿä½†è¿™å´æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºmapæ–¹æ³•ç”Ÿæˆçš„æ˜¯Stream&lt;T&gt;ç±»å‹çš„æ•°æ®ï¼Œæ²¡åŠæ³•é€šè¿‡sum()æ–¹æ³•æ¥å®ç°æ±‚å’Œï¼Œä¸è¿‡Stream APIæä¾›äº†åŸå§‹ç±»å‹æµç‰¹åŒ–ï¼Œä¸“é—¨å¤„ç†æ•°å€¼æµçš„æ–¹æ³• IntStreamã€DoubleStreamå’ŒLongStreamï¼Œåˆ†åˆ«å°†æµä¸­çš„å…ƒç´ ç‰¹åŒ–ä¸ºintã€longå’Œdoubleï¼Œä»è€Œé¿å…äº†æš—å«çš„è£…ç®±æˆæœ¬ æ˜ å°„åˆ°æ•°å€¼æµ å°†æµè½¬æ¢ä¸ºç‰¹åŒ–ç‰ˆæœ¬çš„å¸¸ç”¨æ–¹æ³•æ˜¯mapToIntã€mapToDoubleå’ŒmapToLong è¿™äº›æ–¹æ³•å’Œå‰é¢è¯´çš„mapæ–¹æ³•çš„å·¥ä½œæ–¹å¼ä¸€æ ·ï¼Œåªæ˜¯å®ƒä»¬è¿”å›çš„æ˜¯ä¸€ä¸ªç‰¹åŒ–æµï¼Œè€Œä¸æ˜¯Stream IntStreamè¿˜æ”¯æŒå…¶ä»–çš„æ–¹ä¾¿æ–¹æ³•ï¼Œå¦‚maxã€minã€averageç­‰ 1234int sum = menu.stream() //Stream&lt;Dish&gt; .mapToInt(Dish::getCalories) // IntStream .sum(); // å¦‚æœIntStreamæ˜¯ç©ºçš„è¯ï¼Œè¿”å›çš„æ˜¯0 è½¬æ¢å›å¯¹è±¡æµ åŒæ ·ï¼Œä¸€æ—¦æœ‰äº†æ•°å€¼æµï¼Œä½ å¯èƒ½ä¼šæƒ³æŠŠå®ƒè½¬æ¢å›éç‰¹åŒ–æµã€‚ä¾‹å¦‚ï¼ŒIntStreamä¸Šçš„æ“ä½œåªèƒ½äº§ç”ŸåŸå§‹æ•´æ•°ï¼šIntStreamçš„mapæ“ä½œæ¥å—çš„Lambdaå¿…é¡»æ¥å—intå¹¶è¿”å›intï¼ˆä¸€ä¸ªIntUnaryOperatorï¼‰ã€‚ä½†æ˜¯ä½ å¯èƒ½æƒ³è¦ç”Ÿæˆå¦ä¸€ç±»å€¼ï¼Œæ¯”å¦‚Dish 123IntStream intStream = menu.stream() .mapToInt(Dish::getCalories);Stream&lt;Integer&gt; stream = intStream.boxed(); é»˜è®¤å€¼OptionalInt æ±‚å’Œçš„é‚£ä¸ªä¾‹å­å¾ˆå®¹æ˜“ï¼Œå› ä¸ºå®ƒæœ‰ä¸€ä¸ªé»˜è®¤å€¼ï¼š0ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ è¦è®¡ç®—IntStreamä¸­çš„æœ€å¤§å…ƒç´ ï¼Œå°±å¾—æ¢ä¸ªæ³•å­äº†ï¼Œå› ä¸º0æ˜¯é”™è¯¯çš„ç»“æœ Optionalç±»ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯ä»¥è¡¨ç¤ºå€¼å­˜åœ¨æˆ–ä¸å­˜åœ¨çš„å®¹å™¨ã€‚Optionalå¯ä»¥ç”¨Integerã€Stringç­‰å‚è€ƒç±»å‹æ¥å‚æ•°åŒ–ã€‚å¯¹äºä¸‰ç§åŸå§‹æµç‰¹åŒ–ï¼Œä¹Ÿåˆ†åˆ«æœ‰ä¸€ä¸ªOptionalåŸå§‹ç±»å‹ç‰¹åŒ–ç‰ˆæœ¬ï¼šOptionalIntã€OptionalDoubleå’ŒOptionalLong 123456OptionalInt maxCalories = menu.stream() .mapToInt(Dish::getCalories) .max();System.out.println(&quot;maxCalories = &quot; + maxCalories);int max = maxCalories.orElse(1); æ•°å€¼èŒƒå›´ 123456789IntStream.range(1, 10) .filter(value -&gt; value % 2 == 0) .forEach(System.out::println); // â†‘ç»“æœï¼š2ï¼Œ4ï¼Œ6ï¼Œ8IntStream.rangeClosed(1, 10) .filter(value -&gt; value % 2 == 0) .forEach(System.out::println); // â†‘ç»“æœï¼š2ï¼Œ4ï¼Œ6ï¼Œ8ï¼Œ10 // æ€»ç»“rangeèŒƒå›´[x,y),rangeClosedèŒƒå›´[x,y] å°è¯•ï¼šè·å–å‹¾è‚¡æ•° 123456789101112131415161718192021Stream&lt;int[]&gt; pythagoreanTriples = IntStream.rangeClosed(1, 100).boxed() .flatMap(a -&gt; IntStream.rangeClosed(a, 100) .filter(b -&gt; Math.sqrt(a*a + b*b) % 1 == 0) .mapToObj( b -&gt; new int[]&#123;a, b, (int)Math.sqrt(a * a + b * b)&#125;) );pythagoreanTriples.limit(5).forEach(t-&gt;System.out.println(t[0]+&quot;,&quot;+ t[1] + &quot;,&quot; + t[2]));Stream&lt;double[]&gt; pythagoreanTriples = IntStream.rangeClosed(1, 100).boxed() .flatMap(a -&gt; IntStream.rangeClosed(a, 100) .mapToObj( b -&gt; new double[]&#123;a, b, Math.sqrt(a * a + b * b)&#125;) ) .filter(t -&gt; t[2] % 1 == 0);pythagoreanTriples.limit(5).forEach(t-&gt;System.out.println(t[0]+&quot;,&quot;+ t[1] + &quot;,&quot; + t[2])); Optionalç®€ä»‹ Optional&lt;T&gt;ç±»ï¼ˆjava.util.Optionalï¼‰æ˜¯ä¸€ä¸ªå®¹å™¨ç±»ï¼Œä»£è¡¨ä¸€ä¸ªå€¼å­˜åœ¨æˆ–ä¸å­˜åœ¨ã€‚ åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒfindAnyå­˜åœ¨ä»€ä¹ˆå…ƒç´ éƒ½æ²¡æœ‰æ‰¾åˆ°çš„å¯èƒ½ï¼Œæ‰€ä»¥java8å¼•å…¥äº†Optional&lt;T&gt;,ç”¨æ¥é¿å…è¿”å›nullçš„é—®é¢˜ æµ‹è¯• æµ‹è¯•1ï¼šfilter æ ¹æ®ç¤ºä¾‹ä»£ç ï¼Œç»“åˆfilterä½¿ç”¨æµç­›é€‰å‡ºå‰ä¸¤ä¸ªè¤èœ 12345List&lt;Dish&gt; collect = menu.stream() .filter(dish -&gt; dish.getType().equals(Dish.Type.MEAT)) .limit(2) .collect(toList()); æµ‹è¯•2ï¼šmap æ ¹æ®ç¤ºä¾‹ä»£ç ï¼Œç»“åˆæ˜ å°„ (1)ç»™å®šä¸€ä¸ªæ•°å­—åˆ—è¡¨ï¼Œå¦‚ä½•è¿”å›ä¸€ä¸ªç”±æ¯ä¸ªæ•°çš„å¹³æ–¹æ„æˆçš„åˆ—è¡¨å‘¢ï¼Ÿä¾‹å¦‚ï¼Œç»™å®š[1, 2, 3, 4, 5]ï¼Œåº”è¯¥è¿”å›[1, 4, 9, 16,25]ã€‚ (2) ç»™å®šä¸¤ä¸ªæ•°å­—åˆ—è¡¨ï¼Œå¦‚ä½•è¿”å›æ‰€æœ‰çš„æ•°å¯¹å‘¢ï¼Ÿä¾‹å¦‚ï¼Œç»™å®šåˆ—è¡¨[1, 2, 3]å’Œåˆ—è¡¨[3, 4]ï¼Œåº”è¯¥è¿”å›[(1, 3), (1, 4), (2, 3), (2,4), (3, 3), (3, 4)]ã€‚ä¸ºç®€å•èµ·è§ï¼Œä½ å¯ä»¥ç”¨æœ‰ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„æ¥ä»£è¡¨æ•°å¯¹ (3) å¦‚ä½•æ‰©å±•å‰ä¸€ä¸ªä¾‹å­ï¼Œåªè¿”å›æ€»å’Œèƒ½è¢«3æ•´é™¤çš„æ•°å¯¹ 12345// (1)ç»™å®šä¸€ä¸ªæ•°å­—åˆ—è¡¨ï¼Œå¦‚ä½•è¿”å›ä¸€ä¸ªç”±æ¯ä¸ªæ•°çš„å¹³æ–¹æ„æˆçš„åˆ—è¡¨å‘¢ï¼Ÿä¾‹å¦‚ï¼Œç»™å®š[1, 2, 3, 4, 5]ï¼Œåº”è¯¥è¿”å›[1, 4, 9, 16,25]ã€‚List&lt;Integer&gt; numbers = Arrays.asList(1, 2, 3, 4, 5);List&lt;Integer&gt; collect = numbers.stream().map(n -&gt; n * n) .collect(toList());System.out.println(&quot;collect = &quot; + collect); 123456789// (2)ç»™å®šä¸¤ä¸ªæ•°å­—åˆ—è¡¨ï¼Œå¦‚ä½•è¿”å›æ‰€æœ‰çš„æ•°å¯¹å‘¢ï¼Ÿä¾‹å¦‚ï¼Œç»™å®šåˆ—è¡¨[1, 2, 3]å’Œåˆ—è¡¨[3, 4]ï¼Œåº”è¯¥è¿”å›[(1, 3), (1, 4), (2, 3), (2,4), (3, 3), (3, 4)]ã€‚ä¸ºç®€å•èµ·è§ï¼Œä½ å¯ä»¥ç”¨æœ‰ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„æ¥ä»£è¡¨æ•°å¯¹List&lt;Integer&gt; numbers1 = Arrays.asList(1, 2, 3);List&lt;Integer&gt; numbers2 = Arrays.asList(3, 4);List&lt;int[]&gt; pairs = numbers1.stream() .flatMap(i -&gt; numbers2.stream() .map(j -&gt; new int[]&#123;i, j&#125;) ) .collect(toList()); 1234567891011// (3)å¦‚ä½•æ‰©å±•å‰ä¸€ä¸ªä¾‹å­ï¼Œåªè¿”å›æ€»å’Œèƒ½è¢«3æ•´é™¤çš„æ•°å¯¹List&lt;Integer&gt; numbers1 = Arrays.asList(1, 2, 3);List&lt;Integer&gt; numbers2 = Arrays.asList(3, 4);List&lt;int[]&gt; pairs = numbers1.stream() .flatMap(i -&gt; numbers2.stream() .filter(j -&gt; (i + j) % 3 == 0) .map(j -&gt; new int[]&#123;i, j&#125;) ) .collect(toList()); æµ‹è¯•3ï¼šreduce æ ¹æ®ç¤ºä¾‹ä»£ç ï¼Œç»“åˆreduceï¼Œæ•°ä¸€æ•°æµä¸­æœ‰å¤šå°‘ä¸ªèœ 1int count = menu.stream().map(d -&gt; 1).reduce(0, (a, b) -&gt; a + b); ç­‰ä»·äº 1long count = menu.stream().count(); ç»¼åˆæµ‹è¯• æºä»£ç  123456789101112Trader raoul = new Trader(&quot;Raoul&quot;, &quot;Cambridge&quot;);Trader mario = new Trader(&quot;Mario&quot;, &quot;Milan&quot;);Trader alan = new Trader(&quot;Alan&quot;, &quot;Cambridge&quot;);Trader brian = new Trader(&quot;Brian&quot;, &quot;Cambridge&quot;);List&lt;Transaction&gt; transactions = Arrays.asList( new Transaction(brian, 2011, 300), new Transaction(raoul, 2012, 1000), new Transaction(raoul, 2011, 400), new Transaction(mario, 2012, 710), new Transaction(mario, 2012, 700), new Transaction(alan, 2012, 950)); 1234567891011121314151617181920212223242526272829303132333435363738394041public class Trader&#123; private final String name; private final String city; public Trader(String n, String c)&#123; this.name = n; this.city = c; &#125; public String getName()&#123; return this.name; &#125; public String getCity()&#123; return this.city; &#125; public String toString()&#123; return &quot;Trader:&quot;+this.name + &quot; in &quot; + this.city; &#125;&#125;public class Transaction&#123; private final Trader trader; private final int year; private final int value; public Transaction(Trader trader, int year, int value)&#123; this.trader = trader; this.year = year; this.value = value; &#125; public Trader getTrader()&#123; return this.trader; &#125; public int getYear()&#123; return this.year; &#125; public int getValue()&#123; return this.value; &#125; public String toString()&#123; return &quot;&#123;&quot; + this.trader + &quot;, &quot; + &quot;year: &quot;+this.year+&quot;, &quot; + &quot;value:&quot; + this.value +&quot;&#125;&quot;; &#125;&#125; é—®é¢˜ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162// (1) æ‰¾å‡º2011å¹´å‘ç”Ÿçš„æ‰€æœ‰äº¤æ˜“ï¼Œå¹¶æŒ‰äº¤æ˜“é¢æ’åºï¼ˆä»ä½åˆ°é«˜ï¼‰ã€‚ List&lt;Transaction&gt; tr2011 = transactions.stream() .filter(transaction -&gt; transaction.getYear() == 2011) .sorted(Comparator.comparing(Transaction::getValue)) .collect(Collectors.toList()); System.out.println(&quot;tr2011 = &quot; + tr2011);// (2) äº¤æ˜“å‘˜éƒ½åœ¨å“ªäº›ä¸åŒçš„åŸå¸‚å·¥ä½œè¿‡ï¼Ÿ List&lt;String&gt; cities = transactions.stream() .map(transaction -&gt; transaction.getTrader().getCity()) .distinct() .collect(Collectors.toList());// Set&lt;String&gt; cities = transactions.stream()// .map(transaction -&gt; transaction.getTrader().getCity())// .collect(Collectors.toSet());// System.out.println(&quot;cities = &quot; + cities); System.out.println(&quot;cities = &quot; + cities);// (3) æŸ¥æ‰¾æ‰€æœ‰æ¥è‡ªäºå‰‘æ¡¥çš„äº¤æ˜“å‘˜ï¼Œå¹¶æŒ‰å§“åæ’åºã€‚ List&lt;Trader&gt; cambridgeTrader = transactions.stream() .map(Transaction::getTrader) .filter(trader -&gt; trader.getCity().equals(&quot;Cambridge&quot;)) .distinct() .sorted(Comparator.comparing(Trader::getName)) .collect(Collectors.toList()); System.out.println(&quot;cambridgeTrader = &quot; + cambridgeTrader);// (4) è¿”å›æ‰€æœ‰äº¤æ˜“å‘˜çš„å§“åå­—ç¬¦ä¸²ï¼ŒæŒ‰å­—æ¯é¡ºåºæ’åºã€‚// String reduce = transactions.stream()// .map(transaction -&gt; transaction.getTrader().getName())// .distinct()// .sorted()// .reduce(&quot;&quot;, (n1, n2) -&gt; n1 + n2); String reduce = transactions.stream() .map(transaction -&gt; transaction.getTrader().getName()) .distinct() .sorted() .collect(Collectors.joining()); System.out.println(&quot;reduce = &quot; + reduce);// (5) æœ‰æ²¡æœ‰äº¤æ˜“å‘˜æ˜¯åœ¨ç±³å…°å·¥ä½œçš„ï¼Ÿ boolean anyOneInMilan = transactions.stream() .anyMatch(transaction -&gt; transaction.getTrader().getCity().equals(&quot;Milan&quot;)); System.out.println(&quot;anyOneInMilan = &quot; + anyOneInMilan);// (6) æ‰“å°ç”Ÿæ´»åœ¨å‰‘æ¡¥çš„äº¤æ˜“å‘˜çš„æ‰€æœ‰äº¤æ˜“é¢ã€‚ transactions.stream() .filter(transaction -&gt; transaction.getTrader().getCity().equals(&quot;Cambridge&quot;)) .map(Transaction::getValue) .forEach(System.out::println);// (7) æ‰€æœ‰äº¤æ˜“ä¸­ï¼Œæœ€é«˜çš„äº¤æ˜“é¢æ˜¯å¤šå°‘ï¼Ÿ Optional&lt;Integer&gt; max = transactions.stream() .map(Transaction::getValue) .reduce(Integer::max); Optional&lt;Transaction&gt; max1 = transactions.stream().max(Comparator.comparing(Transaction::getValue)); System.out.println(&quot;max = &quot; + max); System.out.println(&quot;max1 = &quot; + max1);// (8) æ‰¾åˆ°äº¤æ˜“é¢æœ€å°çš„äº¤æ˜“ã€‚ Optional&lt;Integer&gt; min = transactions.stream() .map(Transaction::getValue) .reduce(Integer::min); Optional&lt;Transaction&gt; min1 = transactions.stream().min(Comparator.comparing(Transaction::getValue)); System.out.println(&quot;min = &quot; + min); System.out.println(&quot;min1 = &quot; + min1); æµ‹è¯•æ ‘å½¢æ•°æ® 1234567891011121314151617181920212223242526272829303132333435public static void main(String[] args) &#123; ArrayList&lt;Zz&gt; source = new ArrayList&lt;&gt;(); for (int i = 1; i &lt; 10; i++) &#123; Zz z1 = new Zz(); z1.setId(Long.valueOf(i)); int i1 = i % 3 == 2 ? i - 1 : 0; z1.setPid(Long.valueOf(i1)); source.add(z1); &#125; System.out.println(source); List&lt;Zz&gt; tree = source.stream() .filter(item -&gt; item.getPid().equals(0)) .map(item -&gt; &#123; List&lt;Zz&gt; children = new ArrayList&lt;&gt;(); item.setChildren(children); getChildren(children, item.getId(), source); return item; &#125;) .collect(Collectors.toList()); System.out.println(tree);&#125;private static void getChildren(List&lt;Zz&gt; children, Long id, ArrayList&lt;Zz&gt; source) &#123; source.stream() .filter(item -&gt; item.getPid().equals(id)) .map(item -&gt; &#123; children.add(item); List&lt;Zz&gt; child = new ArrayList&lt;&gt;(); item.setChildren(child); getChildren(children, item.getId(), source); return item; &#125;) .collect(Collectors.toList());&#125; å‡½æ•°å¼ç¼–ç¨‹Function å¾…ç»­","categories":[{"name":"Java","slug":"Java","permalink":"https://solitaire-12.github.io/categories/Java/"}],"tags":[{"name":"Java8","slug":"Java8","permalink":"https://solitaire-12.github.io/tags/Java8/"}]},{"title":"Java|JVM","slug":"Java/JVM","date":"2024-03-18T12:10:55.000Z","updated":"2024-03-19T00:38:37.182Z","comments":true,"path":"2024/03/18/Java/JVM/","permalink":"https://solitaire-12.github.io/2024/03/18/Java/JVM/","excerpt":"","text":"ç±»åŠ è½½ åŠ è½½è¿‡ç¨‹ å°†javaæ–‡ä»¶ç¼–è¯‘æˆclasså­—èŠ‚ç æ–‡ä»¶ï¼Œé€šè¿‡ç±»åŠ è½½å™¨å†™å…¥åˆ°JVMè™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºä¸­ã€‚ ç±»åŠ è½½æµç¨‹ â€‹ ç±»åŠ è½½éœ€è¦ç»å†äº”ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯åŠ è½½ï¼ŒéªŒè¯ï¼Œå‡†å¤‡ï¼Œè§£æï¼Œåˆå§‹åŒ–ã€‚å…¶ä¸­åŠ è½½ï¼ŒéªŒè¯ï¼Œå‡†å¤‡ï¼Œåˆå§‹åŒ–è¿™å››ä¸ªé˜¶æ®µå‘ç”Ÿçš„é¡ºåºæ—¶ç¡®å®šçš„ï¼Œè€Œè§£æé˜¶æ®µæ—¶ä¸ä¸€å®šçš„ã€‚å®ƒåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥åœ¨åˆå§‹åŒ–é˜¶æ®µä¹‹åå¼€å§‹ï¼Œè¿™æ˜¯ä¸ºäº†æ”¯æŒjavaçš„è¿è¡Œæ—¶ç»‘å®šï¼ˆä¹Ÿç§°åšåŠ¨æ€ç»‘å®šï¼‰ã€‚å¦å¤–ï¼Œè¿™äº›é˜¶æ®µéƒ½æ˜¯æŒ‰é¡ºåºå¼€å§‹ï¼Œè€ŒéæŒ‰é¡ºåºè¿›è¡Œæˆ–è€…å®Œæˆã€‚ ç±»åŠ è½½å™¨ åŒäº²å§”æ´¾æœºåˆ¶ï¼š â€‹ å½“æŸä¸ªç±»åŠ è½½å™¨éœ€è¦åŠ è½½æŸä¸ªclassæ–‡ä»¶æ—¶ï¼Œå®ƒé¦–å…ˆä¼šæŠŠè¿™ä¸ªä»»åŠ¡å§”æ´¾ç»™å®ƒçš„çˆ¶çº§åŠ è½½å™¨ï¼Œé€’å½’åˆ°é¡¶çº§åŠ è½½å™¨ã€‚éšåè¿›è¡ŒåŠ è½½ï¼Œå€˜è‹¥åŠ è½½å¤±è´¥ï¼Œç”±å­ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ã€‚å¯ä»¥ä¿è¯åŒä¸€ä¸ªclassåªè¢«åŠ è½½ä¸€æ¬¡ã€‚ è¿è¡Œæ—¶æ•°æ®åŒº ç»¿è‰²çº¿ç¨‹å…±äº«ï¼Œè“è‰²çº¿ç¨‹ç§æœ‰ JDK6ï¼šæœ‰æ°¸ä¹…ä»£ï¼Œé™æ€å˜é‡å­˜æ”¾åœ¨æ°¸ä¹…ä»£ä¸Š JDK7ï¼šæœ‰æ°¸ä¹…ä»£ï¼Œä½†æ˜¯å·²ç»æŠŠè¿è¡Œæ—¶å¸¸é‡æ± ï¼Œå¸¸é‡æ± å­˜æ”¾åœ¨æ–¹æ³•åŒºä¸­äº†ï¼Œé€æ¸çš„å‡å°‘æ°¸ä¹…ä»£çš„ä½¿ç”¨ã€‚ JDK8ï¼šæ— æ°¸ä¹…ä»£ï¼Œè¿è¡Œæ˜¯å¸¸é‡æ± ã€ç±»å¸¸é‡æ± éƒ½ä¿å­˜åœ¨å…ƒæ•°æ®åŒºï¼Œä¹Ÿå°±æ˜¯å…ƒç©ºé—´ ã€‚ä½†æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä»»ç„¶æ”¾åœ¨å †ä¸Šã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå…ƒç©ºé—´å ç”¨çš„æ˜¯æœ¬åœ°å†…å­˜ã€‚ å†…å­˜æ¨¡å‹ ç¨‹åºè®¡æ•°å™¨ çº¿ç¨‹ç§æœ‰ã€‚Javaè™šæ‹Ÿæœºæ‰§è¡Œå¤šçº¿ç¨‹æ—¶ï¼Œç”±äºCPUæ—¶é—´ç‰‡é™åˆ¶ï¼Œçº¿ç¨‹æ‰§è¡Œå…·æœ‰éšæœºæ€§ï¼Œæ“ä½œç³»ç»Ÿä¼šä¸€ç›´åˆ‡æ¢æ‰§è¡Œä¸åŒæŒ‡ä»¤ï¼Œæˆ‘ä»¬éœ€è¦æŠŠåˆ‡æ¢æ—¶å€™çº¿ç¨‹æ‰§è¡Œçš„ä½ç½®å­˜å…¥åˆ°PCå¯„å­˜å™¨ä¸­ï¼Œç­‰åˆ‡å›æ¥çš„æ—¶å€™èƒ½å¤Ÿå›åˆ°åŸæ¥çš„ä½ç½®ç»§ç»­æ‰§è¡Œã€‚ ä»»ä½•æ—¶å€™ï¼Œæ¯ä¸ªJavaè™šæ‹Ÿæœºéƒ½åœ¨æ‰§è¡Œå•ä¸ªæ–¹æ³•çš„ä»£ç ï¼Œå³è¯¥çº¿ç¨‹çš„å½“å‰æ–¹æ³•ã€‚å¦‚æœè¯¥æ–¹æ³•ä¸æ˜¯Nativeæ–¹æ³•ï¼Œå³PCå¯„å­˜å™¨ä¼šè®°å½•å½“å‰æ­£åœ¨æ‰§è¡Œçš„javaè™šæ‹ŸæœºæŒ‡ä»¤çš„åœ°å€ï¼Œå¦‚æœçº¿ç¨‹å½“å‰æ‰§è¡Œçš„æ–¹æ³•æ˜¯æœ¬åœ°çš„ï¼Œé‚£ä¹ˆjavaè™šæ‹Ÿæœºçš„PCå¯„å­˜å™¨çš„å€¼å°±æ˜¯Undefinedã€‚ ç¨‹åºè®¡æ•°å™¨æ˜¯å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºç°OOMçš„åŒºåŸŸã€‚ æœ¬åœ°æ–¹æ³•æ ˆ çº¿ç¨‹ç§æœ‰ã€‚æä¾›è™šæ‹Ÿæœºä½¿ç”¨åˆ°æœ¬åœ°Nativeæ–¹æ³•ï¼Œæœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆåœ¨æœ‰çš„è™šæ‹Ÿæœºæ˜¯åˆåœ¨ä¸€èµ·çš„ï¼Œä¾‹å¦‚Hot Spotè™šæ‹Ÿæœºã€‚ æ ˆ çº¿ç¨‹ç§æœ‰ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªä¸çº¿ç¨‹åŒæ—¶åˆ›å»ºçš„ç§æœ‰çš„è™šæ‹Ÿæœºæ ˆã€‚è™šæ‹Ÿæœºæ ˆä¸­å­˜å‚¨æ ˆå¸§ï¼Œæ¯ä¸ªè¢«çº¿ç¨‹è°ƒç”¨çš„æ–¹æ³•éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ ˆå¸§ï¼Œæ ˆå¸§ä¸­ä¿å­˜ä¸€ä¸ªæ–¹æ³•çš„çŠ¶æ€ä¿¡æ¯ï¼Œä¾‹å¦‚å±€éƒ¨å˜é‡(å­˜å‚¨æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡)ã€æ“ä½œæ•°å¸§(ç”¨æ¥è®¡ç®—ä¸´æ—¶å­˜æ”¾å˜é‡)ã€æ–¹æ³•å‡ºå£(è®°å½•å“ªä¸ªæ–¹æ³•çš„æœ¬æ–¹æ³•)ã€åŠ¨æ€é“¾æ¥(å­˜æ”¾æ–¹æ³•çš„å…ƒä¿¡æ¯)ç­‰ã€‚è°ƒç”¨ä¸€ä¸ªæ–¹æ³•å°±æ˜¯æ‰§è¡Œä¸€ä¸ªæ ˆå¸§çš„è¿‡ç¨‹ï¼Œä¸€ä¸ªæ–¹æ³•è°ƒç”¨å®Œæˆï¼Œå¯¹åº”çš„æ ˆå¸§å°±ä¼šå‡ºæ ˆã€‚ å¦‚æœçº¿ç¨‹æ‰§è¡Œæ‰€éœ€æ ˆæ·±åº¦å¤§äºJavaè™šæ‹Ÿæœºæ ˆæ·±åº¦ï¼Œå°±ä¼šæŠ›å‡ºStackOverFlowErrorï¼Œå…¶å®æ–¹æ³•è°ƒç”¨çš„è¿‡ç¨‹å°±æ˜¯å…¥æ ˆå’Œå‡ºæ ˆçš„è¿‡ç¨‹ï¼Œå¦‚æœä¸€è‡´å…¥æ ˆä¸å‡ºæ ˆï¼Œå°±å®¹æ˜“å‘ç”Ÿå¼‚å¸¸ï¼ˆé€’å½’è°ƒç”¨ï¼‰ å¦‚æœJavaè™šæ‹Ÿæœºæ ˆå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œä½†æ˜¯æ‰©å±•å¤§å°çš„æ—¶å€™æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œåˆ™ä¼šæŠ›å‡ºOutOfMemoryErrorã€‚ å † çº¿ç¨‹å…±äº«ã€‚å †æ˜¯javaè™šæ‹Ÿæœºç®¡ç†å†…å­˜æœ€å¤§çš„ä¸€å—ï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºï¼Œæ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œå †ä¸­çš„å¯¹è±¡æ°¸è¿œä¸ä¼šè¢«æ˜¾å¼é‡Šæ”¾ï¼Œå¿…é¡»ç”±GCå›æ”¶ï¼Œæ‰€ä»¥GCä¹Ÿä¸»è¦å›æ”¶å †ä¸­çš„å¯¹è±¡å®ä¾‹ï¼Œæˆ‘ä»¬å¹³å¸¸è®¨è®ºçš„åƒåœ¾å›æ”¶å°±æ˜¯å›æ”¶å †å†…å­˜ã€‚å †å¯ä»¥å¤„äºç‰©ç†ä¸Šä¸è¿ç»­çš„ç©ºé—´ï¼Œå¯ä»¥å›ºå®šå¤§å°ï¼Œä¹Ÿå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œé€šè¿‡å‚æ•°-Xmså’Œ-Xmxä¸¤ä¸ªå‚æ•°æ§åˆ¶å †çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ã€‚è¿™é‡Œæ˜¯**OOMå¼‚å¸¸çš„æ˜“å‘åŒº** åˆ†æˆæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚ æ–°ç”Ÿä»£åˆåˆ†æˆ1ä¸ªEdenåŒºå’Œ2ä¸ªSurvivoråŒºï¼Œé»˜è®¤æ¯”ä¾‹8:1:1 ç»å¤§å¤šæ•°å¯¹è±¡åœ¨EdenåŒºç”Ÿæˆï¼Œ**å½“EdenåŒºå¡«æ»¡ï¼Œæˆ–è€…ä¸æ»¡è¶³æ–°å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œè§¦å‘Young GCã€‚**å°†å­˜æ´»çš„å¯¹è±¡æ”¾è¿›Survivorã€‚Survivoråˆ†æˆä¸¤å—ï¼Œç”¨äºæ¯æ¬¡Young GCæ—¶ï¼Œå°†å­˜æ´»çš„å¯¹è±¡ç»Ÿç»Ÿå¤åˆ¶è¿›ç©ºçš„å¹¸å­˜åŒºï¼Œå°†æœ‰æ•°æ®çš„é‚£å—æ¸…ç©ºã€‚ å½“ä¸€ä¸ªå¯¹è±¡åœ¨ä¸¤ä¸ªsurvivoråŒºä¹‹é—´äº¤æ¢äº†ä¸€å®šæ¬¡æ•°ä¹‹åï¼Œå°†å¯¹è±¡æ‹·è´åˆ°è€å¹´ä»£ã€‚è¿™ä¸ªæ•°é‡ç”¨-XX:MaxTenuringThresholdé…ç½®ï¼Œé»˜è®¤å€¼æ˜¯15 æ–¹æ³•åŒº çº¿ç¨‹å…±äº«ï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºï¼Œå­˜å‚¨å·²ç»è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ï¼Œå³ç»ç¼–è¯‘å™¨ä¹‹åçš„æ•°æ®(è¿è¡Œæ—¶å¸¸é‡æ± [å­˜æ”¾classæ–‡ä»¶å…ƒä¿¡æ¯æè¿°ï¼Œç¼–è¯‘åçš„ä»£ç æ•°æ®ï¼Œå¼•ç”¨ç±»å‹æ•°æ®ï¼Œç±»æ–‡ä»¶å¸¸é‡æ± ]ã€å±æ€§å’Œæ–¹æ³•æ•°æ®)ï¼Œä»¥åŠæ–¹æ³•å’Œæ„é€ å‡½æ•°çš„ä»£ç ï¼ŒåŒ…æ‹¬åœ¨ç±»å’Œå®ä¾‹åˆå§‹åŒ–ä»¥åŠæ¥å£åˆå§‹åŒ–ä½¿ç”¨çš„ç‰¹æ®Šæ–¹æ³•ï¼Œæ–¹æ³•åŒºåœ¨é€»è¾‘ä¸Šæ˜¯å †çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯å®ƒåˆæœ‰å¦ä¸€ä¸ªåˆ«åå«éå †ï¼Œç›®çš„æ˜¯ä¸å †åŒºåˆ†å¼€ã€‚æ–¹æ³•åŒºå¯ä»¥æ˜¯å›ºå®šå¤§å°ï¼Œä¹Ÿå¯ä»¥æ ¹æ®è®¡ç®—éœ€è¦è¿›è¡Œæ‰©å±•ã€‚å¦‚æœæ–¹æ³•åŒºçš„å†…å­˜æ— æ³•æ»¡è¶³åˆ†é…è¯·æ±‚æ—¶ä¹Ÿä¼šæŠ›å‡ºOutOfMemoryErrorã€‚ æ°¸ä¹…ä»£ å…ƒç©ºé—´ JDK8ä½¿ç”¨å…ƒç©ºé—´ä»£æ›¿æ°¸ä¹…ä»£ï¼ˆç±»å…ƒä¿¡æ¯ï¼Œå­—æ®µï¼Œé™æ€å±æ€§ï¼Œæ–¹æ³•ï¼Œå¸¸é‡ï¼‰ï¼ŒåŒæ—¶è¿è¡Œæ—¶å¸¸é‡æ± ç­‰éƒ½ç§»åŠ¨åˆ°äº†å…ƒç©ºé—´ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± åœ¨å †ä¸­ã€‚ å…ƒç©ºé—´åœ¨æœ¬åœ°å†…å­˜ä¸­ï¼Œå®ƒç‹¬ç«‹äºè¿è¡Œæ—¶æ•°æ®åŒºï¼Œä¹Ÿä¸æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸï¼Œå®ƒç›´æ¥ä»æ“ä½œç³»ç»Ÿä¸­åˆ†é…ï¼Œå› æ­¤ä¸å—å †å¤§å°å½±å“ã€‚ä½†æ˜¯ä¼šå—åˆ°æœ¬æœºæ€»å†…å­˜å¤§å°ä»¥åŠå¤„ç†å™¨å¯»å€ç©ºé—´çš„é™åˆ¶ï¼Œå› æ­¤å®ƒä¹Ÿå¯èƒ½æŠ›å‡ºOOMå¼‚å¸¸ã€‚ åƒåœ¾å›æ”¶ æ‰¾åˆ°åƒåœ¾ â€‹ ä¸¤ç§æ–¹æ³•åˆ¤æ–­å¯¹è±¡æ˜¯å¦éœ€è¦é”€æ¯ï¼š å¼•ç”¨è®¡æ•°æ³• â€‹ ä¸ºå¯¹è±¡æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“å¯¹è±¡è¢«å¼•ç”¨ï¼Œå¼•ç”¨è®¡æ•°å™¨åŠ 1ã€‚å½“å¼•ç”¨å¤±æ•ˆï¼Œå‡ä¸€ã€‚è®¡æ•°å™¨ä¸ºé›¶ï¼Œä»£è¡¨è¯¥å¯¹è±¡å¯ä»¥è¢«å›æ”¶ã€‚ â€‹ **é—®é¢˜ï¼š**å¾ªç¯å¼•ç”¨é—®é¢˜ å¯è¾¾æ€§åˆ†æ â€‹ é€šè¿‡ä¸€ç³»åˆ—&quot;GC Roots&quot;çš„æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œæ²¿ç”¨å¼•ç”¨é“¾è¿›è¡Œæœç´¢ï¼Œå‡¡æ˜¯åœ¨å¼•ç”¨é“¾ä¸Šçš„ï¼Œéƒ½ä¸ä¼šè¢«å›æ”¶ã€‚ â€‹ è§£å†³äº†å¾ªç¯ä¾èµ–é—®é¢˜ã€‚ åƒåœ¾å›æ”¶ç®—æ³•-GC æ ‡è®°-æ¸…é™¤ç®—æ³• é¦–å…ˆåœ¨å †å†…å­˜æ‰«æä¸€éï¼Œç„¶åæŠŠç°è‰²åŒºåŸŸçš„å¯¹è±¡æ ‡è®° ç»§ç»­æ‰«æï¼Œæ‰«æçš„åŒæ—¶å°†è¢«æ ‡è®°çš„å¯¹è±¡ç»Ÿä¸€å›æ”¶å›æ”¶åï¼š å›æ”¶ä¹‹åï¼Œäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ã€‚ éœ€è¦è¿›è¡Œæ ‡è®°ï¼Œæ¸…é™¤ä¸¤ä¸ªè¿‡ç¨‹ï¼Œæ•ˆç‡ä¸é«˜ã€‚ å¤åˆ¶ç®—æ³• â€‹ å°†å†…å­˜åŒºåŸŸåˆ†æˆå¤§å°ä¸€æ ·çš„ä¸¤å—ï¼Œæ¯æ¬¡åªæ˜¯ç”¨ä¸€å—ï¼Œgcä¹‹åå°†å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ï¼Œç„¶åä¸€æ¬¡æ€§æ¸…ç†æ‰è¿™å—å†…å­˜ã€‚ å›æ”¶å‰ï¼š å›æ”¶åï¼š å¤åˆ¶ç®—æ³•çš„ç¼ºç‚¹æ˜¯ç‰ºç‰²äº†ä¸€åŠçš„å†…å­˜ç©ºé—´ï¼Œæœ‰ç‚¹æµªè´¹ã€‚å¤åˆ¶ç®—æ³•åœ¨JVMä¸­çš„ä½“ç°å°±æ˜¯ï¼šjavaå †å†…å­˜åšäº†å‡ æ¬¡åˆ’åˆ†ï¼ŒHot Spotè™šæ‹Ÿæœºä¸­Edenå’ŒSurvivorçš„æ¯”ä¾‹æ˜¯Eden:S0:S1=8:1:1ï¼Œå°†Survivoråˆ†æˆäº†ä¸¤ä¸ªåŒºåŸŸS0å’ŒS1æ¥è¿›è¡Œèµ‹å€¼ï¼Œè¿™ç§åšæ³•æ˜¯ä¸ºäº†å¼¥è¡¥åŸå§‹å¤åˆ¶ç®—æ³•ç›´æ¥å°†ä¸€åŠç©ºé—´ä½œä¸ºç©ºé—²ç©ºé—´çš„æµªè´¹ã€‚IBMå…¬å¸è¡¨ç¤ºï¼šYoungåŒºæœ‰98%çš„å¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•æ­»çš„ï¼Œç”Ÿå‘½å‘¨æœŸæçŸ­ï¼Œæ‰€ä»¥è¯´ä¸€æ¬¡GCä¸‹æ¥å­˜æ´»çš„å¯¹è±¡å¾ˆå°‘ï¼Œæ‰€ä»¥æ²¡å¿…è¦ç”¨ä¸€åŠç©ºé—´æ¥å¤åˆ¶ã€‚ æ ‡è®°-æ•´ç†ç®—æ³• â€‹ æ ‡è®°-æ•´ç†ç®—æ³•å°±æ˜¯ä¸ºäº†è€å¹´ä»£è€Œè®¾è®¡çš„ç®—æ³•ï¼Œæ ‡è®°-æ•´ç†ç®—æ³•å’Œæ ‡è®°-æ¸…é™¤ç®—æ³•çš„åŒºåˆ«åœ¨æœ€åä¸€æ­¥ï¼Œæ ‡è®°-æ•´ç†ä¸ä¼šç›´æ¥å¯¹å¯¹è±¡æ¸…ç†ï¼Œè€Œæ˜¯è¿›è¡Œç§»åŠ¨ï¼Œå°†å­˜æ´»å¯¹è±¡ç§»åŠ¨åˆ°ä¸€ç«¯ï¼Œç„¶åæ¸…ç†æ‰è¾¹ç•Œä»¥å¤–çš„å¯¹è±¡ã€‚ å›æ”¶å‰ï¼š å›æ”¶åï¼š åˆ†ä»£æ”¶é›†ç®—æ³• â€‹ ç›®å‰ä¸»æµçš„å•†ä¸šè™šæ‹Ÿæœºéƒ½æ˜¯é‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œè¿™ç§ç®—æ³•å°±æ˜¯ä¸Šé¢ä¸‰ç§ç®—æ³•çš„ç»“åˆã€‚æ–°ç”Ÿä»£é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°-æ•´ç†æˆ–æ ‡è®°-æ¸…é™¤ç®—æ³•ã€‚ åƒåœ¾æ”¶é›†å™¨ Serial å’ŒSerial Old æ”¶é›†å™¨ Serial å•çº¿ç¨‹ï¼ŒGCæ—¶Stop The Worldï¼ˆSTWï¼‰ï¼Œæš‚åœæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ã€‚ Serial Old å•çº¿ç¨‹ï¼Œä½œç”¨ä¸è€å¹´ä»£ã€‚æ ‡è®°æ•´ç†ç®—æ³• â€‹ ä¼˜ç‚¹ï¼šå•çº¿ç¨‹æ”¶é›†æ•ˆç‡é«˜ â€‹ ç¼ºç‚¹ï¼šéœ€è¦STWï¼Œæš‚åœæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ â€‹ ç®—æ³•ï¼š Serialé‡‡ç”¨å¤åˆ¶ç®—æ³• ï¼›Serial Oldé‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³• ParNewæ”¶é›†å™¨ â€‹ ParNewæ”¶é›†å™¨æ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œå®ç°å¹¶è¡Œæ”¶é›†ï¼Œ åŸç†è·ŸSerialä¸€è‡´ï¼ˆå¹¶è¡ŒæŒ‡çš„æ˜¯å¤šä¸ªGCçº¿ç¨‹å¹¶è¡Œï¼Œä½†æ˜¯ç”¨æˆ·çº¿ç¨‹è¿˜æ˜¯æš‚åœï¼Œå¹¶å‘æŒ‡çš„æ˜¯ç”¨æˆ·çº¿ç¨‹å’ŒGCçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼‰ã€‚ParNewé»˜è®¤å¼€å¯å’ŒCPUä¸ªæ•°ç›¸åŒçš„çº¿ç¨‹æ•°è¿›è¡Œå›æ”¶ã€‚ â€‹ ä¼˜ç‚¹ï¼šåœ¨å¤šCPUæ—¶ï¼Œæ¯”Serialçš„æ•ˆç‡é«˜ã€‚ â€‹ ç¼ºç‚¹ï¼šè¿˜æ˜¯éœ€è¦STWï¼Œå•CPUæ—¶æ¯”Serialæ•ˆç‡ä½ â€‹ ç®—æ³•ï¼šå¤åˆ¶ç®—æ³• Parallel Scavenge æ”¶é›†å™¨ æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œä¹Ÿæ˜¯å¤åˆ¶ç®—æ³•ï¼Œå’ŒParNewä¸€æ ·å¹¶è¡Œçš„å¤šçº¿ç¨‹æ”¶é›†å™¨ï¼Œæ›´å…³æ³¨ç³»ç»Ÿçš„ååé‡[ååé‡=(è¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´) / (è¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´+ GC æ—¶é—´) ]Parallel Scavenge æä¾›äº†ä¸¤ä¸ªå‚æ•°ç”¨äºç²¾ç¡®æ§åˆ¶ååé‡ï¼š 123456789-XX:MaxGCPauseMillis //GCæœ€å¤§åœé¡¿æ¯«ç§’æ•°ï¼Œå¿…é¡»å¤§äº0-XX:GCTimeRation //è®¾ç½®ååé‡å¤§å°ï¼Œå¤§äº0å°äº100ï¼Œé»˜è®¤å€¼ä¸º99-XX:+UseAdaptiveSizePolicy //å¼€å¯è‡ªé€‚åº”ç­–ç•¥//ä½ ä¼šä¸ä¼šè§‰å¾—æŠŠMaxGCPauseMillisè®¾ç½®å°ç‚¹å°±ä¼šè®©GCé€Ÿåº¦å˜å¿«ï¼Ÿ//ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œå¦‚æœè®¾ç½®æ—¶é—´è¿‡å°ï¼ŒParallel Scavenge ä¼šç‰ºç‰²ååé‡å’Œæ–°ç”Ÿä»£ç©ºé—´æ¥äº¤æ¢ï¼Œ//æ¯”å¦‚æ–°ç”Ÿä»£400Mbéœ€è¦GCæ—¶é—´ä¸º100msï¼Œè®¾ç½®æˆ50msäº†ï¼Œé‚£ä¹ˆå°±ä¼šæŠŠæ–°ç”Ÿä»£è°ƒå°ä¸º200Mbï¼Œè¿™æ ·è‚¯å®šæ—¶é—´å°±é™ä¸‹æ¥äº†ï¼Œ//ç„¶è€Œè¿™ç§æ“ä½œå¯èƒ½ä¼šé™ä½ååé‡ï¼ŒåŸå…ˆ10sè§¦å‘ä¸€æ¬¡GCï¼Œæ¯æ¬¡100msï¼Œ// ä¿®æ”¹æ—¶é—´åå˜æˆ5sè§¦å‘ä¸€æ¬¡GCï¼Œæ¯æ¬¡70msï¼Œé‚£ä¹ˆ10msè§¦å‘ä¸¤æ¬¡GCçš„æ—¶é—´å˜æˆäº†140msï¼Œååé‡åè€Œé™ä½ã€‚ Parallel Old æ”¶é›†å™¨ æ˜¯Parallel Scavenge çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ï¼Œå› ä¸ºParallel Scavenge æ— æ³•å’ŒCMSæ­é…ä½¿ç”¨ï¼Œæ‰€ä»¥åªèƒ½å’ŒSerial Oldã€‚è‡ªä»Parallel Oldå‡ºç°ï¼Œå°±æœ‰äº†Parallel Scavenge +Parallel Oldçš„ç»„åˆï¼Œè¿™æ˜¯JDK8ä½¿ç”¨çš„ï¼Œæ³¨é‡ååé‡çš„ä¸€ç»„æ”¶é›†å™¨ã€‚ CMSæ”¶é›†å™¨ è¿™æ˜¯ä¼˜åŒ–GCåœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œå¹¶å‘å›æ”¶ï¼ˆä»ç„¶éœ€è¦STWï¼Œä½†æ˜¯æ—¶é—´å¾ˆçŸ­ï¼‰ã€‚é€šè¿‡-XX:+UseMarkSweepGCå¯ç”¨ã€‚CMSåŸºäºæ ‡è®°-æ¸…é™¤ç®—æ³•å®ç°ã€‚æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºå››æ­¥ï¼š åˆå§‹æ ‡è®°ï¼šéœ€è¦STWï¼Œæ ‡è®°GC Rootså¯¹è±¡ã€‚ å¹¶å‘æ ‡è®°ï¼šè¿™ä¸ªé˜¶æ®µå¯ä»¥å’Œç”¨æˆ·çº¿ç¨‹ä¸€èµ·è¿›è¡Œï¼Œåˆ†ä¸ºä¸‰æ­¥ï¼š æ ¹æ®ç¬¬ä¸€æ­¥æ‰¾åˆ°çš„GC Rootså¼€å§‹æœç´¢è·ŸGC Rootsç›¸è¿çš„å¯¹è±¡ã€‚ é¢„æ¸…ç†ï¼šå¤„ç†å¹¶å‘æ ‡è®°ä¹‹åå‘ç”Ÿå˜åŒ–çš„å¯¹è±¡ã€‚ å¯è¢«ç»ˆæ­¢çš„é¢„æ¸…ç†ï¼šæœ‰ä¸€ä¸ªabort è§¦å‘æ¡ä»¶ï¼Œè¯¥é˜¶æ®µå­˜åœ¨çš„ç›®çš„æ˜¯å¸Œæœ›èƒ½å‘ç”Ÿä¸€æ¬¡Young GCï¼Œæ¥å‡å°‘YoungåŒºå¯¹è±¡æ•°é‡ï¼Œé™ä½é‡æ–°æ ‡è®°çš„å·¥ä½œé‡ï¼Œå› ä¸ºé‡æ–°æ ‡è®°ä¼šæ‰«ææ•´ä¸ªå †å†…ç©ºé—´ï¼Œå¯ä»¥é€šè¿‡å‚æ•°-XX:+CMSScavangeBeforeRemark æ§åˆ¶åœ¨é‡æ–°æ ‡è®°å‰å‘ç”Ÿä¸€æ¬¡Young GCï¼Œé»˜è®¤ä¸ºfalseã€‚ é‡æ–°æ ‡è®°ï¼šéœ€è¦STWï¼Œè¿™ä¸ªé˜¶æ®µæ˜¯ä¸ºäº†ä¿®æ­£åœ¨é˜¶æ®µ2æ ‡è®°ä¹‹åäº§ç”Ÿå˜åŒ–çš„å¯¹è±¡ã€‚ å¹¶å‘æ¸…é™¤ï¼šå’Œç”¨æˆ·çº¿ç¨‹åŒæ—¶è¿›è¡Œï¼Œå¼€å§‹æ­£å¼æ¸…ç†åƒåœ¾ï¼Œæ­¤é˜¶æ®µäº§ç”Ÿçš„åƒåœ¾ç•™å¾…ä¸‹æ¬¡æ¸…é™¤ã€‚ ä¼˜ç‚¹ï¼šå¹¶å‘æ”¶é›†ï¼Œä½åœé¡¿ ç¼ºç‚¹ï¼šäº§ç”Ÿå¤§é‡ç¢ç‰‡ï¼Œå¹¶å‘é˜¶æ®µä¼šé™ä½ååé‡ G1æ”¶é›†å™¨ â€‹ G1æ˜¯ä»¥ä¼˜åŒ–GCåœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œå®ƒå°è¯•ä»¥é«˜æ¦‚ç‡æ»¡è¶³GCåœé¡¿æ—¶é—´ä¸ºç›®æ ‡ï¼ŒåŒæ—¶å®ç°é«˜ååé‡ã€‚åœ¨G1ä¸­ï¼Œå°†å †çš„æ•´ä¸ªå†…å­˜å¸ƒå±€åšäº†ä¿®æ”¹ï¼Œåœ¨G1ä¸­æ•´ä¸ªå †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸRegionï¼Œè™½ç„¶åœ¨é€»è¾‘ä¸Šè¿˜ä¿ç•™äº†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œä½†æ˜¯ç‰©ç†ä¸Šå·²ç»éš”ç¦»äº†ï¼ŒG1çš„å †å†…å­˜å¸ƒå±€å¦‚ä¸‹å›¾ ï¼š ä¸Šå›¾æ™ºèƒ½æŸœè¢«åˆ’åˆ†æˆä¸€ç»„å¤§å°ç›¸åŒçš„Regionï¼Œæ¯ä¸ªRegionéƒ½æ˜¯è¿ç»­çš„è™šæ‹Ÿå†…å­˜èŒƒå›´ï¼ŒG1å¯ä»¥çŸ¥é“å“ªä¸ªRegionåŒºåŸŸå†…å¤§éƒ¨åˆ†æ˜¯ç©ºçš„ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æ¯æ¬¡å…è®¸çš„æ”¶é›†æ—¶é—´å†…ä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„RegionåŒºåŸŸï¼ˆæ ¹æ®å›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°ä»¥åŠå›æ”¶éœ€è¦çš„æ—¶é—´ç»¼åˆè€ƒè™‘ï¼‰æ‰€ä»¥è¿™å°±æ˜¯G1å«åšGarbage-Firstçš„åŸå› ã€‚G1æ˜¯JDK8é»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨ã€‚G1çš„å·¥ä½œæµç¨‹å’ŒCMSå¾ˆç›¸ä¼¼ï¼ŒåŒºåˆ«åœ¨æœ€åçš„æ­¥éª¤ã€‚ä¹Ÿæœ‰å››æ­¥ï¼š åˆå§‹æ ‡è®°ï¼šéœ€è¦STWï¼Œæ ‡è®°ä¸‹GC Rootså…³è”çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¿®æ”¹TAMSï¼ˆNext Top at Mark Startï¼‰çš„å€¼ï¼Œä½¿å¾—ä¸‹ä¸€é˜¶æ®µå¹¶å‘è¿è¡Œæ—¶ï¼Œèƒ½åœ¨æ­£ç¡®å¯ç”¨çš„Regionä¸­åˆ›å»ºå¯¹è±¡ã€‚ å¹¶å‘æ ‡è®°ï¼šå’ŒCMSä¸€æ ·ï¼Œä¸»è¦æ˜¯è¿›è¡ŒGC Rootsçš„å‘ä¸‹æœç´¢ï¼Œæ‰¾å‡ºå­˜æ´»å¯¹è±¡è¿›è¡Œæ ‡è®°ã€‚ æœ€ç»ˆæ ‡è®°ï¼šéœ€è¦STWï¼Œå’ŒCMSä¸€æ ·ï¼Œè¿™ä¸ªé˜¶æ®µæ˜¯ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºè¿è¡Œè€Œå¯¼è‡´å˜åŠ¨çš„å¯¹è±¡ã€‚ ç­›é€‰å›æ”¶ï¼šå¯¹å„ä¸ªRegionçš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æœŸæœ›çš„GCåœé¡¿æ—¶é—´åˆ¶å®šå›æ”¶è®¡åˆ’ã€‚ G1çš„ç¬¬ä¸€ä¸ªé‡ç‚¹æ˜¯ä¸ºè¿è¡Œéœ€è¦å¤§å †ä¸”GCå»¶è¿Ÿæœ‰é™çš„åº”ç”¨ç¨‹åºçš„ç”¨æˆ·æä¾›è§£å†³æ–¹æ¡ˆï¼Œè¿™å°±æ„å‘³ç€å †å¤§å°çº¦ä¸º6Gæˆ–æ›´å¤§ï¼Œå¹¶ä¸”ç¨³å®šä¸”å¯é¢„æµ‹çš„æš‚åœæ—¶é—´ä½äº0.5ç§’ã€‚å¦‚æœåº”ç”¨ç¨‹åºå…·å¤‡ä»¥ä¸‹ç‰¹æ€§ï¼Œå¯ä»¥è€ƒè™‘åˆ‡æ¢åˆ°G1æ”¶é›†å™¨ï¼š è¶…è¿‡50%çš„Javaå †è¢«å®æ—¶æ•°æ®å ç”¨ å¯¹è±¡åˆ†é…ç‡æˆ–æå‡ç‡å·®å¼‚å¾ˆå¤§ å½“å‰åº”ç”¨ç¨‹åºGCåœé¡¿æ—¶é—´è¶…è¿‡0.5ç§’ï¼Œåˆæƒ³ç¼©çŸ­åœé¡¿æ—¶é—´ å„æ”¶é›†å¯¹æ¯” æ”¶é›†å™¨ ä¸²è¡Œ/å¹¶è¡Œ/å¹¶å‘ æ–°ç”Ÿä»£/è€å¹´ä»£ ç®—æ³• ç›®æ ‡ é€‚ç”¨åœºæ™¯ Serial ä¸²è¡Œ æ–°ç”Ÿä»£ å¤åˆ¶ å“åº”é€Ÿåº¦ä¼˜å…ˆ å•CPUç¯å¢ƒä¸‹çš„Clientæ¨¡å¼ Serial Old ä¸²è¡Œ è€å¹´ä»£ æ ‡è®°-æ•´ç† å“åº”é€Ÿåº¦ä¼˜å…ˆ å•CPUç¯å¢ƒä¸‹çš„Clientæ¨¡å¼ï¼ŒCMSçš„åå¤‡é¢„æ¡ˆ ParNew å¹¶è¡Œ æ–°ç”Ÿä»£ å¤åˆ¶ å“åº”é€Ÿåº¦ä¼˜å…ˆ å¤šCPUç¯å¢ƒæ—¶åœ¨Serveræ¨¡å¼ä¸‹ä¸CMSé…åˆä½¿ç”¨ Parallel Scavenge å¹¶è¡Œ æ–°ç”Ÿä»£ å¤åˆ¶ ååé‡ä¼˜å…ˆ åœ¨åå°è¿ç®—ä¸”ä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡ Parallel å¹¶è¡Œ è€å¹´ä»£ æ ‡è®°-æ•´ç† ååé‡ä¼˜å…ˆ åœ¨åå°è¿ç®—ä¸”ä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡ CMS å¹¶å‘ è€å¹´ä»£ æ ‡è®°-æ¸…é™¤ å“åº”é€Ÿåº¦ä¼˜å…ˆ é›†ä¸­åœ¨äº’è”ç½‘ç½‘ç«™ æˆ– B/Sç³»ç»ŸæœåŠ¡ç«¯ä¸­çš„Javaåº”ç”¨ G1 å¹¶å‘ å…¼é¡¾ æ ‡è®°-æ•´ç†+å¤åˆ¶ å“åº”é€Ÿåº¦ä¼˜å…ˆ é¢å‘æœåŠ¡ç«¯åº”ç”¨ ä¸²è¡Œæ”¶é›†å™¨ï¼šSerialå’ŒSerial Oldå•çº¿ç¨‹æ”¶é›†ï¼Œé€‚ç”¨äºå†…å­˜è¾ƒå°çš„åµŒå…¥å¼è®¾å¤‡ã€‚ å¹¶è¡Œæ”¶é›†å™¨ã€ååé‡ä¼˜å…ˆã€‘ï¼šParallel Scavenge + Parallel Oldï¼Œé€‚ç”¨äºç§‘å­¦è®¡ç®—ã€åå°å¤„ç†ç­‰åœºæ™¯ã€‚ å¹¶å‘æ”¶é›†å™¨ã€GCåœé¡¿æ—¶é—´ä¼˜å…ˆã€‘ï¼šCMSå’ŒG1ï¼Œé€‚ç”¨äºå¯¹æ—¶é—´æœ‰è¦æ±‚çš„åœºæ™¯ï¼Œä¾‹å¦‚Webåº”ç”¨ã€‚ è°ƒä¼˜ æ‰€è°“è°ƒä¼˜å°±æ˜¯è®¾ç½®ä¸€ä¸ªåˆç†çš„JVMå‚æ•°ï¼Œé€‚é…å½“å‰ç³»ç»Ÿè¿è¡Œã€‚ å‚æ•° å¯ä»¥åˆ†æˆä¸‰ç±»ï¼šæ ‡å‡†å‚æ•°ï¼Œ-Xå‚æ•°ï¼Œ-XXå‚æ•° æ ‡å‡†å‚æ•° â€‹ ä»¥&quot;-&quot;å¼€å¤´çš„å‚æ•°ç§°ä¸ºæ ‡å‡†å‚æ•°ï¼Œæ˜¯ä»»ä½•ä¸€ä¸ªJDKç‰ˆæœ¬éƒ½æ”¯æŒçš„ï¼Œæ¯”è¾ƒç¨³å®šï¼Œä¸ä¼šéšç‰ˆæœ¬æ›´æ–°å’Œæ”¹å˜ã€‚ä¾‹å¦‚-version,-help,-serverã€‚ -Xå‚æ•° â€‹ ä»¥-Xå¼€å¤´çš„å‚æ•°æ˜¯åœ¨ç‰¹å®šç‰ˆæœ¬HotSpotæ”¯æŒçš„å‘½ä»¤ã€‚JDKç‰ˆæœ¬å˜åŒ–ä¹‹åï¼Œå‚æ•°å¯èƒ½å˜åŒ–ï¼Œè¿™ä¸ªå‚æ•°ç”¨çš„è¾ƒå°‘ã€‚ -XXå‚æ•° -XXæ˜¯ä¸ç¨³å®šçš„å‚æ•°ï¼Œä¹Ÿæ˜¯ä¸»è¦å‚æ•°ï¼Œåˆ†ä¸ºBooleanç±»å‹å’ŒéBooleanç±»å‹ã€‚ Booleanç±»å‹ -XX:[+-]&lt;name&gt;ï¼š+æˆ–-è¡¨ç¤ºå¯ç”¨æˆ–è€…ç¦ç”¨nameå±æ€§ 123456è¡¨ç¤ºå¯ç”¨CMSåƒåœ¾æ”¶é›†å™¨-XX:+UseConcMarkSweepGCè¡¨ç¤ºå¯ç”¨G1åƒåœ¾æ”¶é›†å™¨-XX:+UseG1GCè¡¨ç¤ºæ‰“å°å‡ºæ‰€æœ‰çš„JVMå‚æ•°ä¿¡æ¯-XX:+PrintFlagsFinal éBooleanç±»å‹ -XX&lt;name&gt;=&lt;value&gt;ï¼šnameè¡¨ç¤ºå±æ€§ï¼Œvalueè¡¨ç¤ºå±æ€§å¯¹åº”çš„å€¼ 12è®¾ç½®æœ€å¤§æ°¸ä¹…ä»£ç©ºé—´å¤§å°ä¸º5M-XX:MaxMetaspaceSize=5M å…¶ä»– 123-Xms1000 ç­‰ä»·äº -XX:InitialHeapSize=1000-Xmx1000 ç­‰ä»·äº -XX:MaxHeapSize=1000-Xss1000 ç­‰ä»·äº -XX:ThreadStackSize=1000 å¸¸ç”¨å‚æ•° è®¾ç½® è¯´æ˜ -XX:ClCompilerCount=3 æœ€å¤§å¹¶è¡Œç¼–è¯‘æ•°ï¼Œå¤§äº1æ—¶å¯ä»¥æé«˜ç¼–è¯‘é€Ÿåº¦ï¼Œä½†ä¼šå½±å“ç³»ç»Ÿç¨³å®šæ€§ -XX:InitialHeapSize=100m åˆå§‹å †å¤§å°ï¼Œå¯ä»¥ç®€å†™ä¸º-Xms100 -XX:MaxHeapSize æœ€å¤§å †å¤§å°ï¼Œå¯ä»¥ç®€å†™ä¸º-Xmx100 -XX:NewSize=20m è®¾ç½®å¹´è½»ä»£å¤§å° -XX:MaxNewSize è®¾ç½®å¹´è½»ä»£æœ€å¤§å€¼ -XX:OldSize=50m è®¾ç½®è€å¹´ä»£å¤§å° -XX:MetaspaceSize=50m è®¾ç½®æ–¹æ³•åŒºå¤§å°ï¼ŒJDK8æ‰æœ‰ï¼Œç”¨å…ƒç©ºé—´ä»£æ›¿æ–¹æ³•åŒº -XX:+UseParallelGC è®¾ç½®Parallel Scavengeä½œä¸ºæ–°ç”Ÿä»£æ”¶é›†å™¨ç³»ç»Ÿé»˜è®¤ä¼šé€‰æ‹©Parallel Oldä½œä¸ºè€å¹´ä»£æ”¶é›†å™¨ -XX:NewRatio æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”å€¼æ¯”å¦‚ -XX:NewRatio=4è¡¨ç¤ºæ–°ç”Ÿä»£ï¼šè€å¹´ä»£=1ï¼š4 -XX:SurvivorRatio è¡¨ç¤ºSurvivoråŒºå’ŒEdenåŒºçš„æ¯”å€¼æ¯”å¦‚-XX:SurvivorRatio=8è¡¨ç¤ºï¼ˆS0æˆ–S1):Eden=1:8 å‘½ä»¤ç›‘æ§å·¥å…· å¾…ç»­ å‚è€ƒï¼š Java SE Specifications (oracle.com) JVMä¸‡å­—æ€»ç»“ - æ˜é‡‘ (juejin.cn) ã€JVMç³»åˆ—8ã€‘JVMçŸ¥è¯†ç‚¹æ€»è§ˆ - æ˜é‡‘ (juejin.cn) JVM8å†…å­˜æ¨¡å‹_jdk8å†…å­˜æ¨¡å‹_ä½™ç”Ÿä¹‹å›çš„åšå®¢-CSDNåšå®¢ JVMå†…å­˜æ¨¡å‹æ€»ç»“ï¼Œæœ‰å„ç‰ˆæœ¬JDKå¯¹æ¯”ã€æœ‰å…ƒç©ºé—´OOMç›‘æ§æ¡ˆä¾‹ã€æœ‰Javaç‰ˆè™šæ‹Ÿæœºï¼Œç»¼åˆå®è·µå­¦ä¹ ï¼ - å°å‚…å“¥ - åšå®¢å›­ (cnblogs.com) https://zhuanlan.zhihu.com/p/297001119","categories":[{"name":"Java","slug":"Java","permalink":"https://solitaire-12.github.io/categories/Java/"}],"tags":[{"name":"JVM","slug":"JVM","permalink":"https://solitaire-12.github.io/tags/JVM/"}]},{"title":"å†…ç½‘ç©¿é€","slug":"Server/å†…ç½‘ç©¿é€","date":"2024-03-18T09:05:07.000Z","updated":"2024-03-25T03:57:26.002Z","comments":true,"path":"2024/03/18/Server/å†…ç½‘ç©¿é€/","permalink":"https://solitaire-12.github.io/2024/03/18/Server/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/","excerpt":"","text":"ç¯å¢ƒï¼š æœåŠ¡ç«¯é˜¿é‡Œäº‘ï¼š CentOS 8.5.2111 å®¢æˆ·ç«¯ï¼šwindows 11 / windows 10 frp 0.42 ç¬¬ä¸€æ­¥ å®˜ç½‘ä¸‹è½½frpè½¯ä»¶ ç¬”è€…ä½¿ç”¨çš„ç‰ˆæœ¬ï¼šé“¾æ¥ï¼šhttps://pan.baidu.com/s/1cjmUiOY8iRIywx6whkhRdg æå–ç ï¼šgatr ç¬¬äºŒæ­¥ æœåŠ¡ç«¯ï¼š å°† frp_0.42.0_linux_amd64.tar.gzå‹ç¼©åŒ…ä¼ ç»™linux è¿›å…¥åˆ°æ–‡ä»¶å­˜æ”¾ç›®å½• 123tar -zxvf frp_0.42.0_linux_amd64.tar.gzcd frp_0.42.0_linux_amd64/vi frps.ini ğŸ’¬æé†’ï¼šåªè¦bind_portçš„7000ç«¯å£æ²¡è¢«å ç”¨ï¼Œä¸€èˆ¬ä¸å»ºè®®ä¿®æ”¹ã€‚ 12./frps -c frps.ini #ä¸´æ—¶å¯åŠ¨nohup ./frps -c frps.ini &amp; #æ°¸ä¹…å¯åŠ¨ å®¢æˆ·ç«¯ï¼š è§£å‹ frp_0.42.0_windows_amd64.zip ï¼Œæ³¨æ„å…³é—­ä¸€ä¸‹æ€æ¯’è½¯ä»¶ã€‚ æ‰“å¼€ä¹‹åï¼Œä¿®æ”¹frpc.iniæ–‡ä»¶ã€‚ ğŸ’¬è§£é‡Šï¼š 12[ssh]å®šä¹‰ä¸€ä¸ªä½¿ç”¨ [type] åè®®çš„url: [local_ip]:[local_port]è¢«[server_addr]:[remote_port]ä»£ç†äº†ã€‚å³ï¼šç”¨æˆ·è®¿é—® [server_addr]:[remote_port] åï¼ŒæœåŠ¡å™¨&quot;è·³è½¬&quot;åˆ° [local_ip]:[local_port] å¯åŠ¨ 12# è¿›å…¥cmdfrpc.exe -c frpc.ini âš ï¸æ³¨æ„ï¼šå‡å¦‚ä½ å°†frpc.iniä¸­çš„remote_portå’Œfrps.iniä¸­çš„dashboard_porté…ç½®æˆä¸€æ ·çš„è¯ï¼Œå¯åŠ¨å®¢æˆ·ç«¯çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç° [ssh] start error: port unavailableã€‚","categories":[{"name":"æœåŠ¡å™¨","slug":"æœåŠ¡å™¨","permalink":"https://solitaire-12.github.io/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"}],"tags":[{"name":"å†…ç½‘ç©¿é€","slug":"å†…ç½‘ç©¿é€","permalink":"https://solitaire-12.github.io/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"}]},{"title":"linux|é¡¹ç›®éƒ¨ç½²","slug":"Server/é¡¹ç›®ä¸Šçº¿","date":"2024-03-18T08:25:07.000Z","updated":"2024-03-25T03:57:29.375Z","comments":true,"path":"2024/03/18/Server/é¡¹ç›®ä¸Šçº¿/","permalink":"https://solitaire-12.github.io/2024/03/18/Server/%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/","excerpt":"","text":"ç¯å¢ƒ ç³»ç»Ÿï¼šCentos 8.4.2105 docker : 24.0.5 nginx: nginx/1.25.1 åç«¯ å®¿ä¸»æœºå®‰è£… åç«¯è¾¾æˆjaråŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨ ps -ef | grep javaæŸ¥çœ‹æœ‰æ²¡æœ‰åœ¨è¿è¡Œçš„javaé¡¹ç›®ï¼Œè¦æ˜¯ç«¯å£å†²çªçš„è¯ï¼Œç›´æ¥kill java -jaræ²¡æœ‰é—®é¢˜ä¹‹åï¼Œnohup java -jar x.jar &gt; x.log 2&gt;&amp;1 &amp; å°±å¯ä»¥ã€‚ dockerå†…éƒ¨ åˆ›å»ºDockerfile vi Dockerfile 1234FROM openjdk:8ADD 18080.jar test.jarEXPOSE 18080ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;test.jar&quot;] æè¿°ï¼š FROM openjdk:8:æ‹‰å–åŸºç¡€é•œåƒ ADD 18080.jar test.jarï¼šå°†18080.jarå¤åˆ¶åˆ°é•œåƒä¸­ï¼Œé‡å‘½åæˆtest.jar EXPOSE 18080:å£°æ˜ç«¯å£ï¼Œä¸€èˆ¬æŒ‡å®šçš„æ˜¯jarè¿è¡Œç«¯å£ ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;test.jar&quot;]ï¼šå®¹å™¨å¯åŠ¨ä¹‹åæ‰§è¡Œçš„å‘½ä»¤ MAINTAINER xx: æ·»åŠ ä½œè€…ä¿¡æ¯ æ„å»ºé•œåƒ 1docker build -t test . æè¿°ï¼š testï¼šé•œåƒåç§° .ï¼šè¡¨ç¤ºDockerfileåœ¨å½“å‰ç›®å½•ä¸‹ æŸ¥çœ‹é•œåƒ 1docker images è¿è¡Œè¿›è¡Œ 1docker run -d --restart=always --name test -p 8080:18080 test æè¿°ï¼š -dï¼šè¡¨ç¤ºåå°è¿è¡Œå®¹å™¨ --restart=alwaysï¼šä»£è¡¨å®¹å™¨åœ¨åœæ­¢æˆ–è€…æœåŠ¡å™¨å¼€æœºä¹‹åä¼šè‡ªåŠ¨é‡å¯ --name test:å‘½åæˆtest -p 8080:18080ï¼šç«¯å£æ˜ å°„ [å®¿ä¸»æœºç«¯å£]:[å®¹å™¨ç«¯å£] test:è¿è¡Œçš„é•œåƒ æ›´æ–°jaråŒ… 1docker cp new.jar [å®¹å™¨id]:/test.jar éšåï¼Œé‡å¯å®¹å™¨ Dockeréƒ¨ç½²å¯æ‰§è¡ŒjaråŒ…-é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº (aliyun.com) å‰ç«¯ é¡¹ç›®æ‰“åŒ… æ‰“åŒ…ä¹‹åå°†é¡¹ç›®æ”¾åœ¨æŒ‚è½½çš„htmlç›®å½•ä¸‹,è¯¦æƒ…æŸ¥çœ‹dockerå®‰è£…nginx | çº¿ä¸Šè·³è½¬â†—ï¸ æŒ‚è½½é¡¹ç›®ï¼š å°†é¡¹ç›®æŒ‚è½½åˆ°æ–‡ä»¶å¤¹aé‡Œè¾¹ é…ç½®nginx ä¿®æ”¹å‰çš„é…ç½®æ–‡ä»¶ï¼š ä¿®æ”¹åçš„é…ç½®æ–‡ä»¶ï¼š æ³¨æ„äº‹é¡¹ è¦æ˜¯jarè¿è¡Œåœ¨å®¿ä¸»æœº(å®‰è£…dokcerçš„æœåŠ¡å™¨)ä¸Šé¢çš„è¯ï¼Œå»ºè®®server_nameä¿®æ”¹æˆ172.17.0.1(è¿™ä¸ªåœ°å€æ˜¯å®‰è£…dockerä¹‹åï¼Œé»˜è®¤ç”Ÿæˆçš„ç½‘æ¡¥)ã€‚ç”¨ifconfig -aå¯ä»¥æŸ¥çœ‹Linux çš„IPåœ°å€ ä¸è¦åœ¨ localtion / &#123;&#125;è¿™å—é‡Œè¾¹å–å†™ proxy_passï¼Œä¼šç½‘é¡µéƒ½æ‰“ä¸å¼€ã€‚ å€˜è‹¥æœ‰ç¬¬äºŒä¸ªå‰ç«¯é¡¹ç›®çš„è¯ï¼ŒåŒæ ·htmlç›®å½•ä¸‹é¢åˆ›å»ºæŒ‚è½½æ–‡ä»¶å¤¹å¹¶æŠŠæ–‡ä»¶å­˜æ”¾åœ¨å†…ã€‚ç„¶ååœ¨å†™ä¸€ä¸ªlocaltionå—ï¼Œä¿®æ”¹ä¸€ä¸‹listenç«¯å£ã€‚ä¾‹å¦‚ï¼š é—®é¢˜æ’æŸ¥ï¼š 1.è¿è¡ŒjaråŒ…æœåŠ¡å™¨å¡æ­» ç¯å¢ƒï¼š ç³»ç»Ÿï¼š8.5.2111 é…ç½®ï¼š2æ ¸2G ç›®æ ‡æœåŠ¡ï¼š Minioï¼Œfrpï¼Œdockerï¼Œnginxï¼Œredisï¼Œmysqlï¼Œå‰ç«¯ï¼Œåç«¯ åœºæ™¯ï¼š æœåŠ¡å™¨è¿è¡Œç€Minioï¼Œfrpï¼Œnginxï¼Œdockerï¼Œredis-dockerï¼Œmysql-dockerï¼Œå‰ç«¯ã€‚å°†åç«¯jaråŒ…ä¸Šä¼ æœåŠ¡å™¨ï¼Œnohup java -jar xx &amp;è¿æ¥æœåŠ¡å™¨çš„xshellæ•²å‘½ä»¤æ‰§è¡Œå¡é¡¿ï¼Œæ— æ³•é‡è¿xshellï¼ŒéšåæœåŠ¡å™¨å¡æ­»ã€‚ é—®é¢˜æ’æŸ¥ï¼š è§‚å¯Ÿåˆ°xshellå‘½ä»¤è¿˜æ˜¯èƒ½æ•²ä¸Šçš„ï¼Œä½†æ˜¯é”®ç›˜æ•²å‡»ä¹‹åï¼Œxshellç•Œé¢å¾ˆä¹…æ‰èƒ½å›æ˜¾ï¼Œæ‰§è¡Œä¹Ÿè¦å¾ˆä¹…å¾ˆä¹…ï¼Œè€Œä¸”é‡è¿xshellä¹Ÿæ˜¯å¾ˆé•¿æ—¶é—´è¿æ¥ä¸ä¸Šã€‚ ç±»ä¼¼è¿™ç§ååº”æ—¶é—´å¾ˆé•¿ï¼Œç³»ç»Ÿå‡ºç°&quot;æ­»æœº&quot;çš„ç°è±¡ï¼Œå¤šåŠæ˜¯å†…å­˜ä¸è¶³ã€‚ ä¸ºå•¥ä¼šå†…å­˜ä¸è¶³å‘¢ï¼Ÿ é‡å¯æœåŠ¡å™¨ä¹‹åï¼Œé‡æ–°é…ç½®å¥½éœ€è¦çš„ç¯å¢ƒï¼Œä¸è¿è¡ŒjaråŒ…ã€‚æŸ¥çœ‹topå‘½ä»¤ï¼š è§‚å¯Ÿå…¶ä¸­çš„è¿›ç¨‹ï¼Œæ³¨æ„åˆ°æœ‰ä¸ªmysqldå ç”¨äº†22.4%çš„å­˜ï¼Œæ•´å°æœåŠ¡å™¨çš„å†…å­˜æ˜¯2Gï¼Œå®é™…è¿è¡Œèµ·æ¥æŒ‡å®šæ²¡æœ‰2048Mçš„ï¼Œä»¥åŠå…¶ä»–ä¸€äº›ç³»ç»Ÿæ”¯æŒçš„ï¼Œç®—äºæŸ10%ï¼Œç©ºé—²å†…å­˜å®é™…çº¦ä¸º1850Mã€‚åˆ¨å»mysqldé»˜è®¤å ç”¨çš„1Gï¼Œå®é™…å ç”¨çš„450Mã€‚è¦æƒ³ç»´ç³»æ•´ä¸ªç³»ç»Ÿçš„å¼€æ”¯ï¼Œå¯ç”¨å†…å­˜ä¹Ÿå°±1Gå·¦å³ã€‚ å°†jaråœ¨å¼€å‘ç¯å¢ƒä¸Šè¿è¡Œï¼Œè§‚å¯Ÿåˆ°å…¶å ç”¨äº†å¼€å‘ç”µè„‘1000-1300Mçš„å†…å­˜èµ„æºã€‚ è§£å†³æ–¹æ¡ˆä¹Ÿå°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼š é…ç½®java -jarJVMçš„å‚æ•°ï¼Œé™å®šå…¶å†…å­˜å¤§å°ã€‚ä¾‹å¦‚ï¼š 1java -Xmx512M -jar xxx.jar ä»mysqldä¸Šè§£å†³ï¼Œå‚è€ƒ1 å‚è€ƒ2 å®ƒæ˜¯Performance Schema çš„å¤§å°ï¼Œé»˜è®¤é…ç½®æ˜¯1Gã€‚ æ­¤æ—¶åŸºæœ¬è§£å†³å†…å­˜ä¸è¶³é—®é¢˜ã€‚ 2.jaråŒ…è¿è¡Œï¼ŒCPUé£™å‡è‡³190% ç¯å¢ƒï¼š ç³»ç»Ÿï¼š8.5.2111 é…ç½®ï¼š2æ ¸2G ç›®æ ‡æœåŠ¡å™¨ä»»åŠ¡è¿›ç¨‹ï¼š Minioï¼Œfrpï¼Œdockerï¼Œnginxï¼Œredisï¼Œmysqlï¼Œå‰ç«¯ï¼Œåç«¯ åœºæ™¯ï¼š æœåŠ¡å™¨è¿è¡Œç€Minioï¼Œfrpï¼Œnginxï¼Œdockerï¼Œredis-dockerï¼Œmysql-dockerï¼Œå‰ç«¯ã€‚å°†åç«¯jaråŒ…ä¸Šä¼ æœåŠ¡å™¨ï¼Œnohup java -jar xx &amp;åï¼ŒtopæŒ‡ä»¤ç›‘æµ‹åˆ°cpuå¤„åœ¨190%é™„è¿‘ã€‚ é—®é¢˜æ’æŸ¥ï¼š é€šè¿‡ å‘½ä»¤ï¼ŒæŸ¥çœ‹è¯¥è¿›ç¨‹ä¸‹çš„çº¿ç¨‹èµ„æºå ç”¨æƒ…å†µã€‚ 1ps -mp pid -o THREAD,tid,time å°†å…¶ä¸­%CPUé«˜çš„çº¿ç¨‹TIDè¿›è¡Œè½¬ç  1print &quot;%x\\n&quot; TID é€šè¿‡æŸ¥çœ‹cpuå ç”¨å¾ˆé«˜çš„çº¿ç¨‹çŠ¶æ€ 1jstack PID | grep [0xTID:ç¬¬äºŒéƒ¨è½¬ç å‡ºæ¥çš„tid] å¦‚æœçº¿ç¨‹è¿˜å¤„åœ¨RunnableçŠ¶æ€ï¼Œé‚£ä¹ˆé€šè¿‡jstackå»æ‰¾åˆ°è¯¦æƒ…ã€‚å¦‚æœé—®é¢˜æŒ‡å‘ä»£ç ï¼Œé‚£å°±å»ä¿®æ”¹ã€‚ åˆ°æ­¤åŸºæœ¬è§£å†³ã€‚ å½“ç„¶ï¼Œè¿˜æœ‰ä¸ªæƒ…å†µå°±æ˜¯ï¼Œæ­£å¸¸å¯åŠ¨ç›´æ¥æ‹‰çˆ†ï¼Œéšååˆé™é»˜åˆ°1%çš„ï¼ŒæŸ¥çº¿ç¨‹é«˜å ç”¨çš„éƒ½åœæ­¢äº†ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå€˜è‹¥åæœŸè¿˜æœ‰MQä»€ä¹ˆçš„å…¶ä»–æœåŠ¡è¦ç”¨çš„è¯ï¼Œå»ºè®®å°†å‡çº§åˆ°4æ ¸cpuã€‚","categories":[{"name":"æœåŠ¡å™¨","slug":"æœåŠ¡å™¨","permalink":"https://solitaire-12.github.io/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"}],"tags":[{"name":"éƒ¨ç½²","slug":"éƒ¨ç½²","permalink":"https://solitaire-12.github.io/tags/%E9%83%A8%E7%BD%B2/"}]},{"title":"linux|dockerå®‰è£…RabbitMQ","slug":"Server/dockerå®‰è£…RabbitMQ","date":"2024-03-18T08:23:07.000Z","updated":"2024-03-25T03:57:07.939Z","comments":true,"path":"2024/03/18/Server/dockerå®‰è£…RabbitMQ/","permalink":"https://solitaire-12.github.io/2024/03/18/Server/docker%E5%AE%89%E8%A3%85RabbitMQ/","excerpt":"","text":"å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨ï¼šwindowsä¸‹è½½erlang ä¸‹è½½RabbitMQ ä¸‹è½½RabbitMQæºç  Dockerå®‰è£…RabbitMQ 12345678910111213# æŸ¥æ‰¾rabbitmqé•œåƒdocker search rabbitmq# pullé•œåƒdocker pull rabbitmq# è¿è¡Œmq ## -p [æš´éœ²çš„å®¿ä¸»æœºç«¯å£]:[dockerå†…éƒ¨ç«¯å£]docker run -d --hostname rabbit-test --name rabbit \\-p 15672:15672 -p 5672:5672 rabbitmq# è¿›å…¥mqé•œåƒdocker exec -it [å®¹å™¨id] /bin/bash# è¿è¡Œrabbitmq-plugins enable rabbitmq_management# é»˜è®¤è´¦å·å¯†ç ï¼šguestï¼šguest","categories":[{"name":"æœåŠ¡å™¨","slug":"æœåŠ¡å™¨","permalink":"https://solitaire-12.github.io/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"}],"tags":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"https://solitaire-12.github.io/tags/RabbitMQ/"}]},{"title":"linux|dockerå®‰è£…nginx","slug":"Server/dockerå®‰è£…nginx","date":"2024-03-18T08:23:07.000Z","updated":"2024-03-25T03:57:03.767Z","comments":true,"path":"2024/03/18/Server/dockerå®‰è£…nginx/","permalink":"https://solitaire-12.github.io/2024/03/18/Server/docker%E5%AE%89%E8%A3%85nginx/","excerpt":"","text":"centos8.5.2111 æ‹‰å–é•œåƒ 1docker pull nginx åˆ›å»ºNginxæŒ‚è½½ç›®å½• 123mkdir -p mytools/nginx/confmkdir -p mytools/nginx/logmkdir -p mytools/nginx/html å°†å®¹å™¨ä¸­çš„é…ç½®å¤åˆ¶åˆ°å®¿ä¸»æœº 12345678# ç”Ÿæˆå®¹å™¨docker run --name nginx -p 9001:80 -d nginx# å°†å®¹å™¨nginx.confæ–‡ä»¶å¤åˆ¶åˆ°å®¿ä¸»æœºdocker cp nginx:/etc/nginx/nginx.conf /mytools/nginx/conf/nginx.conf# å°†å®¹å™¨conf.dæ–‡ä»¶å¤¹ä¸‹å†…å®¹å¤åˆ¶åˆ°å®¿ä¸»æœºdocker cp nginx:/etc/nginx/conf.d /mytools/nginx/conf/conf.d# å°†å®¹å™¨ä¸­çš„htmlæ–‡ä»¶å¤¹å¤åˆ¶åˆ°å®¿ä¸»æœºdocker cp nginx:/usr/share/nginx/html /mytools/nginx/ æ­£å¼å¯åŠ¨nginx 12345678docker run \\-p 9002:80 \\--name nginx \\-v /mytools/nginx/conf/nginx.conf:/etc/nginx/nginx.conf \\-v /mytools/nginx/conf/conf.d:/etc/nginx/conf.d \\-v /mytools/nginx/log:/var/log/nginx \\-v /mytools/nginx/html:/usr/share/nginx/html \\-d nginx:latest æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ 1curl localhost:9002 å…¬ç½‘IPè®¿é—® ä¿®æ”¹htmlæŸ¥çœ‹è¿è¡ŒçŠ¶æ€ æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆ 1docker restart nginx","categories":[{"name":"æœåŠ¡å™¨","slug":"æœåŠ¡å™¨","permalink":"https://solitaire-12.github.io/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"}],"tags":[{"name":"Nginx","slug":"Nginx","permalink":"https://solitaire-12.github.io/tags/Nginx/"}]},{"title":"linux|dockerå®‰è£…redis","slug":"Server/dockerå®‰è£…redis","date":"2024-03-18T08:22:07.000Z","updated":"2024-03-25T03:57:11.363Z","comments":true,"path":"2024/03/18/Server/dockerå®‰è£…redis/","permalink":"https://solitaire-12.github.io/2024/03/18/Server/docker%E5%AE%89%E8%A3%85redis/","excerpt":"","text":"centos 8.5.2111 æ‹‰å–redisé•œåƒ 1docker pull redis å‡†å¤‡redisçš„é…ç½®æ–‡ä»¶ å®˜ç½‘ï¼š redis 6.0.6 ä¸‹è½½ â€“ Redisä¸­å›½ç”¨æˆ·ç»„ï¼ˆCRUGï¼‰ æŠŠredis.confä¸Šä¼ åˆ°æœåŠ¡å™¨rediså®‰è£…çš„ä½ç½® é…ç½®redis.confæ–‡ä»¶ bind 127.0.0.1 #æ³¨é‡Šæ‰è¿™éƒ¨åˆ†ï¼Œä½¿rediså¯ä»¥å¤–éƒ¨è®¿é—® daemonize no#ç”¨å®ˆæŠ¤çº¿ç¨‹çš„æ–¹å¼å¯åŠ¨ requirepass ä½ çš„å¯†ç #ç»™redisè®¾ç½®å¯†ç  appendonly yes#redisæŒä¹…åŒ– é»˜è®¤æ˜¯no tcp-keepalive 300 #é˜²æ­¢å‡ºç°è¿œç¨‹ä¸»æœºå¼ºè¿«å…³é—­äº†ä¸€ä¸ªç°æœ‰çš„è¿æ¥çš„é”™è¯¯ é»˜è®¤æ˜¯300 123456789101112#æ³¨é‡Šæ‰è¿™éƒ¨åˆ†ï¼Œä½¿rediså¯ä»¥å¤–éƒ¨è®¿é—®bind 127.0.0.1 #ç”¨å®ˆæŠ¤çº¿ç¨‹çš„æ–¹å¼å¯åŠ¨daemonize no#ç»™redisè®¾ç½®å¯†ç requirepass ä½ çš„å¯†ç #redisæŒä¹…åŒ– é»˜è®¤æ˜¯noappendonly yes#é˜²æ­¢å‡ºç°è¿œç¨‹ä¸»æœºå¼ºè¿«å…³é—­äº†ä¸€ä¸ªç°æœ‰çš„è¿æ¥çš„é”™è¯¯ é»˜è®¤æ˜¯300tcp-keepalive 300 # :/[findword] åœ¨viå‘½ä»¤ä¸­å¯»æ‰¾æ–‡å­—ï¼Œæœ€å¥½åŠ ä¸ªç©ºæ ¼å»æ‰¾ åˆ›å»ºæœ¬åœ°ä¸dockeræ˜ å°„ç›®å½• 12mkdir mytools/redismkdir mytools/redis/data æŠŠä¸Šè¿°çš„redis.confå¤åˆ¶åˆ°redisç›®å½•ä¸‹ å¯åŠ¨ 1sudo docker run -p 6379:6379 --name redis -v /mytools/redis/redis.conf:/etc/redis/redis.conf -v /mytools/redis/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes -p 6379:6379:æŠŠå®¹å™¨å†…çš„6379ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœº6379ç«¯å£-v /data/redis/redis.conf:/etc/redis/redis.confï¼šæŠŠå®¿ä¸»æœºé…ç½®å¥½çš„redis.confæ”¾åˆ°å®¹å™¨å†…çš„è¿™ä¸ªä½ç½®ä¸­-v /data/redis/data:/dataï¼šæŠŠredisæŒä¹…åŒ–çš„æ•°æ®åœ¨å®¿ä¸»æœºå†…æ˜¾ç¤ºï¼Œåšæ•°æ®å¤‡ä»½redis-server /etc/redis/redis.confï¼šè¿™ä¸ªæ˜¯å…³é”®é…ç½®ï¼Œè®©redisä¸æ˜¯æ— é…ç½®å¯åŠ¨ï¼Œè€Œæ˜¯æŒ‰ç…§è¿™ä¸ªredis.confçš„é…ç½®å¯åŠ¨â€“appendonly yesï¼šrediså¯åŠ¨åæ•°æ®æŒä¹…åŒ– æŸ¥çœ‹æ—¥å¿—ï¼šdocker logs redis","categories":[{"name":"æœåŠ¡å™¨","slug":"æœåŠ¡å™¨","permalink":"https://solitaire-12.github.io/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"}],"tags":[{"name":"redis","slug":"redis","permalink":"https://solitaire-12.github.io/tags/redis/"}]},{"title":"linux|dockerå®‰è£…minio","slug":"Server/minio","date":"2024-03-18T08:22:07.000Z","updated":"2024-03-25T03:57:22.551Z","comments":true,"path":"2024/03/18/Server/minio/","permalink":"https://solitaire-12.github.io/2024/03/18/Server/minio/","excerpt":"","text":"ç¯å¢ƒ centos 8.5 åˆ›å»ºminioæ–‡ä»¶å¤¹ 12mkdir /mytools/miniocd /mytools/minio wgetä¸‹è½½minio 1wget https://dl.minio.io/server/minio/release/linux-amd64/minio åˆ›å»ºæ—¥å¿—ï¼Œæˆæƒ 12touch minio.logchmod 777 minio å¯åŠ¨minio 12# åé¢è·Ÿç€çš„æ˜¯é™æ€æ–‡ä»¶æŒ‚è½½ç›®å½•./minio server /opt/minio/data **é—®é¢˜åŸå› ï¼š**ç¬”è€…ç¼–å†™æ–‡æ¡£ä¹‹å‰ï¼Œè¿è¡Œè¿‡minioï¼Œè¿™é‡Œæ˜¾ç¤ºç«¯å£å ç”¨é—®é¢˜ï¼Œkillä¸€ä¸‹è¿›ç¨‹å°±å¥½äº† çº¢å­—ï¼šè­¦å‘Š:æ£€æµ‹åˆ°é»˜è®¤å‡­æ®â€™minioadmin:minioadminâ€™ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨â€™MINIO_ROOT_USERâ€™å’Œâ€™MINIO_ROOT_PASSWORDâ€™ç¯å¢ƒå˜é‡æ›´æ”¹è¿™äº›å€¼ é…ç½®ç¯å¢ƒå˜é‡ 12345vim /etc/profile export MINIO_ROOT_USER=fileadmin export MINIO_ROOT_PASSWORD=fileadminsource /etc/profile æŒ‡å®šç«¯å£é‡å¯minio 12# æœ‰éœ€æ±‚è‡ªå·±æ¢æˆè‡ªå·±çš„å­˜æ”¾ç›®å½•./minio server /opt/minio/data --console-address &quot;:9050&quot; è®¾ç½®åå°å¯åŠ¨ 12345vim start.shnohup /mytools/minio/minio server /opt/minio/data --console-address &quot;:9050&quot; &gt; /opt/minio/minio.log 2&gt;&amp;1 &amp;sh start.sh é—®é¢˜ï¼š minioæœåŠ¡éƒ¨ç½²åœ¨äº‘ç«¯æ—¶ï¼Œé…ç½®æœåŠ¡ç½‘ç«™è¦ç”¨å…¬ç½‘ipï¼Œä¸ç„¶æ²¡åŠæ³•å›æ˜¾","categories":[{"name":"æœåŠ¡å™¨","slug":"æœåŠ¡å™¨","permalink":"https://solitaire-12.github.io/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"}],"tags":[{"name":"minio","slug":"minio","permalink":"https://solitaire-12.github.io/tags/minio/"}]},{"title":"linux|dockerå®‰è£…mysql8","slug":"Server/dockerå®‰è£…mysql8","date":"2024-03-18T08:21:07.000Z","updated":"2024-03-25T03:56:59.934Z","comments":true,"path":"2024/03/18/Server/dockerå®‰è£…mysql8/","permalink":"https://solitaire-12.github.io/2024/03/18/Server/docker%E5%AE%89%E8%A3%85mysql8/","excerpt":"","text":"æ‹‰å–é•œåƒ 1docker pull mysql:8.0.23 æ£€æŸ¥é•œåƒ 1docker images å¯åŠ¨é•œåƒ 1234567891011sudo docker run -p 3306:3306 --name mysql \\-v /usr/local/docker/mysql/mysql-files:/var/lib/mysql-files \\-v /usr/local/docker/mysql/conf:/etc/mysql \\-v /usr/local/docker/mysql/logs:/var/log/mysql \\-v /usr/local/docker/mysql/data:/var/lib/mysql \\-e MYSQL_ROOT_PASSWORD=root \\-d mysql:8.0.23docker run --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=root -d mysql 1docker logs -f mysql #æŸ¥çœ‹å¯åŠ¨æ—¥å¿— è¿›å…¥å®¹å™¨ 1docker exec -it mysql bash æ–¹æ³•äºŒ ä¸‹è½½mysql 1docker pull mysql:8.0.23 åˆ›å»ºæ–‡ä»¶å¤¹åšæŒ‚è½½ 12345//åˆ›å»ºæ–‡ä»¶å¤¹åšæŒ‚è½½mkdir -p /mydata/mysql/confmkdir /mydata/mysql/data//åˆ›å»ºmy.cnfé…ç½®æ–‡ä»¶vi /mydata/mysql/conf/my.cnf my.cnfæ·»åŠ å¦‚ä¸‹å†…å®¹ 123456789101112131415[mysqld]user=mysqlcharacter-set-server=utf8default_authentication_plugin=mysql_native_passwordsecure_file_priv=/var/lib/mysqlexpire_logs_days=7sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTIONmax_connections=1000lower_case_table_names=1 [client]default-character-set=utf8 [mysql]default-character-set=utf8 æ³¨æ„ï¼š ä½ çš„æ•°æ®åº“è¦æ˜¯ä»æœ¬åœ°windowsä¸Šè¿ç§»åˆ°linuxçš„è¯ï¼Œlower_case_table_names=1,è¿™ä¸ªä¸€å®šè¦åŠ ä¸Šï¼Œä¸ç„¶çš„è¯è¦é‡æ–°éƒ¨ç½²ï¼Œå¾ˆéº»çƒ¦ åˆ›å»ºå®¹å™¨ 12345678910docker run \\--restart=always \\--privileged=true \\-p 3306:3306 --name mysql \\-v /mydata/mysql/log:/var/log/mysql \\-v /mydata/mysql/data:/var/lib/mysql \\-v /mydata/mysql/conf/my.cnf:/etc/mysql/my.cnf \\-v /mydata/mysql/conf/conf.d:/etc/mysql/conf.d \\-e MYSQL_ROOT_PASSWORD=root \\-d mysql:8.0 è¿›å…¥å®¹å™¨ 1docker exec -it mysql bash è¿›å…¥mysql 123mysql -u root -p# æŸ¥çœ‹æ•°æ®åº“show databases","categories":[{"name":"æœåŠ¡å™¨","slug":"æœåŠ¡å™¨","permalink":"https://solitaire-12.github.io/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"https://solitaire-12.github.io/tags/MySQL/"}]},{"title":"linux|å®‰è£…Git/Maven","slug":"Server/GitMaven","date":"2024-03-18T08:20:07.000Z","updated":"2024-03-25T03:57:15.190Z","comments":true,"path":"2024/03/18/Server/GitMaven/","permalink":"https://solitaire-12.github.io/2024/03/18/Server/GitMaven/","excerpt":"","text":"å®‰è£…Git 1yum install -y git æ ¡éªŒå®‰è£…ç»“æœ 1git --version å®‰è£…maven åˆ›å»ºå­˜æ”¾mavençš„æ–‡ä»¶å¤¹ 1mkdir -p /mytools/maven å°†maven.gzä¸Šä¼ åˆ°è¯¥æ–‡ä»¶å¤¹ è§£å‹ 1tar -xvf apache-maven-3.9.4-bin.tar.gz é…ç½®ç¯å¢ƒå˜é‡ 1234vim /etc/profile export MAVEN_HOME=/mydata/maven/apache-maven-3.9.4 export PATH=$&#123;MAVEN_HOME&#125;/bin:$PATHsource /etc/profile éªŒè¯ 1mvn -v é…ç½®é˜¿é‡Œé•œåƒ(çœ‹æƒ…å†µ)","categories":[{"name":"æœåŠ¡å™¨","slug":"æœåŠ¡å™¨","permalink":"https://solitaire-12.github.io/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"}],"tags":[{"name":"ç¯å¢ƒ","slug":"ç¯å¢ƒ","permalink":"https://solitaire-12.github.io/tags/%E7%8E%AF%E5%A2%83/"}]},{"title":"linux|å®‰è£…Docker","slug":"Server/docker","date":"2024-03-18T08:20:07.000Z","updated":"2024-03-25T03:56:56.334Z","comments":true,"path":"2024/03/18/Server/docker/","permalink":"https://solitaire-12.github.io/2024/03/18/Server/docker/","excerpt":"","text":"ç¯å¢ƒ ï¼š centos 8.4.2105 æ£€æŸ¥æ˜¯å¦å­˜åœ¨docker 1docker -v å¸è½½docker 12345678910yum remove docker \\ docker-client \\ docker-client-latest \\ docker-common \\ docker-latest \\ docker-latest-logrotate \\ docker-logrotate \\ docker-selinux \\ docker-engine-selinux \\ docker-engine 123yum remove docker-ce \\ docker-ce-cli \\ containerd è®¾ç½®ä»“åº“ 1sudo yum install -y yum-utils device-mapper-persistent-data lvm2 ç¨³å®šä»“åº“ 12# é˜¿é‡Œäº‘sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo 1234# æ¸…åé•œåƒsudo yum-config-manager \\ --add-repo \\ https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/docker-ce.repo å®‰è£… Docker Engine-Community 1sudo yum install docker-ce docker-ce-cli containerd.io docker-compose-plugin é—®é¢˜ï¼š åŸå› ï¼šCentOS-8äº2021å¹´12æœˆ31æ—¥åœæ­¢äº†æºçš„æœåŠ¡ è§£å†³æ­¥éª¤ï¼š 1234567# 1cd /etc/yum.repos.d# 2mkdir bakcp * bak/# 3vi root_.repo #æŠŠenabled=1ï¼Œæ”¹æˆenable=0 æŒ‡å®šç‰ˆæœ¬å®‰è£… 123456789$ yum list docker-ce --showduplicates | sort -rdocker-ce.x86_64 3:18.09.1-3.el7 docker-ce-stabledocker-ce.x86_64 3:18.09.0-3.el7 docker-ce-stabledocker-ce.x86_64 18.06.1.ce-3.el7 docker-ce-stabledocker-ce.x86_64 18.06.0.ce-3.el7 docker-ce-stable$ sudo yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io å¯åŠ¨docker 123sudo systemctl start docker# è¿è¡Œhello-worldé•œåƒï¼ŒæŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸsudo docker run hello-world å¸è½½docker 1234# åˆ é™¤å®‰è£…åŒ…yum remove docker-ce# åˆ é™¤é•œåƒã€å®¹å™¨ã€é…ç½®æ–‡ä»¶ç­‰å†…å®¹rm -rf /var/lib/docker centos 8.2å®‰è£…é—®é¢˜ è®¾ç½®ä»“åº“æ—¶å‘ç”Ÿé—®é¢˜ï¼š è§£å†³ï¼šæ›´æ–°ä¸€ä¸‹yum 1yum -y update å‡ºç°Failed to download metadata for repo â€˜appstreamâ€™: Cannot prepare internal mirrorlist: No URLs in mirrorlist é—®é¢˜åŸå› ï¼š å› ä¸ºcentos8é¡¹ç›®å®˜æ–¹å·²äº2021å¹´åº•åœæ­¢ç»´æŠ¤ï¼Œç›¸å…³æºå·²æ— æ³•ä½¿ç”¨ï¼Œæ‰€ä»¥ç½‘ä¸Š22å¹´å‰çš„æ¢æºæ•™ç¨‹éƒ½å·²æ— æ³•ä½¿ç”¨ã€‚ è§£å†³ï¼š 12345678#è¿›å…¥é…ç½®æ–‡ä»¶ç›®å½•cd /etc/yum.repos.d/#åˆ é™¤æ—§çš„é…ç½®æ–‡ä»¶rm -rf *.repo# ä¸‹è½½å¯ç”¨çš„.repoæ–‡ä»¶wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-vault-8.5.2111.repo# è¿è¡Œ yum makecache ç”Ÿæˆç¼“å­˜yum makecache","categories":[{"name":"æœåŠ¡å™¨","slug":"æœåŠ¡å™¨","permalink":"https://solitaire-12.github.io/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"}],"tags":[{"name":"Docker","slug":"Docker","permalink":"https://solitaire-12.github.io/tags/Docker/"}]},{"title":"linux|å®‰è£…JDK","slug":"Server/JDK","date":"2024-03-18T08:14:07.000Z","updated":"2024-03-25T03:57:18.985Z","comments":true,"path":"2024/03/18/Server/JDK/","permalink":"https://solitaire-12.github.io/2024/03/18/Server/JDK/","excerpt":"","text":"æ¸…åäº‘ä¸‹è½½jdk ï¼š https://repo.huaweicloud.com/java/ 12345678910111213141516171819202122# æŸ¥çœ‹æ˜¯å¦å®‰è£…è¿‡jdkrpm -qa | grep java# â†‘è¿™é‡Œè¦æ˜¯å­˜åœ¨å†…å®¹ï¼Œæ‰§è¡Œåˆ é™¤rpm -qa | grep java | xargs rpm -e --nodeps# æŸ¥çœ‹javaç‰ˆæœ¬java -version# åˆ›å»ºå­˜æ”¾javaçš„æ–‡ä»¶mkdir /usr/java# cdè¿›å…¥è¿™ä¸€ä¸ªæ–‡ä»¶å¤¹# æŠŠä¸‹è½½å¥½çš„jdkä¸Šä¼ åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹# è§£å‹tar -xvf jdk1.8.0_202ar.gz# é…ç½®ç¯å¢ƒvi /etc/profile# åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ  ã€æ³¨æ„=é™„è¿‘ä¸è¦æœ‰ç©ºæ ¼ã€‘export JAVA_HOME=/usr/java/jdk1.8.0_202export CLASSPATH=$CLASSPATH:$JAVA_HOME/lib/ export PATH=$PATH:$JAVA_HOME/bin# åˆå§‹åŒ–é…ç½® - æ‰§è¡Œè¿™æ¡è¯­å¥ï¼Œå¯ä»¥è®©ç¯å¢ƒç«‹å³ç”Ÿæ•ˆï¼Œä¸éœ€è¦é‡å¯source /etc/profile# æŸ¥çœ‹ç‰ˆæœ¬ (æœ‰ä¿¡æ¯çš„è¯ï¼Œå°±å®‰è£…æˆåŠŸäº†)java -version å¦‚æœä¸Šè¿°ä¸­æ²¡æœ‰æ·»åŠ åˆ°ç¯å¢ƒä¸­ï¼Œå°è¯•ç»ˆç«¯ç›´æ¥è¿è¡Œä»¥ä¸‹ä»£ç  1234export JAVA_HOME=/mytools/java/jdk1.8.0_202export JRE_HOME=$&#123;JAVA_HOME&#125;/jreexport CLASSPATH=:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/libexport PATH=$&#123;JAVA_HOME&#125;/bin:$PATH","categories":[{"name":"æœåŠ¡å™¨","slug":"æœåŠ¡å™¨","permalink":"https://solitaire-12.github.io/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"}],"tags":[{"name":"ç¯å¢ƒ","slug":"ç¯å¢ƒ","permalink":"https://solitaire-12.github.io/tags/%E7%8E%AF%E5%A2%83/"}]},{"title":"Hexo|å›¾ç‰‡ç›¸å…³","slug":"Hexo/Hexo-å›¾ç‰‡ç›¸å…³","date":"2024-03-18T07:14:55.000Z","updated":"2024-03-18T07:55:33.857Z","comments":true,"path":"2024/03/18/Hexo/Hexo-å›¾ç‰‡ç›¸å…³/","permalink":"https://solitaire-12.github.io/2024/03/18/Hexo/Hexo-%E5%9B%BE%E7%89%87%E7%9B%B8%E5%85%B3/","excerpt":"","text":"1.ç›¸å¯¹è·¯å¾„æŒ‚è½½å›¾ç‰‡ã€æ–‡ç« æ˜¾ç¤ºã€‘ åœ¨ _config.ymlæ–‡ä»¶ä¸­é…ç½® post_asset_folder 1234post_asset_folder: truemarked: prependRoot: true postAsset: true ğŸ’¬é…ç½®ä¹‹åï¼Œå½“æ‰§è¡Œ hexo new titleNameä¹‹åï¼Œä¼šåœ¨è¯¥titleName.mdæ–‡ä»¶å¤¹çš„åŒçº§ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªåŒåæ–‡ä»¶å¤¹ç”¨æ¥å­˜æ”¾å›¾ç‰‡èµ„æºã€‚ .mdæ–‡ä»¶ä¸­ä½¿ç”¨ 1![](photoName.jpg) ğŸ’¬hexo-renderer-markedé»˜è®¤æ¸²æŸ“å¼•æ“ï¼Œé€šè¿‡hexo gä¹‹åï¼Œä¼šå°†è¯¥å›¾ç‰‡è·¯å¾„æ¸²æŸ“æˆç»å¯¹è·¯å¾„ã€‚åœ¨æ–‡ç« åˆ—è¡¨ä¸­ï¼Œæ— æ³•åŠ è½½å›¾ç‰‡ã€‚ 2.ç»å¯¹è·¯å¾„æŒ‚è½½å›¾ç‰‡ã€ä¸»é¡µæ˜¾ç¤ºã€‘ åœ¨sourceæ–‡ä»¶å¤¹ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªimgæ–‡ä»¶å¤¹ç”¨æ¥å­˜æ”¾å›¾ç‰‡ .mdæ–‡ä»¶ä¸­ä½¿ç”¨ 1![](/img/photoName.jpg) ğŸ’¬/imgä»£è¡¨æ ¹ç›®å½•ä¸‹çš„imgæ–‡ä»¶å¤¹ï¼Œå…¶ä¸­ /æŒ‡ä»£æ ¹ç›®å½•ã€publicæ–‡ä»¶å¤¹ã€‘ 3.åŒæ—¶æ˜¾ç¤º å®‰è£… hexo-asset-image 1npm hexo-asset-image --save å®‰è£…ä¹‹åï¼Œå‘ç°å›¾ç‰‡è·¯å¾„éƒ½ä¸æ˜¾ç¤ºäº†ï¼ŒF12æŸ¥çœ‹å›¾ç‰‡è·¯å¾„å˜æˆäº†/.io//xxx.xxã€‚ ä¿®å¤ä¸Šè¿°bugã€‚è¿›å…¥åˆ°node_modulesæ‰¾åˆ°hexo-asset-imageæ’ä»¶ï¼Œç”¨ä¸‹è¿°ä»£ç æ›¿æ¢æ‰index.jsåŸæœ‰ä»£ç ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859&quot;use strict&quot;;var cheerio = require(&quot;cheerio&quot;);// http://stackoverflow.com/questions/14480345/how-to-get-the-nth-occurrence-in-a-stringfunction getPosition(str, m, i) &#123; return str.split(m, i).join(m).length;&#125;var version = String(hexo.version).split(&quot;.&quot;);hexo.extend.filter.register(&quot;after_post_render&quot;, function (data) &#123; var config = hexo.config; if (config.post_asset_folder) &#123; var link = data.permalink; if (version.length &gt; 0 &amp;&amp; Number(version[0]) == 3) var beginPos = getPosition(link, &quot;/&quot;, 1) + 1; else var beginPos = getPosition(link, &quot;/&quot;, 3) + 1; // In hexo 3.1.1, the permalink of &quot;about&quot; page is like &quot;.../about/index.html&quot;. var endPos = link.lastIndexOf(&quot;/&quot;) + 1; link = link.substring(beginPos, endPos); var toprocess = [&quot;excerpt&quot;, &quot;more&quot;, &quot;content&quot;]; for (var i = 0; i &lt; toprocess.length; i++) &#123; var key = toprocess[i]; var $ = cheerio.load(data[key], &#123; ignoreWhitespace: false, xmlMode: false, lowerCaseTags: false, decodeEntities: false, &#125;); $(&quot;img&quot;).each(function () &#123; if ($(this).attr(&quot;src&quot;)) &#123; // For windows style path, we replace &#x27;\\&#x27; to &#x27;/&#x27;. var src = $(this).attr(&quot;src&quot;).replace(&quot;\\\\&quot;, &quot;/&quot;); if (!/http[s]*.*|\\/\\/.*/.test(src) &amp;&amp; !/^\\s*\\//.test(src)) &#123; // For &quot;about&quot; page, the first part of &quot;src&quot; can&#x27;t be removed. // In addition, to support multi-level local directory. var linkArray = link.split(&quot;/&quot;).filter(function (elem) &#123; return elem != &quot;&quot;; &#125;); var srcArray = src.split(&quot;/&quot;).filter(function (elem) &#123; return elem != &quot;&quot; &amp;&amp; elem != &quot;.&quot;; &#125;); if (srcArray.length &gt; 1) srcArray.shift(); src = srcArray.join(&quot;/&quot;); $(this).attr(&quot;src&quot;, config.root + link + src); console.info &amp;&amp; console.info(&quot;update link as:--&gt;&quot; + config.root + link + src); &#125; &#125; else &#123; console.info &amp;&amp; console.info(&quot;no src attr, skipped...&quot;); console.info &amp;&amp; console.info($(this)); &#125; &#125;); data[key] = $.html(); &#125; &#125;&#125;); æ›¿æ¢ä¹‹åï¼Œé‡æ–°hexo gå³å¯ã€‚ 4.æ”¯æŒemoji hexo-renderer-markedé»˜è®¤æ¸²æŸ“å¼•æ“å¹¶ä¸æ”¯æŒemojiï¼Œå´æ¢åˆ°å¯ä»¥æ”¯æŒçš„æ¸²æŸ“å¼•æ“ã€‚ç¬”è€…ä½¿ç”¨çš„æ˜¯ hexo-renderer-markdown-itã€‚ 12npm un hexo-renderer-marked --savenpm i hexo-renderer-markdown-it --save åœ¨ _config.ymlæ–‡ä»¶ä¸­é…ç½®ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243# hexo-renderer-markdown-itmarkdown: preset: &quot;default&quot; render: html: true xhtmlOut: false langPrefix: &quot;language-&quot; breaks: true linkify: true typographer: true quotes: &quot;â€œâ€â€˜â€™&quot; enable_rules: disable_rules: plugins: - markdown-it-abbr - markdown-it-cjk-breaks - markdown-it-deflist - markdown-it-emoji - markdown-it-footnote - markdown-it-ins - markdown-it-mark - markdown-it-sub - markdown-it-sup # - markdown-it-checkbox # - markdown-it-imsize # - markdown-it-expandable - name: markdown-it-container options: success - name: markdown-it-container options: tips - name: markdown-it-container options: warning - name: markdown-it-container options: danger anchors: level: 2 collisionSuffix: &quot;&quot; permalink: false permalinkClass: &quot;header-anchor&quot; permalinkSide: &quot;left&quot; permalinkSymbol: &quot;Â¶&quot; case: 0 separator: &quot;-&quot; å‚è€ƒï¼š Hexoå›¾ç‰‡ç›¸å…³ - æ–‡ç« æ˜¾ç¤ºã€ä¸»é¡µæ˜¾ç¤ºã€ä¿®æ”¹fancybox_hexo æ–‡ç« ç¼©ç•¥-CSDNåšå®¢ ã€Hexoã€‘é€‰æ‹©æ›´é«˜çº§çš„Markdownæ¸²æŸ“å™¨_hexo-renderer-marked-CSDNåšå®¢","categories":[{"name":"åšå®¢","slug":"åšå®¢","permalink":"https://solitaire-12.github.io/categories/%E5%8D%9A%E5%AE%A2/"}],"tags":[{"name":"Hexo","slug":"Hexo","permalink":"https://solitaire-12.github.io/tags/Hexo/"}]},{"title":"æ•°æ®ç®¡ç†DMS","slug":"Server/dms","date":"2024-03-18T05:40:07.000Z","updated":"2024-03-25T03:56:51.512Z","comments":true,"path":"2024/03/18/Server/dms/","permalink":"https://solitaire-12.github.io/2024/03/18/Server/dms/","excerpt":"","text":"ä¸‹è½½ï¼šæ•°æ®ç®¡ç†DMSâ€“ä¸‹è½½ä¸­å¿ƒ (aliyun.com) æœ¬åœ°éƒ¨ç½²ï¼š å®‰è£…å¥½ä¹‹åï¼Œç™»å½•å®ä¾‹å³å¯ã€‚ é—®é¢˜ï¼šå†…ç½‘IPé“¾æ¥å¤±è´¥ è§£å†³æ–¹æ³•ï¼šã€æœ¬åœ°æ•°æ®åº“æ˜¯MySQLã€‘ ç™»å½•æ•°æ®åº“ï¼Œåˆ‡æ¢åˆ°mysql 1select user,host from user; # æŸ¥çœ‹ä¿¡æ¯ âš ï¸ä¸Šè¿°ä¿¡æ¯æ˜¯æŒ‡è¯¥ç”¨æˆ·ååªèƒ½é€šè¿‡localhostè¿™ä¸ªåœ°å€è¿›è¡Œè®¿é—®ã€‚ ä¿®æ”¹rootç”¨æˆ·çš„host 1update user set host =&quot;%&quot; where user = &quot;root&quot;; åˆ·æ–°æƒé™ 1flush privileges;","categories":[{"name":"æœåŠ¡å™¨","slug":"æœåŠ¡å™¨","permalink":"https://solitaire-12.github.io/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"}],"tags":[{"name":"DMS","slug":"DMS","permalink":"https://solitaire-12.github.io/tags/DMS/"}]},{"title":"Hello World","slug":"hello-world","date":"2024-03-14T05:00:15.235Z","updated":"2024-03-25T02:10:12.947Z","comments":true,"path":"2024/03/14/hello-world/","permalink":"https://solitaire-12.github.io/2024/03/14/hello-world/","excerpt":"","text":"$log_{}n$ $$ log_{}n $$ ğŸ˜„ $$ \\frac{m}{2}\\leq k \\leq m $$ $log_{2}n$ Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick Start Create a new post 1$ hexo new &quot;My New Post&quot; More info: Writing Run server 1$ hexo server More info: Server Generate static files 1$ hexo generate More info: Generating Deploy to remote sites 1$ hexo deploy More info: Deployment","categories":[{"name":"åˆå§‹","slug":"åˆå§‹","permalink":"https://solitaire-12.github.io/categories/%E5%88%9D%E5%A7%8B/"}],"tags":[]}],"categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://solitaire-12.github.io/categories/MySQL/"},{"name":"Spring","slug":"Spring","permalink":"https://solitaire-12.github.io/categories/Spring/"},{"name":"Redis","slug":"Redis","permalink":"https://solitaire-12.github.io/categories/Redis/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://solitaire-12.github.io/categories/%E7%AE%97%E6%B3%95/"},{"name":"Java","slug":"Java","permalink":"https://solitaire-12.github.io/categories/Java/"},{"name":"æœåŠ¡å™¨","slug":"æœåŠ¡å™¨","permalink":"https://solitaire-12.github.io/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"},{"name":"åšå®¢","slug":"åšå®¢","permalink":"https://solitaire-12.github.io/categories/%E5%8D%9A%E5%AE%A2/"},{"name":"åˆå§‹","slug":"åˆå§‹","permalink":"https://solitaire-12.github.io/categories/%E5%88%9D%E5%A7%8B/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"https://solitaire-12.github.io/tags/MySQL/"},{"name":"spring","slug":"spring","permalink":"https://solitaire-12.github.io/tags/spring/"},{"name":"AOP","slug":"AOP","permalink":"https://solitaire-12.github.io/tags/AOP/"},{"name":"IOC","slug":"IOC","permalink":"https://solitaire-12.github.io/tags/IOC/"},{"name":"redis","slug":"redis","permalink":"https://solitaire-12.github.io/tags/redis/"},{"name":"é«˜å¯ç”¨","slug":"é«˜å¯ç”¨","permalink":"https://solitaire-12.github.io/tags/%E9%AB%98%E5%8F%AF%E7%94%A8/"},{"name":"æŒä¹…åŒ–","slug":"æŒä¹…åŒ–","permalink":"https://solitaire-12.github.io/tags/%E6%8C%81%E4%B9%85%E5%8C%96/"},{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://solitaire-12.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"JavaåŸºç¡€","slug":"JavaåŸºç¡€","permalink":"https://solitaire-12.github.io/tags/Java%E5%9F%BA%E7%A1%80/"},{"name":"æ’åº","slug":"æ’åº","permalink":"https://solitaire-12.github.io/tags/%E6%8E%92%E5%BA%8F/"},{"name":"Java8","slug":"Java8","permalink":"https://solitaire-12.github.io/tags/Java8/"},{"name":"JVM","slug":"JVM","permalink":"https://solitaire-12.github.io/tags/JVM/"},{"name":"å†…ç½‘ç©¿é€","slug":"å†…ç½‘ç©¿é€","permalink":"https://solitaire-12.github.io/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"},{"name":"éƒ¨ç½²","slug":"éƒ¨ç½²","permalink":"https://solitaire-12.github.io/tags/%E9%83%A8%E7%BD%B2/"},{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"https://solitaire-12.github.io/tags/RabbitMQ/"},{"name":"Nginx","slug":"Nginx","permalink":"https://solitaire-12.github.io/tags/Nginx/"},{"name":"minio","slug":"minio","permalink":"https://solitaire-12.github.io/tags/minio/"},{"name":"ç¯å¢ƒ","slug":"ç¯å¢ƒ","permalink":"https://solitaire-12.github.io/tags/%E7%8E%AF%E5%A2%83/"},{"name":"Docker","slug":"Docker","permalink":"https://solitaire-12.github.io/tags/Docker/"},{"name":"Hexo","slug":"Hexo","permalink":"https://solitaire-12.github.io/tags/Hexo/"},{"name":"DMS","slug":"DMS","permalink":"https://solitaire-12.github.io/tags/DMS/"}]}