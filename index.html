<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>知秋个人博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="知秋个人博客">
<meta property="og:url" content="https://solitaire-12.github.io/index.html">
<meta property="og:site_name" content="知秋个人博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="solitaire-12">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="知秋个人博客" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">知秋个人博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://solitaire-12.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-Java/Java8" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/18/Java/Java8/" class="article-date">
  <time class="dt-published" datetime="2024-03-18T12:14:55.000Z" itemprop="datePublished">2024-03-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/18/Java/Java8/">Java|Java8</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1>java8实战汇总</h1>
<h2 id="Lambda表达式">Lambda表达式</h2>
<p><code>Lambda表达式有三个部分，参数-&gt;主体</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(parameters) -&gt; expression</span><br><span class="line">(parameters) -&gt;&#123; statements; &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">() -&gt; &#123;&#125; </span><br><span class="line">() -&gt; <span class="string">&quot;Raoul&quot;</span></span><br><span class="line">() -&gt; &#123;<span class="keyword">return</span> <span class="string">&quot;Mario&quot;</span>; &#125;</span><br><span class="line"><span class="comment">// return是一个控制流语句。要使用此Lambda有效，需要使用花括号</span></span><br><span class="line">(Integer i) -&gt; <span class="keyword">return</span> <span class="string">&quot;Alan&quot;</span> + i;</span><br><span class="line">	(Integer i) -&gt; &#123;<span class="keyword">return</span> <span class="string">&quot;Alan&quot;</span> + i;&#125;</span><br><span class="line"><span class="comment">// “Iron Man”是一个表达式，不是一个语句。要使此Lambda有效，可以去除花括号和分号</span></span><br><span class="line">(String s) -&gt; &#123;<span class="string">&quot;Iron Man&quot;</span>; &#125;</span><br><span class="line">	(String s) -&gt; <span class="string">&quot;Iron Man&quot;</span>; </span><br></pre></td></tr></table></figure>
<h3 id="演示代码">演示代码</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="stream流的操作">stream流的操作</h2>
<p>❏ 元素序列——就像集合一样，流也提供了一个接口，可以访问特定元素类型的一组有序值。因为集合是数据结构，所以它的主要目的是以特定的时间/空间复杂度存储和访问元素（如ArrayList与LinkedList）。但流的目的在于表达计算，比如你前面见到的filter、sorted和map。集合讲的是数据，流讲的是计算。后面几节会详细解释这个思想。</p>
<p>❏ 源——流会使用一个提供数据的源，比如集合、数组或I/O资源。请注意，从有序集合生成流时会保留原有的顺序。由列表生成的流，其元素顺序与列表一致。</p>
<p>❏ 数据处理操作——流的数据处理功能支持类似于数据库的操作，以及函数式编程语言中的常用操作，比如filter、map、reduce、find、match、sort等。流操作可以顺序执行，也可以并行执行。</p>
<p>流操作有两个重要的特点。</p>
<p>❏ 流水线——很多流操作本身会返回一个流，这样多个操作就可以链接起来，构成一个更大的流水线。这使得一些优化成为可能，比如处理延迟和短路。流水线的操作可以看作类似对数据源进行数据库查询。</p>
<p>❏ 内部迭代——与集合使用迭代器进行显式迭代不同，流的迭代操作是在后台进行的。</p>
<h3 id="示例代码">示例代码</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Dish&gt; menu = Arrays.asList(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Dish</span>(<span class="string">&quot;pork&quot;</span>, <span class="literal">false</span>, <span class="number">800</span>, Dish.Type.MEAT),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Dish</span>(<span class="string">&quot;beef&quot;</span>, <span class="literal">false</span>, <span class="number">700</span>, Dish.Type.MEAT),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Dish</span>(<span class="string">&quot;chicken&quot;</span>, <span class="literal">false</span>, <span class="number">400</span>, Dish.Type.MEAT),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Dish</span>(<span class="string">&quot;french fries&quot;</span>, <span class="literal">true</span>, <span class="number">530</span>, Dish.Type.OTHER),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Dish</span>(<span class="string">&quot;rice&quot;</span>, <span class="literal">true</span>, <span class="number">350</span>, Dish.Type.OTHER),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Dish</span>(<span class="string">&quot;season fruit&quot;</span>, <span class="literal">true</span>, <span class="number">120</span>, Dish.Type.OTHER),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Dish</span>(<span class="string">&quot;pizza&quot;</span>, <span class="literal">true</span>, <span class="number">550</span>, Dish.Type.OTHER),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Dish</span>(<span class="string">&quot;prawns&quot;</span>, <span class="literal">false</span>, <span class="number">300</span>, Dish.Type.FISH),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Dish</span>(<span class="string">&quot;salmon&quot;</span>, <span class="literal">false</span>, <span class="number">450</span>, Dish.Type.FISH) );</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dish</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">boolean</span> vegetarian;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> calories;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Type type;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Dish</span><span class="params">(String name, <span class="type">boolean</span> vegetarian, <span class="type">int</span> calories, Type type)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.vegetarian = vegetarian;</span><br><span class="line">        <span class="built_in">this</span>.calories = calories;</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isVegetarian</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> vegetarian;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCalories</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> calories;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Type <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> type;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Type</span> &#123; MEAT, FISH, OTHER &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="初次使用stream">初次使用stream</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// toList()是一个静态方法，需要 import static java.util.stream.Collectors.toList;</span></span><br><span class="line"><span class="comment">// 要是不想导包，可以把toList() 改成 Collectors.toList()</span></span><br><span class="line">List&lt;String&gt; collect = menu.stream().filter(dish -&gt; dish.getCalories() &gt; <span class="number">300</span>)</span><br><span class="line">    .map(Dish::getName)</span><br><span class="line">    .limit(<span class="number">3</span>)</span><br><span class="line">    .collect(toList());</span><br><span class="line">System.out.println(collect);</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Java/Java8/%E9%80%BB%E8%BE%91%E6%8F%8F%E8%BF%B0.png" alt></p>
<blockquote>
<p>上述中<code>Dish::getName</code>相当于<code>Lambda d -&gt; d.getName()</code></p>
<p>筛选（filter）、提取（map）或截断（limit）功能</p>
</blockquote>
<h3 id="流的特性">流的特性</h3>
<h4 id="只能遍历一遍">只能遍历一遍</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Dish&gt; stream = menu.stream();</span><br><span class="line">stream.forEach(System.out::println);</span><br><span class="line">stream.forEach(System.out::println);</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Java/Java8/%E6%B5%81%E5%8F%AA%E8%83%BD%E8%A2%AB%E9%81%8D%E5%8E%86%E4%B8%80%E6%AC%A1.png" alt></p>
<h4 id="内部迭代">内部迭代</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用for-each循环外部迭代</span></span><br><span class="line">ArrayList&lt;String&gt; names = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (Dish dish : menu) &#123;</span><br><span class="line">    names.add(dish.getName());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * for-each结构是一个语法糖，其背后逻辑是一个迭代器，Iterator</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">ArrayList&lt;String&gt; names = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">Iterator&lt;Dish&gt; iterator = menu.iterator();</span><br><span class="line"><span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">    names.add(iterator.next().getName());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// stream的内部迭代</span></span><br><span class="line">List&lt;String&gt; names = menu.stream().map(Dish::getName).collect(toList());</span><br><span class="line"></span><br><span class="line">System.out.println(names);</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Java/Java8/%E5%86%85%E9%83%A8%E8%BF%AD%E4%BB%A3%E5%92%8C%E5%A4%96%E9%83%A8%E8%BF%AD%E4%BB%A3%E7%9A%84%E5%8C%BA%E5%88%AB.png" alt></p>
<h4 id="重构测试">重构测试</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; highCaloricDishes = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">Iterator&lt;String&gt; iterator = menu.iterator();</span><br><span class="line"><span class="keyword">while</span>(iterator.hasNext()) &#123;</span><br><span class="line">    <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">    <span class="keyword">if</span>(dish.getCalories() &gt; <span class="number">300</span>) &#123;</span><br><span class="line">        highCaloricDishes.add(d.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; highCaloricDishes =</span><br><span class="line">    menu.stream()</span><br><span class="line">    	.filter(dish -&gt; dish.getCalories() &gt; <span class="number">300</span>)</span><br><span class="line">    	.collect(toList());</span><br></pre></td></tr></table></figure>
<h3 id="流的操作">流的操作</h3>
<p><a href="#%E5%88%9D%E6%AC%A1%E4%BD%BF%E7%94%A8stream">从上述代码中</a>,不难看出，stream()之后跟着filter，map，limit，collect等操作，这是<code>java.util.stream.Stream</code>中的Stream接口定义的操作，它们可以分成两类。</p>
<blockquote>
<p>❏ 中间操作：filter、map和limit可以连成一条流水线；</p>
<p>❏终端操作： collect触发流水线执行并关闭它。</p>
</blockquote>
<p><strong>总结</strong>：</p>
<ol>
<li>一个数据源</li>
<li>一个中间操作链，形成流水线</li>
<li>一个终端操作，执行流水线，并生成结果</li>
</ol>
<h4 id="中间操作">中间操作</h4>
<table>
<thead>
<tr>
<th>类型</th>
<th style="text-align:center">操作</th>
<th style="text-align:center">返回类型</th>
<th style="text-align:center">操作参数</th>
<th style="text-align:center">函数描述</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td style="text-align:center"><code>filter</code></td>
<td style="text-align:center"><code>Stream&lt;T&gt;</code></td>
<td style="text-align:center"><code>Predicate&lt;T&gt;</code></td>
<td style="text-align:center"><code>T -&gt; boolean</code></td>
<td><a href="#%E8%B0%93%E8%AF%8D%E7%AD%9B%E9%80%89">筛选</a></td>
</tr>
<tr>
<td></td>
<td style="text-align:center"><code>map</code></td>
<td style="text-align:center"><code>Stream&lt;R&gt;</code></td>
<td style="text-align:center"><code>Function&lt;T,R&gt;</code></td>
<td style="text-align:center"><code>T -&gt; R</code></td>
<td><a href="#%E6%98%A0%E5%B0%84">获取</a></td>
</tr>
<tr>
<td>有状态-无界</td>
<td style="text-align:center"><code>limit</code></td>
<td style="text-align:center"><code>Stream&lt;T&gt;</code></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td><a href="#%E6%88%AA%E7%9F%AD%E6%B5%81">截选</a></td>
</tr>
<tr>
<td>有状态-无界</td>
<td style="text-align:center"><code>skip</code></td>
<td style="text-align:center"><code>Stream&lt;T&gt;</code></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td><a href="#%E8%B7%B3%E8%BF%87%E5%85%83%E7%B4%A0">跳过</a></td>
</tr>
<tr>
<td>有状态-无界</td>
<td style="text-align:center"><code>sorted</code></td>
<td style="text-align:center"><code>Stream&lt;T&gt;</code></td>
<td style="text-align:center"><code>Comparator&lt;T&gt;</code></td>
<td style="text-align:center"><code>(T,T) -&gt; int</code></td>
<td></td>
</tr>
<tr>
<td>有状态-无界</td>
<td style="text-align:center"><code>distinct</code></td>
<td style="text-align:center"><code>Stream&lt;T&gt;</code></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td><a href="#%E7%AD%9B%E9%80%89%E5%90%84%E5%BC%82%E7%9A%84%E5%85%83%E7%B4%A0">去重</a></td>
</tr>
<tr>
<td></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="终端操作">终端操作</h4>
<table>
<thead>
<tr>
<th>类型</th>
<th style="text-align:center">操作</th>
<th style="text-align:center">返回类型</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td style="text-align:center"><code>forEach</code></td>
<td style="text-align:center">void</td>
<td style="text-align:center">消费流中的每个元素并对其应用Lambda</td>
</tr>
<tr>
<td></td>
<td style="text-align:center"><code>count</code></td>
<td style="text-align:center">long</td>
<td style="text-align:center">返回流中元素的个数</td>
</tr>
<tr>
<td></td>
<td style="text-align:center"><code>collect</code></td>
<td style="text-align:center">(generic)</td>
<td style="text-align:center">把流整合成一个集合，比如List，Map，甚至是Iterator</td>
</tr>
<tr>
<td></td>
<td style="text-align:center"><code>anyMatch</code></td>
<td style="text-align:center">boolean</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td></td>
<td style="text-align:center"><code>noneMatch</code></td>
<td style="text-align:center">boolean</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td></td>
<td style="text-align:center"><code>allMatch</code></td>
<td style="text-align:center">boolean</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td></td>
<td style="text-align:center"><code>findAny</code></td>
<td style="text-align:center"><code>Optinal&lt;T&gt;</code></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td></td>
<td style="text-align:center"><code>findFirst</code></td>
<td style="text-align:center"><code>Optinal&lt;T&gt;</code></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td>有状态-有界</td>
<td style="text-align:center"><code>reduce</code></td>
<td style="text-align:center"><code>Optinal&lt;T&gt;</code></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<h3 id="使用流">使用流</h3>
<h4 id="筛选">筛选</h4>
<h5 id="谓词筛选">谓词筛选</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Dish&gt; collect = menu.stream().filter(Dish::isVegetarian).collect(toList());</span><br><span class="line">System.out.println(collect);</span><br></pre></td></tr></table></figure>
<h5 id="筛选各异的元素">筛选各异的元素</h5>
<blockquote>
<p>流还支持一个叫作distinct的方法，它会返回一个元素各异（根据流所生成元素的hashCode和equals方法实现）的流。例如，以下代码会筛选出列表中所有的偶数，并确保没有重复（使用equals方法进行比较)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">numbers.stream()</span><br><span class="line">    .filter(i -&gt; i % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">    .distinct()</span><br><span class="line">    .forEach(System.out::println);</span><br></pre></td></tr></table></figure>
<h4 id="切片">切片</h4>
<h5 id="谓词切片">谓词切片</h5>
<p><code>takeWhile</code>和<code>dropWhile</code>，这两个是java9引入的新方法。</p>
<blockquote>
<p>引入原因：倘若<a href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81">数据源</a>已经按照热量从小到大排序了，还要筛选出热量小于320的数据，filter筛选会去遍历所有数据，这样比较消耗性能。所以引入了<code>takeWhile</code>和<code>dropWhile</code>。</p>
<p><code>takeWhile</code>:通过谓词去选取出符合的数据，遭遇到第一个不符合的元素时，停止处理</p>
<p><code>dropWhile</code>:和<code>taskWhile</code>是相反的操作，它会删除掉符合要求的数据</p>
</blockquote>
<h5 id="截短流">截短流</h5>
<blockquote>
<p>流支持limit(n)方法，该方法会返回另一个不超过给定长度的流。所需的长度作为参数传递给limit。如果流是有序的，则最多会返回前n个元素。</p>
</blockquote>
<h5 id="跳过元素">跳过元素</h5>
<blockquote>
<p>流还支持skip(n)方法，返回一个扔掉了前n个元素的流。如果流中元素不足n个，则返回一个空流。请注意，limit(n)和skip(n)是互补的</p>
</blockquote>
<h4 id="映射">映射</h4>
<blockquote>
<p>流支持map方法，它会接受一个函数作为参数。这个函数会被应用到每个元素上，并将其映射成一个新的元素（使用映射一词，是因为它和转换类似，但其中的细微差别在于它是“创建一个新版本”而不是去“修改”）</p>
</blockquote>
<h5 id="流的扁平化">流的扁平化</h5>
<p><strong>案例</strong></p>
<blockquote>
<p>对于一张单词表，如何返回一张列表，列出里面各不相同的字符?</p>
<p>例如，给定单词列表[“Hello”,“World”]，要返回列表[“H”, “e”, “l”, “o”, “W”, “r”, “d”]</p>
</blockquote>
<p><strong>尝试1</strong>：不行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; words = Arrays.asList(&quot;hello&quot;, &quot;world&quot;);</span><br><span class="line">List&lt;String[]&gt; collect = </span><br><span class="line">	words.stream()</span><br><span class="line">        .map(word -&gt; word.split(&quot;&quot;))</span><br><span class="line">        .distinct()</span><br><span class="line">        .collect(toList());</span><br><span class="line">System.out.println(&quot;words = &quot; + words);</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Java/Java8/%E6%B5%8B%E8%AF%95%EF%BC%9A%E6%89%81%E5%B9%B3%E5%8C%961.png" alt></p>
<p><strong>尝试2</strong>：不行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; words = Arrays.asList(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>);</span><br><span class="line">List&lt;Stream&lt;String&gt;&gt; collect = </span><br><span class="line">    words.stream()</span><br><span class="line">        .map(word -&gt; word.split(<span class="string">&quot;&quot;</span>))</span><br><span class="line">        .map(Arrays::stream)</span><br><span class="line">        .distinct()</span><br><span class="line">        .collect(toList());</span><br><span class="line">System.out.println(<span class="string">&quot;words = &quot;</span> + words);</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Java/Java8/%E6%B5%8B%E8%AF%95%EF%BC%9A%E6%89%81%E5%B9%B3%E5%8C%962.png" alt></p>
<p><em>解释<code>Arrays::stream</code></em>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String[] arrayOfWords = &#123;<span class="string">&quot;Goodbye&quot;</span>, <span class="string">&quot;World&quot;</span>&#125;;</span><br><span class="line">List&lt;String&gt; streamOfwords = Arrays</span><br><span class="line">    .stream(arrayOfWords) <span class="comment">// 这是Stream&lt;String&gt;类型的</span></span><br><span class="line">    .collect(toList());</span><br></pre></td></tr></table></figure>
<p><strong>尝试3</strong>：使用<code>flatMap</code>,成功</p>
<h6 id="flatMap">flatMap</h6>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; words = Arrays.asList(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>);</span><br><span class="line">List&lt;String&gt; collect = </span><br><span class="line">    words.stream()</span><br><span class="line">        .map(word -&gt; word.split(<span class="string">&quot;&quot;</span>))</span><br><span class="line">        .flatMap(Arrays::stream)</span><br><span class="line">        .distinct()</span><br><span class="line">        .collect(toList());</span><br><span class="line">System.out.println(<span class="string">&quot;words = &quot;</span> + words);</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Java/Java8/%E6%B5%8B%E8%AF%95%EF%BC%9A%E6%89%81%E5%B9%B3%E5%8C%963.png" alt></p>
<h4 id="查找和匹配">查找和匹配</h4>
<blockquote>
<p>另一个常见的数据处理套路是看看数据集中的某些元素是否匹配一个给定的属性。Stream API通过allMatch、anyMatch、noneMatch、findFirst和findAny方法提供了这样的工具。</p>
</blockquote>
<h5 id="anyMatch">anyMatch</h5>
<blockquote>
<p>anyMatch方法可以回答“流中是否有一个元素能匹配给定的谓词”</p>
<p>比如↓，你可以用它来看看菜单里面是否有素食可选择</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(menu.stream().anyMatch(Dish::isVegetarian))&#123;</span><br><span class="line">	System.out.println(<span class="string">&quot;The menu is (somewhat) vegetarian friendly! ! &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//anyMatch方法返回一个boolean</span></span><br></pre></td></tr></table></figure>
<h5 id="allMatch">allMatch</h5>
<blockquote>
<p>allMatch方法会看流中的元素是否都能匹配给定的谓词。</p>
<p>比如↓，你可以用它来看看菜品是否有利健康（即所有菜的热量都低于1000卡路里）：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="variable">isHealthy</span> <span class="operator">=</span> menu.stream().allMatch(dish -&gt; dish.getCalories() &lt; <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<h5 id="noneMatch">noneMatch</h5>
<blockquote>
<p>它可以确保流中没有任何元素与给定的谓词匹配</p>
<p>比如↓，你可以用noneMatch重写前面的例子</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="variable">isHealthy</span> <span class="operator">=</span> menu.stream().noneMatch(dish -&gt; dish.getCalories() &gt;= <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<h5 id="findAny">findAny</h5>
<blockquote>
<p>findAny方法将返回当前流中的任意元素。它可以与其他流操作结合使用</p>
<p>比如↓，你可能想找到一道素食菜肴。可以结合使用filter和findAny方法来实现这个查询</p>
<p><a href="#Optional%E7%AE%80%E4%BB%8B">Optional</a></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;Dish&gt; dish = menu.stream().filter(Dish::isVegetarian).findAny();</span><br></pre></td></tr></table></figure>
<h5 id="findFirst">findFirst</h5>
<blockquote>
<p>有些流由一个出现顺序（encounter order）来指定流中项目出现的逻辑顺序（比如由List或排序好的数据列生成的流）。对于这种流，你可能想要找到第一个元素。为此有一个findFirst方法，它的工作方式类似于findAny</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; someNumbers = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">Optional&lt;Integer&gt; firstSquareDivisibleByThree =</span><br><span class="line">    someNumbers.stream()</span><br><span class="line">    .map(n -&gt; n * n)</span><br><span class="line">    .filter(n -&gt; n % <span class="number">3</span> == <span class="number">0</span>)</span><br><span class="line">    .findFirst(); <span class="comment">// 9</span></span><br></pre></td></tr></table></figure>
<h4 id="归约-reduce">归约-reduce</h4>
<blockquote>
<p>此类查询需要将流中所有元素反复结合起来，得到一个值，比如一个Integer。这样的查询可以被归类为归约操作（将流归约成一个值）。用函数式编程语言的术语来说，这称为折叠（fold），因为你可以将这个操作看成把一张长长的纸（你的流）反复折叠成一个小方块，而这就是折叠操作的结果</p>
</blockquote>
<h5 id="求和">求和</h5>
<blockquote>
<p>在研究如何使用reduce方法之前，先来看看如何使用for-each循环来对数字列表中的元素求和</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : numbers) &#123;</span><br><span class="line">    sum += x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从上述代码看，for-each的求和过程并不复杂，那为什么还要引入reduce呢？</p>
<blockquote>
<p>for-each代码复用率低，reduce对重复应用的模式做了抽象</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入reduce求和</span></span><br><span class="line"><span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> numbers.stream().reduce(<span class="number">0</span>,(a,b)-&gt;a+b);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>reduce接收的参数：</p>
<ol>
<li>
<p>初始值，即对应for-each中的sum</p>
</li>
<li>
<p><code>BinaryOperator&lt;T&gt;</code>用来将两个元素结合起来产生一个新的值。上述代码中是一个lambda表达式</p>
</li>
</ol>
<p><code>(a,b)-&gt;a+b</code></p>
</blockquote>
<p>所以，当有累乘的业务时，我们可也写成：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">product</span> <span class="operator">=</span> numbers.stream().reduce(<span class="number">1</span>,(a,b)-&gt;a*b);</span><br></pre></td></tr></table></figure>
<ul>
<li>引入java8静态方法sum进行求和</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> numbers.stream().reduce(<span class="number">0</span>,Integer::sum);</span><br></pre></td></tr></table></figure>
<ul>
<li>无初始值</li>
</ul>
<blockquote>
<p>reduce还有一个重载的变体，它不接受初始值，但是会返回一个Optional对象</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> numbers.stream().reduce((a,b)-&gt;a+b);</span><br></pre></td></tr></table></figure>
<h5 id="最大值和最小值">最大值和最小值</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;Integer&gt; max = numbers.stream().reduce(Integer::max);</span><br><span class="line">Optional&lt;Integer&gt; min = numbers.stream().reduce(Integer::min);</span><br></pre></td></tr></table></figure>
<h5 id="归约方法的优势与并行化">归约方法的优势与并行化</h5>
<blockquote>
<p>从for-each循环求和来看，这种迭代求和方式一旦并行，问题时致命的。而reduce提供了更加安全，简便的实现方式。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// use stream to sum all elements in parallel</span></span><br><span class="line"><span class="comment">// 使用流对所有元素并行求和</span></span><br><span class="line"><span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> numbers.parallelStream().reduce(<span class="number">0</span>,Integer::sum);</span><br></pre></td></tr></table></figure>
<h4 id="原始类型流特化">原始类型流特化</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int calories = menu.stream().map(Dish::getCalories).reduce(0, Integer::sum);</span><br></pre></td></tr></table></figure>
<p>像上述代码，直接写成<code>int calories = menu.stream().map(Dish::getCalories).sum();</code>不是更好？但这却是不可能的，因为map方法生成的是<code>Stream&lt;T&gt;</code>类型的数据，没办法通过<code>sum()</code>方法来实现求和，不过Stream API提供了<strong>原始类型流特化</strong>，专门处理数值流的方法</p>
<blockquote>
<p>IntStream、DoubleStream和LongStream，分别将流中的元素特化为int、long和double，从而避免了暗含的装箱成本</p>
</blockquote>
<h5 id="映射到数值流">映射到数值流</h5>
<blockquote>
<p>将流转换为特化版本的常用方法是mapToInt、mapToDouble和mapToLong</p>
<p>这些方法和前面说的map方法的工作方式一样，只是它们返回的是一个特化流，而不是Stream<T></T></p>
<p>IntStream还支持其他的方便方法，如max、min、average等</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int sum = </span><br><span class="line">	menu.stream() //Stream&lt;Dish&gt;</span><br><span class="line">        .mapToInt(Dish::getCalories) // IntStream</span><br><span class="line">        .sum(); // 如果IntStream是空的话，返回的是0</span><br></pre></td></tr></table></figure>
<h5 id="转换回对象流">转换回对象流</h5>
<blockquote>
<p>同样，一旦有了数值流，你可能会想把它转换回非特化流。例如，IntStream上的操作只能产生原始整数：IntStream的map操作接受的Lambda必须接受int并返回int（一个IntUnaryOperator）。但是你可能想要生成另一类值，比如Dish</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">IntStream intStream = menu.stream()</span><br><span class="line">	.mapToInt(Dish::getCalories);</span><br><span class="line">Stream&lt;Integer&gt; stream = intStream.boxed();</span><br></pre></td></tr></table></figure>
<h5 id="默认值OptionalInt">默认值OptionalInt</h5>
<blockquote>
<p>求和的那个例子很容易，因为它有一个默认值：0。但是，如果你要计算IntStream中的最大元素，就得换个法子了，因为0是错误的结果</p>
<p>Optional类，这是一个可以表示值存在或不存在的容器。Optional可以用Integer、String等参考类型来参数化。对于三种原始流特化，也分别有一个Optional原始类型特化版本：OptionalInt、OptionalDouble和OptionalLong</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">OptionalInt maxCalories = </span><br><span class="line">	menu.stream()</span><br><span class="line">        .mapToInt(Dish::getCalories)</span><br><span class="line">        .max();</span><br><span class="line">System.out.println(&quot;maxCalories = &quot; + maxCalories);</span><br><span class="line">int max = maxCalories.orElse(1);</span><br></pre></td></tr></table></figure>
<h5 id="数值范围">数值范围</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">IntStream.range(1, 10)        </span><br><span class="line">	.filter(value -&gt; value % 2 == 0)        </span><br><span class="line">	.forEach(System.out::println);</span><br><span class="line">	// ↑结果：2，4，6，8</span><br><span class="line">IntStream.rangeClosed(1, 10)</span><br><span class="line">    .filter(value -&gt; value % 2 == 0)</span><br><span class="line">    .forEach(System.out::println);</span><br><span class="line">    // ↑结果：2，4，6，8，10</span><br><span class="line">    // 总结range范围[x,y),rangeClosed范围[x,y]</span><br></pre></td></tr></table></figure>
<p><strong>尝试：获取勾股数</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;<span class="type">int</span>[]&gt; pythagoreanTriples =</span><br><span class="line">    IntStream.rangeClosed(<span class="number">1</span>, <span class="number">100</span>).boxed()</span><br><span class="line">    	.flatMap(a -&gt;</span><br><span class="line">             IntStream.rangeClosed(a, <span class="number">100</span>)</span><br><span class="line">             .filter(b -&gt; Math.sqrt(a*a + b*b) % <span class="number">1</span> == <span class="number">0</span>)</span><br><span class="line">             .mapToObj(</span><br><span class="line">                 b -&gt; <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;a, b, (<span class="type">int</span>)Math.sqrt(a * a + b * b)&#125;)</span><br><span class="line">            	);</span><br><span class="line">pythagoreanTriples.limit(<span class="number">5</span>).forEach(t-&gt;System.out.println(t[<span class="number">0</span>]+<span class="string">&quot;,&quot;</span>+ t[<span class="number">1</span>] + <span class="string">&quot;,&quot;</span> + t[<span class="number">2</span>]));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Stream&lt;<span class="type">double</span>[]&gt; pythagoreanTriples =</span><br><span class="line">    IntStream.rangeClosed(<span class="number">1</span>, <span class="number">100</span>).boxed()</span><br><span class="line">    	.flatMap(a -&gt;</span><br><span class="line">             IntStream.rangeClosed(a, <span class="number">100</span>)</span><br><span class="line">             .mapToObj(</span><br><span class="line">                 b -&gt; <span class="keyword">new</span> <span class="title class_">double</span>[]&#123;a, b, Math.sqrt(a * a + b * b)&#125;)</span><br><span class="line">            	)</span><br><span class="line">    		.filter(t -&gt; t[<span class="number">2</span>] % <span class="number">1</span> == <span class="number">0</span>);</span><br><span class="line">pythagoreanTriples.limit(<span class="number">5</span>).forEach(t-&gt;System.out.println(t[<span class="number">0</span>]+<span class="string">&quot;,&quot;</span>+ t[<span class="number">1</span>] + <span class="string">&quot;,&quot;</span> + t[<span class="number">2</span>]));</span><br></pre></td></tr></table></figure>
<h4 id="Optional简介">Optional简介</h4>
<blockquote>
<p><code>Optional&lt;T&gt;</code>类（<code>java.util.Optional</code>）是一个容器类，代表一个值存在或不存在。</p>
<p>在<a href="#findAny">上述代码中</a>，findAny存在什么元素都没有找到的可能，所以java8引入了<code>Optional&lt;T&gt;</code>,用来避免返回null的问题</p>
</blockquote>
<h3 id="测试">测试</h3>
<h4 id="测试1：filter">测试1：filter</h4>
<p><a href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81">根据示例代码</a>，<a href="#%E7%AD%9B%E9%80%89">结合filter</a>使用流筛选出前两个荤菜</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Dish&gt; collect = </span><br><span class="line">	menu.stream()</span><br><span class="line">		.filter(dish -&gt; dish.getType().equals(Dish.Type.MEAT))</span><br><span class="line">		.limit(2)</span><br><span class="line">		.collect(toList());</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Java/Java8/%E6%B5%8B%E8%AF%95%EF%BC%9A%E7%AD%9B%E9%80%89%E5%89%8D%E4%B8%A4%E4%B8%AA%E8%8D%A4%E8%8F%9C.png" alt></p>
<h4 id="测试2：map">测试2：map</h4>
<p><a href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81">根据示例代码</a>，<a href="#%E6%98%A0%E5%B0%84">结合映射</a></p>
<blockquote>
<p>(1)给定一个数字列表，如何返回一个由每个数的平方构成的列表呢？例如，给定[1, 2, 3, 4, 5]，应该返回[1, 4, 9, 16,25]。</p>
<p>(2) 给定两个数字列表，如何返回所有的数对呢？例如，给定列表[1, 2, 3]和列表[3, 4]，应该返回[(1, 3), (1, 4), (2, 3), (2,4), (3, 3), (3, 4)]。为简单起见，你可以用有两个元素的数组来代表数对</p>
<p>(3) 如何扩展前一个例子，只返回总和能被3整除的数对</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// (1)给定一个数字列表，如何返回一个由每个数的平方构成的列表呢？例如，给定[1, 2, 3, 4, 5]，应该返回[1, 4, 9, 16,25]。</span></span><br><span class="line">List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">List&lt;Integer&gt; collect = numbers.stream().map(n -&gt; n * n)</span><br><span class="line">    .collect(toList());</span><br><span class="line">System.out.println(<span class="string">&quot;collect = &quot;</span> + collect);</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Java/Java8/%E6%B5%8B%E8%AF%952%EF%BC%9A(1).png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// (2)给定两个数字列表，如何返回所有的数对呢？例如，给定列表[1, 2, 3]和列表[3, 4]，应该返回[(1, 3), (1, 4), (2, 3), (2,4), (3, 3), (3, 4)]。为简单起见，你可以用有两个元素的数组来代表数对</span></span><br><span class="line">List&lt;Integer&gt; numbers1 = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">List&lt;Integer&gt; numbers2 = Arrays.asList(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">List&lt;<span class="type">int</span>[]&gt; pairs =</span><br><span class="line">    numbers1.stream()</span><br><span class="line">    .flatMap(i -&gt; numbers2.stream()</span><br><span class="line">             .map(j -&gt; <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;i, j&#125;)</span><br><span class="line">            )</span><br><span class="line">    .collect(toList());</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Java/Java8/%E6%B5%8B%E8%AF%952%EF%BC%9A(2).png" alt></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// (3)如何扩展前一个例子，只返回总和能被3整除的数对</span><br><span class="line">List&lt;Integer&gt; numbers1 = Arrays.asList(1, 2, 3);</span><br><span class="line">List&lt;Integer&gt; numbers2 = Arrays.asList(3, 4);</span><br><span class="line">List&lt;int[]&gt; pairs =</span><br><span class="line">    numbers1.stream()</span><br><span class="line">    .flatMap(i -&gt;</span><br><span class="line">        numbers2.stream()</span><br><span class="line">            .filter(j -&gt; (i + j) % 3 == 0)</span><br><span class="line">            .map(j -&gt; new int[]&#123;i, j&#125;)</span><br><span class="line">    )</span><br><span class="line">    .collect(toList());</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Java/Java8/%E6%B5%8B%E8%AF%952%EF%BC%9A(3).png" alt></p>
<h4 id="测试3：reduce">测试3：reduce</h4>
<p><a href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81">根据示例代码</a>，结合<a href="#%E5%BD%92%E7%BA%A6-reduce">reduce</a>，数一数流中有多少个菜</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> menu.stream().map(d -&gt; <span class="number">1</span>).reduce(<span class="number">0</span>, (a, b) -&gt; a + b);</span><br></pre></td></tr></table></figure>
<p>等价于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> menu.stream().count();</span><br></pre></td></tr></table></figure>
<h4 id="综合测试">综合测试</h4>
<p>源代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Trader raoul = new Trader(&quot;Raoul&quot;, &quot;Cambridge&quot;);</span><br><span class="line">Trader mario = new Trader(&quot;Mario&quot;, &quot;Milan&quot;);</span><br><span class="line">Trader alan = new Trader(&quot;Alan&quot;, &quot;Cambridge&quot;);</span><br><span class="line">Trader brian = new Trader(&quot;Brian&quot;, &quot;Cambridge&quot;);</span><br><span class="line">List&lt;Transaction&gt; transactions = Arrays.asList(</span><br><span class="line">    new Transaction(brian, 2011, 300),</span><br><span class="line">    new Transaction(raoul, 2012, 1000),</span><br><span class="line">    new Transaction(raoul, 2011, 400),</span><br><span class="line">    new Transaction(mario, 2012, 710),</span><br><span class="line">    new Transaction(mario, 2012, 700),</span><br><span class="line">    new Transaction(alan, 2012, 950)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Trader</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String city;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Trader</span><span class="params">(String n, String c)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.name = n;</span><br><span class="line">        <span class="built_in">this</span>.city = c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCity</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.city;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Trader:&quot;</span>+<span class="built_in">this</span>.name + <span class="string">&quot; in &quot;</span> + <span class="built_in">this</span>.city;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Transaction</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Trader trader;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> year;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Transaction</span><span class="params">(Trader trader, <span class="type">int</span> year, <span class="type">int</span> value)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.trader = trader;</span><br><span class="line">        <span class="built_in">this</span>.year = year;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Trader <span class="title function_">getTrader</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.trader;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getYear</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.year;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&quot;</span> + <span class="built_in">this</span>.trader + <span class="string">&quot;, &quot;</span> +</span><br><span class="line">            <span class="string">&quot;year: &quot;</span>+<span class="built_in">this</span>.year+<span class="string">&quot;, &quot;</span> +</span><br><span class="line">            <span class="string">&quot;value:&quot;</span> + <span class="built_in">this</span>.value +<span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>问题：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// (1) 找出2011年发生的所有交易，并按交易额排序（从低到高）。</span></span><br><span class="line">        List&lt;Transaction&gt; tr2011 = transactions.stream()</span><br><span class="line">                .filter(transaction -&gt; transaction.getYear() == <span class="number">2011</span>)</span><br><span class="line">                .sorted(Comparator.comparing(Transaction::getValue))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        System.out.println(<span class="string">&quot;tr2011 = &quot;</span> + tr2011);</span><br><span class="line"><span class="comment">// (2) 交易员都在哪些不同的城市工作过？</span></span><br><span class="line">        List&lt;String&gt; cities = transactions.stream()</span><br><span class="line">                .map(transaction -&gt; transaction.getTrader().getCity())</span><br><span class="line">                .distinct()</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"><span class="comment">//        Set&lt;String&gt; cities = transactions.stream()</span></span><br><span class="line"><span class="comment">//                .map(transaction -&gt; transaction.getTrader().getCity())</span></span><br><span class="line"><span class="comment">//                .collect(Collectors.toSet());</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;cities = &quot; + cities);</span></span><br><span class="line">        System.out.println(<span class="string">&quot;cities = &quot;</span> + cities);</span><br><span class="line"></span><br><span class="line"><span class="comment">// (3) 查找所有来自于剑桥的交易员，并按姓名排序。</span></span><br><span class="line">        List&lt;Trader&gt; cambridgeTrader = transactions.stream()</span><br><span class="line">                .map(Transaction::getTrader)</span><br><span class="line">                .filter(trader -&gt; trader.getCity().equals(<span class="string">&quot;Cambridge&quot;</span>))</span><br><span class="line">                .distinct()</span><br><span class="line">                .sorted(Comparator.comparing(Trader::getName))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        System.out.println(<span class="string">&quot;cambridgeTrader = &quot;</span> + cambridgeTrader);</span><br><span class="line"><span class="comment">// (4) 返回所有交易员的姓名字符串，按字母顺序排序。</span></span><br><span class="line"><span class="comment">//        String reduce = transactions.stream()</span></span><br><span class="line"><span class="comment">//                .map(transaction -&gt; transaction.getTrader().getName())</span></span><br><span class="line"><span class="comment">//                .distinct()</span></span><br><span class="line"><span class="comment">//                .sorted()</span></span><br><span class="line"><span class="comment">//                .reduce(&quot;&quot;, (n1, n2) -&gt; n1 + n2);</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">reduce</span> <span class="operator">=</span> transactions.stream()</span><br><span class="line">                .map(transaction -&gt; transaction.getTrader().getName())</span><br><span class="line">                .distinct()</span><br><span class="line">                .sorted()</span><br><span class="line">                .collect(Collectors.joining());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;reduce = &quot;</span> + reduce);</span><br><span class="line"><span class="comment">// (5) 有没有交易员是在米兰工作的？</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">anyOneInMilan</span> <span class="operator">=</span> transactions.stream()</span><br><span class="line">                .anyMatch(transaction -&gt; transaction.getTrader().getCity().equals(<span class="string">&quot;Milan&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;anyOneInMilan = &quot;</span> + anyOneInMilan);</span><br><span class="line"><span class="comment">// (6) 打印生活在剑桥的交易员的所有交易额。</span></span><br><span class="line">        transactions.stream()</span><br><span class="line">                .filter(transaction -&gt; transaction.getTrader().getCity().equals(<span class="string">&quot;Cambridge&quot;</span>))</span><br><span class="line">                .map(Transaction::getValue)</span><br><span class="line">                .forEach(System.out::println);</span><br><span class="line"><span class="comment">// (7) 所有交易中，最高的交易额是多少？</span></span><br><span class="line">        Optional&lt;Integer&gt; max = transactions.stream()</span><br><span class="line">                .map(Transaction::getValue)</span><br><span class="line">                .reduce(Integer::max);</span><br><span class="line">        Optional&lt;Transaction&gt; max1 = transactions.stream().max(Comparator.comparing(Transaction::getValue));</span><br><span class="line">        System.out.println(<span class="string">&quot;max = &quot;</span> + max);</span><br><span class="line">        System.out.println(<span class="string">&quot;max1 = &quot;</span> + max1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// (8) 找到交易额最小的交易。</span></span><br><span class="line">        Optional&lt;Integer&gt; min = transactions.stream()</span><br><span class="line">                .map(Transaction::getValue)</span><br><span class="line">                .reduce(Integer::min);</span><br><span class="line">        Optional&lt;Transaction&gt; min1 = transactions.stream().min(Comparator.comparing(Transaction::getValue));</span><br><span class="line">        System.out.println(<span class="string">&quot;min = &quot;</span> + min);</span><br><span class="line">        System.out.println(<span class="string">&quot;min1 = &quot;</span> + min1);</span><br></pre></td></tr></table></figure>
<h4 id="测试树形数据">测试树形数据</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    ArrayList&lt;Zz&gt; source = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="type">Zz</span> <span class="variable">z1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Zz</span>();</span><br><span class="line">        z1.setId(Long.valueOf(i));</span><br><span class="line">        <span class="type">int</span> <span class="variable">i1</span> <span class="operator">=</span> i % <span class="number">3</span> == <span class="number">2</span> ? i - <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        z1.setPid(Long.valueOf(i1));</span><br><span class="line">        source.add(z1);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(source);</span><br><span class="line"></span><br><span class="line">    List&lt;Zz&gt; tree = source.stream()</span><br><span class="line">        .filter(item -&gt; item.getPid().equals(<span class="number">0</span>))</span><br><span class="line">        .map(item -&gt; &#123;</span><br><span class="line">            List&lt;Zz&gt; children = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            item.setChildren(children);</span><br><span class="line">            getChildren(children, item.getId(), source);</span><br><span class="line">            <span class="keyword">return</span> item;</span><br><span class="line">        &#125;)</span><br><span class="line">        .collect(Collectors.toList());</span><br><span class="line">    System.out.println(tree);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">getChildren</span><span class="params">(List&lt;Zz&gt; children, Long id, ArrayList&lt;Zz&gt; source)</span> &#123;</span><br><span class="line">    source.stream()</span><br><span class="line">        .filter(item -&gt; item.getPid().equals(id))</span><br><span class="line">        .map(item -&gt; &#123;</span><br><span class="line">            children.add(item);</span><br><span class="line">            List&lt;Zz&gt; child = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            item.setChildren(child);</span><br><span class="line">            getChildren(children, item.getId(), source);</span><br><span class="line">            <span class="keyword">return</span> item;</span><br><span class="line">        &#125;)</span><br><span class="line">        .collect(Collectors.toList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="函数式编程Function">函数式编程Function</h2>
<p>待续</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://solitaire-12.github.io/2024/03/18/Java/Java8/" data-id="cltxncw1n001ofgfm3wkkfba3" data-title="Java|Java8" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java8/" rel="tag">Java8</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Java/JVM" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/18/Java/JVM/" class="article-date">
  <time class="dt-published" datetime="2024-03-18T12:10:55.000Z" itemprop="datePublished">2024-03-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/18/Java/JVM/">Java|JVM</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1>类加载</h1>
<h2 id="加载过程">加载过程</h2>
<blockquote>
<p>将<code>java</code>文件<strong>编译</strong>成<code>class</code>字节码文件，通过<strong>类加载器</strong>写入到<code>JVM</code>虚拟机<strong>运行时数据区</strong>中。</p>
</blockquote>
<p><img src="/2024/03/18/Java/JVM/%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B.png" alt></p>
<h2 id="类加载流程">类加载流程</h2>
<p>​	类加载需要经历<strong>五个</strong>阶段，分别是<strong>加载，验证，准备，解析，初始化</strong>。其中加载，验证，准备，初始化这四个阶段发生的顺序时确定的，而解析阶段时不一定的。它在某些情况下可以在初始化阶段之后开始，这是为了支持<code>java</code>的运行时绑定（也称做动态绑定）。另外，这些阶段都是按<strong>顺序开始</strong>，而非按顺序进行或者完成。</p>
<p><img src="/2024/03/18/Java/JVM/%E7%B1%BB%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F(%E7%B1%BB%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B).png" alt></p>
<h2 id="类加载器">类加载器</h2>
<p><strong>双亲委派机制</strong>：</p>
<p>​	当某个类加载器需要加载某个<code>class</code>文件时，它首先会把这个任务委派给它的父级加载器，递归到顶级加载器。随后进行加载，倘若加载失败，由子类加载器进行加载。可以保证同一个<code>class</code>只被加载一次。</p>
<p><img src="/2024/03/18/Java/JVM/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8.png" alt></p>
<h1>运行时数据区</h1>
<p>绿色线程共享，蓝色线程私有</p>
<p><img src="/2024/03/18/Java/JVM/jdk6.png" alt><br>
<img src="/2024/03/18/Java/JVM/jdk7.png" alt><br>
<img src="/2024/03/18/Java/JVM/jdk8.png" alt><br>
<img src="/2024/03/18/Java/JVM/jdk8%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA.png" alt></p>
<ul>
<li><code>JDK6</code>：有永久代，静态变量存放在永久代上</li>
<li><code>JDK7</code>：有永久代，但是已经把运行时常量池，常量池存放在方法区中了，逐渐的减少永久代的使用。</li>
<li><code>JDK8</code>：无永久代，运行是常量池、类常量池都保存在元数据区，也就是<strong>元空间</strong> 。但是字符串常量池任然放在堆上。需要注意的是：元空间占用的是<strong>本地内存</strong>。</li>
</ul>
<h2 id="内存模型">内存模型</h2>
<h3 id="程序计数器">程序计数器</h3>
<p><strong>线程私有</strong>。Java虚拟机执行多线程时，由于CPU时间片限制，线程执行具有随机性，操作系统会一直切换执行不同指令，我们需要把切换时候线程执行的位置存入到PC寄存器中，等切回来的时候能够回到原来的位置继续执行。 任何时候，每个Java虚拟机都在执行单个方法的代码，即该线程的当前方法。如果该方法不是<code>Native</code>方法，即PC寄存器会记录当前正在执行的<code>java</code>虚拟机指令的地址，如果线程当前执行的方法是本地的，那么<code>java</code>虚拟机的PC寄存器的值就是<code>Undefined</code>。 <strong>程序计数器是唯一一个不会出现<code>OOM</code>的区域。</strong></p>
<h3 id="本地方法栈">本地方法栈</h3>
<p><strong>线程私有</strong>。提供虚拟机使用到本地<code>Native</code>方法，本地方法栈和虚拟机栈在有的虚拟机是合在一起的，例如Hot Spot虚拟机。</p>
<h3 id="栈">栈</h3>
<p><strong>线程私有</strong>，每个线程都有一个与线程同时创建的私有的虚拟机栈。虚拟机栈中存储栈帧，每个被线程调用的方法都会产生一个栈帧，栈帧中保存一个方法的状态信息，例如<strong>局部变量</strong>(存储方法内的局部变量)、<strong>操作数帧</strong>(用来计算临时存放变量)、<strong>方法出口</strong>(记录哪个方法的本方法)、<strong>动态链接</strong>(存放方法的元信息)等。调用一个方法就是执行一个栈帧的过程，一个方法调用完成，对应的栈帧就会出栈。</p>
<ul>
<li>如果线程执行所需栈深度大于Java虚拟机栈深度，就会抛出<code>StackOverFlowError</code>，其实方法调用的过程就是入栈和出栈的过程，如果一致入栈不出栈，就容易发生异常（递归调用）</li>
<li>如果Java虚拟机栈可以动态扩展，但是扩展大小的时候无法申请到足够的内存，则会抛出<code>OutOfMemoryError</code>。</li>
</ul>
<h3 id="堆">堆</h3>
<p><strong>线程共享</strong>。堆是<code>java</code>虚拟机管理内存最大的一块，在虚拟机启动时创建，所有线程共享，堆中的对象永远不会被显式释放，必须由<code>GC</code>回收，所以<code>GC</code>也主要回收堆中的对象实例，我们平常讨论的垃圾回收就是回收堆内存。堆可以处于物理上不连续的空间，可以固定大小，也可以动态扩展，通过参数<code>-Xms</code>和<code>-Xmx</code>两个参数控制堆的最小值和最大值。这里是**<code>OOM</code>异常的易发区**</p>
<p>分成新生代和老年代。</p>
<p>新生代又分成1个<code>Eden</code>区和2个<code>Survivor</code>区，默认比例<code>8:1:1</code></p>
<p>绝大多数对象在<code>Eden</code>区生成，**当Eden区填满，或者不满足新建一个对象时，触发<code>Young GC</code>。**将存活的对象放进<code>Survivor</code>。<code>Survivor</code>分成两块，用于每次<code>Young GC</code>时，将存活的对象统统复制进空的幸存区，将有数据的那块清空。</p>
<p>当一个对象在两个survivor区之间交换了一定次数之后，将对象拷贝到老年代。<strong>这个数量用<code>-XX:MaxTenuringThreshold</code>配置，默认值是15</strong></p>
<h3 id="方法区">方法区</h3>
<p><strong>线程共享</strong>，在虚拟机启动时创建，存储已经被虚拟机加载的类信息、常量、静态变量，即经编译器之后的数据(运行时常量池[存放<code>class</code>文件元信息描述，编译后的代码数据，引用类型数据，类文件常量池]、属性和方法数据)，以及方法和构造函数的代码，包括在类和实例初始化以及接口初始化使用的特殊方法，方法区在逻辑上是堆的一部分，但是它又有另一个别名叫非堆，目的是与堆区分开。方法区可以是固定大小，也可以根据计算需要进行扩展。如果方法区的内存无法满足分配请求时也会抛出<code>OutOfMemoryError</code>。</p>
<p><strong>永久代</strong></p>
<h3 id="元空间">元空间</h3>
<p><code>JDK8</code>使用元空间代替永久代（类元信息，字段，静态属性，方法，常量），同时运行时常量池等都移动到了元空间，字符串常量池在堆中。</p>
<p>元空间在<strong>本地内存</strong>中，它独立于运行时数据区，也不是Java虚拟机规范中定义的内存区域，它直接从操作系统中分配，因此不受堆大小影响。但是会受到本机总内存大小以及处理器寻址空间的限制，因此它也可能抛出<code>OOM</code>异常。</p>
<h1>垃圾回收</h1>
<h2 id="找到垃圾">找到垃圾</h2>
<p>​	两种方法判断对象是否需要销毁：</p>
<ul>
<li>
<p>引用计数法</p>
<p>​	为对象添加一个引用计数器，每当对象被引用，引用计数器加1。当引用失效，减一。计数器为零，代表该对象可以被回收。</p>
<p>​	**问题：**循环引用问题</p>
</li>
<li>
<p>可达性分析</p>
<p>​	通过一系列&quot;<code>GC Roots</code>&quot;的根节点开始，沿用引用链进行搜索，凡是在引用链上的，都不会被回收。</p>
<p>​	解决了循环依赖问题。</p>
</li>
</ul>
<h2 id="垃圾回收算法-GC">垃圾回收算法-<code>GC</code></h2>
<h3 id="标记-清除算法">标记-清除算法</h3>
<p><img src="/2024/03/18/Java/JVM/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%89%8D.png" alt></p>
<ol>
<li>首先在堆内存扫描一遍，然后把灰色区域的对象标记</li>
<li>继续扫描，扫描的同时将被标记的对象统一回收回收后：</li>
</ol>
<p><img src="/2024/03/18/Java/JVM/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%90%8E-%E6%A0%87%E8%AE%B0%E6%B8%85%E9%99%A4.png" alt></p>
<ul>
<li>回收之后，产生大量不连续的内存碎片。</li>
<li>需要进行标记，清除两个过程，效率不高。</li>
</ul>
<h3 id="复制算法">复制算法</h3>
<p>​	将内存区域分成大小一样的两块，每次只是用一块，<code>gc</code>之后将对象复制到另一块，然后一次性清理掉这块内存。</p>
<p>回收前：</p>
<p><img src="/2024/03/18/Java/JVM/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%89%8D-%E5%A4%8D%E5%88%B6%E7%AE%97%E6%B3%95.png" alt></p>
<p>回收后：</p>
<p><img src="/2024/03/18/Java/JVM/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%90%8E-%E5%A4%8D%E5%88%B6%E7%AE%97%E6%B3%95.png" alt></p>
<p>复制算法的缺点是牺牲了一半的内存空间，有点浪费。复制算法在<code>JVM</code>中的体现就是：<code>java</code>堆内存做了几次划分，<code>Hot Spot</code>虚拟机中<code>Eden</code>和<code>Survivor</code>的比例是<code>Eden:S0:S1=8:1:1</code>，将<code>Survivor</code>分成了两个区域<code>S0</code>和<code>S1</code>来进行赋值，这种做法是为了弥补原始复制算法直接将一半空间作为空闲空间的浪费。IBM公司表示：<code>Young</code>区有98%的对象都是朝生夕死的，生命周期极短，所以说一次<code>GC</code>下来存活的对象很少，所以没必要用一半空间来复制。</p>
<h3 id="标记-整理算法">标记-整理算法</h3>
<p>​	标记-整理算法就是为了老年代而设计的算法，标记-整理算法和标记-清除算法的区别在最后一步，标记-整理不会直接对对象清理，而是进行移动，将存活对象移动到一端，然后清理掉边界以外的对象。</p>
<p>回收前：</p>
<p><img src="/2024/03/18/Java/JVM/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%89%8D.png" alt></p>
<p>回收后：</p>
<p><img src="/2024/03/18/Java/JVM/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%90%8E-%E6%A0%87%E8%AE%B0%E6%95%B4%E7%90%86.png" alt></p>
<h3 id="分代收集算法">分代收集算法</h3>
<p>​	目前主流的商业虚拟机都是采用分代收集算法，这种算法就是上面三种算法的结合。新生代采用复制算法，老年代采用标记-整理或标记-清除算法。</p>
<h2 id="垃圾收集器">垃圾收集器</h2>
<h3 id="Serial-和Serial-Old-收集器">Serial 和Serial Old 收集器</h3>
<p><img src="/2024/03/18/Java/JVM/Serial%E5%92%8CSerial_Old%E6%94%B6%E9%9B%86%E5%99%A8.png" alt></p>
<p>Serial 单线程，<code>GC</code>时Stop The World（<code>STW</code>），暂停所有用户线程。</p>
<p>Serial Old 单线程，作用与老年代。标记整理算法</p>
<p>​	<strong>优点</strong>：单线程收集效率高</p>
<p>​	<strong>缺点</strong>：需要<code>STW</code>，暂停所有用户线程</p>
<p>​	<strong>算法</strong>： Serial采用复制算法 ；Serial Old采用标记-整理算法</p>
<h3 id="ParNew收集器">ParNew收集器</h3>
<p><img src="/2024/03/18/Java/JVM/ParNew_GC%E6%94%B6%E9%9B%86%E5%99%A8.png" alt></p>
<p>​	<code>ParNew</code>收集器是Serial收集器的多线程版本，实现并行收集， 原理跟Serial一致（并行指的是多个<code>GC</code>线程并行，但是用户线程还是暂停，并发指的是用户线程和<code>GC</code>线程同时执行）。<code>ParNew</code>默认开启和CPU个数相同的线程数进行回收。</p>
<p>​	<strong>优点</strong>：在多CPU时，比Serial的效率高。</p>
<p>​	<strong>缺点</strong>：还是需要<code>STW</code>，单CPU时比Serial效率低</p>
<p>​	<strong>算法</strong>：复制算法</p>
<h3 id="Parallel-Scavenge-收集器">Parallel Scavenge 收集器</h3>
<p>新生代收集器，也是<strong>复制算法</strong>，和<code>ParNew</code>一样并行的多线程收集器，更关注系统的吞吐量<br>[吞吐量=(运行用户代码的时间) / (运行用户代码的时间+ <code>GC</code> 时间) ]<br>Parallel Scavenge 提供了两个参数用于精确控制吞吐量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-XX:MaxGCPauseMillis //GC最大停顿毫秒数，必须大于0</span><br><span class="line">-XX:GCTimeRation //设置吞吐量大小，大于0小于100，默认值为99</span><br><span class="line">-XX:+UseAdaptiveSizePolicy //开启自适应策略</span><br><span class="line"></span><br><span class="line">//你会不会觉得把MaxGCPauseMillis设置小点就会让GC速度变快？</span><br><span class="line">//答案是否定的，如果设置时间过小，Parallel Scavenge 会牺牲吞吐量和新生代空间来交换，</span><br><span class="line">//比如新生代400Mb需要GC时间为100ms，设置成50ms了，那么就会把新生代调小为200Mb，这样肯定时间就降下来了，</span><br><span class="line">//然而这种操作可能会降低吞吐量，原先10s触发一次GC，每次100ms，</span><br><span class="line">//	修改时间后变成5s触发一次GC，每次70ms，那么10ms触发两次GC的时间变成了140ms，吞吐量反而降低。</span><br></pre></td></tr></table></figure>
<h3 id="Parallel-Old-收集器">Parallel Old 收集器</h3>
<p>是Parallel Scavenge 的老年代版本，使用<strong>标记-整理算法</strong>，因为Parallel Scavenge 无法和<code>CMS</code>搭配使用，所以只能和Serial Old。自从Parallel Old出现，就有了Parallel Scavenge +Parallel Old的组合，这是<code>JDK8</code>使用的，注重吞吐量的一组收集器。</p>
<p><img src="/2024/03/18/Java/JVM/Parallel_Scavenge%E5%92%8CParallel_Old-GC%E6%94%B6%E9%9B%86%E5%99%A8.png" alt></p>
<h3 id="CMS收集器">CMS收集器</h3>
<p><img src="/2024/03/18/Java/JVM/CMS%E6%94%B6%E9%9B%86%E5%99%A8.png" alt></p>
<p>这是优化<code>GC</code>停顿时间为目标的收集器，并发回收（仍然需要<code>STW</code>，但是时间很短）。通过<code>-XX:+UseMarkSweepGC</code>启用。<code>CMS</code>基于<strong>标记-清除算法</strong>实现。整个过程分为四步：</p>
<ul>
<li>初始标记：需要<code>STW</code>，标记<code>GC Roots</code>对象。</li>
<li>并发标记：这个阶段可以和用户线程一起进行，分为三步：
<ol>
<li>根据第一步找到的<code>GC Roots</code>开始搜索跟<code>GC Roots</code>相连的对象。</li>
<li>预清理：处理并发标记之后发生变化的对象。</li>
<li>可被终止的预清理：有一个abort 触发条件，该阶段存在的目的是希望能发生一次<code>Young GC</code>，来减少<code>Young</code>区对象数量，降低重新标记的工作量，因为重新标记会扫描整个堆内空间，可以通过参数<br><code>-XX:+CMSScavangeBeforeRemark</code> 控制在重新标记前发生一次<code>Young GC</code>，默认为<code>false</code>。</li>
</ol>
</li>
<li>重新标记：需要<code>STW</code>，这个阶段是为了修正在阶段2标记之后产生变化的对象。</li>
<li>并发清除：和用户线程同时进行，开始正式清理垃圾，此阶段产生的垃圾留待下次清除。</li>
</ul>
<p><strong>优点</strong>：并发收集，低停顿</p>
<p><strong>缺点</strong>：产生大量碎片，并发阶段会降低吞吐量</p>
<h3 id="G1收集器">G1收集器</h3>
<p>​	<code>G1</code>是以优化<code>GC</code>停顿时间为目标的收集器，它尝试以高概率满足<code>GC</code>停顿时间为目标，同时实现高吞吐量。在<code>G1</code>中，将堆的整个内存布局做了修改，在<code>G1</code>中整个堆划分为多个大小相等的独立区域Region，虽然在逻辑上还保留了新生代和老年代，但是物理上已经隔离了，<code>G1</code>的堆内存布局如下<a target="_blank" rel="noopener" href="https://blog.csdn.net/java_beautiful/article/details/125483273">图</a> ：</p>
<p><img src="/2024/03/18/Java/JVM/G1%E6%94%B6%E9%9B%86%E5%99%A8%E5%86%85%E5%AD%98%E5%9B%BE.png" alt></p>
<p>上图智能柜被划分成一组大小相同的Region，每个Region都是连续的虚拟内存范围，<code>G1</code>可以知道哪个Region区域内大部分是空的，这样就可以在每次允许的收集时间内优先回收价值最大的Region区域（根据回收所获得的空间大小以及回收需要的时间综合考虑）所以这就是<code>G1</code>叫做Garbage-First的原因。<strong><code>G1</code>是<code>JDK8</code>默认的垃圾收集器</strong>。<code>G1</code>的工作流程和<code>CMS</code>很相似，区别在最后的步骤。也有四步：</p>
<ul>
<li>初始标记：需要<code>STW</code>，标记下<code>GC Roots</code>关联的对象，并且修改TAMS（Next Top at Mark Start）的值，使得下一阶段并发运行时，能在正确可用的Region中创建对象。</li>
<li>并发标记：和<code>CMS</code>一样，主要是进行<code>GC Roots</code>的向下搜索，找出存活对象进行标记。</li>
<li>最终标记：需要<code>STW</code>，和<code>CMS</code>一样，这个阶段是修正并发标记期间因用户程序运行而导致变动的对象。</li>
<li>筛选回收：对各个Region的回收价值和成本进行排序，根据用户期望的<code>GC</code>停顿时间制定回收计划。</li>
</ul>
<p><img src="/2024/03/18/Java/JVM/G1%E6%94%B6%E9%9B%86%E5%99%A8.png" alt></p>
<p><code>G1</code>的第一个重点是为运行需要大堆且<code>GC</code>延迟有限的应用程序的用户提供解决方案，这就意味着堆大小约为<code>6G</code>或更大，并且稳定且可预测的暂停时间低于0.5秒。如果应用程序具备以下特性，可以考虑切换到<code>G1</code>收集器：</p>
<ul>
<li>超过50%的Java堆被实时数据占用</li>
<li>对象分配率或提升率差异很大</li>
<li>当前应用程序<code>GC</code>停顿时间超过0.5秒，又想缩短停顿时间</li>
</ul>
<h3 id="各收集对比">各收集对比</h3>
<table>
<thead>
<tr>
<th>收集器</th>
<th>串行/并行/并发</th>
<th>新生代/老年代</th>
<th>算法</th>
<th>目标</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td>Serial</td>
<td>串行</td>
<td>新生代</td>
<td>复制</td>
<td>响应速度优先</td>
<td>单CPU环境下的Client模式</td>
</tr>
<tr>
<td>Serial Old</td>
<td>串行</td>
<td>老年代</td>
<td>标记-整理</td>
<td>响应速度优先</td>
<td>单CPU环境下的Client模式，<code>CMS</code>的后备预案</td>
</tr>
<tr>
<td>ParNew</td>
<td>并行</td>
<td>新生代</td>
<td>复制</td>
<td>响应速度优先</td>
<td>多CPU环境时在Server模式下与<code>CMS</code>配合使用</td>
</tr>
<tr>
<td>Parallel Scavenge</td>
<td>并行</td>
<td>新生代</td>
<td>复制</td>
<td>吞吐量优先</td>
<td>在后台运算且不需要太多交互的任务</td>
</tr>
<tr>
<td>Parallel</td>
<td>并行</td>
<td>老年代</td>
<td>标记-整理</td>
<td>吞吐量优先</td>
<td>在后台运算且不需要太多交互的任务</td>
</tr>
<tr>
<td>CMS</td>
<td>并发</td>
<td>老年代</td>
<td>标记-清除</td>
<td>响应速度优先</td>
<td>集中在互联网网站 或 B/S系统服务端中的Java应用</td>
</tr>
<tr>
<td>G1</td>
<td>并发</td>
<td>兼顾</td>
<td>标记-整理+复制</td>
<td>响应速度优先</td>
<td>面向服务端应用</td>
</tr>
</tbody>
</table>
<ul>
<li>串行收集器：Serial和Serial Old单线程收集，适用于内存较小的嵌入式设备。</li>
<li>并行收集器【吞吐量优先】：Parallel Scavenge + Parallel Old，适用于科学计算、后台处理等场景。</li>
<li>并发收集器【GC停顿时间优先】：CMS和G1，适用于对时间有要求的场景，例如Web应用。</li>
</ul>
<h2 id="调优">调优</h2>
<p>所谓调优就是设置一个合理的JVM参数，适配当前系统运行。</p>
<h3 id="参数">参数</h3>
<p>可以分成三类：标准参数，-X参数，-XX参数</p>
<ul>
<li>
<p>标准参数</p>
<p>​	以&quot;-&quot;开头的参数称为标准参数，是任何一个JDK版本都支持的，比较稳定，不会随版本更新和改变。例如-version,-help,-server。</p>
</li>
<li>
<p>-X参数</p>
<p>​	以-X开头的参数是在特定版本<code>HotSpot</code>支持的命令。JDK版本变化之后，参数可能变化，这个参数用的较少。</p>
</li>
<li>
<p>-XX参数</p>
<p>-XX是不稳定的参数，也是主要参数，分为Boolean类型和非Boolean类型。</p>
<ul>
<li>
<p>Boolean类型</p>
<p><code>-XX:[+-]&lt;name&gt;：+或-表示启用或者禁用name属性</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">表示启用CMS垃圾收集器</span><br><span class="line">-XX:+UseConcMarkSweepGC</span><br><span class="line">表示启用G1垃圾收集器</span><br><span class="line">-XX:+UseG1GC</span><br><span class="line">表示打印出所有的JVM参数信息</span><br><span class="line">-XX:+PrintFlagsFinal</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>非Boolean类型</p>
<p><code>-XX&lt;name&gt;=&lt;value&gt;：name表示属性，value表示属性对应的值</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">设置最大永久代空间大小为5M</span><br><span class="line">-XX:MaxMetaspaceSize=5M</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>其他</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-Xms1000 等价于 -XX:InitialHeapSize=1000</span><br><span class="line">-Xmx1000 等价于 -XX:MaxHeapSize=1000</span><br><span class="line">-Xss1000 等价于 -XX:ThreadStackSize=1000</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h4 id="常用参数">常用参数</h4>
<table>
<thead>
<tr>
<th>设置</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-XX:ClCompilerCount=3</td>
<td>最大并行编译数，大于1时可以提高编译速度，但会影响系统稳定性</td>
</tr>
<tr>
<td>-XX:InitialHeapSize=100m</td>
<td>初始堆大小，可以简写为-Xms100</td>
</tr>
<tr>
<td>-XX:MaxHeapSize</td>
<td>最大堆大小，可以简写为-Xmx100</td>
</tr>
<tr>
<td>-XX:NewSize=20m</td>
<td>设置年轻代大小</td>
</tr>
<tr>
<td>-XX:MaxNewSize</td>
<td>设置年轻代最大值</td>
</tr>
<tr>
<td>-XX:OldSize=50m</td>
<td>设置老年代大小</td>
</tr>
<tr>
<td>-XX:MetaspaceSize=50m</td>
<td>设置方法区大小，JDK8才有，用元空间代替方法区</td>
</tr>
<tr>
<td>-XX:+UseParallelGC</td>
<td>设置Parallel Scavenge作为新生代收集器<br>系统默认会选择Parallel Old作为老年代收集器</td>
</tr>
<tr>
<td>-XX:NewRatio</td>
<td>新生代和老年代的比值<br>比如 -XX:NewRatio=4表示新生代：老年代=1：4</td>
</tr>
<tr>
<td>-XX:SurvivorRatio</td>
<td>表示Survivor区和Eden区的比值<br>比如-XX:SurvivorRatio=8表示（S0或S1):Eden=1:8</td>
</tr>
</tbody>
</table>
<h3 id="命令监控工具">命令监控工具</h3>
<p>待续</p>
<hr>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/index.html">Java SE Specifications (oracle.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6941242430737874974">JVM万字总结 - 掘金 (juejin.cn)</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7007353422550663198">【JVM系列8】JVM知识点总览 - 掘金 (juejin.cn)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/java_collect/article/details/102922764">JVM8内存模型_jdk8内存模型_余生之君的博客-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiaofuge/p/14244755.html">JVM内存模型总结，有各版本JDK对比、有元空间OOM监控案例、有Java版虚拟机，综合实践学习！ - 小傅哥 - 博客园 (cnblogs.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/297001119">https://zhuanlan.zhihu.com/p/297001119</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://solitaire-12.github.io/2024/03/18/Java/JVM/" data-id="cltxncw1i000sfgfmdrj7d910" data-title="Java|JVM" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JVM/" rel="tag">JVM</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Server/内网穿透" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/18/Server/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" class="article-date">
  <time class="dt-published" datetime="2024-03-18T09:05:07.000Z" itemprop="datePublished">2024-03-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/18/Server/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/">内网穿透</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="环境：">环境：</h2>
<ul>
<li>服务端阿里云： CentOS 8.5.2111</li>
<li>客户端：windows 11 / windows 10</li>
<li>frp 0.42</li>
</ul>
<h2 id="第一步">第一步</h2>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/fatedier/frp/releases">官网下载frp软件</a></li>
<li>笔者使用的版本：链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1cjmUiOY8iRIywx6whkhRdg">https://pan.baidu.com/s/1cjmUiOY8iRIywx6whkhRdg</a> 提取码：gatr</li>
</ol>
<h2 id="第二步">第二步</h2>
<p><strong>服务端：</strong></p>
<ol>
<li>
<p>将 <code>frp_0.42.0_linux_amd64.tar.gz</code>压缩包传给linux</p>
</li>
<li>
<p>进入到文件存放目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf frp_0.42.0_linux_amd64.tar.gz</span><br><span class="line">cd frp_0.42.0_linux_amd64/</span><br><span class="line">vi frps.ini</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Server/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/frps.ini%E6%96%87%E4%BB%B6.png" alt="frps.ini文件"></p>
<p>💬<strong>提醒</strong>：只要<code>bind_port</code>的7000端口没被占用，一般不建议修改。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./frps <span class="literal">-c</span> frps.ini <span class="comment">#临时启动</span></span><br><span class="line">nohup ./frps <span class="literal">-c</span> frps.ini &amp; <span class="comment">#永久启动</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>客户端：</strong></p>
<ol>
<li>
<p>解压 <code>frp_0.42.0_windows_amd64.zip</code> ，注意关闭一下杀毒软件。</p>
</li>
<li>
<p>打开之后，修改<code>frpc.ini</code>文件。</p>
<p><img src="/2024/03/18/Server/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/frpc.ini%E6%96%87%E4%BB%B6.png" alt="frpc.ini文件"></p>
<p>💬<strong>解释</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ssh]定义一个使用 [type] 协议的url: [local_ip]:[local_port]被[server_addr]:[remote_port]代理了。</span><br><span class="line">即：用户访问 [server_addr]:[remote_port] 后，服务器&quot;跳转&quot;到 [local_ip]:[local_port]</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>启动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入cmd</span></span><br><span class="line">frpc.exe -c frpc.ini</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>⚠️<strong>注意</strong>：假如你将<code>frpc.ini</code>中的<code>remote_port</code>和<code>frps.ini</code>中的<code>dashboard_port</code>配置成一样的话，启动客户端的时候，就会出现 <code>[ssh] start error: port unavailable</code>。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://solitaire-12.github.io/2024/03/18/Server/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" data-id="cltxncw1j0010fgfm43whfpkd" data-title="内网穿透" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AE%89%E8%A3%85/" rel="tag">安装</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Server/项目上线" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/18/Server/%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/" class="article-date">
  <time class="dt-published" datetime="2024-03-18T08:25:07.000Z" itemprop="datePublished">2024-03-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/18/Server/%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/">linux|项目部署</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="环境">环境</h3>
<p>系统：Centos 8.4.2105</p>
<p>docker : 24.0.5</p>
<p>nginx: nginx/1.25.1</p>
<h3 id="后端">后端</h3>
<h4 id="宿主机安装">宿主机安装</h4>
<ol>
<li>后端达成jar包上传到服务器</li>
<li><code>ps -ef | grep java</code>查看有没有在运行的java项目，要是端口冲突的话，直接<code>kill</code></li>
<li><code>java -jar</code>没有问题之后，<code>nohup java -jar x.jar &gt; x.log 2&gt;&amp;1 &amp; </code>就可以。</li>
</ol>
<h4 id="docker内部">docker内部</h4>
<ol>
<li>
<p>创建Dockerfile</p>
<p><img src="/2024/03/18/Server/%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/Dockerfile%E4%BD%8D%E7%BD%AE.png" alt></p>
</li>
<li>
<p><code>vi Dockerfile</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM openjdk:8</span><br><span class="line">ADD 18080.jar test.jar</span><br><span class="line">EXPOSE 18080</span><br><span class="line">ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;test.jar&quot;]</span><br></pre></td></tr></table></figure>
<p>描述：</p>
<p><code>FROM openjdk:8</code>:拉取基础镜像</p>
<p><code>ADD 18080.jar test.jar</code>：将<code>18080.jar</code>复制到镜像中，重命名成<code>test.jar</code></p>
<p><code>EXPOSE 18080</code>:声明端口，一般指定的是jar运行端口</p>
<p><code>ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;test.jar&quot;]</code>：容器启动之后执行的命令</p>
<p><code>MAINTAINER xx</code>: 添加作者信息</p>
</li>
<li>
<p>构建镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t test .</span><br></pre></td></tr></table></figure>
<p>描述：</p>
<p><code>test</code>：镜像名称</p>
<p><code>.</code>：表示<code>Dockerfile</code>在当前目录下</p>
</li>
<li>
<p>查看镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>运行进行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --restart=always --name test -p 8080:18080 test</span><br></pre></td></tr></table></figure>
<p>描述：</p>
<p><code>-d</code>：表示后台运行容器</p>
<p><code>--restart=always</code>：代表容器在停止或者服务器开机之后会自动重启</p>
<p><code>--name test</code>:命名成test</p>
<p><code>-p 8080:18080</code>：端口映射 [宿主机端口]:[容器端口]</p>
<p><code>test</code>:运行的镜像</p>
</li>
<li>
<p>更新jar包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp new.jar [容器id]:/test.jar</span><br></pre></td></tr></table></figure>
<p>随后，重启容器</p>
</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/841076">Docker部署可执行jar包-阿里云开发者社区 (aliyun.com)</a></p>
<h3 id="前端">前端</h3>
<h4 id="项目打包">项目打包</h4>
<p>打包之后将项目放在挂载的<code>html</code>目录下,详情查看<a href="docker%E5%AE%89%E8%A3%85nginx">docker安装nginx</a> | <a href="2024/03/18/Server/docker%E5%AE%89%E8%A3%85nginx/">线上跳转↗️</a></p>
<p>挂载项目：</p>
<p><img src="/2024/03/18/Server/%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/%E6%8C%82%E8%BD%BD%E9%A1%B9%E7%9B%AE.png" alt></p>
<p>将项目挂载到文件夹<code>a</code>里边</p>
<p><img src="/2024/03/18/Server/%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/%E5%89%8D%E7%AB%AF%E6%89%93%E5%8C%85%E7%BB%93%E6%9E%9C.png" alt></p>
<h4 id="配置nginx">配置nginx</h4>
<p>修改前的配置文件：</p>
<p><img src="/2024/03/18/Server/%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/%E4%BF%AE%E6%94%B9%E5%89%8Dnginx%E9%85%8D%E7%BD%AE.png" alt></p>
<p>修改后的配置文件：<img src="/2024/03/18/Server/%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/%E4%BF%AE%E6%94%B9nginx%E9%85%8D%E7%BD%AE.png" alt></p>
<h5 id="注意事项"><strong>注意事项</strong></h5>
<ol>
<li>
<p>要是<code>jar</code>运行在宿主机(安装<code>dokcer</code>的服务器)上面的话，建议<code>server_name</code>修改成<code>172.17.0.1</code>(这个地址是安装<code>docker</code>之后，默认生成的网桥)。用<code>ifconfig -a</code>可以查看<code>Linux</code> 的<code>IP</code>地址</p>
<p><img src="/2024/03/18/Server/%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/docker%E7%BD%91%E6%A1%A5.png" alt></p>
</li>
<li>
<p>不要在 <code>localtion / &#123;&#125;</code>这块里边取写 <code>proxy_pass</code>，会网页都打不开。</p>
</li>
<li>
<p>倘若有第二个前端项目的话，同样<code>html</code>目录下面创建挂载文件夹并把文件存放在内。然后在写一个<code>localtion</code>块，修改一下<code>listen</code>端口。例如：</p>
<p><img src="/2024/03/18/Server/%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/%E5%A4%9A%E5%89%8D%E7%AB%AF%E9%85%8D%E7%BD%AE.png" alt></p>
</li>
</ol>
<h2 id="问题排查：">问题排查：</h2>
<h3 id="1-运行jar包服务器卡死">1.运行jar包服务器卡死</h3>
<p><strong>环境：</strong></p>
<ul>
<li>
<p>系统：8.5.2111</p>
</li>
<li>
<p>配置：2核2G</p>
</li>
<li>
<p>目标服务：</p>
<p>Minio，frp，docker，nginx，redis，mysql，前端，后端</p>
</li>
</ul>
<p><strong>场景：</strong></p>
<blockquote>
<p>服务器运行着Minio，frp，nginx，docker，redis-docker，mysql-docker，前端。将后端jar包上传服务器，<code>nohup java -jar xx &amp;</code>连接服务器的xshell敲命令执行卡顿，无法重连xshell，随后服务器卡死。</p>
</blockquote>
<p><strong>问题排查：</strong></p>
<p>观察到xshell命令还是能敲上的，但是键盘敲击之后，xshell界面很久才能回显，执行也要很久很久，而且重连xshell也是很长时间连接不上。</p>
<p><mark><strong>类似这种反应时间很长，系统出现&quot;死机&quot;的现象，多半是内存不足。</strong></mark></p>
<p>为啥会内存不足呢？</p>
<p>重启服务器之后，重新配置好需要的环境，不运行jar包。查看<code>top</code>命令：</p>
<p><img src="/2024/03/18/Server/%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/top%E5%91%BD%E4%BB%A4.png" alt="图片是问题修复之后截的"></p>
<p>观察其中的进程，注意到有个<code>mysqld</code>占用了22.4%的存，整台服务器的内存是2G，实际运行起来指定没有2048M的，以及其他一些系统支持的，算亏损10%，空闲内存实际约为1850M。刨去<code>mysqld</code>默认占用的1G，实际占用的450M。要想维系整个系统的开支，可用内存也就1G左右。</p>
<p>将jar在开发环境上运行，观察到其占用了开发电脑1000-1300M的内存资源。</p>
<p>解决方案也就呼之欲出了：</p>
<ul>
<li>
<p>配置<code>java -jar</code>JVM的参数，限定其内存大小。例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Xmx512M -jar xxx.jar</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>从mysqld上解决，<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_46978507/article/details/129950706">参考1</a>   <a target="_blank" rel="noopener" href="https://blog.csdn.net/paulwang040/article/details/128580776">参考2</a></p>
<p>它是Performance Schema 的大小，默认配置是1G。</p>
</li>
</ul>
<p>此时基本解决内存不足问题。</p>
<h3 id="2-jar包运行，CPU飙升至190">2.jar包运行，CPU飙升至190%</h3>
<p><strong>环境：</strong></p>
<ul>
<li>
<p>系统：8.5.2111</p>
</li>
<li>
<p>配置：2核2G</p>
</li>
<li>
<p>目标服务器任务进程：</p>
<p>Minio，frp，docker，nginx，redis，mysql，前端，后端</p>
</li>
</ul>
<p><strong>场景：</strong></p>
<p>服务器运行着Minio，frp，nginx，docker，redis-docker，mysql-docker，前端。将后端jar包上传服务器，<code>nohup java -jar xx &amp;</code>后，top指令监测到cpu处在190%附近。</p>
<p><strong>问题排查：</strong></p>
<ol>
<li>
<p>通过 命令，查看该进程下的线程资源占用情况。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -mp pid -o THREAD,tid,time</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>将其中%CPU高的线程TID进行转码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print &quot;%x\n&quot; TID</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>通过查看cpu占用很高的线程状态</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstack PID | grep [0xTID:第二部转码出来的tid]</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>如果线程还处在Runnable状态，那么通过<code>jstack</code>去找到详情。如果问题指向代码，那就去修改。</p>
</li>
<li>
<p>到此基本解决。</p>
</li>
</ol>
<p>当然，还有个情况就是，正常启动直接拉爆，随后又静默到1%的，查线程高占用的都停止了，这种情况下，倘若后期还有MQ什么的其他服务要用的话，建议将升级到4核cpu。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://solitaire-12.github.io/2024/03/18/Server/%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/" data-id="cltxncw1k0014fgfmfvx822s5" data-title="linux|项目部署" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%83%A8%E7%BD%B2/" rel="tag">部署</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Server/docker安装RabbitMQ" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85RabbitMQ/" class="article-date">
  <time class="dt-published" datetime="2024-03-18T08:23:07.000Z" itemprop="datePublished">2024-03-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85RabbitMQ/">linux|docker安装RabbitMQ</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>工欲善其事必先利其器：windows<a target="_blank" rel="noopener" href="https://erlang.org/download/">下载erlang</a>  <a target="_blank" rel="noopener" href="https://www.rabbitmq.com/download.html">下载RabbitMQ</a>  <a target="_blank" rel="noopener" href="https://mirrors.huaweicloud.com/rabbitmq-server/">下载RabbitMQ源码</a></p>
<h2 id="Docker安装RabbitMQ">Docker安装RabbitMQ</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找rabbitmq镜像</span></span><br><span class="line">docker search rabbitmq</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pull镜像</span></span><br><span class="line">docker pull rabbitmq</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行mq</span> </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># -p [暴露的宿主机端口]:[docker内部端口]</span></span></span><br><span class="line">docker run -d --hostname rabbit-test --name rabbit \</span><br><span class="line">-p 15672:15672 -p 5672:5672 rabbitmq</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入mq镜像</span></span><br><span class="line">docker exec -it [容器id] /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行</span></span><br><span class="line">rabbitmq-plugins enable rabbitmq_management</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">默认账号密码：guest：guest</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://solitaire-12.github.io/2024/03/18/Server/docker%E5%AE%89%E8%A3%85RabbitMQ/" data-id="cltxncw1e000ffgfmgpsy9ron" data-title="linux|docker安装RabbitMQ" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AE%89%E8%A3%85/" rel="tag">安装</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Server/docker安装nginx" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85nginx/" class="article-date">
  <time class="dt-published" datetime="2024-03-18T08:23:07.000Z" itemprop="datePublished">2024-03-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85nginx/">linux|docker安装nginx</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>centos8.5.2111</p>
<h3 id="拉取镜像">拉取镜像</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx</span><br></pre></td></tr></table></figure>
<h3 id="创建Nginx挂载目录">创建Nginx挂载目录</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p mytools/nginx/conf</span><br><span class="line"><span class="built_in">mkdir</span> -p mytools/nginx/log</span><br><span class="line"><span class="built_in">mkdir</span> -p mytools/nginx/html</span><br></pre></td></tr></table></figure>
<h3 id="将容器中的配置复制到宿主机">将容器中的配置复制到宿主机</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成容器</span></span><br><span class="line">docker run --name nginx -p 9001:80 -d nginx</span><br><span class="line"><span class="comment"># 将容器nginx.conf文件复制到宿主机</span></span><br><span class="line">docker <span class="built_in">cp</span> nginx:/etc/nginx/nginx.conf /mytools/nginx/conf/nginx.conf</span><br><span class="line"><span class="comment"># 将容器conf.d文件夹下内容复制到宿主机</span></span><br><span class="line">docker <span class="built_in">cp</span> nginx:/etc/nginx/conf.d /mytools/nginx/conf/conf.d</span><br><span class="line"><span class="comment"># 将容器中的html文件夹复制到宿主机</span></span><br><span class="line">docker <span class="built_in">cp</span> nginx:/usr/share/nginx/html /mytools/nginx/</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85nginx/%E5%88%9D%E6%AC%A1%E5%90%AF%E5%8A%A8nginx%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png" alt></p>
<h3 id="正式启动nginx">正式启动nginx</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">-p 9002:80 \</span><br><span class="line">--name nginx \</span><br><span class="line">-v /mytools/nginx/conf/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">-v /mytools/nginx/conf/conf.d:/etc/nginx/conf.d \</span><br><span class="line">-v /mytools/nginx/log:/var/log/nginx \</span><br><span class="line">-v /mytools/nginx/html:/usr/share/nginx/html \</span><br><span class="line">-d nginx:latest</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85nginx/%E6%AD%A3%E5%BC%8F%E5%90%AF%E5%8A%A8nginx.png" alt></p>
<h3 id="查看运行状态">查看运行状态</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:9002</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85nginx/%E6%9C%AC%E5%9C%B0%E8%AE%BF%E9%97%AEnginx.png" alt></p>
<p><strong>公网IP访问</strong></p>
<p><img src="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85nginx/%E5%85%AC%E7%BD%91ip%E8%AE%BF%E9%97%AEnginx.png" alt></p>
<h3 id="修改html查看运行状态">修改html查看运行状态</h3>
<p><img src="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85nginx/%E4%BF%AE%E6%94%B9index_html%E6%96%87%E4%BB%B6.png" alt></p>
<h3 id="查看是否生效">查看是否生效</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart nginx</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85nginx/%E9%87%8D%E5%90%AF%E6%9F%A5%E7%9C%8B%E4%BF%AE%E6%94%B9%E6%98%AF%E5%90%A6%E7%94%9F%E6%95%88.png" alt></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://solitaire-12.github.io/2024/03/18/Server/docker%E5%AE%89%E8%A3%85nginx/" data-id="cltxncw1g000lfgfmdms2htnx" data-title="linux|docker安装nginx" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AE%89%E8%A3%85/" rel="tag">安装</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Server/docker安装redis" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85redis/" class="article-date">
  <time class="dt-published" datetime="2024-03-18T08:22:07.000Z" itemprop="datePublished">2024-03-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85redis/">linux|docker安装redis</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>centos 8.5.2111</p>
<h3 id="拉取redis镜像">拉取redis镜像</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull redis</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85redis/pull.png" alt></p>
<h3 id="准备redis的配置文件">准备redis的配置文件</h3>
<p>官网： <a target="_blank" rel="noopener" href="http://www.redis.cn/download.html">redis 6.0.6 下载 – Redis中国用户组（CRUG）</a></p>
<p><img src="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85redis/%E5%AE%98%E7%BD%91%E4%B8%8B%E8%BD%BD%E4%B8%80%E4%B8%AAredis.png" alt></p>
<p>把<code>redis.conf</code>上传到服务器redis安装的位置</p>
<p><img src="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85redis/%E5%A4%87%E4%BB%BDredis.conf%E6%96%87%E4%BB%B6.png" alt></p>
<h3 id="配置redis-conf文件">配置redis.conf文件</h3>
<blockquote>
<p><code>bind 127.0.0.1</code> #注释掉这部分，使redis可以外部访问<br>
<code>daemonize no</code>#用守护线程的方式启动<br>
<code>requirepass 你的密码</code>#给redis设置密码<br>
<code>appendonly yes</code>#redis持久化　　默认是no<br>
<code>tcp-keepalive 300</code> #防止出现远程主机强迫关闭了一个现有的连接的错误 默认是300</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">注释掉这部分，使redis可以外部访问</span></span><br><span class="line">bind 127.0.0.1 </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">用守护线程的方式启动</span></span><br><span class="line">daemonize no</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">给redis设置密码</span></span><br><span class="line">requirepass 你的密码</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">redis持久化　　默认是no</span></span><br><span class="line">appendonly yes</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">防止出现远程主机强迫关闭了一个现有的连接的错误 默认是300</span></span><br><span class="line">tcp-keepalive 300 </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">:/[findword] 在vi命令中寻找文字，最好加个空格去找</span></span><br></pre></td></tr></table></figure>
<h3 id="创建本地与docker映射目录">创建本地与docker映射目录</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir mytools/redis</span><br><span class="line">mkdir mytools/redis/data</span><br></pre></td></tr></table></figure>
<p><strong>把上述的redis.conf复制到redis目录下</strong></p>
<h3 id="启动">启动</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -p 6379:6379 --name redis -v /mytools/redis/redis.conf:/etc/redis/redis.conf  -v /mytools/redis/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>-p 6379:6379</code>:把容器内的6379端口映射到宿主机6379端口<code>-v /data/redis/redis.conf:/etc/redis/redis.conf</code>：把宿主机配置好的redis.conf放到容器内的这个位置中<code>-v /data/redis/data:/data</code>：把redis持久化的数据在宿主机内显示，做数据备份<code>redis-server /etc/redis/redis.conf</code>：这个是关键配置，让redis不是无配置启动，而是按照这个redis.conf的配置启动<code>–appendonly yes</code>：redis启动后数据持久化</p>
</blockquote>
<p><strong>查看日志</strong>：<code>docker logs redis</code></p>
<p><img src="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85redis/redis%E5%90%AF%E5%8A%A8%E6%88%90%E5%8A%9F.png" alt></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://solitaire-12.github.io/2024/03/18/Server/docker%E5%AE%89%E8%A3%85redis/" data-id="cltxncw1h000pfgfm2nhc9duw" data-title="linux|docker安装redis" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AE%89%E8%A3%85/" rel="tag">安装</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Server/minio" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/18/Server/minio/" class="article-date">
  <time class="dt-published" datetime="2024-03-18T08:22:07.000Z" itemprop="datePublished">2024-03-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/18/Server/minio/">linux|docker安装minio</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>环境 centos 8.5</p>
<h3 id="创建minio文件夹">创建minio文件夹</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /mytools/minio</span><br><span class="line">cd /mytools/minio</span><br></pre></td></tr></table></figure>
<h3 id="wget下载minio">wget下载minio</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.minio.io/server/minio/release/linux-amd64/minio</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Server/minio/wgetMinIO.png" alt></p>
<h3 id="创建日志，授权">创建日志，授权</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> minio.log</span><br><span class="line"><span class="built_in">chmod</span> 777 minio</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Server/minio/%E6%8E%88%E6%9D%83+%E6%97%A5%E5%BF%97.png" alt></p>
<h3 id="启动minio">启动minio</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 后面跟着的是静态文件挂载目录</span></span><br><span class="line">./minio server /opt/minio/data </span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Server/minio/%E5%90%AF%E5%8A%A8%E9%94%99%E8%AF%AF.png" alt></p>
<p>**问题原因：**笔者编写文档之前，运行过minio，这里显示端口占用问题，kill一下进程就好了</p>
<p><img src="/2024/03/18/Server/minio/%E5%90%AF%E5%8A%A8%E6%88%90%E5%8A%9F.png" alt="启动成功"></p>
<p><strong>红字</strong>：警告:检测到默认凭据’minioadmin:minioadmin’，我们建议您使用’MINIO_ROOT_USER’和’MINIO_ROOT_PASSWORD’环境变量更改这些值</p>
<h4 id="配置环境变量">配置环境变量</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line">	<span class="built_in">export</span> MINIO_ROOT_USER=fileadmin</span><br><span class="line">	<span class="built_in">export</span> MINIO_ROOT_PASSWORD=fileadmin</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>
<h3 id="指定端口重启minio">指定端口重启minio</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 有需求自己换成自己的存放目录</span><br><span class="line">./minio server /opt/minio/data --console-address &quot;:9050&quot;</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Server/minio/%E6%88%90%E5%8A%9F%E8%AE%BF%E9%97%AE.png" alt></p>
<h3 id="设置后台启动">设置后台启动</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim start.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">nohup</span> /mytools/minio/minio server /opt/minio/data --console-address <span class="string">&quot;:9050&quot;</span> &gt; /opt/minio/minio.log 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line">sh start.sh</span><br></pre></td></tr></table></figure>
<h3 id="问题：">问题：</h3>
<p>minio服务部署在云端时，配置服务网站要用公网ip，不然没办法回显</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://solitaire-12.github.io/2024/03/18/Server/minio/" data-id="cltxncw1j000wfgfm9gud7okf" data-title="linux|docker安装minio" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AE%89%E8%A3%85/" rel="tag">安装</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Server/docker安装mysql8" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85mysql8/" class="article-date">
  <time class="dt-published" datetime="2024-03-18T08:21:07.000Z" itemprop="datePublished">2024-03-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85mysql8/">linux|docker安装mysql8</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="拉取镜像">拉取镜像</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:8.0.23</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85mysql8/%E6%8B%89%E5%8F%96MySQL8%E9%95%9C%E5%83%8F.png" alt></p>
<h3 id="检查镜像">检查镜像</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85mysql8/%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8MySQL8%E9%95%9C%E5%83%8F.png" alt></p>
<h3 id="启动镜像">启动镜像</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -p 3306:3306 --name mysql  \</span><br><span class="line">-v /usr/local/docker/mysql/mysql-files:/var/lib/mysql-files \</span><br><span class="line">-v /usr/local/docker/mysql/conf:/etc/mysql \</span><br><span class="line">-v /usr/local/docker/mysql/logs:/var/log/mysql \</span><br><span class="line">-v /usr/local/docker/mysql/data:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root \</span><br><span class="line">-d mysql:8.0.23</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=root -d mysql</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85mysql8/%E5%90%AF%E5%8A%A8mysql.png" alt></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs -f mysql #查看启动日志</span><br></pre></td></tr></table></figure>
<h3 id="进入容器">进入容器</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mysql bash</span><br></pre></td></tr></table></figure>
<h1>方法二</h1>
<h3 id="下载mysql">下载mysql</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:8.0.23</span><br></pre></td></tr></table></figure>
<h3 id="创建文件夹做挂载">创建文件夹做挂载</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//创建文件夹做挂载</span><br><span class="line">mkdir -p /mydata/mysql/conf</span><br><span class="line">mkdir /mydata/mysql/data</span><br><span class="line">//创建my.cnf配置文件</span><br><span class="line">vi /mydata/mysql/conf/my.cnf</span><br></pre></td></tr></table></figure>
<h4 id="my-cnf添加如下内容">my.cnf添加如下内容</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">user=mysql</span><br><span class="line">character-set-server=utf8</span><br><span class="line">default_authentication_plugin=mysql_native_password</span><br><span class="line">secure_file_priv=/var/lib/mysql</span><br><span class="line">expire_logs_days=7</span><br><span class="line">sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION</span><br><span class="line">max_connections=1000</span><br><span class="line">lower_case_table_names=1</span><br><span class="line"> </span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line"> </span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<p>你的数据库要是从本地windows上迁移到linux的话，<code>lower_case_table_names=1</code>,这个一定要加上，不然的话要重新部署，很麻烦</p>
<h3 id="创建容器">创建容器</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">--restart=always \</span><br><span class="line">--privileged=true \</span><br><span class="line">-p 3306:3306 --name mysql \</span><br><span class="line">-v /mydata/mysql/log:/var/log/mysql \</span><br><span class="line">-v /mydata/mysql/data:/var/lib/mysql \</span><br><span class="line">-v /mydata/mysql/conf/my.cnf:/etc/mysql/my.cnf \</span><br><span class="line">-v /mydata/mysql/conf/conf.d:/etc/mysql/conf.d \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root \</span><br><span class="line">-d mysql:8.0</span><br></pre></td></tr></table></figure>
<h3 id="进入容器-2">进入容器</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mysql bash</span><br></pre></td></tr></table></figure>
<h3 id="进入mysql">进入mysql</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line"># 查看数据库</span><br><span class="line">show databases</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://solitaire-12.github.io/2024/03/18/Server/docker%E5%AE%89%E8%A3%85mysql8/" data-id="cltxncw1f000ifgfm41knhev0" data-title="linux|docker安装mysql8" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AE%89%E8%A3%85/" rel="tag">安装</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Server/GitMaven" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/18/Server/GitMaven/" class="article-date">
  <time class="dt-published" datetime="2024-03-18T08:20:07.000Z" itemprop="datePublished">2024-03-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/18/Server/GitMaven/">linux|安装Git/Maven</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="安装Git">安装Git</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y git</span><br></pre></td></tr></table></figure>
<p><strong>校验安装结果</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git --version</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Server/GitMaven/git%E7%89%88%E6%9C%AC.png" alt></p>
<h2 id="安装maven">安装maven</h2>
<ol>
<li>
<p>创建存放maven的文件夹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /mytools/maven</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>将<code>maven.gz</code>上传到该文件夹</p>
<p><img src="/2024/03/18/Server/GitMaven/%E4%B8%8A%E4%BC%A0maven.png" alt></p>
</li>
<li>
<p>解压</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf apache-maven-3.9.4-bin.tar.gz</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>配置环境变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line">    <span class="built_in">export</span> MAVEN_HOME=/mydata/maven/apache-maven-3.9.4</span><br><span class="line">    <span class="built_in">export</span> PATH=<span class="variable">$&#123;MAVEN_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>验证</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn -v</span><br></pre></td></tr></table></figure>
<p><img src="/2024/03/18/Server/GitMaven/maven%E7%89%88%E6%9C%AC.png" alt></p>
</li>
<li>
<p>配置阿里镜像(看情况)</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://solitaire-12.github.io/2024/03/18/Server/GitMaven/" data-id="cltxncw1a0006fgfm2nap0tmm" data-title="linux|安装Git/Maven" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AE%89%E8%A3%85/" rel="tag">安装</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%88%9D%E5%A7%8B/">初始</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8D%9A%E5%AE%A2/">博客</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/" rel="tag">JVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java8/" rel="tag">Java8</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%89%E8%A3%85/" rel="tag">安装</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%83%A8%E7%BD%B2/" rel="tag">部署</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/JVM/" style="font-size: 10px;">JVM</a> <a href="/tags/Java8/" style="font-size: 10px;">Java8</a> <a href="/tags/%E5%AE%89%E8%A3%85/" style="font-size: 20px;">安装</a> <a href="/tags/%E9%83%A8%E7%BD%B2/" style="font-size: 10px;">部署</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">三月 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/03/18/Java/Java8/">Java|Java8</a>
          </li>
        
          <li>
            <a href="/2024/03/18/Java/JVM/">Java|JVM</a>
          </li>
        
          <li>
            <a href="/2024/03/18/Server/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/">内网穿透</a>
          </li>
        
          <li>
            <a href="/2024/03/18/Server/%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/">linux|项目部署</a>
          </li>
        
          <li>
            <a href="/2024/03/18/Server/docker%E5%AE%89%E8%A3%85RabbitMQ/">linux|docker安装RabbitMQ</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 solitaire-12<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>